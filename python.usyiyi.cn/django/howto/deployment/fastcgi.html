<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>如何与FastCGI, SCGI或AJP一起使用Django — Django 1.8.2 中文文档</title>
<link href="../../_static/default.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.8.2.dev20150513143415',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
<script src="../../_static/jquery.js" type="text/javascript"></script>
<script src="../../_static/underscore.js" type="text/javascript"></script>
<script src="../../_static/doctools.js" type="text/javascript"></script>
<link href="../../index.html" rel="top" title="Django 1.8.2.dev20150513143415 documentation"/>
<link href="index.html" rel="up" title="Deploying Django"/>
<link href="http://python.usyiyi.cn/django/howto/upgrade-version.html" rel="next" title="Upgrading Django to a newer version"/>
<link href="checklist.html" rel="prev" title="Deployment checklist"/>
<script src="http://python.usyiyi.cn/django/templatebuiltins.js" type="text/javascript"></script>
<script type="text/javascript">
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='http://python.usyiyi.cn/django/howto/deployment/&quot;&#32;+&#32;base&#32;+&#32;&quot;#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='http://python.usyiyi.cn/django/howto/deployment/&quot;&#32;+&#32;base&#32;+&#32;&quot;#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);
</script>
</head>
<body>
<div class="document">
<div class="yui-t6" id="custom-doc">
<div id="hd">
<h1><font id="108">Django 1.8.2.dev20150513143415 documentation</font></h1>
<div id="global-nav">
<a href="../../index.html" title="Home page">Home</a>  |
        <a href="../../contents.html" title="Table of contents">Table of contents</a>  |
        <a href="../../genindex.html" title="Global index">Index</a>  |
        <a href="../../py-modindex.html" title="Module index">Modules</a>
</div>
<div class="nav">
    « <a href="checklist.html" title="Deployment checklist">previous</a>
     |
    <a accesskey="U" href="http://python.usyiyi.cn/django/howto/index.html" title="&amp;#8220;How-to&amp;#8221; guides">up</a>
   |
    <a href="http://python.usyiyi.cn/django/howto/upgrade-version.html" title="Upgrading Django to a newer version">next</a> »</div>
</div>
<div id="bd">
<div id="yui-main">
<div class="yui-b">
<div class="yui-g" id="howto-deployment-fastcgi">
<div class="section" id="s-how-to-use-django-with-fastcgi-scgi-or-ajp">
<span id="how-to-use-django-with-fastcgi-scgi-or-ajp"></span><h1><font id="109">How to use Django with FastCGI, SCGI, or AJP</font><a class="headerlink" href="fastcgi.html#how-to-use-django-with-fastcgi-scgi-or-ajp" title="Permalink to this headline">¶</a></h1>
<div class="deprecated">
<p><font id="1"><span class="versionmodified">Deprecated since version 1.7: </span></font><font id="2">FastCGI support is deprecated and will be removed in Django 1.9.</font></p>
</div>
<p><font id="3">Although <a class="reference internal" href="wsgi/index.html"><em>WSGI</em></a> is the preferred deployment platform for Django, many people use shared hosting, on which protocols such as FastCGI, SCGI or AJP are the only viable options.</font></p>
<div class="admonition-note admonition">
<p class="first admonition-title"><font id="4">Note</font></p>
<p class="last"><font id="5">This document primarily focuses on FastCGI. </font><font id="6">Other protocols, such as SCGI and AJP, are also supported, through the <tt class="docutils literal"><span class="pre">flup</span></tt> Python package. </font><font id="7">See the <a class="reference internal" href="fastcgi.html#protocols">Protocols</a> section below for specifics about SCGI and AJP.</font></p>
</div>
<p><font id="8">Essentially, FastCGI is an efficient way of letting an external application serve pages to a Web server. </font><font id="9">The Web server delegates the incoming Web requests (via a socket) to FastCGI, which executes the code and passes the response back to the Web server, which, in turn, passes it back to the client’s Web browser.</font></p>
<p><font id="10">Like WSGI, FastCGI allows code to stay in memory, allowing requests to be served with no startup time. </font><font id="11">While e.g. <a class="reference internal" href="wsgi/modwsgi.html"><em>mod_wsgi</em></a> can either be configured embedded in the Apache Web server process or as a separate daemon process, a FastCGI process never runs inside the Web server process, always in a separate, persistent process.</font></p>
<div class="admonition-why-run-code-in-a-separate-process admonition">
<p class="first admonition-title"><font id="12">Why run code in a separate process?</font></p>
<p><font id="13">The traditional <tt class="docutils literal"><span class="pre">mod_*</span></tt> arrangements in Apache embed various scripting languages (most notably PHP, Python and Perl) inside the process space of your Web server. </font><font id="14">Although this lowers startup time – because code doesn’t have to be read off disk for every request – it comes at the cost of memory use.</font></p>
<p class="last"><font id="15">Due to the nature of FastCGI, it’s even possible to have processes that run under a different user account than the Web server process. </font><font id="16">That’s a nice security benefit on shared systems, because it means you can secure your code from other users.</font></p>
</div>
<div class="section" id="s-prerequisite-flup">
<span id="prerequisite-flup"></span><h2><font id="110">Prerequisite: flup</font><a class="headerlink" href="fastcgi.html#prerequisite-flup" title="Permalink to this headline">¶</a></h2>
<p><font id="17">Before you can start using FastCGI with Django, you’ll need to install <a class="reference external" href="http://www.saddi.com/software/flup/">flup</a>, a Python library for dealing with FastCGI. </font><font id="18">Version 0.5 or newer should work fine.</font></p>
</div>
<div class="section" id="s-starting-your-fastcgi-server">
<span id="starting-your-fastcgi-server"></span><h2><font id="111">Starting your FastCGI server</font><a class="headerlink" href="fastcgi.html#starting-your-fastcgi-server" title="Permalink to this headline">¶</a></h2>
<p><font id="19">FastCGI operates on a client-server model, and in most cases you’ll be starting the FastCGI process on your own. </font><font id="20">Your Web server (be it Apache, lighttpd, or otherwise) only contacts your Django-FastCGI process when the server needs a dynamic page to be loaded. </font><font id="21">Because the daemon is already running with the code in memory, it’s able to serve the response very quickly.</font></p>
<div class="admonition-note admonition">
<p class="first admonition-title"><font id="22">Note</font></p>
<p class="last"><font id="23">If you’re on a shared hosting system, you’ll probably be forced to use Web server-managed FastCGI processes. </font><font id="24">See the section below on running Django with Web server-managed processes for more information.</font></p>
</div>
<p><font id="25">A Web server can connect to a FastCGI server in one of two ways: It can use either a Unix domain socket (a “named pipe” on Win32 systems), or it can use a TCP socket. </font><font id="26">What you choose is a manner of preference; </font><font id="27">a TCP socket is usually easier due to permissions issues.</font></p>
<p><font id="28">To start your server, first change into the directory of your project (wherever your <a class="reference internal" href="../../ref/django-admin.html"><em>manage.py</em></a> is), and then run the <a class="reference internal" href="../../ref/django-admin.html#django-admin-runfcgi"><tt class="xref std std-djadmin docutils literal"><span class="pre">runfcgi</span></tt></a> command:</font></p>
<div class="highlight-bash"><div class="highlight"><pre>./manage.py runfcgi <span class="o">[</span>options<span class="o">]</span>
</pre></div>
</div>
<p><font id="29">If you specify <tt class="docutils literal"><span class="pre">help</span></tt> as the only option after <a class="reference internal" href="../../ref/django-admin.html#django-admin-runfcgi"><tt class="xref std std-djadmin docutils literal"><span class="pre">runfcgi</span></tt></a>, it’ll display a list of all the available options.</font></p>
<p><font id="30">You’ll need to specify either a <a class="reference internal" href="../../ref/django-admin.html#django-admin-option-socket"><tt class="xref std std-djadminopt docutils literal"><span class="pre">socket</span></tt></a>, a <a class="reference internal" href="../../ref/django-admin.html#django-admin-option-protocol"><tt class="xref std std-djadminopt docutils literal"><span class="pre">protocol</span></tt></a> or both <a class="reference internal" href="../../ref/django-admin.html#django-admin-option-host"><tt class="xref std std-djadminopt docutils literal"><span class="pre">host</span></tt></a> and <a class="reference internal" href="../../ref/django-admin.html#django-admin-option-port"><tt class="xref std std-djadminopt docutils literal"><span class="pre">port</span></tt></a>. </font><font id="31">Then, when you set up your Web server, you’ll just need to point it at the host/port or socket you specified when starting the FastCGI server. </font><font id="32">See the <a class="reference internal" href="fastcgi.html#examples">examples</a>, below.</font></p>
<div class="section" id="s-protocols">
<span id="protocols"></span><h3><font id="118">Protocols</font><a class="headerlink" href="fastcgi.html#protocols" title="Permalink to this headline">¶</a></h3>
<p><font id="33">Django supports all the protocols that <a class="reference external" href="http://www.saddi.com/software/flup/">flup</a> does, namely <a class="reference external" href="http://www.fastcgi.com/">fastcgi</a>, <a class="reference external" href="http://python.ca/scgi/protocol.txt">SCGI</a> and <a class="reference external" href="http://tomcat.apache.org/connectors-doc/ajp/ajpv13a.html">AJP1.3</a> (the Apache JServ Protocol, version 1.3). </font><font id="34">Select your preferred protocol by using the <a class="reference internal" href="../../ref/django-admin.html#django-admin-option-protocol"><tt class="xref std std-djadminopt docutils literal"><span class="pre">protocol=&lt;protocol_name&gt;</span></tt></a> option with <tt class="docutils literal"><span class="pre">./manage.py</span> <span class="pre">runfcgi</span></tt> – where <tt class="docutils literal"><span class="pre">&lt;protocol_name&gt;</span></tt> may be one of: <tt class="docutils literal"><span class="pre">fcgi</span></tt> (the default), <tt class="docutils literal"><span class="pre">scgi</span></tt> or <tt class="docutils literal"><span class="pre">ajp</span></tt>. </font><font id="35">For example:</font></p>
<div class="highlight-bash"><div class="highlight"><pre>./manage.py runfcgi <span class="nv">protocol</span><span class="o">=</span>scgi
</pre></div>
</div>
</div>
<div class="section" id="s-examples">
<span id="examples"></span><h3><font id="119">Examples</font><a class="headerlink" href="fastcgi.html#examples" title="Permalink to this headline">¶</a></h3>
<p><font id="36">Running a threaded server on a TCP port:</font></p>
<div class="highlight-bash"><div class="highlight"><pre>./manage.py runfcgi <span class="nv">method</span><span class="o">=</span>threaded <span class="nv">host</span><span class="o">=</span>127.0.0.1 <span class="nv">port</span><span class="o">=</span>3033
</pre></div>
</div>
<p><font id="37">Running a preforked server on a Unix domain socket:</font></p>
<div class="highlight-bash"><div class="highlight"><pre>./manage.py runfcgi <span class="nv">method</span><span class="o">=</span>prefork <span class="nv">socket</span><span class="o">=</span>/home/user/mysite.sock <span class="nv">pidfile</span><span class="o">=</span>django.pid
</pre></div>
</div>
<div class="admonition-socket-security admonition">
<p class="first admonition-title"><font id="38">Socket security</font></p>
<p class="last"><font id="39">Django’s default umask requires that the web server and the Django fastcgi process be run with the same group <strong>and</strong> user. </font><font id="40">For increased security, you can run them under the same group but as different users. </font><font id="41">If you do this, you will need to set the umask to 0002 using the <tt class="docutils literal"><span class="pre">umask</span></tt> argument to <tt class="docutils literal"><span class="pre">runfcgi</span></tt>.</font></p>
</div>
<p><font id="42">Run without daemonizing (backgrounding) the process (good for debugging):</font></p>
<div class="highlight-bash"><div class="highlight"><pre>./manage.py runfcgi <span class="nv">daemonize</span><span class="o">=</span><span class="nb">false </span><span class="nv">socket</span><span class="o">=</span>/tmp/mysite.sock <span class="nv">maxrequests</span><span class="o">=</span>1
</pre></div>
</div>
</div>
<div class="section" id="s-stopping-the-fastcgi-daemon">
<span id="stopping-the-fastcgi-daemon"></span><h3><font id="120">Stopping the FastCGI daemon</font><a class="headerlink" href="fastcgi.html#stopping-the-fastcgi-daemon" title="Permalink to this headline">¶</a></h3>
<p><font id="43">If you have the process running in the foreground, it’s easy enough to stop it: Simply hitting <tt class="docutils literal"><span class="pre">Ctrl-C</span></tt> will stop and quit the FastCGI server. </font><font id="44">However, when you’re dealing with background processes, you’ll need to resort to the Unix <tt class="docutils literal"><span class="pre">kill</span></tt> command.</font></p>
<p><font id="45">If you specify the <a class="reference internal" href="../../ref/django-admin.html#django-admin-option-pidfile"><tt class="xref std std-djadminopt docutils literal"><span class="pre">pidfile</span></tt></a> option to <a class="reference internal" href="../../ref/django-admin.html#django-admin-runfcgi"><tt class="xref std std-djadmin docutils literal"><span class="pre">runfcgi</span></tt></a>, you can kill the running FastCGI daemon like this:</font></p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">kill</span> <span class="sb">`</span>cat <span class="nv">$PIDFILE</span><span class="sb">`</span>
</pre></div>
</div>
<p><font id="46">...where <tt class="docutils literal"><span class="pre">$PIDFILE</span></tt> is the <tt class="docutils literal"><span class="pre">pidfile</span></tt> you specified.</font></p>
<p><font id="47">To easily restart your FastCGI daemon on Unix, try this small shell script:</font></p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="c"># Replace these three settings.</span>
<span class="nv">PROJDIR</span><span class="o">=</span><span class="s2">"/home/user/myproject"</span>
<span class="nv">PIDFILE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PROJDIR</span><span class="s2">/mysite.pid"</span>
<span class="nv">SOCKET</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PROJDIR</span><span class="s2">/mysite.sock"</span>

<span class="nb">cd</span> <span class="nv">$PROJDIR</span>
<span class="k">if</span> <span class="o">[</span> -f <span class="nv">$PIDFILE</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">kill</span> <span class="sb">`</span>cat -- <span class="nv">$PIDFILE</span><span class="sb">`</span>
    rm -f -- <span class="nv">$PIDFILE</span>
<span class="k">fi</span>

<span class="nb">exec</span> /usr/bin/env - <span class="se">\</span>
  <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="s2">"../python:.."</span> <span class="se">\</span>
  ./manage.py runfcgi <span class="nv">socket</span><span class="o">=</span><span class="nv">$SOCKET</span> <span class="nv">pidfile</span><span class="o">=</span><span class="nv">$PIDFILE</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-apache-setup">
<span id="apache-setup"></span><h2><font id="112">Apache setup</font><a class="headerlink" href="fastcgi.html#apache-setup" title="Permalink to this headline">¶</a></h2>
<p><font id="48">To use Django with Apache and FastCGI, you’ll need Apache installed and configured, with <a class="reference external" href="http://www.fastcgi.com/mod_fastcgi/docs/mod_fastcgi.html">mod_fastcgi</a> installed and enabled. </font><font id="49">Consult the Apache documentation for instructions.</font></p>
<p><font id="50">Once you’ve got that set up, point Apache at your Django FastCGI instance by editing the <tt class="docutils literal"><span class="pre">httpd.conf</span></tt> (Apache configuration) file. </font><font id="51">You’ll need to do two things:</font></p>
<ul class="simple">
<li><font id="132">Use the <tt class="docutils literal"><span class="pre">FastCGIExternalServer</span></tt> directive to specify the location of your FastCGI server.</font></li>
<li><font id="133">Use <tt class="docutils literal"><span class="pre">mod_rewrite</span></tt> to point URLs at FastCGI as appropriate.</font></li>
</ul>
<div class="section" id="s-specifying-the-location-of-the-fastcgi-server">
<span id="specifying-the-location-of-the-fastcgi-server"></span><h3><font id="121">Specifying the location of the FastCGI server</font><a class="headerlink" href="fastcgi.html#specifying-the-location-of-the-fastcgi-server" title="Permalink to this headline">¶</a></h3>
<p><font id="52">The <tt class="docutils literal"><span class="pre">FastCGIExternalServer</span></tt> directive tells Apache how to find your FastCGI server. </font><font id="53">As the <a class="reference external" href="http://www.fastcgi.com/mod_fastcgi/docs/mod_fastcgi.html#FastCgiExternalServer">FastCGIExternalServer docs</a> explain, you can specify either a <tt class="docutils literal"><span class="pre">socket</span></tt> or a <tt class="docutils literal"><span class="pre">host</span></tt>. </font><font id="54">Here are examples of both:</font></p>
<div class="highlight-apache"><div class="highlight"><pre><span class="c"># Connect to FastCGI via a socket / named pipe.</span>
<span class="nb">FastCGIExternalServer</span> <span class="sx">/home/user/public_html/mysite.fcgi</span> -socket <span class="sx">/home/user/mysite.sock</span>

<span class="c"># Connect to FastCGI via a TCP host/port.</span>
<span class="nb">FastCGIExternalServer</span> <span class="sx">/home/user/public_html/mysite.fcgi</span> -host <span class="m">127.0.0.1</span>:3033
</pre></div>
</div>
<p><font id="55">In either case, the file <tt class="docutils literal"><span class="pre">/home/user/public_html/mysite.fcgi</span></tt> doesn’t actually have to exist. </font><font id="56">It’s just a URL used by the Web server internally – a hook for signifying which requests at a URL should be handled by FastCGI. </font><font id="57">(More on this in the next section.)</font></p>
</div>
<div class="section" id="s-using-mod-rewrite-to-point-urls-at-fastcgi">
<span id="using-mod-rewrite-to-point-urls-at-fastcgi"></span><h3><font id="122">Using mod_rewrite to point URLs at FastCGI</font><a class="headerlink" href="fastcgi.html#using-mod-rewrite-to-point-urls-at-fastcgi" title="Permalink to this headline">¶</a></h3>
<p><font id="58">The second step is telling Apache to use FastCGI for URLs that match a certain pattern. </font><font id="59">To do this, use the <a class="reference external" href="http://httpd.apache.org/docs/2.0/mod/mod_rewrite.html">mod_rewrite</a> module and rewrite URLs to <tt class="docutils literal"><span class="pre">mysite.fcgi</span></tt> (or whatever you specified in the <tt class="docutils literal"><span class="pre">FastCGIExternalServer</span></tt> directive, as explained in the previous section).</font></p>
<p><font id="60">In this example, we tell Apache to use FastCGI to handle any request that doesn’t represent a file on the filesystem and doesn’t start with <tt class="docutils literal"><span class="pre">/media/</span></tt>. </font><font id="61">This is probably the most common case, if you’re using Django’s admin site:</font></p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nt">&lt;VirtualHost</span> <span class="s">12.34.56.78</span><span class="nt">&gt;</span>
  <span class="nb">ServerName</span> example.com
  <span class="nb">DocumentRoot</span> <span class="sx">/home/user/public_html</span>
  <span class="nb">Alias</span> <span class="sx">/media</span> <span class="sx">/home/user/python/django/contrib/admin/media</span>
  <span class="nb">RewriteEngine</span> <span class="k">On</span>
  <span class="nb">RewriteRule</span> ^/(media.*)$ /$1 [QSA,L,PT]
  <span class="nb">RewriteCond</span> %{REQUEST_FILENAME} !-f
  <span class="nb">RewriteRule</span> ^/(.*)$ <span class="sx">/mysite.fcgi/</span>$1 [QSA,L]
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</div>
<p><font id="62">Django will automatically use the pre-rewrite version of the URL when constructing URLs with the <a class="reference internal" href="../../ref/templates/builtins.html#std:templatetag-url"><tt class="xref std std-ttag docutils literal"><span class="pre">{%</span> <span class="pre">url</span> <span class="pre">%}</span></tt></a> template tag (and similar methods).</font></p>
</div>
<div class="section" id="s-using-mod-fcgid-as-alternative-to-mod-fastcgi">
<span id="using-mod-fcgid-as-alternative-to-mod-fastcgi"></span><h3><font id="123">Using mod_fcgid as alternative to mod_fastcgi</font><a class="headerlink" href="fastcgi.html#using-mod-fcgid-as-alternative-to-mod-fastcgi" title="Permalink to this headline">¶</a></h3>
<p><font id="63">Another way to serve applications through FastCGI is by using Apache’s <a class="reference external" href="http://httpd.apache.org/mod_fcgid/">mod_fcgid</a> module. </font><font id="64">Compared to mod_fastcgi mod_fcgid handles FastCGI applications differently in that it manages the spawning of worker processes by itself and doesn’t offer something like <tt class="docutils literal"><span class="pre">FastCGIExternalServer</span></tt>. </font><font id="65">This means that the configuration looks slightly different.</font></p>
<p><font id="66">In effect, you have to go the way of adding a script handler similar to what is described later on regarding running Django in a <a class="reference internal" href="fastcgi.html#apache-shared-hosting"><em>shared-hosting environment</em></a>. </font><font id="67">For further details please refer to the <a class="reference external" href="http://httpd.apache.org/mod_fcgid/mod/mod_fcgid.html">mod_fcgid reference</a></font></p>
</div>
</div>
<div class="section" id="s-lighttpd-setup">
<span id="lighttpd-setup"></span><h2><font id="113">lighttpd setup</font><a class="headerlink" href="fastcgi.html#lighttpd-setup" title="Permalink to this headline">¶</a></h2>
<p><font id="68"><a class="reference external" href="http://www.lighttpd.net/">lighttpd</a> is a lightweight Web server commonly used for serving static files. </font><font id="69">It supports FastCGI natively and, thus, is a good choice for serving both static and dynamic pages, if your site doesn’t have any Apache-specific needs.</font></p>
<p><font id="70">Make sure <tt class="docutils literal"><span class="pre">mod_fastcgi</span></tt> is in your modules list, somewhere after <tt class="docutils literal"><span class="pre">mod_rewrite</span></tt> and <tt class="docutils literal"><span class="pre">mod_access</span></tt>, but not after <tt class="docutils literal"><span class="pre">mod_accesslog</span></tt>. </font><font id="71">You’ll probably want <tt class="docutils literal"><span class="pre">mod_alias</span></tt> as well, for serving admin media.</font></p>
<p><font id="72">Add the following to your lighttpd config file:</font></p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">server</span><span class="p">.</span><span class="n">document</span><span class="o">-</span><span class="n">root</span> <span class="o">=</span> <span class="s2">"</span><span class="s">/home/user/public_html"</span>
<span class="n">fastcgi</span><span class="p">.</span><span class="n">server</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">"</span><span class="s">/mysite.fcgi"</span> <span class="o">=&gt;</span> <span class="p">(</span>
        <span class="s2">"</span><span class="s">main"</span> <span class="o">=&gt;</span> <span class="p">(</span>
            <span class="o">#</span> <span class="n">Use</span> <span class="n">host</span> <span class="o">/</span> <span class="n">port</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">socket</span> <span class="k">for</span> <span class="n">TCP</span> <span class="n">fastcgi</span>
            <span class="o">#</span> <span class="s2">"</span><span class="s">host"</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="s">127.0.0.1"</span><span class="p">,</span>
            <span class="o">#</span> <span class="s2">"</span><span class="s">port"</span> <span class="o">=&gt;</span> <span class="mi">3033</span><span class="p">,</span>
            <span class="s2">"</span><span class="s">socket"</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="s">/home/user/mysite.sock"</span><span class="p">,</span>
            <span class="s2">"</span><span class="s">check-local"</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="s">disable"</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">alias</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">"</span><span class="s">/media"</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="s">/home/user/django/contrib/admin/media/"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">url</span><span class="p">.</span><span class="n">rewrite</span><span class="o">-</span><span class="n">once</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">"</span><span class="s">^(/media.*)$"</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="s">$1"</span><span class="p">,</span>
    <span class="s2">"</span><span class="s">^/favicon\.ico$"</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="s">/media/favicon.ico"</span><span class="p">,</span>
    <span class="s2">"</span><span class="s">^(/.*)$"</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="s">/mysite.fcgi$1"</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="section" id="s-running-multiple-django-sites-on-one-lighttpd">
<span id="running-multiple-django-sites-on-one-lighttpd"></span><h3><font id="124">Running multiple Django sites on one lighttpd</font><a class="headerlink" href="fastcgi.html#running-multiple-django-sites-on-one-lighttpd" title="Permalink to this headline">¶</a></h3>
<p><font id="73">lighttpd lets you use “conditional configuration” to allow configuration to be customized per host. </font><font id="74">To specify multiple FastCGI sites, just add a conditional block around your FastCGI config for each site:</font></p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># If the hostname is 'www.example1.com'...</span>
<span class="nv">$HTTP</span><span class="o">[</span><span class="s2">"host"</span><span class="o">]</span> <span class="o">==</span> <span class="s2">"www.example1.com"</span> <span class="o">{</span>
    server.document-root <span class="o">=</span> <span class="s2">"/foo/site1"</span>
    fastcgi.server <span class="o">=</span> <span class="o">(</span>
       ...
    <span class="o">)</span>
    ...
<span class="o">}</span>

<span class="c"># If the hostname is 'www.example2.com'...</span>
<span class="nv">$HTTP</span><span class="o">[</span><span class="s2">"host"</span><span class="o">]</span> <span class="o">==</span> <span class="s2">"www.example2.com"</span> <span class="o">{</span>
    server.document-root <span class="o">=</span> <span class="s2">"/foo/site2"</span>
    fastcgi.server <span class="o">=</span> <span class="o">(</span>
       ...
    <span class="o">)</span>
    ...
<span class="o">}</span>
</pre></div>
</div>
<p><font id="75">You can also run multiple Django installations on the same site simply by specifying multiple entries in the <tt class="docutils literal"><span class="pre">fastcgi.server</span></tt> directive. </font><font id="76">Add one FastCGI host for each.</font></p>
</div>
</div>
<div class="section" id="s-cherokee-setup">
<span id="cherokee-setup"></span><h2><font id="114">Cherokee setup</font><a class="headerlink" href="fastcgi.html#cherokee-setup" title="Permalink to this headline">¶</a></h2>
<p><font id="77">Cherokee is a very fast, flexible and easy to configure Web Server. </font><font id="78">It supports the widespread technologies nowadays: FastCGI, SCGI, PHP, CGI, SSI, TLS and SSL encrypted connections, Virtual hosts, Authentication, on the fly encoding, Load Balancing, Apache compatible log files, Data Base Balancer, Reverse HTTP Proxy and much more.</font></p>
<p><font id="79">The Cherokee project provides a documentation to <a class="reference external" href="http://www.cherokee-project.com/doc/cookbook_django.html">setting up Django</a> with Cherokee.</font></p>
</div>
<div class="section" id="s-running-django-on-a-shared-hosting-provider-with-apache">
<span id="s-apache-shared-hosting"></span><span id="running-django-on-a-shared-hosting-provider-with-apache"></span><span id="apache-shared-hosting"></span><h2><font id="115">Running Django on a shared-hosting provider with Apache</font><a class="headerlink" href="fastcgi.html#running-django-on-a-shared-hosting-provider-with-apache" title="Permalink to this headline">¶</a></h2>
<p><font id="80">Many shared-hosting providers don’t allow you to run your own server daemons or edit the <tt class="docutils literal"><span class="pre">httpd.conf</span></tt> file. </font><font id="81">In these cases, it’s still possible to run Django using Web server-spawned processes.</font></p>
<div class="admonition-note admonition">
<p class="first admonition-title"><font id="82">Note</font></p>
<p class="last"><font id="83">If you’re using Web server-spawned processes, as explained in this section, there’s no need for you to start the FastCGI server on your own. </font><font id="84">Apache will spawn a number of processes, scaling as it needs to.</font></p>
</div>
<p><font id="85">In your Web root directory, add this to a file named <tt class="docutils literal"><span class="pre">.htaccess</span></tt>:</font></p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nb">AddHandler</span> fastcgi-script .fcgi
<span class="nb">RewriteEngine</span> <span class="k">On</span>
<span class="nb">RewriteCond</span> %{REQUEST_FILENAME} !-f
<span class="nb">RewriteRule</span> ^(.*)$ mysite.fcgi/$1 [QSA,L]
</pre></div>
</div>
<p><font id="86">Then, create a small script that tells Apache how to spawn your FastCGI program. </font><font id="87">Create a file <tt class="docutils literal"><span class="pre">mysite.fcgi</span></tt> and place it in your Web directory, and be sure to make it executable:</font></p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c">#!/usr/bin/python</span>
import sys, os

<span class="c"># Add a custom Python path.</span>
sys.path.insert<span class="o">(</span>0, <span class="s2">"/home/user/python"</span><span class="o">)</span>

<span class="c"># Switch to the directory of your project. (Optional.)</span>
<span class="c"># os.chdir("/home/user/myproject")</span>

<span class="c"># Set the DJANGO_SETTINGS_MODULE environment variable.</span>
os.environ<span class="o">[</span><span class="s1">'DJANGO_SETTINGS_MODULE'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"myproject.settings"</span>

from django.core.servers.fastcgi import runfastcgi
runfastcgi<span class="o">(</span><span class="nv">method</span><span class="o">=</span><span class="s2">"threaded"</span>, <span class="nv">daemonize</span><span class="o">=</span><span class="s2">"false"</span><span class="o">)</span>
</pre></div>
</div>
<p><font id="88">This works if your server uses mod_fastcgi. </font><font id="89">If, on the other hand, you are using mod_fcgid the setup is mostly the same except for a slight change in the <tt class="docutils literal"><span class="pre">.htaccess</span></tt> file. </font><font id="90">Instead of adding a fastcgi-script handler, you have to add a fcgid-handler:</font></p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nb">AddHandler</span> fcgid-script .fcgi
<span class="nb">RewriteEngine</span> <span class="k">On</span>
<span class="nb">RewriteCond</span> %{REQUEST_FILENAME} !-f
<span class="nb">RewriteRule</span> ^(.*)$ mysite.fcgi/$1 [QSA,L]
</pre></div>
</div>
<div class="section" id="s-restarting-the-spawned-server">
<span id="restarting-the-spawned-server"></span><h3><font id="125">Restarting the spawned server</font><a class="headerlink" href="fastcgi.html#restarting-the-spawned-server" title="Permalink to this headline">¶</a></h3>
<p><font id="91">If you change any Python code on your site, you’ll need to tell FastCGI the code has changed. </font><font id="92">But there’s no need to restart Apache in this case. </font><font id="93">Rather, just reupload <tt class="docutils literal"><span class="pre">mysite.fcgi</span></tt>, or edit the file, so that the timestamp on the file will change. </font><font id="94">When Apache sees the file has been updated, it will restart your Django application for you.</font></p>
<p><font id="95">If you have access to a command shell on a Unix system, you can accomplish this easily by using the <tt class="docutils literal"><span class="pre">touch</span></tt> command:</font></p>
<div class="highlight-bash"><div class="highlight"><pre>touch mysite.fcgi
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-serving-admin-media-files">
<span id="serving-admin-media-files"></span><h2><font id="116">Serving admin media files</font><a class="headerlink" href="fastcgi.html#serving-admin-media-files" title="Permalink to this headline">¶</a></h2>
<p><font id="96">Regardless of the server and configuration you eventually decide to use, you will also need to give some thought to how to serve the admin media files. </font><font id="97">The advice given in the <a class="reference internal" href="wsgi/modwsgi.html#serving-the-admin-files"><em>mod_wsgi</em></a> documentation is also applicable in the setups detailed above.</font></p>
</div>
<div class="section" id="s-forcing-the-url-prefix-to-a-particular-value">
<span id="forcing-the-url-prefix-to-a-particular-value"></span><h2><font id="117">Forcing the URL prefix to a particular value</font><a class="headerlink" href="fastcgi.html#forcing-the-url-prefix-to-a-particular-value" title="Permalink to this headline">¶</a></h2>
<p><font id="98">Because many of these fastcgi-based solutions require rewriting the URL at some point inside the Web server, the path information that Django sees may not resemble the original URL that was passed in. </font><font id="99">This is a problem if the Django application is being served from under a particular prefix and you want your URLs from the <a class="reference internal" href="../../ref/templates/builtins.html#std:templatetag-url"><tt class="xref std std-ttag docutils literal"><span class="pre">{%</span> <span class="pre">url</span> <span class="pre">%}</span></tt></a> tag to look like the prefix, rather than the rewritten version, which might contain, for example, <tt class="docutils literal"><span class="pre">mysite.fcgi</span></tt>.</font></p>
<p><font id="100">Django makes a good attempt to work out what the real script name prefix should be. </font><font id="101">In particular, if the Web server sets the <tt class="docutils literal"><span class="pre">SCRIPT_URL</span></tt> (specific to Apache’s mod_rewrite), or <tt class="docutils literal"><span class="pre">REDIRECT_URL</span></tt> (set by a few servers, including Apache + mod_rewrite in some situations), Django will work out the original prefix automatically.</font></p>
<p><font id="102">In the cases where Django cannot work out the prefix correctly and where you want the original value to be used in URLs, you can set the <a class="reference internal" href="../../ref/settings.html#std:setting-FORCE_SCRIPT_NAME"><tt class="xref std std-setting docutils literal"><span class="pre">FORCE_SCRIPT_NAME</span></tt></a> setting in your main <tt class="docutils literal"><span class="pre">settings</span></tt> file. </font><font id="103">This sets the script name uniformly for every URL served via that settings file. </font><font id="104">Thus you’ll need to use different settings files if you want different sets of URLs to have different script names in this case, but that is a rare situation.</font></p>
<p><font id="105">As an example of how to use it, if your Django configuration is serving all of the URLs under <tt class="docutils literal"><span class="pre">'/'</span></tt> and you wanted to use this setting, you would set <tt class="docutils literal"><span class="pre">FORCE_SCRIPT_NAME</span> <span class="pre">=</span> <span class="pre">''</span></tt> in your settings file.</font></p>
</div>
</div>
</div>
</div>
</div>
<div class="yui-b" id="sidebar">
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
<h3><font id="126">Table Of Contents</font></h3>
<ul>
<li><a class="reference internal" href="fastcgi.html#"><font id="134">How to use Django with FastCGI, SCGI, or AJP</font></a><ul>
<li><a class="reference internal" href="fastcgi.html#prerequisite-flup"><font id="135">Prerequisite: flup</font></a></li>
<li><a class="reference internal" href="fastcgi.html#starting-your-fastcgi-server"><font id="136">Starting your FastCGI server</font></a><ul>
<li><a class="reference internal" href="fastcgi.html#protocols"><font id="137">Protocols</font></a></li>
<li><a class="reference internal" href="fastcgi.html#examples"><font id="138">Examples</font></a></li>
<li><a class="reference internal" href="fastcgi.html#stopping-the-fastcgi-daemon"><font id="139">Stopping the FastCGI daemon</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="fastcgi.html#apache-setup"><font id="140">Apache setup</font></a><ul>
<li><a class="reference internal" href="fastcgi.html#specifying-the-location-of-the-fastcgi-server"><font id="141">Specifying the location of the FastCGI server</font></a></li>
<li><a class="reference internal" href="fastcgi.html#using-mod-rewrite-to-point-urls-at-fastcgi"><font id="142">Using mod_rewrite to point URLs at FastCGI</font></a></li>
<li><a class="reference internal" href="fastcgi.html#using-mod-fcgid-as-alternative-to-mod-fastcgi"><font id="143">Using mod_fcgid as alternative to mod_fastcgi</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="fastcgi.html#lighttpd-setup"><font id="144">lighttpd setup</font></a><ul>
<li><a class="reference internal" href="fastcgi.html#running-multiple-django-sites-on-one-lighttpd"><font id="145">Running multiple Django sites on one lighttpd</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="fastcgi.html#cherokee-setup"><font id="146">Cherokee setup</font></a></li>
<li><a class="reference internal" href="fastcgi.html#running-django-on-a-shared-hosting-provider-with-apache"><font id="147">Running Django on a shared-hosting provider with Apache</font></a><ul>
<li><a class="reference internal" href="fastcgi.html#restarting-the-spawned-server"><font id="148">Restarting the spawned server</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="fastcgi.html#serving-admin-media-files"><font id="149">Serving admin media files</font></a></li>
<li><a class="reference internal" href="fastcgi.html#forcing-the-url-prefix-to-a-particular-value"><font id="150">Forcing the URL prefix to a particular value</font></a></li>
</ul>
</li>
</ul>
<h3><font id="127">Browse</font></h3>
<ul>
<li><font id="151">Prev: <a href="checklist.html">Deployment checklist</a></font></li>
<li><font id="152">Next: <a href="http://python.usyiyi.cn/django/howto/upgrade-version.html">Upgrading Django to a newer version</a></font></li>
</ul>
<h3><font id="128">You are here:</font></h3>
<ul>
<li>
<a href="../../index.html"><font id="153">Django 1.8.2.dev20150513143415 documentation</font></a>
<ul><li><a href="http://python.usyiyi.cn/django/howto/index.html">“How-to” guides</a>
<ul><li><a href="index.html"><font id="154">Deploying Django</font></a>
<ul><li><font id="155">How to use Django with FastCGI, SCGI, or AJP</font></li></ul>
</li></ul></li></ul>
</li>
</ul>
<h3><font id="129">This Page</font></h3>
<ul class="this-page-menu">
<li><a href="http://python.usyiyi.cn/django/_sources/howto/deployment/fastcgi.txt" rel="nofollow"><font id="156">Show Source</font></a></li>
</ul>
<div id="searchbox" style="display: none">
<h3><font id="130">Quick search</font></h3>
<form action="http://python.usyiyi.cn/django/search.html" class="search" method="get">
<input name="q" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
<p class="searchtip" style="font-size: 90%"><font id="106"> Enter search terms or a module, class or function name. </font></p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>
</div>
<h3><font id="131">Last update:</font></h3>
<p class="topless"><font id="107">May 13, 2015</font></p>
</div>
</div>
<div id="ft">
<div class="nav">
    « <a href="checklist.html" title="Deployment checklist">previous</a>
     |
    <a accesskey="U" href="http://python.usyiyi.cn/django/howto/index.html" title="&amp;#8220;How-to&amp;#8221; guides">up</a>
   |
    <a href="http://python.usyiyi.cn/django/howto/upgrade-version.html" title="Upgrading Django to a newer version">next</a> »</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div id="disqus_thread"></div><br>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'djangocn'; // required: replace example with your forum shortname
    var disqus_identifier = '/django/howto/deployment/fastcgi';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<link href="http://python.usyiyi.cn/django/_static/ms_translator.css" rel="stylesheet" type="text/css"/>
<script src="http://python.usyiyi.cn/django/_static/ms_translator.js" type="text/javascript"></script>
<script src="http://python.usyiyi.cn/django/_static/jquery-ui-1.9.2.custom.min.js" type="text/javascript"></script>
<div id="MicrosoftTranslator" style="display:none; position: absolute; z-index: 2147483647; margin: 0px; border: 2px solid rgb(210, 210, 210); padding: 0px; color: rgb(0, 0, 0); background-color: rgb(230, 230, 230); font-family: Arial,Helvetica,Sans-Serif; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: normal; direction: ltr; text-align: left; left: 274px; top: 2048.03px; min-width: 400px;">
    <div id="MSTCClose" style="float: right;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/tooltip_close.gif">
      </a>
    </div>
    
    <div id="MSTCPopDown" style="float: right;" style="display: none;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/popdown.gif">
      </a>
    </div>
    <div id="MSTCPopUP" style="float: right;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/popup.gif">
      </a>
    </div>
    
    <div id="MSTCTitle" style="margin: 4px 4px 8px; font-weight: bold;">原文
    </div>
    
    <div style="direction: ltr; text-align: left;">
      <span id="MSTCOrigion" style="display: inline-block; margin: 0px 4px 4px;"> </span>
    </div>
    
    <div id="MicrosoftTranslatorCommunity" class="MSTCltr">
      <div id="MSTCContent">
        <a id="MSTCExpandLink">
          <span id="MSTCImprove">改进翻译</span>
          <span id="MSTCSuggest">最小化</span>
          <img src="http://python.usyiyi.cn/django/_static/ctftoggledown.gif" id="MSTCToggleDown">
          <img src="http://python.usyiyi.cn/django/_static/ctftoggleup.gif" id="MSTCToggleUp">
        </a>
        <div id="MSTCRootPanel">
          <span id="MSTCLoading" style="display: none;">正在加载...</span>
          <div style="display: none;" id="MSTCTransPanelError">
            <div class="MSTCTableRow">
              <div class="MSTCTransPanelExc MSTCTableCell">
                <img style="border-width:0px;" src="http://python.usyiyi.cn/django/_static/error_exclamation.gif" id="ExclamationImage">
              </div>
              <div class="MSTCTableCell">
                <span id="MSTCTransPanelErrorMsg"></span>
              </div>
            </div>
            <div class="MSTCTableRow">
              <div class="MSTCTableCell"></div>
              <div class="MSTCTableCell MSTCFlipHoriz">
                <input type="image" style="border-width:0px;" src="http://python.usyiyi.cn/django/_static/error_OK.gif" class="MSTCErrorButtons" id="MSTCOKImgBtn" name="MSTCOKImgBtn">
              </div>
            </div>
          </div>
          
          <div id="MSTCTransPanel">
          </div>
          
          <div id="MSTCPrevNextPanel">
            <a id="MSTCPrevLink" style='border-right-width: 1px;border-right-style: solid;padding-right: 5px;'>
              <span>上一页</span>
            </a>
            <a style='color: black; border-right-width: 1px;border-right-style: solid;padding-right: 5px;'>
              <span>第</span>
              <span id="MSTCPage"></span>
              <span>页</span>
            </a>
            <a id="MSTCNextLink" style='padding-left: 5px;'>
              <span>下一页</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>
</html>