<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>使用Django认证系统 — Django 1.8.2 中文文档</title>
<link href="../../_static/default.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.8.2.dev20150513143415',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
<script src="../../_static/jquery.js" type="text/javascript"></script>
<script src="../../_static/underscore.js" type="text/javascript"></script>
<script src="../../_static/doctools.js" type="text/javascript"></script>
<link href="../../index.html" rel="top" title="Django 1.8.2.dev20150513143415 documentation"/>
<link href="index.html" rel="up" title="User authentication in Django"/>
<link href="passwords.html" rel="next" title="Password management in Django"/>
<link href="index.html" rel="prev" title="User authentication in Django"/>
<script src="http://python.usyiyi.cn/django/templatebuiltins.js" type="text/javascript"></script>
<script type="text/javascript">
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='http://python.usyiyi.cn/django/topics/auth/&quot;&#32;+&#32;base&#32;+&#32;&quot;#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='http://python.usyiyi.cn/django/topics/auth/&quot;&#32;+&#32;base&#32;+&#32;&quot;#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);
</script>
</head>
<body>
<div class="document">
<div class="yui-t6" id="custom-doc">
<div id="hd">
<h1><font id="286">Django 1.8.2 文档</font></h1>
<div id="global-nav">
<a href="../../index.html" title="Home page">Home</a>  |
        <a href="../../contents.html" title="Table of contents">Table of contents</a>  |
        <a href="../../genindex.html" title="Global index">Index</a>  |
        <a href="../../py-modindex.html" title="Module index">Modules</a>
</div>
<div class="nav">
    « <a href="index.html" title="User authentication in Django">previous</a>
     |
    <a accesskey="U" href="../index.html" title="Using Django">up</a>
   |
    <a href="passwords.html" title="Password management in Django">next</a> »</div>
</div>
<div id="bd">
<div id="yui-main">
<div class="yui-b">
<div class="yui-g" id="topics-auth-default">
<div class="section" id="s-using-the-django-authentication-system">
<span id="using-the-django-authentication-system"></span><h1><font id="287">使用Django认证系统</font><a class="headerlink" href="default.html#using-the-django-authentication-system" title="Permalink to this headline">¶</a></h1>
<p><font id="1">这篇文档解释默认配置下Django认证系统的使用。</font><font id="2">这些配置已经逐步可以满足大部分常见项目对的需要，可以处理范围非常广泛的任务，且具有一套细致的密码和权限实现。</font><font id="3">对于需要与默认配置不同需求的项目，Django支持<a class="reference internal" href="customizing.html"><em>扩展和自定义</em></a>认证。</font></p>
<p><font id="4">Django的认证同时提供认证和授权，并通常统一称为认证系统，因为这些功能某些地方是耦合的。</font></p>
<div class="section" id="s-user-objects">
<span id="s-id1"></span><span id="user-objects"></span><span id="id1"></span><h2><font id="288">User对象</font><a class="headerlink" href="default.html#user-objects" title="Permalink to this headline">¶</a></h2>
<p><font id="5"><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><tt class="xref py py-class docutils literal"><span class="pre">User</span></tt></a>对象是认证系统的核心。</font><font id="6">它们通常表示与你的站点进行交互的用户，并用于启用限制访问、注册用户信息和关联内容给创建者等。</font><font id="7">在Django的认证框架中只存在一种类型的用户，因此诸如<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.is_superuser" title="django.contrib.auth.models.User.is_superuser"><tt class="xref py py-attr docutils literal"><span class="pre">'superusers'</span></tt></a>或管理员<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.is_staff" title="django.contrib.auth.models.User.is_staff"><tt class="xref py py-attr docutils literal"><span class="pre">'staff'</span></tt></a>用户只是具有特殊属性集的user对象，而不是不同类型的user对象。</font></p>
<p><font id="8">默认user的基本属性有：</font></p>
<ul class="simple">
<li><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.username" title="django.contrib.auth.models.User.username"><font id="325">username</font></a></li>
<li><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.password" title="django.contrib.auth.models.User.password"><font id="326">password</font></a></li>
<li><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.email" title="django.contrib.auth.models.User.email"><font id="327">email</font></a></li>
<li><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.first_name" title="django.contrib.auth.models.User.first_name"><font id="328">first_name</font></a></li>
<li><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.last_name" title="django.contrib.auth.models.User.last_name"><font id="329">last_name</font></a></li>
</ul>
<p><font id="9">完整的参考请参阅<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><tt class="xref py py-class docutils literal"><span class="pre">full</span> <span class="pre">API</span> <span class="pre">documentation</span></tt></a>，该文档更偏重特定的任务。</font></p>
<div class="section" id="s-creating-users">
<span id="s-topics-auth-creating-users"></span><span id="creating-users"></span><span id="topics-auth-creating-users"></span><h3><font id="292">创建users</font><a class="headerlink" href="default.html#creating-users" title="Permalink to this headline">¶</a></h3>
<p><font id="10">创建users最直接的方法是使用<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.UserManager.create_user" title="django.contrib.auth.models.UserManager.create_user"><tt class="xref py py-meth docutils literal"><span class="pre">create_user()</span></tt></a>辅助函数：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">'john'</span><span class="p">,</span> <span class="s">'lennon@thebeatles.com'</span><span class="p">,</span> <span class="s">'johnpassword'</span><span class="p">)</span>

<span class="go"># At this point, user is a User object that has already been saved</span>
<span class="go"># to the database. You can continue to change its attributes</span>
<span class="go"># if you want to change other fields.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="s">'Lennon'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="11">如果你已经安装了Django admin，你也可以<a class="reference internal" href="default.html#auth-admin"><em>间接地创建users</em></a>.</font></p>
</div>
<div class="section" id="s-creating-superusers">
<span id="s-topics-auth-creating-superusers"></span><span id="creating-superusers"></span><span id="topics-auth-creating-superusers"></span><h3><font id="293">创建superusers</font><a class="headerlink" href="default.html#creating-superusers" title="Permalink to this headline">¶</a></h3>
<p><font id="12">使用<a class="reference internal" href="../../ref/django-admin.html#django-admin-createsuperuser"><tt class="xref std std-djadmin docutils literal"><span class="pre">createsuperuser</span></tt></a>命令创建superusers：</font></p>
<div class="highlight-python"><div class="highlight"><pre>$ python manage.py createsuperuser --username=joe --email=joe@example.com
</pre></div>
</div>
<p><font id="13">将会提示你输入一个密码。</font><font id="14">在你输入一个密码后，该user将会立即创建。</font><font id="15">如果不带<a class="reference internal" href="../../ref/django-admin.html#django-admin-option---username"><tt class="xref std std-djadminopt docutils literal"><span class="pre">--username</span></tt></a>和<a class="reference internal" href="../../ref/django-admin.html#django-admin-option---email"><tt class="xref std std-djadminopt docutils literal"><span class="pre">--email</span></tt></a>选项，将会提示你输入这些值。</font></p>
</div>
<div class="section" id="s-changing-passwords">
<span id="changing-passwords"></span><h3><font id="294">修改密码</font><a class="headerlink" href="default.html#changing-passwords" title="Permalink to this headline">¶</a></h3>
<p><font id="16">Django不会在user模型上存储原始的（明文）密码，而只是一个哈希（完整的细节参见<a class="reference internal" href="passwords.html"><em>文档：密码是如何管理的</em></a>）。</font><font id="17">因为这个原因，不要尝试直接操作user的password属性。</font><font id="18">这也是为什么创建一个user时要使用辅助函数。</font></p>
<p><font id="19">若要修改一个用户的密码，你有几种选择：</font></p>
<p><font id="20"><a class="reference internal" href="../../ref/django-admin.html#django-admin-changepassword"><tt class="xref std std-djadmin docutils literal"><span class="pre">manage.py</span> <span class="pre">changepassword</span> <span class="pre">*username*</span></tt></a>提供一种从命令行修改User密码的方法。</font><font id="21">它提示你修改一个给定user的密码，你必须输入两次。</font><font id="22">如果它们匹配，新的密码将会立即修改。</font><font id="23">如果你没有提供user，命令行将尝试修改与当前系统用户匹配的用户名的密码。</font></p>
<p><font id="24">你也可以通过程序修改密码，使用<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.set_password" title="django.contrib.auth.models.User.set_password"><tt class="xref py py-meth docutils literal"><span class="pre">set_password()</span></tt></a>：</font></p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">'john'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="s">'new password'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="25">如果你安装了Django admin，你还可以在<a class="reference internal" href="default.html#auth-admin"><em>认证系统的admin页面</em></a>修改user的密码。</font></p>
<p><font id="26">Django还提供<a class="reference internal" href="default.html#built-in-auth-views"><em>views</em></a>和<a class="reference internal" href="default.html#built-in-auth-forms"><em>forms</em></a>用于允许user修改他们自己密码。</font></p>
<div class="versionadded">
<span class="title">New in Django 1.7.</span> </div>
<p><font id="27">如果启用了<a class="reference internal" href="../../ref/middleware.html#django.contrib.auth.middleware.SessionAuthenticationMiddleware" title="django.contrib.auth.middleware.SessionAuthenticationMiddleware"><tt class="xref py py-class docutils literal"><span class="pre">SessionAuthenticationMiddleware</span></tt></a>，修改user的密码将会登出他们所有的会话。 </font><font id="28">详细信息请参阅<a class="reference internal" href="default.html#session-invalidation-on-password-change"><em>密码修改后会话失效</em></a>。</font></p>
</div>
<div class="section" id="s-authenticating-users">
<span id="authenticating-users"></span><h3><font id="295">认证Users</font><a class="headerlink" href="default.html#authenticating-users" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="django.contrib.auth.authenticate">
<tt class="descname">authenticate</tt>(<em>**credentials</em>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth.html#authenticate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.authenticate" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="29">认证一个给定用户名和密码，请使用<a class="reference internal" href="default.html#django.contrib.auth.authenticate" title="django.contrib.auth.authenticate"><tt class="xref py py-func docutils literal"><span class="pre">authenticate()</span></tt></a>。</font><font id="30">它以关键字参数形式接收凭证，对于默认的配置它是<tt class="docutils literal"><span class="pre">username</span></tt>和<tt class="docutils literal"><span class="pre">password，如果密码对于给定的用户名有效它将返回一个</span></tt><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><tt class="xref py py-class docutils literal"><span class="pre">User</span></tt></a>对象。</font><font id="31">如果密码无效，<a class="reference internal" href="default.html#django.contrib.auth.authenticate" title="django.contrib.auth.authenticate"><tt class="xref py py-func docutils literal"><span class="pre">authenticate()</span></tt></a>返回<tt class="docutils literal"><span class="pre">None</span></tt>。</font><font id="32">例子：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">authenticate</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">'john'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">'secret'</span><span class="p">)</span>
<span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="c"># the password verified for the user</span>
    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"User is valid, active and authenticated"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"The password is valid, but the account has been disabled!"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c"># the authentication system was unable to verify the username and password</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"The username and password were incorrect."</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title"><font id="33">注</font></p>
<p class="last"><font id="34">这是认证一系列凭证的低级的方法；</font><font id="35">例如，它被<a class="reference internal" href="../../ref/middleware.html#django.contrib.auth.middleware.RemoteUserMiddleware" title="django.contrib.auth.middleware.RemoteUserMiddleware"><tt class="xref py py-class docutils literal"><span class="pre">RemoteUserMiddleware</span></tt></a>使用。</font><font id="36">除非你正在编写你自己的认证系统，你可能不会使用到它。</font><font id="37">当然如果你在寻找一种登录user的方法，请参见<a class="reference internal" href="default.html#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><tt class="xref py py-func docutils literal"><span class="pre">login_required()</span></tt></a>装饰器。</font></p>
</div>
</dd></dl>
</div>
</div>
<div class="section" id="s-permissions-and-authorization">
<span id="s-topic-authorization"></span><span id="permissions-and-authorization"></span><span id="topic-authorization"></span><h2><font id="289">权限和授权</font><a class="headerlink" href="default.html#permissions-and-authorization" title="Permalink to this headline">¶</a></h2>
<p><font id="38">Django从开始就带有一个简单的权限系统。</font><font id="39">它提供一种分配权限给特定的用户和用户组的方法。</font></p>
<p><font id="40">它被Django的admin站点使用，但欢迎你在你自己的代码中使用。</font></p>
<p><font id="41">Django admin 站点使用如下的权限：</font></p>
<ul class="simple">
<li><font id="480">查看"add"表单并添加一个只限具有该类型对象的“add”权限的用户对象。</font></li>
<li><font id="481">查看修改列表、查看“change”表单以及修改一个只限具有该类型对象的“change”权限的用户对象。</font></li>
<li><font id="482">删除一个只限具有该类型对象的“delete”权限的用户对象。</font></li>
</ul>
<p><font id="42">权限不但可以根据每个对象的类型，而且可以根据特定的对象实例设置。</font><font id="43">通过使用<a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin" title="django.contrib.admin.ModelAdmin"><tt class="xref py py-class docutils literal"><span class="pre">ModelAdmin</span></tt></a>类提供的<a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.has_add_permission" title="django.contrib.admin.ModelAdmin.has_add_permission"><tt class="xref py py-meth docutils literal"><span class="pre">has_add_permission()</span></tt></a>、<a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.has_change_permission" title="django.contrib.admin.ModelAdmin.has_change_permission"><tt class="xref py py-meth docutils literal"><span class="pre">has_change_permission()</span></tt></a>和<a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.has_delete_permission" title="django.contrib.admin.ModelAdmin.has_delete_permission"><tt class="xref py py-meth docutils literal"><span class="pre">has_delete_permission()</span></tt></a>方法，可以针对相同类型的不同对象实例自定义权限。</font></p>
<p><font id="44"><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><tt class="xref py py-class docutils literal"><span class="pre">User</span></tt></a>对象具有两个多对多的字段：<tt class="docutils literal"><span class="pre">groups</span></tt>和<tt class="docutils literal"><span class="pre">user_permissions</span></tt>。</font><font id="45"><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><tt class="xref py py-class docutils literal"><span class="pre">User</span></tt></a>对象可以用和其它<a class="reference internal" href="../db/models.html"><em>Django 模型</em></a>一样的方式访问它们相关的对象：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">myuser</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">group_list</span><span class="p">]</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">user_permissions</span> <span class="o">=</span> <span class="p">[</span><span class="n">permission_list</span><span class="p">]</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">permission</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">permission</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="s-default-permissions">
<span id="default-permissions"></span><h3><font id="296">默认的权限</font><a class="headerlink" href="default.html#default-permissions" title="Permalink to this headline">¶</a></h3>
<p><font id="46">当<tt class="docutils literal"><span class="pre">django.contrib.auth</span></tt>在你的<a class="reference internal" href="../../ref/settings.html#std:setting-INSTALLED_APPS"><tt class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a>设置中列出时，它将确保为你安装的应用中的每个Django模型创建3个默认的权限 – add、change和delete。</font></p>
<p><font id="47">这些权限将在你运行<a class="reference internal" href="../../ref/django-admin.html#django-admin-migrate"><tt class="xref std std-djadmin docutils literal"><span class="pre">manage.py</span> <span class="pre">migrate</span></tt></a>时创建；</font><font id="48">在添加<tt class="docutils literal"><span class="pre">django.contrib.auth</span></tt>到<a class="reference internal" href="../../ref/settings.html#std:setting-INSTALLED_APPS"><tt class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a>中之后，当你第一次运行<tt class="docutils literal"><span class="pre">migrate</span></tt>时，将会为之前安装的模型创建默认的权限，包括与其同时正在安装的新的模型。</font><font id="49">之后，每当你运行<a class="reference internal" href="../../ref/django-admin.html#django-admin-migrate"><tt class="xref std std-djadmin docutils literal"><span class="pre">manage.py</span> <span class="pre">migrate</span></tt></a>时，它都将为新的模型创建默认的权限。</font></p>
<p><font id="50">假设你有个应用的<a class="reference internal" href="../../ref/models/options.html#django.db.models.Options.app_label" title="django.db.models.Options.app_label"><tt class="xref py py-attr docutils literal"><span class="pre">app_label</span></tt></a>是<tt class="docutils literal"><span class="pre">foo</span></tt>和一个名为<tt class="docutils literal"><span class="pre">Bar</span></tt>的模型，要测试基本的权限，你应该使用：</font></p>
<ul class="simple">
<li>add: <tt class="docutils literal"><span class="pre">user.has_perm('foo.add_bar')</span></tt></li>
<li>change: <tt class="docutils literal"><span class="pre">user.has_perm('foo.change_bar')</span></tt></li>
<li>delete: <tt class="docutils literal"><span class="pre">user.has_perm('foo.delete_bar')</span></tt></li>
</ul>
<p><font id="51">很少直接访问<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.Permission" title="django.contrib.auth.models.Permission"><tt class="xref py py-class docutils literal"><span class="pre">Permission</span></tt></a>模型。</font></p>
</div>
<div class="section" id="s-groups">
<span id="groups"></span><h3><font id="297">组</font><a class="headerlink" href="default.html#groups" title="Permalink to this headline">¶</a></h3>
<p><font id="52"><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.Group" title="django.contrib.auth.models.Group"><tt class="xref py py-class docutils literal"><span class="pre">django.contrib.auth.models.Group</span></tt></a>模型是用户分类的一种通用的方式，通过这种方式你可以应用权限或其它标签到这些用户。</font><font id="53">一个用户可以属于任意多个组。</font></p>
<p><font id="54">组中某个用户自动具有赋给那个组的权限。</font><font id="55">例如，如果组<tt class="docutils literal"><span class="pre">Site</span> <span class="pre">editors</span></tt>具有权限 <tt class="docutils literal"><span class="pre">can_edit_home_page</span></tt>，那么该组中的任何用户都具有该权限。</font></p>
<p><font id="56">出权限之外，组还是给用户分类的一种方便的方法以给他们某些标签或扩展的功能。</font><font id="57">例如，你可以创建一个组<tt class="docutils literal"><span class="pre">'Special</span> <span class="pre">users'</span></tt>，然后你可以这样写代码，给他们访问你的站点仅限会员的部分，或者给他们发仅限于会员的邮件。</font></p>
</div>
<div class="section" id="s-programmatically-creating-permissions">
<span id="programmatically-creating-permissions"></span><h3><font id="298">用程序创建权限</font><a class="headerlink" href="default.html#programmatically-creating-permissions" title="Permalink to this headline">¶</a></h3>
<p><font id="58">虽然<a class="reference internal" href="customizing.html#custom-permissions"><em>custom permissions</em></a>可以定义在<tt class="docutils literal"><span class="pre">Meta</span></tt>类中，你还可以直接创建权限。</font><font id="59">例如，你可以为<tt class="docutils literal"><span class="pre">myapp</span></tt>中的<tt class="docutils literal"><span class="pre">BlogPost</span></tt>&nbsp;创建<tt class="docutils literal"><span class="pre">can_publish</span></tt>权限：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">myapp.models</span> <span class="kn">import</span> <span class="n">BlogPost</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">Group</span><span class="p">,</span> <span class="n">Permission</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>

<span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">BlogPost</span><span class="p">)</span>
<span class="n">permission</span> <span class="o">=</span> <span class="n">Permission</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">'can_publish'</span><span class="p">,</span>
                                       <span class="n">name</span><span class="o">=</span><span class="s">'Can Publish Posts'</span><span class="p">,</span>
                                       <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="60">然后该权限可以通过<tt class="docutils literal"><span class="pre">user_permissions</span></tt>属性分配给一个<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><tt class="xref py py-class docutils literal"><span class="pre">User</span></tt></a>，或者通过<tt class="docutils literal"><span class="pre">permissions</span></tt>属性分配给<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.Group" title="django.contrib.auth.models.Group"><tt class="xref py py-class docutils literal"><span class="pre">Group</span></tt></a>。</font></p>
</div>
<div class="section" id="s-permission-caching">
<span id="permission-caching"></span><h3><font id="299">权限的缓存</font><a class="headerlink" href="default.html#permission-caching" title="Permalink to this headline">¶</a></h3>
<p><font id="61"><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.backends.ModelBackend" title="django.contrib.auth.backends.ModelBackend"><tt class="xref py py-class docutils literal"><span class="pre">ModelBackend</span></tt></a>在第一次需要访问<tt class="docutils literal"><span class="pre">User</span></tt>对象来检查权限时会缓存它们的权限。</font><font id="62">这对于请求-响应循环还是比较好的，因为在权限添加进来之后并不会立即检查（例如在admin中）。</font><font id="63">如果你正在添加权限并需要立即检查它们，例如在一个测试或视图中，最简单的解决办法是从数据库中重新获取<tt class="docutils literal"><span class="pre">User</span></tt>。 </font><font id="64">例如：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">Permission</span><span class="p">,</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span>

<span class="k">def</span> <span class="nf">user_gains_perms</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
    <span class="c"># any permission check will cache the current set of permissions</span>
    <span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s">'myapp.change_bar'</span><span class="p">)</span>

    <span class="n">permission</span> <span class="o">=</span> <span class="n">Permission</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s">'change_bar'</span><span class="p">)</span>
    <span class="n">user</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">permission</span><span class="p">)</span>

    <span class="c"># Checking the cached permission set</span>
    <span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s">'myapp.change_bar'</span><span class="p">)</span>  <span class="c"># False</span>

    <span class="c"># Request new instance of User</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>

    <span class="c"># Permission cache is repopulated from the database</span>
    <span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s">'myapp.change_bar'</span><span class="p">)</span>  <span class="c"># True</span>

    <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-authentication-in-web-requests">
<span id="s-auth-web-requests"></span><span id="authentication-in-web-requests"></span><span id="auth-web-requests"></span><h2><font id="290">Web请求中的认证</font><a class="headerlink" href="default.html#authentication-in-web-requests" title="Permalink to this headline">¶</a></h2>
<p><font id="65">Django使用<a class="reference internal" href="../http/sessions.html"><em>会话</em></a>和中间件来拦截<a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><tt class="xref py py-class docutils literal"><span class="pre">request</span> <span class="pre">对象</span></tt></a>到认证系统中。</font></p>
<p><font id="66">它们在每个请求上提供一个<a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.user" title="django.http.HttpRequest.user"><tt class="xref py py-attr docutils literal"><span class="pre">request.user</span></tt></a>属性，表示当前的用户。</font><font id="67">如果当前的用户没有登入，该属性将设置成<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.AnonymousUser" title="django.contrib.auth.models.AnonymousUser"><tt class="xref py py-class docutils literal"><span class="pre">AnonymousUser</span></tt></a>的一个实例，否则它将是<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><tt class="xref py py-class docutils literal"><span class="pre">User</span></tt></a>的实例。</font></p>
<p><font id="68">你可以通过<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.is_authenticated" title="django.contrib.auth.models.User.is_authenticated"><tt class="xref py py-meth docutils literal"><span class="pre">is_authenticated()</span></tt></a>区分它们，像这样：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
    <span class="c"># Do something for authenticated users.</span>
    <span class="o">...</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c"># Do something for anonymous users.</span>
    <span class="o">...</span>
</pre></div>
</div>
<div class="section" id="s-how-to-log-a-user-in">
<span id="s-id2"></span><span id="how-to-log-a-user-in"></span><span id="id2"></span><h3><font id="300">如何登入一个用户</font><a class="headerlink" href="default.html#how-to-log-a-user-in" title="Permalink to this headline">¶</a></h3>
<p><font id="69">如果你有一个认证了的用户，你想把它附带到当前的会话中 - 这可以通过<a class="reference internal" href="default.html#django.contrib.auth.login" title="django.contrib.auth.login"><tt class="xref py py-func docutils literal"><span class="pre">login()</span></tt></a>函数完成。</font></p>
<dl class="function">
<dt id="django.contrib.auth.login">
<tt class="descname">login</tt>()<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth.html#login"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.login" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="70">从视图中登入一个用户，请使用<a class="reference internal" href="default.html#django.contrib.auth.login" title="django.contrib.auth.login"><tt class="xref py py-func docutils literal"><span class="pre">login()</span></tt></a>。</font><font id="71">它接受一个<a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><tt class="xref py py-class docutils literal"><span class="pre">HttpRequest</span></tt></a>对象和一个<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><tt class="xref py py-class docutils literal"><span class="pre">User</span></tt></a>对象。</font><font id="72"><a class="reference internal" href="default.html#django.contrib.auth.login" title="django.contrib.auth.login"><tt class="xref py py-func docutils literal"><span class="pre">login()</span></tt></a>使用Django的会话框架保存用户的ID在会话中。</font></p>
<p><font id="73">注意任何在匿名会话中设置的数据都会在用户登入后的会话中都会记住。</font></p>
<p><font id="74">这个例子展示你可能如何使用<a class="reference internal" href="default.html#django.contrib.auth.authenticate" title="django.contrib.auth.authenticate"><tt class="xref py py-func docutils literal"><span class="pre">authenticate()</span></tt></a>和 <a class="reference internal" href="default.html#django.contrib.auth.login" title="django.contrib.auth.login"><tt class="xref py py-func docutils literal"><span class="pre">login()</span></tt></a>：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">authenticate</span><span class="p">,</span> <span class="n">login</span>

<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">'username'</span><span class="p">]</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">'password'</span><span class="p">]</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
            <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
            <span class="c"># Redirect to a success page.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Return a 'disabled account' error message</span>
            <span class="o">...</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Return an 'invalid login' error message.</span>
        <span class="o">...</span>
</pre></div>
</div>
</dd></dl>
<div class="admonition-calling-authenticate-first admonition">
<p class="first admonition-title"><font id="75">先调用<tt class="docutils literal"><span class="pre">authenticate()</span></tt>：</font></p>
<p class="last"><font id="76">当你是手工登入一个用户时，你<em>必须</em>在调用<a class="reference internal" href="default.html#django.contrib.auth.login" title="django.contrib.auth.login"><tt class="xref py py-func docutils literal"><span class="pre">login()</span></tt></a>之前通过<a class="reference internal" href="default.html#django.contrib.auth.authenticate" title="django.contrib.auth.authenticate"><tt class="xref py py-func docutils literal"><span class="pre">authenticate()</span></tt></a>成功地认证该用户。</font><font id="77"><a class="reference internal" href="default.html#django.contrib.auth.authenticate" title="django.contrib.auth.authenticate"><tt class="xref py py-func docutils literal"><span class="pre">authenticate()</span></tt></a>在<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><tt class="xref py py-class docutils literal"><span class="pre">User</span></tt></a>上设置一个属性标识哪种认证后台成功认证了该用户（细节参见<a class="reference internal" href="customizing.html#authentication-backends"><em>后台的文档</em></a>），且该信息在后面登录的过程中是需要的。</font><font id="78">如果你视图登入一个直接从数据库中取出的用户，将会抛出一个错误。</font></p>
</div>
</div>
<div class="section" id="s-how-to-log-a-user-out">
<span id="how-to-log-a-user-out"></span><h3><font id="301">如何登出一个用户</font><a class="headerlink" href="default.html#how-to-log-a-user-out" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="django.contrib.auth.logout">
<tt class="descname">logout</tt>()<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth.html#logout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.logout" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="79">若要登出一个已经通过<a class="reference internal" href="default.html#django.contrib.auth.login" title="django.contrib.auth.login"><tt class="xref py py-func docutils literal"><span class="pre">django.contrib.auth.login()</span></tt></a>登入的用户，可以在你的视图中使用<a class="reference internal" href="default.html#django.contrib.auth.logout" title="django.contrib.auth.logout"><tt class="xref py py-func docutils literal"><span class="pre">django.contrib.auth.logout()</span></tt></a>。 </font><font id="80">它接收一个<a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><tt class="xref py py-class docutils literal"><span class="pre">HttpRequest</span></tt></a>对象且没有返回值。</font><font id="81">例如：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">logout</span>

<span class="k">def</span> <span class="nf">logout_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">logout</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="c"># Redirect to a success page.</span>
</pre></div>
</div>
<p><font id="82">注意，即使用户没有登入<a class="reference internal" href="default.html#django.contrib.auth.logout" title="django.contrib.auth.logout"><tt class="xref py py-func docutils literal"><span class="pre">logout()</span></tt></a>也不会抛出任何错误。</font></p>
<p><font id="83">当你调用<a class="reference internal" href="default.html#django.contrib.auth.logout" title="django.contrib.auth.logout"><tt class="xref py py-func docutils literal"><span class="pre">logout()</span></tt></a>时，当前请求的会话数据将被完全清除。</font><font id="84">所有存在的数据都将清除。</font><font id="85">这是为了防止另外一个人使用相同的Web浏览器登入并访问前一个用户的会话数据。</font><font id="86">如果你想在用户登出之后>可以立即访问放入会话中的数据，请在调用<a class="reference internal" href="default.html#django.contrib.auth.logout" title="django.contrib.auth.logout"><tt class="xref py py-func docutils literal"><span class="pre">django.contrib.auth.logout()</span></tt></a><em>之后</em>放入。</font></p>
</dd></dl>
</div>
<div class="section" id="s-limiting-access-to-logged-in-users">
<span id="limiting-access-to-logged-in-users"></span><h3><font id="302">限制访问给登陆后的用户</font><a class="headerlink" href="default.html#limiting-access-to-logged-in-users" title="Permalink to this headline">¶</a></h3>
<div class="section" id="s-the-raw-way">
<span id="the-raw-way"></span><h4><font id="315">原始的方法</font><a class="headerlink" href="default.html#the-raw-way" title="Permalink to this headline">¶</a></h4>
<p><font id="87">限制页面访问的简单、原始的方法是检查<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.is_authenticated" title="django.contrib.auth.models.User.is_authenticated"><tt class="xref py py-meth docutils literal"><span class="pre">request.user.is_authenticated()</span></tt></a>并重定向到一个登陆页面：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>

<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'</span><span class="si">%s</span><span class="s">?next=</span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">LOGIN_URL</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
    <span class="c"># ...</span>
</pre></div>
</div>
<p><font id="88">...或者显示一个错误信息：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'myapp/login_error.html'</span><span class="p">)</span>
    <span class="c"># ...</span>
</pre></div>
</div>
</div>
<div class="section" id="s-the-login-required-decorator">
<span id="the-login-required-decorator"></span><h4><font id="316">login_required 装饰器</font><a class="headerlink" href="default.html#the-login-required-decorator" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="django.contrib.auth.decorators.login_required">
<tt class="descname">login_required</tt>(<span class="optional">[</span><em>redirect_field_name=REDIRECT_FIELD_NAME</em>, <em>login_url=None</em><span class="optional">]</span>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/decorators.html#login_required"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.decorators.login_required" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="89">作为一个快捷方式，你可以使用便捷的<a class="reference internal" href="default.html#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><tt class="xref py py-func docutils literal"><span class="pre">login_required()</span></tt></a>装饰器：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>

<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p><font id="90"><a class="reference internal" href="default.html#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><tt class="xref py py-func docutils literal"><span class="pre">login_required()</span></tt></a>完成下面的事情：</font></p>
<ul class="simple">
<li><font id="453">如果用户没有登入，则重定向到<a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_URL">settings.LOGIN_URL</a>，并传递当前查询字符串中的绝对路径。</font><font id="454">例如：<tt class="docutils literal"><span class="pre">/accounts/login/?next=/polls/3/</span></tt>。</font></li>
<li><font id="455">如果用户已经登入，则正常执行视图。</font><font id="456">视图的代码可以安全地假设用户已经登入。</font></li>
</ul>
<p><font id="91">默认情况下，在成功认证后用户应该被重定向的路径存储在查询字符串的一个叫做<tt class="docutils literal"><span class="pre">"next"</span></tt>的参数中。</font><font id="452">如果对该参数你倾向使用一个不同的名字，<a class="reference internal" href="default.html#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><tt class="xref py py-func docutils literal"><span class="pre">login_required()</span></tt></a>带有一个可选的<tt class="docutils literal"><span class="pre">redirect_field_name</span></tt>参数：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>

<span class="nd">@login_required</span><span class="p">(</span><span class="n">redirect_field_name</span><span class="o">=</span><span class="s">'my_redirect_field'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p><font id="92">注意，如果你提供一个值给<tt class="docutils literal"><span class="pre">redirect_field_name</span></tt>，你非常可能同时需要自定义你的登录模板，因为存储重定向路径的模板上下文变量将使用<tt class="docutils literal"><span class="pre">redirect_field_name</span></tt>值作为它的键，而不是默认的<tt class="docutils literal"><span class="pre">"next"</span></tt>。</font></p>
<p><font id="93"><a class="reference internal" href="default.html#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><tt class="xref py py-func docutils literal"><span class="pre">login_required()</span></tt></a>还带有一个可选的<tt class="docutils literal"><span class="pre">login_url</span></tt>参数。</font><font id="94">例如：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>

<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">'/accounts/login/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p><font id="95">注意，如果你没有指定<tt class="docutils literal"><span class="pre">login_url</span></tt>参数，你需要确保<a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_URL"><tt class="xref std std-setting docutils literal"><span class="pre">settings.LOGIN_URL</span></tt></a>并且你的登录视图正确关联。</font><font id="97">例如，使用默认值，可以添加下面几行到你的URLconf中：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>

<span class="n">url</span><span class="p">(</span><span class="s">r'^accounts/login/$'</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">login</span><span class="p">),</span>
</pre></div>
</div>
<p><font id="98"><a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_URL"><tt class="xref std std-setting docutils literal"><span class="pre">settings.LOGIN_URL</span></tt></a>同时还接收视图函数名和<a class="reference internal" href="../http/urls.html#naming-url-patterns"><em>命名的URL模式</em></a>。</font><font id="100">这允许你自由地重新映射你的URLconf中的登录视图而不用更新设置。</font></p>
</dd></dl>
<div class="admonition note">
<p class="first admonition-title"><font id="101">注</font></p>
<p class="last"><font id="102">login_required装饰器不检查user的is_active标志位。</font></p>
</div>
</div>
<div class="section" id="s-limiting-access-to-logged-in-users-that-pass-a-test">
<span id="limiting-access-to-logged-in-users-that-pass-a-test"></span><h4><font id="317">给已验证登录的用户添加访问限制</font><a class="headerlink" href="default.html#limiting-access-to-logged-in-users-that-pass-a-test" title="Permalink to this headline">¶</a></h4>
<p><font id="103">基于特定的权限和其他方式来限制访问，你最好按照前面所叙述的那样操做。</font></p>
<p><font id="104">简单的方法就是在视图中直接运行你对<a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.user" title="django.http.HttpRequest.user"><tt class="xref py py-attr docutils literal"><span class="pre">request.user</span></tt></a>的测试。</font><font id="105">例如，视图检查用户的邮件属于特定的地址（例如@example.com），若不是，则重定向到登录页面。</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>

<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'@example.com'</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/login/?next=</span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="c"># ...</span>
</pre></div>
</div>
<dl class="function">
<dt id="django.contrib.auth.decorators.user_passes_test">
<tt class="descname">user_passes_test</tt>(<em>func</em><span class="optional">[</span>, <em>login_url=None</em>, <em>redirect_field_name=REDIRECT_FIELD_NAME</em><span class="optional">]</span>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/decorators.html#user_passes_test"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.decorators.user_passes_test" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="106">你可以用方便的 <tt class="docutils literal"><span class="pre">user_passes_test</span></tt> 装饰器，当回掉函数返回 <tt class="docutils literal"><span class="pre">False</span></tt> 时会执行一个重定向操作：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">user_passes_test</span>

<span class="k">def</span> <span class="nf">email_check</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'@example.com'</span><span class="p">)</span>

<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">email_check</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p><font id="107"><a class="reference internal" href="default.html#django.contrib.auth.decorators.user_passes_test" title="django.contrib.auth.decorators.user_passes_test"><tt class="xref py py-func docutils literal"><span class="pre">user_passes_test()</span></tt></a> 要求一个以<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><tt class="xref py py-class docutils literal"><span class="pre">User</span></tt></a> 对象为参数的回调函数，若用户允许访问此视图，返回 <tt class="docutils literal"><span class="pre">True</span></tt>。</font><font id="108">注意，<a class="reference internal" href="default.html#django.contrib.auth.decorators.user_passes_test" title="django.contrib.auth.decorators.user_passes_test"><tt class="xref py py-func docutils literal"><span class="pre">user_passes_test()</span></tt></a> 不会自动检查 <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><tt class="xref py py-class docutils literal"><span class="pre">User</span></tt></a> 是否是不是匿名对象。</font></p>
<p><font id="109"><a class="reference internal" href="default.html#django.contrib.auth.decorators.user_passes_test" title="django.contrib.auth.decorators.user_passes_test"><tt class="xref py py-func docutils literal"><span class="pre">user_passes_test()</span></tt></a>接收两个额外的参数：</font></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">login_url</span></tt></dt>
<dd><font id="483">让你指定那些没有通过检查的用户要重定向至哪里。</font><font id="484">若不指定其值，它可能是默认的 <a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_URL"><tt class="xref std std-setting docutils literal"><span class="pre">settings.LOGIN_URL</span></tt></a>。</font></dd>
<dt><tt class="docutils literal"><span class="pre">redirect_field_name</span></tt></dt>
<dd><font id="485">与<a class="reference internal" href="default.html#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><tt class="xref py py-func docutils literal"><span class="pre">login_required()</span></tt></a>的参数相同。</font><font id="486">把它设置为 <tt class="docutils literal"><span class="pre">None</span></tt> 来把它从 URL 中移除，当你想把通不过检查的用户重定向到没有next page 的非登录页面时。</font></dd>
</dl>
<p><font id="110">例如：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">email_check</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">'/login/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</dd></dl>
</div>
<div class="section" id="s-the-permission-required-decorator">
<span id="the-permission-required-decorator"></span><h4><font id="318">permission_required 装饰器</font><a class="headerlink" href="default.html#the-permission-required-decorator" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="django.contrib.auth.decorators.permission_required">
<tt class="descname">permission_required</tt>(<em>perm</em><span class="optional">[</span>, <em>login_url=None</em>, <em>raise_exception=False</em><span class="optional">]</span>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/decorators.html#permission_required"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.decorators.permission_required" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="111">检查一个用户是否有指定的权限是相对常见的需求。</font><font id="112">因此，Django 提供了一个快捷方式： <a class="reference internal" href="default.html#django.contrib.auth.decorators.permission_required" title="django.contrib.auth.decorators.permission_required"><tt class="xref py py-func docutils literal"><span class="pre">permission_required()</span></tt></a> 装饰器：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">permission_required</span>

<span class="nd">@permission_required</span><span class="p">(</span><span class="s">'polls.can_vote'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p><font id="113"><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.has_perm" title="django.contrib.auth.models.User.has_perm"><tt class="xref py py-meth docutils literal"><span class="pre">has_perm()</span></tt></a> 方法, 权限名称采用如下方法 <tt class="docutils literal"><span class="pre">"&lt;app</span> <span class="pre">label&gt;.&lt;permission</span> <span class="pre">codename&gt;"</span></tt> (例如 <tt class="docutils literal"><span class="pre">polls.can_vote</span></tt> 表示在 <tt class="docutils literal"><span class="pre">polls</span></tt> 应用下一个模块的权限。</font></p>
<p><font id="114">要注意<a class="reference internal" href="default.html#django.contrib.auth.decorators.permission_required" title="django.contrib.auth.decorators.permission_required"><tt class="xref py py-func docutils literal"><span class="pre">permission_required()</span></tt></a> 也接受一个可选的<tt class="docutils literal"><span class="pre">login_url</span></tt>参数。</font><font id="115">例如：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">permission_required</span>

<span class="nd">@permission_required</span><span class="p">(</span><span class="s">'polls.can_vote'</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">'/loginpage/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p><font id="116">在 <a class="reference internal" href="default.html#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><tt class="xref py py-func docutils literal"><span class="pre">login_required()</span></tt></a> 装饰器中， <tt class="docutils literal"><span class="pre">login_url</span></tt>默认为<a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_URL"><tt class="xref std std-setting docutils literal"><span class="pre">settings.</span></tt></a></font><font id="117">LOGIN_URL。</font></p>
<p><font id="118">如果提供了&nbsp;<tt class="docutils literal"><span class="pre">raise_exception</span></tt> 参数，装饰器抛出<a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.PermissionDenied" title="django.core.exceptions.PermissionDenied"><tt class="xref py py-exc docutils literal"><span class="pre">PermissionDenied</span></tt></a>异常，使用&nbsp;<a class="reference internal" href="../../ref/views.html#http-forbidden-view"><em>the 403 (HTTP Forbidden) 视图</em></a>而不是重定向到登录页面。</font></p>
<div class="versionchanged">
<span class="title">Changed in Django 1.7:</span> <p><font id="119"><a class="reference internal" href="default.html#django.contrib.auth.decorators.permission_required" title="django.contrib.auth.decorators.permission_required"><tt class="xref py py-func docutils literal"><span class="pre">permission_required()</span></tt></a>装饰器既可以接收一个权限序列也可以接收一个单个的权限。</font></p>
</div>
</dd></dl>
</div>
<div class="section" id="s-applying-permissions-to-generic-views">
<span id="s-id3"></span><span id="applying-permissions-to-generic-views"></span><span id="id3"></span><h4><font id="319">对普通的视图使用权限</font><a class="headerlink" href="default.html#applying-permissions-to-generic-views" title="Permalink to this headline">¶</a></h4>
<p><font id="120">若要对一个<a class="reference internal" href="../../ref/class-based-views/index.html"><em>基于类的普通视图</em></a>使用权限，可以在该类上装饰<a class="reference internal" href="../../ref/class-based-views/base.html#django.views.generic.base.View.dispatch" title="django.views.generic.base.View.dispatch"><tt class="xref py py-meth docutils literal"><span class="pre">View.dispatch</span></tt></a>方法。</font><font id="121">详细细节参见<a class="reference internal" href="../class-based-views/intro.html#id2"><em>Decorating the class</em></a>。 </font><font id="122">另外一个方法是<a class="reference internal" href="../class-based-views/intro.html#mixins-that-wrap-as-view"><em>编写一个封装as_view()的mixin</em></a>。</font></p>
</div>
<div class="section" id="s-session-invalidation-on-password-change">
<span id="s-id4"></span><span id="session-invalidation-on-password-change"></span><span id="id4"></span><h4><font id="320">密码更改后的会话失效</font><a class="headerlink" href="default.html#session-invalidation-on-password-change" title="Permalink to this headline">¶</a></h4>
<div class="versionadded">
<span class="title">New in Django 1.7.</span> </div>
<div class="admonition warning">
<p class="first admonition-title"><font id="123">警告</font></p>
<p><font id="124">这种保护只在<a class="reference internal" href="../../ref/settings.html#std:setting-MIDDLEWARE_CLASSES"><tt class="xref std std-setting docutils literal"><span class="pre">MIDDLEWARE_CLASSES</span></tt></a>中<a class="reference internal" href="../../ref/middleware.html#django.contrib.auth.middleware.SessionAuthenticationMiddleware" title="django.contrib.auth.middleware.SessionAuthenticationMiddleware"><tt class="xref py py-class docutils literal"><span class="pre">SessionAuthenticationMiddleware</span></tt></a>开启的情况下应用。</font><font id="125">如果<tt class="docutils literal"><span class="pre">settings.py</span></tt>由Django&nbsp;≥ 1.7. 的<a class="reference internal" href="../../ref/django-admin.html#django-admin-startproject"><tt class="xref std std-djadmin docutils literal"><span class="pre">startproject</span></tt></a>生成，它会被包含进来。</font></p>
<p class="last"><font id="126">在Django 2.0中，会话验证会变成强制性的， 无论是否开启了<tt class="docutils literal"><span class="pre">SessionAuthenticationMiddleware</span></tt> 。 </font><font id="127">如果你拥有一个1.7之前的项目，或者使用不包含<tt class="docutils literal"><span class="pre">SessionAuthenticationMiddleware</span></tt>的模板生成的项目，考虑在阅读下面的升级说明之后开启它。</font></p>
</div>
<p><font id="128">如果你的<a class="reference internal" href="../../ref/settings.html#std:setting-AUTH_USER_MODEL"><tt class="xref std std-setting docutils literal"><span class="pre">AUTH_USER_MODEL</span></tt></a>继承自<a class="reference internal" href="customizing.html#django.contrib.auth.models.AbstractBaseUser" title="django.contrib.auth.models.AbstractBaseUser"><tt class="xref py py-class docutils literal"><span class="pre">AbstractBaseUser</span></tt></a>，或者实现了它自己的<a class="reference internal" href="customizing.html#django.contrib.auth.models.AbstractBaseUser.get_session_auth_hash" title="django.contrib.auth.models.AbstractBaseUser.get_session_auth_hash"><tt class="xref py py-meth docutils literal"><span class="pre">get_session_auth_hash()</span></tt></a>方法，验证后的会话会包含这个函数返回的哈希值。</font><font id="129">在<a class="reference internal" href="customizing.html#django.contrib.auth.models.AbstractBaseUser" title="django.contrib.auth.models.AbstractBaseUser"><tt class="xref py py-class docutils literal"><span class="pre">AbstractBaseUser</span></tt></a>的情况中，这是密码字段的HMAC。</font><font id="130">如果开启了<a class="reference internal" href="../../ref/middleware.html#django.contrib.auth.middleware.SessionAuthenticationMiddleware" title="django.contrib.auth.middleware.SessionAuthenticationMiddleware"><tt class="xref py py-class docutils literal"><span class="pre">SessionAuthenticationMiddleware</span></tt></a> ，Django会验证每个请求带有的哈希值是否匹配服务端计算出来的哈希值。</font><font id="131">这允许用户通过修改密码来登出所有的会话。</font></p>
<p><font id="132">Django中包含的默认的密码修改视图，以及<a class="reference internal" href="index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><tt class="xref py py-mod docutils literal"><span class="pre">django.contrib.auth</span></tt></a>中的&nbsp;<a class="reference internal" href="default.html#django.contrib.auth.views.password_change" title="django.contrib.auth.views.password_change"><tt class="xref py py-func docutils literal"><span class="pre">django.contrib.auth.views.password_change()</span></tt></a>和<tt class="docutils literal"><span class="pre">user_change_password</span></tt>视图 ，会使用新的密码哈希值升级会话，以便用户在修改密码是不会登出。</font><font id="133">如果你拥有自定义的密码修改视图，并且希望具有相似的行为，使用这个函数：</font></p>
<dl class="function">
<dt id="django.contrib.auth.decorators.update_session_auth_hash">
<tt class="descname">update_session_auth_hash</tt>(<em>request</em>, <em>user</em>)<a class="headerlink" href="default.html#django.contrib.auth.decorators.update_session_auth_hash" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="134">这个函数接受当前请求，并且会在会话哈希值得到的地方升级用户对象，也会适当地升级会话哈希值。</font><font id="135">使用示例：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">update_session_auth_hash</span>

<span class="k">def</span> <span class="nf">password_change</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PasswordChangeForm</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">update_session_auth_hash</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
</dd></dl>
<p><font id="136">如果你在升级一个现存的站点，并且希望开启这一中间件，而不希望你的所有用户之后重新登录，你可以首先升级到DJango1.7并且运行它一段时间，以便所有会话在用户登录时自然被创建，它们包含上面描述的会话哈希。</font><font id="137">一旦你使用<a class="reference internal" href="../../ref/middleware.html#django.contrib.auth.middleware.SessionAuthenticationMiddleware" title="django.contrib.auth.middleware.SessionAuthenticationMiddleware"><tt class="xref py py-class docutils literal"><span class="pre">SessionAuthenticationMiddleware</span></tt></a>开始运行你的站点，任何没有登录并且会话使用验证哈希值升级过的用户的现有会话都会失效，并且需要重新登录。</font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="138">注意</font></p>
<p class="last"><font id="139">虽然<a class="reference internal" href="customizing.html#django.contrib.auth.models.AbstractBaseUser.get_session_auth_hash" title="django.contrib.auth.models.AbstractBaseUser.get_session_auth_hash"><tt class="xref py py-meth docutils literal"><span class="pre">get_session_auth_hash()</span></tt></a>给予<a class="reference internal" href="../../ref/settings.html#std:setting-SECRET_KEY"><tt class="xref std std-setting docutils literal"><span class="pre">SECRET_KEY</span></tt></a>，使用新的私钥升级你的站点会使所有现有会话失效。</font></p>
</div>
</div>
</div>
<div class="section" id="s-module-django.contrib.auth.views">
<span id="s-authentication-views"></span><span id="s-built-in-auth-views"></span><span id="module-django.contrib.auth.views"></span><span id="authentication-views"></span><span id="built-in-auth-views"></span><h3><font id="303">认证的视图</font><a class="headerlink" href="default.html#module-django.contrib.auth.views" title="Permalink to this headline">¶</a></h3>
<p><font id="140">Django提供一些视图，你可以用来处理登录、登出和密码管理。</font><font id="141">它们使用<a class="reference internal" href="default.html#built-in-auth-forms"><em>stock auth 表单</em></a>，但你也可以传递你自己的表单。</font></p>
<p><font id="142">Django没有为认证视图提供默认的模板。</font><font id="143">你应该为你想要使用的视图创建自己的模板。</font><font id="144">模板的上下文定义在每个视图中，参见<a class="reference internal" href="default.html#all-authentication-views"><em>所有的认证视图</em></a>.</font></p>
<div class="section" id="s-using-the-views">
<span id="s-id5"></span><span id="using-the-views"></span><span id="id5"></span><h4><font id="321">使用视图</font><a class="headerlink" href="default.html#using-the-views" title="Permalink to this headline">¶</a></h4>
<p><font id="145">有几种不同的方法在你的项目中使用这些视图。</font><font id="146">最简单的方法是包含<tt class="docutils literal"><span class="pre">django.contrib.auth.urls</span></tt>中提供的URLconf到你自己的URLconf中，例如</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">'^'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'django.contrib.auth.urls'</span><span class="p">))</span>
<span class="p">]</span>
</pre></div>
</div>
<p><font id="147">这将包含进下面的URL模式：</font></p>
<div class="highlight-python"><div class="highlight"><pre>^login/$ [name='login']
^logout/$ [name='logout']
^password_change/$ [name='password_change']
^password_change/done/$ [name='password_change_done']
^password_reset/$ [name='password_reset']
^password_reset/done/$ [name='password_reset_done']
^reset/(?P&lt;uidb64&gt;[0-9A-Za-z_\-]+)/(?P&lt;token&gt;[0-9A-Za-z]{1,13}-[0-9A-Za-z]{1,20})/$ [name='password_reset_confirm']
^reset/done/$ [name='password_reset_complete']
</pre></div>
</div>
<p><font id="148">这些视图提供了一个简单易记的URL名称。</font><font id="149">使用命名URL模式的细节请参见<a class="reference internal" href="../http/urls.html"><em>URL文档</em></a>。</font></p>
<p><font id="150">如果你想更多地控制你的URL，你可以在你的URLconf中引用一个特定的视图：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">'^change-password/'</span><span class="p">,</span> <span class="s">'django.contrib.auth.views.password_change'</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p><font id="151">这些视图具有可选的参数，你可以用来改变视图的行为。</font><font id="152">例如，如果你想修改一个视图使用的模板名称，你可以提供<tt class="docutils literal"><span class="pre">template_name</span></tt>参数。</font><font id="153">实现它的一种方法是在URLconf中提供一个关键字参数，它们将被传递到视图中。</font><font id="154">例如：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span>
        <span class="s">'^change-password/'</span><span class="p">,</span>
        <span class="s">'django.contrib.auth.views.password_change'</span><span class="p">,</span>
        <span class="p">{</span><span class="s">'template_name'</span><span class="p">:</span> <span class="s">'change-password.html'</span><span class="p">}</span>
    <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p><font id="155">所有的视图都返回一个<a class="reference internal" href="../../ref/template-response.html#django.template.response.TemplateResponse" title="django.template.response.TemplateResponse"><tt class="xref py py-class docutils literal"><span class="pre">TemplateResponse</span></tt></a> 实例，这允许你在渲染之前很容易自定义响应。</font><font id="156">实现它的一种方法是在你自己的视图中包装一个视图：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span>

<span class="k">def</span> <span class="nf">change_password</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">template_response</span> <span class="o">=</span> <span class="n">views</span><span class="o">.</span><span class="n">password_change</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="c"># Do something with `template_response`</span>
    <span class="k">return</span> <span class="n">template_response</span>
</pre></div>
</div>
<p><font id="157">更多的细节，参见<a class="reference internal" href="../../ref/template-response.html"><em>TemplateResponse文档</em></a>。</font></p>
</div>
<div class="section" id="s-all-authentication-views">
<span id="s-id6"></span><span id="all-authentication-views"></span><span id="id6"></span><h4><font id="322">所有的认证视图</font><a class="headerlink" href="default.html#all-authentication-views" title="Permalink to this headline">¶</a></h4>
<p><font id="158">下面列出了<tt class="docutils literal"><span class="pre">django.contrib.auth</span></tt>提供的所有视图。</font><font id="159">实现细节参见<a class="reference internal" href="default.html#using-the-views"><em>使用视图</em></a>。</font></p>
<dl class="function">
<dt id="django.contrib.auth.views.login">
<tt class="descname">login</tt>(<em>request</em><span class="optional">[</span>, <em>template_name</em>, <em>redirect_field_name</em>, <em>authentication_form</em>, <em>current_app</em>, <em>extra_context</em><span class="optional">]</span>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/views.html#login"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.views.login" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="160"><strong>URL 名称：</strong> </font><font id="161"><tt class="docutils literal"><span class="pre">login</span></tt></font></p>
<p><font id="162">关于使用命名URL模式的细节参见<a class="reference internal" href="../http/urls.html"><em>URL 文档</em></a>。</font></p>
<p><font id="163"><strong>可选的参数：</strong></font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">template_name</span></tt>: <font id="457">用于用户登录视图的模板名。</font><font id="458">默认为<tt class="file docutils literal"><span class="pre">registration/login.html</span></tt>。</font></li>
<li><tt class="docutils literal"><span class="pre">redirect_field_name</span></tt>: <font id="459"><tt class="docutils literal"><span class="pre">GET</span></tt>字段的名称，包含登陆后重定向URL。</font><font id="460">默认为<tt class="docutils literal"><span class="pre">next</span></tt>。</font></li>
<li><tt class="docutils literal"><span class="pre">authentication_form</span></tt>: <font id="461">用于认证的可调用对象（通常只是一个表单类）。</font><font id="462">默认为<a class="reference internal" href="default.html#django.contrib.auth.forms.AuthenticationForm" title="django.contrib.auth.forms.AuthenticationForm">AuthenticationForm</a>。</font></li>
<li><tt class="docutils literal"><span class="pre">current_app</span></tt>: <font id="463">指示包含当前视图的是哪个应用。</font><font id="464">更多信息参见<a class="reference internal" href="../http/urls.html#topics-http-reversing-url-namespaces">命名URL的解析策略</a>。</font></li>
<li><tt class="docutils literal"><span class="pre">extra_context</span></tt>: <font id="465">一个上下文数据的字典，将被添加到传递给模板的默认上下文数据中。</font></li>
</ul>
<p><font id="164">下面是<tt class="docutils literal"><span class="pre">django.contrib.auth.views.login</span></tt>所做的事情：</font></p>
<ul class="simple">
<li><font id="466">如果通过 <tt class="docutils literal"><span class="pre">GET</span></tt>调用，它显示一个POST给相同URL的登录表单。</font><font id="467">后面有更多这方面的信息。</font></li>
<li><font id="468">如果通过<tt class="docutils literal"><span class="pre">POST</span></tt>调用并带有用户提交的凭证，它会尝试登入该用户。</font><font id="469">如果登入成功，该视图重定向到<tt class="docutils literal"><span class="pre">next</span></tt>中指定的URL。</font><font id="470">如果<tt class="docutils literal"><span class="pre">next</span></tt>没有提供，它重定向到<a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_REDIRECT_URL">settings.LOGIN_REDIRECT_URL</a>（默认为<tt class="docutils literal"><span class="pre">/accounts/profile/</span></tt>）。</font><font id="471">如果登入不成功，则重新显示登录表单。</font></li>
</ul>
<p><font id="165">你需要提供html模板给login，默认调用<tt class="docutils literal"><span class="pre">registration/login.html</span></tt>。</font><font id="166">模板会得到4个模板上下文变量：</font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">form</span></tt>: <font id="472">一个表示<a class="reference internal" href="default.html#django.contrib.auth.forms.AuthenticationForm" title="django.contrib.auth.forms.AuthenticationForm">AuthenticationForm</a>的<a class="reference internal" href="../../ref/forms/api.html#django.forms.Form" title="django.forms.Form">Form</a>对象。</font></li>
<li><tt class="docutils literal"><span class="pre">next</span></tt>: <font id="473">登入成功之后重定向的URL。</font><font id="474">它还可能包含一个查询字符串。</font></li>
<li><tt class="docutils literal"><span class="pre">site</span></tt>: <font id="475"></font><font id="476">如果你没有安装site框架，这将被设置成<a class="reference internal" href="../../ref/contrib/sites.html#django.contrib.sites.requests.RequestSite" title="django.contrib.sites.requests.RequestSite">RequestSite</a>的一个实例，它从当前的<a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest">HttpRequest</a>获得site名称和域名。</font></li>
<li><tt class="docutils literal"><span class="pre">site_name</span></tt>: <font id="477"><tt class="docutils literal"><span class="pre">site.name</span></tt>的别名。</font><font id="478">如果你没有安装site框架，这将被设置成<a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.META" title="django.http.HttpRequest.META">request.META['SERVER_NAME']</a>的值。</font><font id="479">关于site 的更多信息，参见<a class="reference internal" href="../../ref/contrib/sites.html"><em>“sites” 框架</em></a>。</font></li>
</ul>
<p><font id="167">如果你不喜欢调用<tt class="file docutils literal"><span class="pre">registration/login.html</span></tt>，你可以通过额外的参数传递<tt class="docutils literal"><span class="pre">template_name</span></tt>参数给你URLconf中的视图。</font><font id="168">例如，下面URLconf中的行将使用<tt class="file docutils literal"><span class="pre">myapp/login.html</span></tt>：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">url</span><span class="p">(</span><span class="s">r'^accounts/login/$'</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">login</span><span class="p">,</span> <span class="p">{</span><span class="s">'template_name'</span><span class="p">:</span> <span class="s">'myapp/login.html'</span><span class="p">}),</span>
</pre></div>
</div>
<p><font id="169">通过传递<tt class="docutils literal"><span class="pre">redirect_field_name</span></tt>给视图，你还可以指定<tt class="docutils literal"><span class="pre">GET</span></tt>字段的值，它包含登入成功后的重定向的URL。</font><font id="170">默认情况下，该字段叫做<tt class="docutils literal"><span class="pre">next</span></tt>。</font></p>
<p><font id="171">下面是一个<tt class="file docutils literal"><span class="pre">registration/login.html</span></tt>模板的示例，你可以用它来作为起点。</font><font id="172">它假设你有一个定义了<tt class="docutils literal"><span class="pre">content</span></tt>块的<tt class="file docutils literal"><span class="pre">base.html</span></tt>模板：</font></p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"base.html"</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.errors</span> <span class="cp">%}</span>
<span class="nt">&lt;p&gt;</span>Your username and password didn't match. Please try again.<span class="nt">&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'django.contrib.auth.views.login'</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>
<span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="nt">&lt;table&gt;</span>
<span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">form.username.label_tag</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">form.username</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">form.password.label_tag</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">{{</span> <span class="nv">form.password</span> <span class="cp">}}</span><span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/table&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"login"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"next"</span> <span class="na">value=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">next</span> <span class="cp">}}</span><span class="s">"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><font id="173">如果你自定义认证（参见<a class="reference internal" href="customizing.html"><em>Customizing Authentication</em></a>），你可以通过<tt class="docutils literal"><span class="pre">authentication_form</span></tt>参数传递一个自定义的认证表单给登录视图。</font><font id="174">该表单必须在它的<tt class="docutils literal"><span class="pre">__init__</span></tt>方法中接收一个<tt class="docutils literal"><span class="pre">request</span></tt>关键字参数，并提供一个<tt class="docutils literal"><span class="pre">get_user</span></tt>方法，此方法返回认证过的用户对象（这个方法永远只在表单验证成功后调用）。</font></p>
</dd></dl>
<dl class="function">
<dt id="django.contrib.auth.views.logout">
<tt class="descname">logout</tt>(<em>request</em><span class="optional">[</span>, <em>next_page</em>, <em>template_name</em>, <em>redirect_field_name</em>, <em>current_app</em>, <em>extra_context</em><span class="optional">]</span>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/views.html#logout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.views.logout" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="175">登出一个用户。</font></p>
<p><font id="176"><strong>URL名称：</strong> </font><font id="177"><tt class="docutils literal"><span class="pre">logout</span></tt></font></p>
<p><font id="178"><strong>可选的参数：</strong></font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">next_page</span></tt>: <font id="487">登出之后要重定向的URL。</font></li>
<li><tt class="docutils literal"><span class="pre">template_name</span></tt>: <font id="488">用户登出之后，要展示的模板的完整名称。</font><font id="489">如果不提供任何参数，默认为<tt class="file docutils literal"><span class="pre">registration/logged_out.html</span></tt>。</font></li>
<li><tt class="docutils literal"><span class="pre">redirect_field_name</span></tt>: <font id="490">包含登出之后所重定向的URL的<tt class="docutils literal"><span class="pre">GET</span></tt>字段的名称。</font><font id="491">默认为 <tt class="docutils literal"><span class="pre">next</span></tt>。</font><font id="492">如果提供了<tt class="docutils literal"><span class="pre">GET</span></tt>参数，会覆盖<tt class="docutils literal"><span class="pre">next_page</span></tt> URL。</font></li>
<li><tt class="docutils literal"><span class="pre">current_app</span></tt>: <font id="493">一个提示，表明哪个应用含有了当前视图。 </font><font id="494">详见 <a class="reference internal" href="../http/urls.html#topics-http-reversing-url-namespaces">命名空间下的URL解析策略</a> 。</font></li>
<li><tt class="docutils literal"><span class="pre">extra_context</span></tt>: <font id="495">一个上下文数据的字典，会被添加到向模板传递的默认的上下文数据中。</font></li>
</ul>
<p><font id="179"><strong>模板上下文：</strong></font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">title</span></tt>: <font id="496">本地化的字符串“登出”。</font></li>
<li><tt class="docutils literal"><span class="pre">site</span></tt>: <font id="497">根据<a class="reference internal" href="../../ref/settings.html#std:setting-SITE_ID">SITE_ID</a> 设置的当前<a class="reference internal" href="../../ref/contrib/sites.html#django.contrib.sites.models.Site" title="django.contrib.sites.models.Site">站点</a>。</font><font id="498">如果你并没有安装站点框架，会设置为&nbsp;<a class="reference internal" href="../../ref/contrib/sites.html#django.contrib.sites.requests.RequestSite" title="django.contrib.sites.requests.RequestSite">RequestSite</a>的示例，它从当前<a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest">HttpRequest</a>来获取站点名称和域名。</font></li>
<li><tt class="docutils literal"><span class="pre">site_name</span></tt>: <font id="499"><tt class="docutils literal"><span class="pre">site.name</span></tt>的别名。</font><font id="500">如果没有安装站点框架，会设置为<a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.META" title="django.http.HttpRequest.META">request.META['SERVER_NAME']</a>。</font><font id="501">站点的更多信息请见<a class="reference internal" href="../../ref/contrib/sites.html"><em>“站点”框架</em></a>。</font></li>
<li><tt class="docutils literal"><span class="pre">current_app</span></tt>: <font id="502">一个提示，表明哪个应用含有了当前视图。 </font><font id="503">详见 <a class="reference internal" href="../http/urls.html#topics-http-reversing-url-namespaces">命名空间下的URL解析策略</a> 。</font></li>
<li><tt class="docutils literal"><span class="pre">extra_context</span></tt>: <font id="504">一个上下文数据的字典，会被添加到向模板传递的默认的上下文数据中。</font></li>
</ul>
</dd></dl>
<dl class="function">
<dt id="django.contrib.auth.views.logout_then_login">
<tt class="descname">logout_then_login</tt>(<em>request</em><span class="optional">[</span>, <em>login_url</em>, <em>current_app</em>, <em>extra_context</em><span class="optional">]</span>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/views.html#logout_then_login"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.views.logout_then_login" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="180">登出一个用户，然后重定向到登录页面。</font></p>
<p><font id="181"><strong>URL 名称：</strong> </font><font id="182">没有提供默认的URL</font></p>
<p><font id="183"><strong>可选的参数：</strong></font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">login_url</span></tt>: <font id="505">登录页面要重定向的URL。</font><font id="506">如果没有提供，默认为<a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_URL">settings.LOGIN_URL</a>。</font></li>
<li><tt class="docutils literal"><span class="pre">current_app</span></tt>: <font id="507">一个提示，表明哪个应用含有了当前视图。</font><font id="508">详见 <a class="reference internal" href="../http/urls.html#topics-http-reversing-url-namespaces">命名空间下的URL解析策略</a> 。</font></li>
<li><tt class="docutils literal"><span class="pre">extra_context</span></tt>: <font id="509">一个上下文数据的字典，会被添加到向模板传递的默认的上下文数据中。</font></li>
</ul>
</dd></dl>
<dl class="function">
<dt id="django.contrib.auth.views.password_change">
<tt class="descname">password_change</tt>(<em>request</em><span class="optional">[</span>, <em>template_name</em>, <em>post_change_redirect</em>, <em>password_change_form</em>, <em>current_app</em>, <em>extra_context</em><span class="optional">]</span>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/views.html#password_change"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.views.password_change" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="184">允许一个用户修改他的密码。</font></p>
<p><font id="185"><strong>URL 名称：</strong> </font><font id="186"><tt class="docutils literal"><span class="pre">password_change</span></tt></font></p>
<p><font id="187"><strong>可选的参数：</strong></font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">template_name</span></tt>: <font id="510">用来显示修改密码表单的template的全名。</font><font id="511">如果没有提供，默认为<tt class="file docutils literal"><span class="pre">registration/password_change_form.html</span></tt> 。</font></li>
<li><tt class="docutils literal"><span class="pre">post_change_redirect</span></tt>: <font id="512">密码修改成功后重定向的URL。</font></li>
<li><tt class="docutils literal"><span class="pre">password_change_form</span></tt>: <font id="513">一个自定义的“修改密码”表单，必须接受<tt class="docutils literal"><span class="pre">user</span></tt> 关键词参数。</font><font id="514">表单用于实际修改用户密码。</font><font id="515">默认为 <a class="reference internal" href="default.html#django.contrib.auth.forms.PasswordChangeForm" title="django.contrib.auth.forms.PasswordChangeForm">PasswordChangeForm</a>。</font></li>
<li><tt class="docutils literal"><span class="pre">current_app</span></tt>: <font id="516">一个提示，暗示哪个应用包含当前的视图。</font><font id="517">详见 <a class="reference internal" href="../http/urls.html#topics-http-reversing-url-namespaces">命名空间下的URL解析策略</a> 。</font></li>
<li><tt class="docutils literal"><span class="pre">extra_context</span></tt>: <font id="518">上下文数据的字典，会添加到传递给模板的默认的上下文数据中。</font></li>
</ul>
<p><font id="188"><strong>模板上下文：</strong></font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">form</span></tt>: <font id="519">密码修改表单（请见上面的<tt class="docutils literal"><span class="pre">password_change_form</span></tt>）。</font></li>
</ul>
</dd></dl>
<dl class="function">
<dt id="django.contrib.auth.views.password_change_done">
<tt class="descname">password_change_done</tt>(<em>request</em><span class="optional">[</span>, <em>template_name</em>, <em>current_app</em>, <em>extra_context</em><span class="optional">]</span>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/views.html#password_change_done"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.views.password_change_done" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="189">这个页面在用户修改密码之后显示。</font></p>
<p><font id="190"><strong>URL 名称：</strong> </font><font id="191"><tt class="docutils literal"><span class="pre">password_change_done</span></tt></font></p>
<p><font id="192"><strong>可选参数：</strong></font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">template_name</span></tt>: <font id="520">所使用模板的完整名称。</font><font id="521">如果没有提供，默认为<tt class="file docutils literal"><span class="pre">registration/password_change_done.html</span></tt>。</font></li>
<li><tt class="docutils literal"><span class="pre">current_app</span></tt>: <font id="522">一个提示，暗示哪个应用包含当前的视图。 </font><font id="523">详见 <a class="reference internal" href="../http/urls.html#topics-http-reversing-url-namespaces">命名空间下的URL解析策略</a> 。</font></li>
<li><tt class="docutils literal"><span class="pre">extra_context</span></tt>: <font id="524">上下文数据的字典，会添加到传递给模板的默认的上下文数据中。</font></li>
</ul>
</dd></dl>
<dl class="function">
<dt id="django.contrib.auth.views.password_reset">
<tt class="descname">password_reset</tt>(<em>request</em><span class="optional">[</span>, <em>is_admin_site</em>, <em>template_name</em>, <em>email_template_name</em>, <em>password_reset_form</em>, <em>token_generator</em>, <em>post_reset_redirect</em>, <em>from_email</em>, <em>current_app</em>, <em>extra_context</em>, <em>html_email_template_name</em><span class="optional">]</span>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/views.html#password_reset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.views.password_reset" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="193">允许用户通过生成一次性的连接并发送到用户注册的邮箱地址中来重置密码。</font></p>
<p><font id="194">如果提供的邮箱地址不在系统中存在，这个视图不会发送任何邮件，但是用户也不会收到任何错误信息。</font><font id="195">这会阻止数据泄露给潜在的攻击者。</font><font id="196">如果你打算在这种情况提供错误信息，你可以继承<a class="reference internal" href="default.html#django.contrib.auth.forms.PasswordResetForm" title="django.contrib.auth.forms.PasswordResetForm"><tt class="xref py py-class docutils literal"><span class="pre">PasswordResetForm</span></tt></a>，并使用<tt class="docutils literal"><span class="pre">password_reset_form</span></tt> 参数。</font></p>
<p><font id="197">用无效密码标记的用户（参见<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.set_unusable_password" title="django.contrib.auth.models.User.set_unusable_password"><tt class="xref py py-meth docutils literal"><span class="pre">set_unusable_password()</span></tt></a>）不允许请求重置密码，为了防止使用类似于LDAP的外部验证资源时的滥用。</font><font id="198">注意它们不会收到任何错误信息，因为这会暴露它们的账户，也不会发送任何邮件。</font></p>
<p><font id="199"><strong>URL 名称：</strong> </font><font id="200"><tt class="docutils literal"><span class="pre">password_reset</span></tt></font></p>
<p><font id="201"><strong>可选参数：</strong></font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">template_name</span></tt>: <font id="525">The full name of a template to use for displaying the password reset form. </font><font id="526">Defaults to <tt class="file docutils literal"><span class="pre">registration/password_reset_form.html</span></tt> if not supplied.</font></li>
<li><tt class="docutils literal"><span class="pre">email_template_name</span></tt>: <font id="527">The full name of a template to use for generating the email with the reset password link. </font><font id="528">Defaults to <tt class="file docutils literal"><span class="pre">registration/password_reset_email.html</span></tt> if not supplied.</font></li>
<li><tt class="docutils literal"><span class="pre">subject_template_name</span></tt>: <font id="529">The full name of a template to use for the subject of the email with the reset password link. </font><font id="530">Defaults to <tt class="file docutils literal"><span class="pre">registration/password_reset_subject.txt</span></tt> if not supplied.</font></li>
<li><tt class="docutils literal"><span class="pre">password_reset_form</span></tt>: <font id="531">Form that will be used to get the email of the user to reset the password for. </font><font id="532">Defaults to <a class="reference internal" href="default.html#django.contrib.auth.forms.PasswordResetForm" title="django.contrib.auth.forms.PasswordResetForm"><tt class="xref py py-class docutils literal"><span class="pre">PasswordResetForm</span></tt></a>.</font></li>
<li><tt class="docutils literal"><span class="pre">token_generator</span></tt>: <font id="533">Instance of the class to check the one time link. </font><font id="534">This will default to <tt class="docutils literal"><span class="pre">default_token_generator</span></tt>, it’s an instance of <tt class="docutils literal"><span class="pre">django.contrib.auth.tokens.PasswordResetTokenGenerator</span></tt>.</font></li>
<li><tt class="docutils literal"><span class="pre">post_reset_redirect</span></tt>: <font id="535">The URL to redirect to after a successful password reset request.</font></li>
<li><tt class="docutils literal"><span class="pre">from_email</span></tt>: <font id="536">A valid email address. </font><font id="537">By default Django uses the <a class="reference internal" href="http://python.usyiyi.cn/ref/settings/#std:setting-DEFAULT_FROM_EMAIL"><tt class="xref std std-setting docutils literal"><span class="pre">DEFAULT_FROM_EMAIL</span></tt></a>.</font></li>
<li><tt class="docutils literal"><span class="pre">current_app</span></tt>: <font id="538">A hint indicating which application contains the current view. </font><font id="539">See the <a class="reference internal" href="http://python.usyiyi.cn/django/http/urls/#topics-http-reversing-url-namespaces"><em>namespaced URL resolution strategy</em></a> for more information.</font></li>
<li><tt class="docutils literal"><span class="pre">extra_context</span></tt>: <font id="540">A dictionary of context data that will be added to the default context data passed to the template.</font></li>
<li><tt class="docutils literal"><span class="pre">html_email_template_name</span></tt>: <font id="541">The full name of a template to use for generating a <tt class="docutils literal"><span class="pre">text/html</span></tt> multipart email with the password reset link. </font><font id="542">By default, HTML email is not sent.</font></li>
</ul>
<div class="versionadded">
<span class="title">New in Django 1.7:</span> <p><font id="202">添加了<tt class="docutils literal"><span class="pre">html_email_template_name</span></tt>。</font></p>
</div>
<div class="deprecated">
<p><font id="203"><span class="versionmodified">Deprecated since version 1.8: </span></font><font id="204"><tt class="docutils literal"><span class="pre">is_admin_site</span></tt>参数已被废弃，将在Django2.0中被移除。</font></p>
</div>
<p><font id="205"><strong>模板上下文：</strong></font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">form</span></tt>: <font id="543">The form (see <tt class="docutils literal"><span class="pre">password_reset_form</span></tt> above) for resetting the user’s password.</font></li>
</ul>
<p><font id="206"><strong>Email模板上下文：</strong></font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">email</span></tt>: <font id="544">An alias for <tt class="docutils literal"><span class="pre">user.email</span></tt></font></li>
<li><tt class="docutils literal"><span class="pre">user</span></tt>: <font id="545">The current <a class="reference internal" href="http://python.usyiyi.cn/ref/contrib/auth/#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><tt class="xref py py-class docutils literal"><span class="pre">User</span></tt></a>, according to the <tt class="docutils literal"><span class="pre">email</span></tt> form field. </font><font id="546">Only active users are able to reset their passwords (<tt class="docutils literal"><span class="pre">User.is_active</span> <span class="pre">is</span> <span class="pre">True</span></tt>).</font></li>
<li><tt class="docutils literal"><span class="pre">site_name</span></tt>: <font id="547">An alias for <tt class="docutils literal"><span class="pre">site.name</span></tt>. </font><font id="548">If you don’t have the site framework installed, this will be set to the value of <a class="reference internal" href="http://python.usyiyi.cn/ref/request-response/#django.http.HttpRequest.META" title="django.http.HttpRequest.META"><tt class="xref py py-attr docutils literal"><span class="pre">request.META['SERVER_NAME']</span></tt></a>. </font><font id="549">For more on sites, see <a class="reference internal" href="../../ref/contrib/sites.html"><em>The “sites” framework</em></a>.</font></li>
<li><tt class="docutils literal"><span class="pre">domain</span></tt>: <font id="550">An alias for <tt class="docutils literal"><span class="pre">site.domain</span></tt>. </font><font id="551">If you don’t have the site framework installed, this will be set to the value of <tt class="docutils literal"><span class="pre">request.get_host()</span></tt>.</font></li>
<li><tt class="docutils literal"><span class="pre">protocol</span></tt>: <font id="552">http or https</font></li>
<li><tt class="docutils literal"><span class="pre">uid</span></tt>: <font id="553">The user’s primary key encoded in base 64.</font></li>
<li><tt class="docutils literal"><span class="pre">token</span></tt>: <font id="554">Token to check that the reset link is valid.</font></li>
</ul>
<p><font id="207"><tt class="docutils literal"><span class="pre">registration/password_reset_email.html</span></tt>样例（邮件正文模板）：</font></p>
<div class="highlight-html+django"><div class="highlight"><pre>Someone asked for password reset for email <span class="cp">{{</span> <span class="nv">email</span> <span class="cp">}}</span>. Follow the link below:
<span class="cp">{{</span> <span class="nv">protocol</span><span class="cp">}}</span>://<span class="cp">{{</span> <span class="nv">domain</span> <span class="cp">}}{%</span> <span class="k">url</span> <span class="s1">'password_reset_confirm'</span> <span class="nv">uidb64</span><span class="o">=</span><span class="nv">uid</span> <span class="nv">token</span><span class="o">=</span><span class="nv">token</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><font id="208">主题模板使用了同样的模板上下文。</font><font id="209">主题必须是单行的纯文本字符串。</font></p>
</dd></dl>
<dl class="function">
<dt id="django.contrib.auth.views.password_reset_done">
<tt class="descname">password_reset_done</tt>(<em>request</em><span class="optional">[</span>, <em>template_name</em>, <em>current_app</em>, <em>extra_context</em><span class="optional">]</span>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/views.html#password_reset_done"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.views.password_reset_done" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="210">这个页面在向用户发送重置密码的邮件后展示。</font><font id="211">如果<a class="reference internal" href="default.html#django.contrib.auth.views.password_reset" title="django.contrib.auth.views.password_reset"><tt class="xref py py-func docutils literal"><span class="pre">password_reset()</span></tt></a>视图没有显式设置&nbsp;<tt class="docutils literal"><span class="pre">post_reset_redirect</span></tt>URL，默认会调用这个视图。</font></p>
<p><font id="212"><strong>URL名称：</strong> </font><font id="213"><tt class="docutils literal"><span class="pre">password_reset_done</span></tt></font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="214">注意</font></p>
<p class="last"><font id="215">如果提供的email地址在系统中不存在，用户未激活，或者密码不可用，用户仍然会重定向到这个视图，但是不会发送邮件。</font></p>
</div>
<p><font id="216"><strong>可选参数：</strong></font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">template_name</span></tt>: The full name of a template to use.
Defaults to <tt class="file docutils literal"><span class="pre">registration/password_reset_done.html</span></tt> if not
supplied.</li>
<li><tt class="docutils literal"><span class="pre">current_app</span></tt>: A hint indicating which application contains the current
view. See the <a class="reference internal" href="../http/urls.html#topics-http-reversing-url-namespaces"><font id="394">{{s.393}}</font></a> for more information.</li>
<li><tt class="docutils literal"><span class="pre">extra_context</span></tt>: A dictionary of context data that will be added to the
default context data passed to the template.</li>
</ul>
</dd></dl>
<dl class="function">
<dt id="django.contrib.auth.views.password_reset_confirm">
<tt class="descname">password_reset_confirm</tt>(<em>request</em><span class="optional">[</span>, <em>uidb64</em>, <em>token</em>, <em>template_name</em>, <em>token_generator</em>, <em>set_password_form</em>, <em>post_reset_redirect</em>, <em>current_app</em>, <em>extra_context</em><span class="optional">]</span>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/views.html#password_reset_confirm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.views.password_reset_confirm" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="217">为输入新密码展示表单。</font></p>
<p><font id="218"><strong>URL名称：</strong> </font><font id="219"><tt class="docutils literal"><span class="pre">password_reset_confirm</span></tt></font></p>
<p><font id="220"><strong>可选参数：</strong></font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">uidb64</span></tt>: The user’s id encoded in base 64. Defaults to <tt class="docutils literal"><span class="pre">None</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">token</span></tt>: Token to check that the password is valid. Defaults to
<tt class="docutils literal"><span class="pre">None</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">template_name</span></tt>: The full name of a template to display the confirm
password view. Default value is <tt class="file docutils literal"><span class="pre">registration/password_reset_confirm.html</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">token_generator</span></tt>: Instance of the class to check the password. This
will default to <tt class="docutils literal"><span class="pre">default_token_generator</span></tt>, it’s an instance of
<tt class="docutils literal"><span class="pre">django.contrib.auth.tokens.PasswordResetTokenGenerator</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">set_password_form</span></tt>: Form that will be used to set the password.
Defaults to <a class="reference internal" href="default.html#django.contrib.auth.forms.SetPasswordForm" title="django.contrib.auth.forms.SetPasswordForm"><font id="396">{{s.395}}</font></a></li>
<li><tt class="docutils literal"><span class="pre">post_reset_redirect</span></tt>: URL to redirect after the password reset
done. Defaults to <tt class="docutils literal"><span class="pre">None</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">current_app</span></tt>: A hint indicating which application contains the current
view. See the <a class="reference internal" href="../http/urls.html#topics-http-reversing-url-namespaces"><font id="401">{{s.400}}</font></a> for more information.</li>
<li><tt class="docutils literal"><span class="pre">extra_context</span></tt>: A dictionary of context data that will be added to the
default context data passed to the template.</li>
</ul>
<p><font id="221"><strong>Template context:</strong></font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">form</span></tt>: The form (see <tt class="docutils literal"><span class="pre">set_password_form</span></tt> above) for setting the
new user’s password.</li>
<li><tt class="docutils literal"><span class="pre">validlink</span></tt>: Boolean, True if the link (combination of <tt class="docutils literal"><span class="pre">uidb64</span></tt> and
<tt class="docutils literal"><span class="pre">token</span></tt>) is valid or unused yet.</li>
</ul>
</dd></dl>
<dl class="function">
<dt id="django.contrib.auth.views.password_reset_complete">
<tt class="descname">password_reset_complete</tt>(<em>request</em><span class="optional">[</span>, <em>template_name</em>, <em>current_app</em>, <em>extra_context</em><span class="optional">]</span>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/views.html#password_reset_complete"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.views.password_reset_complete" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="222">展示一个视图，它通知用户密码修改成功。</font></p>
<p><font id="223"><strong>URL名称：</strong> </font><font id="224"><tt class="docutils literal"><span class="pre">password_reset_complete</span></tt></font></p>
<p><font id="225"><strong>可选参数：</strong></font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">template_name</span></tt>: The full name of a template to display the view.
Defaults to <tt class="file docutils literal"><span class="pre">registration/password_reset_complete.html</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">current_app</span></tt>: A hint indicating which application contains the current
view. See the <a class="reference internal" href="../http/urls.html#topics-http-reversing-url-namespaces"><font id="404">{{s.403}}</font></a> for more information.</li>
<li><tt class="docutils literal"><span class="pre">extra_context</span></tt>: A dictionary of context data that will be added to the
default context data passed to the template.</li>
</ul>
</dd></dl>
</div>
</div>
<div class="section" id="s-helper-functions">
<span id="helper-functions"></span><h3><font id="304">辅助函数</font><a class="headerlink" href="default.html#helper-functions" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="django.contrib.auth.views.redirect_to_login">
<tt class="descname">redirect_to_login</tt>(<em>next</em><span class="optional">[</span>, <em>login_url</em>, <em>redirect_field_name</em><span class="optional">]</span>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/views.html#redirect_to_login"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.views.redirect_to_login" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="226">重定向到登录页面，然后在登入成功后回到另一个URL。</font></p>
<p><font id="227"><strong>必需的参数：</strong></font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">next</span></tt>: The URL to redirect to after a successful login.</li>
</ul>
<p><font id="228"><strong>可选的参数：</strong></font></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">login_url</span></tt>: The URL of the login page to redirect to.
Defaults to <a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_URL"><font id="412">{{s.411}}</font></a> if not supplied.</li>
<li><tt class="docutils literal"><span class="pre">redirect_field_name</span></tt>: The name of a <tt class="docutils literal"><span class="pre">GET</span></tt> field containing the
URL to redirect to after log out. Overrides <tt class="docutils literal"><span class="pre">next</span></tt> if the given
<tt class="docutils literal"><span class="pre">GET</span></tt> parameter is passed.</li>
</ul>
</dd></dl>
</div>
<div class="section" id="s-module-django.contrib.auth.forms">
<span id="s-built-in-forms"></span><span id="s-built-in-auth-forms"></span><span id="module-django.contrib.auth.forms"></span><span id="built-in-forms"></span><span id="built-in-auth-forms"></span><h3><font id="305">内建的表单</font><a class="headerlink" href="default.html#module-django.contrib.auth.forms" title="Permalink to this headline">¶</a></h3>
<p><font id="229">如果你不想用内建的视图，但是又不想编写针对该功能的表单，认证系统提供了几个内建的表单，位于<a class="reference internal" href="default.html#module-django.contrib.auth.forms" title="django.contrib.auth.forms"><tt class="xref py py-mod docutils literal"><span class="pre">django.contrib.auth.forms</span></tt></a>：</font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="230">注</font></p>
<p class="last"><font id="231">内建的验证表单对他们处理的用户模型做了特定假设。</font><font id="232">如果你使用了<a class="reference internal" href="customizing.html#auth-custom-user"><em>自定义的用户模型</em></a>，可能需要为验证系统定义你自己的表单。</font><font id="233">更多信息请见&nbsp;<a class="reference internal" href="customizing.html#custom-users-and-the-built-in-auth-forms"><em>使用带有自定义用户模型的内建验证表单</em></a>的文档。</font></p>
</div>
<dl class="class">
<dt id="django.contrib.auth.forms.AdminPasswordChangeForm">
<em class="property">class </em><tt class="descname">AdminPasswordChangeForm</tt><a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/forms.html#AdminPasswordChangeForm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.forms.AdminPasswordChangeForm" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="234">管理界面中使用的表单，用于修改用户密码。</font></p>
<p><font id="235">接受<tt class="docutils literal"><span class="pre">user</span></tt>作为第一个参数。</font></p>
</dd></dl>
<dl class="class">
<dt id="django.contrib.auth.forms.AuthenticationForm">
<em class="property">class </em><tt class="descname">AuthenticationForm</tt><a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/forms.html#AuthenticationForm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.forms.AuthenticationForm" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="236">用于用户登录的表单。</font></p>
<p><font id="237">接受<tt class="docutils literal"><span class="pre">request</span></tt> 作为第一个参数，它储存在表单实例中，被子类使用。</font></p>
<dl class="method">
<dt id="django.contrib.auth.forms.AuthenticationForm.confirm_login_allowed">
<tt class="descname">confirm_login_allowed</tt>(<em>user</em>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/forms.html#AuthenticationForm.confirm_login_allowed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.forms.AuthenticationForm.confirm_login_allowed" title="Permalink to this definition">¶</a></dt>
<dd><div class="versionadded">
<span class="title">New in Django 1.7.</span> </div>
<p><font id="238">通常，&nbsp;<tt class="docutils literal"><span class="pre">AuthenticationForm</span></tt>会拒绝&nbsp;<tt class="docutils literal"><span class="pre">is_active</span></tt>标志是<tt class="docutils literal"><span class="pre">False</span></tt>的用户。</font><font id="239">你可以使用自定义政策覆盖这一行为，来决定哪些用户可以登录。</font><font id="240">使用一个继承&nbsp;<tt class="docutils literal"><span class="pre">AuthenticationForm</span></tt>并覆写<tt class="docutils literal"><span class="pre">confirm_login_allowed</span></tt>方法的自定义表单来实现它。</font><font id="241">如果提供的用户不能登录，这个方法应该抛出<a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.ValidationError" title="django.core.exceptions.ValidationError"><tt class="xref py py-exc docutils literal"><span class="pre">ValidationError</span></tt></a>异常。</font></p>
<p><font id="242">例如，允许所有用户登录，不管“活动”状态如何：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">AuthenticationForm</span>

<span class="k">class</span> <span class="nc">AuthenticationFormWithInactiveUsersOkay</span><span class="p">(</span><span class="n">AuthenticationForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">confirm_login_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p><font id="243">或者只允许一些活动用户登录进来：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PickyAuthenticationForm</span><span class="p">(</span><span class="n">AuthenticationForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">confirm_login_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s">"This account is inactive."</span><span class="p">),</span>
                <span class="n">code</span><span class="o">=</span><span class="s">'inactive'</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'b'</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s">"Sorry, accounts starting with 'b' aren't welcome here."</span><span class="p">),</span>
                <span class="n">code</span><span class="o">=</span><span class="s">'no_b_users'</span><span class="p">,</span>
            <span class="p">)</span>
</pre></div>
</div>
</dd></dl>
</dd></dl>
<dl class="class">
<dt id="django.contrib.auth.forms.PasswordChangeForm">
<em class="property">class </em><tt class="descname">PasswordChangeForm</tt><a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/forms.html#PasswordChangeForm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.forms.PasswordChangeForm" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="244">一个表单，允许用户修改他们的密码。</font></p>
</dd></dl>
<dl class="class">
<dt id="django.contrib.auth.forms.PasswordResetForm">
<em class="property">class </em><tt class="descname">PasswordResetForm</tt><a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/forms.html#PasswordResetForm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.forms.PasswordResetForm" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="245">一个表单，用于生成和通过邮件发送一次性密码重置链接。</font></p>
<dl class="method">
<dt id="django.contrib.auth.forms.PasswordResetForm.send_email">
<tt class="descname">send_email</tt>(<em>subject_template_name</em>, <em>email_template_name</em>, <em>context</em>, <em>from_email</em>, <em>to_email</em><span class="optional">[</span>, <em>html_email_template_name=None</em><span class="optional">]</span>)<a class="headerlink" href="default.html#django.contrib.auth.forms.PasswordResetForm.send_email" title="Permalink to this definition">¶</a></dt>
<dd><div class="versionadded">
<span class="title">New in Django 1.8.</span> </div>
<p><font id="246">使用参数来发送<tt class="docutils literal"><span class="pre">EmailMultiAlternatives</span></tt>。</font><font id="247">可以覆盖来自定义邮件如何发送给用户。</font></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name"></col>
<col class="field-body"></col>
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>subject_template_name</strong> – the template for the subject.</li>
<li><strong>email_template_name</strong> – the template for the email body.</li>
<li><strong>context</strong> – context passed to the <tt class="docutils literal"><span class="pre">subject_template</span></tt>, <tt class="docutils literal"><span class="pre">email_template</span></tt>,
and <tt class="docutils literal"><span class="pre">html_email_template</span></tt> (if it is not <tt class="docutils literal"><span class="pre">None</span></tt>).</li>
<li><strong>from_email</strong> – the sender’s email.</li>
<li><strong>to_email</strong> – the email of the requester.</li>
<li><strong>html_email_template_name</strong> – the template for the HTML body;
defaults to <tt class="docutils literal"><span class="pre">None</span></tt>, in which case a plain text email is sent.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><font id="248">通常，&nbsp;<tt class="docutils literal"><span class="pre">save()</span></tt> 位于<tt class="docutils literal"><span class="pre">context</span></tt>中，并带有&nbsp;<a class="reference internal" href="default.html#django.contrib.auth.views.password_reset" title="django.contrib.auth.views.password_reset"><tt class="xref py py-func docutils literal"><span class="pre">password_reset()</span></tt></a> 向它的email上下文传递的一些变量。</font></p>
</dd></dl>
</dd></dl>
<dl class="class">
<dt id="django.contrib.auth.forms.SetPasswordForm">
<em class="property">class </em><tt class="descname">SetPasswordForm</tt><a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/forms.html#SetPasswordForm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.forms.SetPasswordForm" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="249">允许用户不输入旧密码修改密码的表单。</font></p>
</dd></dl>
<dl class="class">
<dt id="django.contrib.auth.forms.UserChangeForm">
<em class="property">class </em><tt class="descname">UserChangeForm</tt><a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/forms.html#UserChangeForm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.forms.UserChangeForm" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="250">用户管理界面中修改用户信息和许可的表单。
</font></p>
</dd></dl>
<dl class="class">
<dt id="django.contrib.auth.forms.UserCreationForm">
<em class="property">class </em><tt class="descname">UserCreationForm</tt><a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/contrib/auth/forms.html#UserCreationForm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="default.html#django.contrib.auth.forms.UserCreationForm" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="251">用于创建新用户的表单。</font></p>
</dd></dl>
</div>
<div class="section" id="s-authentication-data-in-templates">
<span id="authentication-data-in-templates"></span><h3><font id="306">模板中的认证数据</font><a class="headerlink" href="default.html#authentication-data-in-templates" title="Permalink to this headline">¶</a></h3>
<p><font id="252">当你使用<a class="reference internal" href="../../ref/templates/api.html#django.template.RequestContext" title="django.template.RequestContext"><tt class="xref py py-class docutils literal"><span class="pre">RequestContext</span></tt></a>时，当前登入的用户和它们的权限在<a class="reference internal" href="../../ref/templates/api.html"><em>模板上下文</em></a>中可以访问。</font></p>
<div class="admonition-technicality admonition">
<p class="first admonition-title"><font id="253">技术细节</font></p>
<p class="last"><font id="254">技术上讲，这些变量只有在你使用<a class="reference internal" href="../../ref/templates/api.html#django.template.RequestContext" title="django.template.RequestContext"><tt class="xref py py-class docutils literal"><span class="pre">RequestContext</span></tt></a>并启用了<tt class="docutils literal"><span class="pre">'django.contrib.auth.context_processors.auth'</span></tt>上下文处理器时才可以在模板上下文中访问到。</font><font id="255">它是默认产生的配置文件。</font><font id="256">更多信息，参见<a class="reference internal" href="../../ref/templates/api.html#subclassing-context-requestcontext"><em>RequestContext 文档</em></a>。</font></p>
</div>
<div class="section" id="s-users">
<span id="users"></span><h4><font id="323">用户</font><a class="headerlink" href="default.html#users" title="Permalink to this headline">¶</a></h4>
<p><font id="257">当渲染<a class="reference internal" href="../../ref/templates/api.html#django.template.RequestContext" title="django.template.RequestContext"><tt class="xref py py-class docutils literal"><span class="pre">RequestContext</span></tt></a>模板时，当前登录的用户，可能是<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><tt class="xref py py-class docutils literal"><span class="pre">User</span></tt></a>实例或者<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.AnonymousUser" title="django.contrib.auth.models.AnonymousUser"><tt class="xref py py-class docutils literal"><span class="pre">AnonymousUser</span></tt></a>实例，会存储在模板变量<tt class="docutils literal"><span class="pre">{{</span> <span class="pre">user</span> <span class="pre">}}</span></tt>中：</font></p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
    <span class="nt">&lt;p&gt;</span>Welcome, <span class="cp">{{</span> <span class="nv">user.username</span> <span class="cp">}}</span>. Thanks for logging in.<span class="nt">&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    <span class="nt">&lt;p&gt;</span>Welcome, new user. Please log in.<span class="nt">&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><font id="258">如果使用的不是<tt class="docutils literal"><span class="pre">RequestContext</span></tt>，则不可以访问该模板变量：</font></p>
</div>
<div class="section" id="s-permissions">
<span id="permissions"></span><h4><font id="324">权限</font><a class="headerlink" href="default.html#permissions" title="Permalink to this headline">¶</a></h4>
<p><font id="259">当前登录的用户的权限存储在模板变量<tt class="docutils literal"><span class="pre">{{</span> <span class="pre">perms</span> <span class="pre">}}</span></tt>中。</font><font id="260">这是个 <tt class="docutils literal"><span class="pre">django.contrib.auth.context_processors</span></tt>实例</font><font id="261">的封装，他是一个对于模板友好的权限代理。</font></p>
<p><font id="262">在<tt class="docutils literal"><span class="pre">{{</span> <span class="pre">perms</span> <span class="pre">}}</span></tt> 对象中，单一属性的查找是&nbsp;<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.has_module_perms" title="django.contrib.auth.models.User.has_module_perms"><tt class="xref py py-meth docutils literal"><span class="pre">User.has_module_perms</span></tt></a>的代理。</font><font id="263">如果已登录的用户在<tt class="docutils literal"><span class="pre">foo</span></tt> 应用中拥有任何许可，这个例子会显示&nbsp;<tt class="docutils literal"><span class="pre">True</span></tt>：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">perms</span><span class="o">.</span><span class="n">foo</span> <span class="p">}}</span>
</pre></div>
</div>
<p><font id="264">二级属性的查找是<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.has_perm" title="django.contrib.auth.models.User.has_perm"><tt class="xref py py-meth docutils literal"><span class="pre">User.has_perm</span></tt></a>的代理。</font><font id="265">如果已登录的用户拥有<tt class="docutils literal"><span class="pre">foo.can_vote</span></tt>的许可，这个示例会显示<tt class="docutils literal"><span class="pre">True</span></tt>：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">perms</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">can_vote</span> <span class="p">}}</span>
</pre></div>
</div>
<p><font id="266">所以，你可以用模板的<tt class="docutils literal"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">%}</span></tt>语句检查权限：</font></p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">if</span> <span class="nv">perms.foo</span> <span class="cp">%}</span>
    <span class="nt">&lt;p&gt;</span>You have permission to do something in the foo app.<span class="nt">&lt;/p&gt;</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">perms.foo.can_vote</span> <span class="cp">%}</span>
        <span class="nt">&lt;p&gt;</span>You can vote!<span class="nt">&lt;/p&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">perms.foo.can_drive</span> <span class="cp">%}</span>
        <span class="nt">&lt;p&gt;</span>You can drive!<span class="nt">&lt;/p&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    <span class="nt">&lt;p&gt;</span>You don't have permission to do anything in the foo app.<span class="nt">&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><font id="267">还可以通过<tt class="docutils literal"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">in</span> <span class="pre">%}</span></tt>语句查询权限。</font><font id="268">例如：</font></p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">if</span> <span class="s1">'foo'</span> <span class="k">in</span> <span class="nv">perms</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="s1">'foo.can_vote'</span> <span class="k">in</span> <span class="nv">perms</span> <span class="cp">%}</span>
        <span class="nt">&lt;p&gt;</span>In lookup works, too.<span class="nt">&lt;/p&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="s-managing-users-in-the-admin">
<span id="s-auth-admin"></span><span id="managing-users-in-the-admin"></span><span id="auth-admin"></span><h2><font id="291">在admin中管理用户</font><a class="headerlink" href="default.html#managing-users-in-the-admin" title="Permalink to this headline">¶</a></h2>
<p><font id="269">如果<tt class="docutils literal"><span class="pre">django.contrib.admin</span></tt>和<tt class="docutils literal"><span class="pre">django.contrib.auth</span></tt>这两个你都安装了，将可以通过admin方便地查看和管理用户、组和权限。</font><font id="270">可以像其它任何Django模型一样创建和删除用户。</font><font id="271">可以创建组，并分配权限给用户和组。</font><font id="272">admin中还会保存和显示对用户模型编辑的日志。</font></p>
<div class="section" id="s-id7">
<span id="id7"></span><h3><font id="307">创建用户</font><a class="headerlink" href="default.html#id7" title="Permalink to this headline">¶</a></h3>
<p><font id="273">在admin的主页，你应该可以在“Auth”部分看到“Users”链接。</font><font id="274">“Add user” 页面与标准admin页面不同点在于它要求你在编辑用户的其它字段之前先选择一个用户名和密码。</font></p>
<p><font id="275">另请注意：如果你想使得一个用户能够使用Django的admin站点创建其它用户， 你需要给他添加用户<em>和</em>修改用户的权限（例如，"Add user” 和“Change user” 权限）。</font><font id="276">如果一个账号具有添加用户的权限但是没有权限修改他们，该账号将不能添加用户。</font><font id="277">为什么呢？</font><font id="278">因为如果你具有添加用户的权限，你将可以添加超级用户，这些超级用户将可以修改其他用户。</font><font id="279">所以Django同时要求添加权限<em>和</em>修改权限作为一种轻量的安全措施。</font></p>
<p><font id="280">仔细考虑一下你是如何允许用户管理权限的。</font><font id="281">如果你了一个非超级用户编辑用户的能力，这和给他们超级用户的权限在最终效果上是一样的，因为他们将能够提升他们自己下面的用户的权限。</font></p>
</div>
<div class="section" id="s-id8">
<span id="id8"></span><h3><font id="308">修改密码</font><a class="headerlink" href="default.html#id8" title="Permalink to this headline">¶</a></h3>
<p><font id="282">用户密码不会显示在admin上（也不会存储在数据库中），但是会显示 <a class="reference internal" href="passwords.html"><em>密码存储的细节</em></a>。 </font><font id="283">这个信息的显示中包含一条指向修改密码表单的链接，允许管理员修改用户的密码。</font></p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="yui-b" id="sidebar">
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
<h3><font id="309">目录</font></h3>
<ul>
<li><a class="reference internal" href="default.html#"><font id="413">使用Django认证系统</font></a><ul>
<li><a class="reference internal" href="default.html#user-objects"><font id="414">User对象</font></a><ul>
<li><a class="reference internal" href="default.html#creating-users"><font id="415">创建users</font></a></li>
<li><a class="reference internal" href="default.html#creating-superusers"><font id="416">创建superusers</font></a></li>
<li><a class="reference internal" href="default.html#changing-passwords"><font id="417">修改密码</font></a></li>
<li><a class="reference internal" href="default.html#authenticating-users"><font id="418">认证Users</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="default.html#permissions-and-authorization"><font id="419">权限和授权</font></a><ul>
<li><a class="reference internal" href="default.html#default-permissions"><font id="420">默认的权限</font></a></li>
<li><a class="reference internal" href="default.html#groups"><font id="421">组</font></a></li>
<li><a class="reference internal" href="default.html#programmatically-creating-permissions"><font id="422">用程序创建权限</font></a></li>
<li><a class="reference internal" href="default.html#permission-caching"><font id="423">权限的缓存</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="default.html#authentication-in-web-requests"><font id="424">Web请求中的认证</font></a><ul>
<li><a class="reference internal" href="default.html#how-to-log-a-user-in"><font id="425">如何登入一个用户</font></a></li>
<li><a class="reference internal" href="default.html#how-to-log-a-user-out"><font id="426">如何登出一个用户</font></a></li>
<li><a class="reference internal" href="default.html#limiting-access-to-logged-in-users"><font id="427">限制访问给登录的用户</font></a><ul>
<li><a class="reference internal" href="default.html#the-raw-way"><font id="428">原始的方法</font></a></li>
<li><a class="reference internal" href="default.html#the-login-required-decorator"><font id="429">login_required装饰器</font></a></li>
<li><a class="reference internal" href="default.html#limiting-access-to-logged-in-users-that-pass-a-test"><font id="430">Limiting access to logged-in users that pass a test</font></a></li>
<li><a class="reference internal" href="default.html#the-permission-required-decorator"><font id="431">permission_required 装饰器</font></a></li>
<li><a class="reference internal" href="default.html#applying-permissions-to-generic-views"><font id="432">Applying permissions to generic views</font></a></li>
<li><a class="reference internal" href="default.html#session-invalidation-on-password-change"><font id="433">Session invalidation on password change</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="default.html#module-django.contrib.auth.views"><font id="434">认证的视图</font></a><ul>
<li><a class="reference internal" href="default.html#using-the-views"><font id="435">使用视图</font></a></li>
<li><a class="reference internal" href="default.html#all-authentication-views"><font id="436">所有的认证视图</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="default.html#helper-functions"><font id="437">Helper functions</font></a></li>
<li><a class="reference internal" href="default.html#module-django.contrib.auth.forms"><font id="438">Built-in forms</font></a></li>
<li><a class="reference internal" href="default.html#authentication-data-in-templates"><font id="439">模板中的认证数据</font></a><ul>
<li><a class="reference internal" href="default.html#users"><font id="440">用户</font></a></li>
<li><a class="reference internal" href="default.html#permissions"><font id="441">权限</font></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="default.html#managing-users-in-the-admin"><font id="442">在admin中管理用户</font></a><ul>
<li><a class="reference internal" href="default.html#id7"><font id="443">创建用户</font></a></li>
<li><a class="reference internal" href="default.html#id8"><font id="444">修改密码</font></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><font id="310">浏览</font></h3>
<ul>
<li>Prev: <a href="index.html"><font id="445">Django中的用户认证</font></a></li>
<li>Next: <a href="passwords.html"><font id="446">Django中的密码管理</font></a></li>
</ul>
<h3><font id="311">你在这里：</font></h3>
<ul>
<li>
<a href="../../index.html"><font id="447">Django 1.8.2 文档</font></a>
<ul><li><a href="../index.html"><font id="448">使用Django</font></a>
<ul><li><a href="index.html"><font id="450">{{s.449}}</font></a>
<ul><li>Using the Django authentication system</li></ul>
</li></ul></li></ul>
</li>
</ul>
<h3><font id="312">当前页</font></h3>
<ul class="this-page-menu">
<li><a href="default.html#" onclick="showOriginTexts();return false;">中英文对照</a></li>
<li><a href="default.html#" onclick="hideOriginTexts();return false;">中文</a></li>
</ul>
</div>
</div>
<h3><font id="314">最后更新：</font></h3>
<p class="topless"><font id="285">May 13, 2015</font></p>
</div>
</div>
<div id="ft">
<div class="nav">
    « <a href="index.html" title="User authentication in Django">previous</a>
     |
    <a accesskey="U" href="../index.html" title="Using Django">up</a>
   |
    <a href="passwords.html" title="Password management in Django">next</a> »</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div id="disqus_thread"></div><br>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'djangocn'; // required: replace example with your forum shortname
    var disqus_identifier = '/django/topics/auth/index';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<link href="http://python.usyiyi.cn/django/_static/ms_translator.css" rel="stylesheet" type="text/css"/>
<script src="http://python.usyiyi.cn/django/_static/ms_translator.js" type="text/javascript"></script>
<script src="http://python.usyiyi.cn/django/_static/jquery-ui-1.9.2.custom.min.js" type="text/javascript"></script>
<div id="MicrosoftTranslator" style="display:none; position: absolute; z-index: 2147483647; margin: 0px; border: 2px solid rgb(210, 210, 210); padding: 0px; color: rgb(0, 0, 0); background-color: rgb(230, 230, 230); font-family: Arial,Helvetica,Sans-Serif; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: normal; direction: ltr; text-align: left; left: 274px; top: 2048.03px; min-width: 400px;">
    <div id="MSTCClose" style="float: right;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/tooltip_close.gif">
      </a>
    </div>
    
    <div id="MSTCPopDown" style="float: right;" style="display: none;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/popdown.gif">
      </a>
    </div>
    <div id="MSTCPopUP" style="float: right;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/popup.gif">
      </a>
    </div>
    
    <div id="MSTCTitle" style="margin: 4px 4px 8px; font-weight: bold;">原文
    </div>
    
    <div style="direction: ltr; text-align: left;">
      <span id="MSTCOrigion" style="display: inline-block; margin: 0px 4px 4px;"> </span>
    </div>
    
    <div id="MicrosoftTranslatorCommunity" class="MSTCltr">
      <div id="MSTCContent">
        <a id="MSTCExpandLink">
          <span id="MSTCImprove">改进翻译</span>
          <span id="MSTCSuggest">最小化</span>
          <img src="http://python.usyiyi.cn/django/_static/ctftoggledown.gif" id="MSTCToggleDown">
          <img src="http://python.usyiyi.cn/django/_static/ctftoggleup.gif" id="MSTCToggleUp">
        </a>
        <div id="MSTCRootPanel">
          <span id="MSTCLoading" style="display: none;">正在加载...</span>
          <div style="display: none;" id="MSTCTransPanelError">
            <div class="MSTCTableRow">
              <div class="MSTCTransPanelExc MSTCTableCell">
                <img style="border-width:0px;" src="http://python.usyiyi.cn/django/_static/error_exclamation.gif" id="ExclamationImage">
              </div>
              <div class="MSTCTableCell">
                <span id="MSTCTransPanelErrorMsg"></span>
              </div>
            </div>
            <div class="MSTCTableRow">
              <div class="MSTCTableCell"></div>
              <div class="MSTCTableCell MSTCFlipHoriz">
                <input type="image" style="border-width:0px;" src="http://python.usyiyi.cn/django/_static/error_OK.gif" class="MSTCErrorButtons" id="MSTCOKImgBtn" name="MSTCOKImgBtn">
              </div>
            </div>
          </div>
          
          <div id="MSTCTransPanel">
          </div>
          
          <div id="MSTCPrevNextPanel">
            <a id="MSTCPrevLink" style='border-right-width: 1px;border-right-style: solid;padding-right: 5px;'>
              <span>上一页</span>
            </a>
            <a style='color: black; border-right-width: 1px;border-right-style: solid;padding-right: 5px;'>
              <span>第</span>
              <span id="MSTCPage"></span>
              <span>页</span>
            </a>
            <a id="MSTCNextLink" style='padding-left: 5px;'>
              <span>下一页</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>
</html>