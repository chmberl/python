<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>如何使用会话 — Django 1.8.2 中文文档</title>
<link href="../../_static/default.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.8.2.dev20150513143415',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
<script src="../../_static/jquery.js" type="text/javascript"></script>
<script src="../../_static/underscore.js" type="text/javascript"></script>
<script src="../../_static/doctools.js" type="text/javascript"></script>
<link href="../../index.html" rel="top" title="Django 1.8.2.dev20150513143415 documentation"/>
<link href="index.html" rel="up" title="Handling HTTP requests"/>
<link href="../forms/index.html" rel="next" title="Working with forms"/>
<link href="middleware.html" rel="prev" title="Middleware"/>
<script src="http://python.usyiyi.cn/django/templatebuiltins.js" type="text/javascript"></script>
<script type="text/javascript">
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='http://python.usyiyi.cn/django/topics/http/&quot;&#32;+&#32;base&#32;+&#32;&quot;#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='http://python.usyiyi.cn/django/topics/http/&quot;&#32;+&#32;base&#32;+&#32;&quot;#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);
</script>
</head>
<body>
<div class="document">
<div class="yui-t6" id="custom-doc">
<div id="hd">
<h1><font id="181">Django 1.8.2 文档</font></h1>
<div id="global-nav">
<a href="../../index.html" title="Home page">Home</a>  |
        <a href="../../contents.html" title="Table of contents">Table of contents</a>  |
        <a href="../../genindex.html" title="Global index">Index</a>  |
        <a href="../../py-modindex.html" title="Module index">Modules</a>
</div>
<div class="nav">
    « <a href="middleware.html" title="Middleware">previous</a>
     |
    <a accesskey="U" href="../index.html" title="Using Django">up</a>
   |
    <a href="../forms/index.html" title="Working with forms">next</a> »</div>
</div>
<div id="bd">
<div id="yui-main">
<div class="yui-b">
<div class="yui-g" id="topics-http-sessions">
<div class="section" id="s-module-django.contrib.sessions">
<span id="s-how-to-use-sessions"></span><span id="module-django.contrib.sessions"></span><span id="how-to-use-sessions"></span><h1><font id="182">如何使用会话</font><a class="headerlink" href="sessions.html#module-django.contrib.sessions" title="Permalink to this headline">¶</a></h1>
<p><font id="1">Django 提供对匿名会话的完全支持。</font><font id="2">其会话框架让你根据各个站点的访问者存储和访问任意数据。</font><font id="3">它在服务器端存储数据并抽象Cookie 的发送和接收。</font><font id="4">Cookie 包含会话的ID —— 不是数据本身（除非你使用<a class="reference internal" href="sessions.html#cookie-session-backend"><em>基于Cookie 的后端</em></a>）。</font></p>
<div class="section" id="s-enabling-sessions">
<span id="enabling-sessions"></span><h2><font id="183">启用会话</font><a class="headerlink" href="sessions.html#enabling-sessions" title="Permalink to this headline">¶</a></h2>
<p><font id="5">会话是通过一个<a class="reference internal" href="../../ref/middleware.html"><em>中间件</em></a>实现的。</font></p>
<p><font id="6">为了启用会话功能，需要这样做：</font></p>
<ul class="simple">
<li><font id="210">编辑<a class="reference internal" href="../../ref/settings.html#std:setting-MIDDLEWARE_CLASSES"><tt class="xref std std-setting docutils literal"><span class="pre">MIDDLEWARE_CLASSES</span></tt></a> 设置并确保它包含<tt class="docutils literal"><span class="pre">'django.contrib.sessions.middleware.SessionMiddleware'</span></tt>。</font><font id="211"><tt class="docutils literal"><span class="pre">django-admin</span> <span class="pre">startproject</span></tt>创建的默认的<tt class="docutils literal"><span class="pre">settings.py</span></tt>已经启用<tt class="docutils literal"><span class="pre">SessionMiddleware</span></tt>。</font></li>
</ul>
<p><font id="7">如果你不想使用会话，你也可以从<a class="reference internal" href="../../ref/settings.html#std:setting-MIDDLEWARE_CLASSES"><tt class="xref std std-setting docutils literal"><span class="pre">MIDDLEWARE_CLASSES</span></tt></a>中删除<tt class="docutils literal"><span class="pre">SessionMiddleware</span></tt>行，并从<a class="reference internal" href="../../ref/settings.html#std:setting-INSTALLED_APPS"><tt class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a>中删除<tt class="docutils literal"><span class="pre">'django.contrib.sessions'</span></tt>。</font><font id="8">它将节省一些性能消耗。</font></p>
</div>
<div class="section" id="s-configuring-the-session-engine">
<span id="s-configuring-sessions"></span><span id="configuring-the-session-engine"></span><span id="configuring-sessions"></span><h2><font id="184">配置会话引擎</font><a class="headerlink" href="sessions.html#configuring-the-session-engine" title="Permalink to this headline">¶</a></h2>
<p><font id="9">默认情况下，Django 存储会话到你的数据库中（使用<tt class="docutils literal"><span class="pre">django.contrib.sessions.models.Session</span></tt>模型）。</font><font id="10">虽然这很方便，但是在某些架构中存储会话在其它地方会更快，所以可以配置Django 来存储会话到你的文件系统上或缓存中。</font></p>
<div class="section" id="s-using-database-backed-sessions">
<span id="using-database-backed-sessions"></span><h3><font id="195">使用数据库支持的会话</font><a class="headerlink" href="sessions.html#using-database-backed-sessions" title="Permalink to this headline">¶</a></h3>
<p><font id="11">如果你想使用数据库支持的会话，你需要添加<tt class="docutils literal"><span class="pre">'django.contrib.sessions'</span></tt> 到你的<a class="reference internal" href="../../ref/settings.html#std:setting-INSTALLED_APPS"><tt class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a>设置中。</font></p>
<p><font id="12">在配置完成之后，请运行<tt class="docutils literal"><span class="pre">manage.py</span> <span class="pre">migrate</span></tt>来安装保存会话数据的一张数据库表。</font></p>
</div>
<div class="section" id="s-using-cached-sessions">
<span id="s-cached-sessions-backend"></span><span id="using-cached-sessions"></span><span id="cached-sessions-backend"></span><h3><font id="196">使用基于缓存的会话</font><a class="headerlink" href="sessions.html#using-cached-sessions" title="Permalink to this headline">¶</a></h3>
<p><font id="13">为了更好的性能，你可能想使用一个基于缓存的会话后端。</font></p>
<p><font id="14">为了使用Django 的缓存系统来存储会话数据，你首先需要确保你已经配置好你的缓存；</font><font id="15">详细信息参见<a class="reference internal" href="../cache.html"><em>缓存的文档</em></a>。</font></p>
<div class="admonition warning">
<p class="first admonition-title"><font id="16">警告</font></p>
<p class="last"><font id="17">你应该只在使用Memcached 缓存系统时才使用基于缓存的会话。</font><font id="18">基于本地内存的缓存系统不会长时间保留数据，所以不是一个好的选择，而且直接使用文件或数据库会话比通过文件或数据库缓存系统要快。</font><font id="19">另外，基于本地内存的缓存系统不是多进程安全的，所以对于生产环境可能不是一个好的选择。</font></p>
</div>
<p><font id="20">如果你在<a class="reference internal" href="../../ref/settings.html#std:setting-CACHES"><tt class="xref std std-setting docutils literal"><span class="pre">CACHES</span></tt></a>中定义多个缓存，Django 将使用默认的缓存。</font><font id="21">若要使用另外一种缓存，请设置<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_CACHE_ALIAS"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_CACHE_ALIAS</span></tt></a>为该缓存的名字。</font></p>
<p><font id="22">配置好缓存之后，对于如何在缓存中存储数据你有两个选择：</font></p>
<ul class="simple">
<li><font id="212">对于简单的缓存会话存储，可以设置<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_ENGINE"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_ENGINE</span></tt></a> 为<tt class="docutils literal"><span class="pre">"django.contrib.sessions.backends.cache"</span></tt> 。</font><font id="275">此时会话数据将直接存储在你的缓存中。</font><font id="276">然而，缓存数据将可能不会持久：如果缓存填满或者缓存服务器重启，缓存数据可能会被清理掉。</font></li>
<li><font id="213">若要持久的缓存数据，可以设置<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_ENGINE"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_ENGINE</span></tt></a>为<tt class="docutils literal"><span class="pre">"django.contrib.sessions.backends.cached_db"</span></tt>。</font><font id="277">它的写操作使用缓存 —— 对缓存的每次写入都将再写入到数据库。对于读取的会话，如果数据不在缓存中，则从数据库读取。</font></li>
</ul>
<p><font id="23">两种会话的存储都非常快，但是简单的缓存更快，因为它放弃了持久性。</font><font id="24">大部分情况下，<tt class="docutils literal"><span class="pre">cached_db</span></tt>后端已经足够快，但是如果你需要榨干最后一点的性能，并且接收让会话数据丢失，那么你可使用<tt class="docutils literal"><span class="pre">cache</span></tt>后端。</font></p>
<p><font id="25">如果你使用<tt class="docutils literal"><span class="pre">cached_db</span></tt> 会话后端，你还需要遵循<a class="reference internal" href="sessions.html#using-database-backed-sessions">使用数据库支持的会话</a>中的配置说明。</font></p>
<div class="versionchanged">
<span class="title">Changed in Django 1.7:</span> <p><font id="26">在1.7 版之前，<tt class="docutils literal"><span class="pre">cached_db</span></tt> 永远使用<tt class="docutils literal"><span class="pre">default</span></tt>缓存而不是<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_CACHE_ALIAS"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_CACHE_ALIAS</span></tt></a>。</font></p>
</div>
</div>
<div class="section" id="s-using-file-based-sessions">
<span id="using-file-based-sessions"></span><h3><font id="197">使用基于文件的会话</font><a class="headerlink" href="sessions.html#using-file-based-sessions" title="Permalink to this headline">¶</a></h3>
<p><font id="27">要使用基于文件的缓存，请设置<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_ENGINE"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_ENGINE</span></tt></a>为<tt class="docutils literal"><span class="pre">"django.contrib.sessions.backends.file"</span></tt>。</font></p>
<p><font id="28">你可能还想设置<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_FILE_PATH"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_FILE_PATH</span></tt></a>（它的默认值来自<tt class="docutils literal"><span class="pre">tempfile.gettempdir()</span></tt>的输出，大部分情况是<tt class="docutils literal"><span class="pre">/tmp</span></tt>）来控制Django在哪里存储会话文件。</font><font id="29">请保证你的Web 服务器具有读取和写入这个位置的权限。</font></p>
</div>
<div class="section" id="s-using-cookie-based-sessions">
<span id="s-cookie-session-backend"></span><span id="using-cookie-based-sessions"></span><span id="cookie-session-backend"></span><h3><font id="198">使用基于Cookie 的会话</font><a class="headerlink" href="sessions.html#using-cookie-based-sessions" title="Permalink to this headline">¶</a></h3>
<p><font id="30">要使用基于Cookie 的会话，请设置<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_ENGINE"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_ENGINE</span></tt></a> 为<tt class="docutils literal"><span class="pre">"django.contrib.sessions.backends.signed_cookies"</span></tt>。</font><font id="274">此时，会话数据的存储将使用Django 的<a class="reference internal" href="../signing.html"><em>加密签名</em></a> 工具和<a class="reference internal" href="../../ref/settings.html#std:setting-SECRET_KEY"><tt class="xref std std-setting docutils literal"><span class="pre">SECRET_KEY</span></tt></a> 设置。</font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="31">注</font></p>
<p class="last"><font id="32">建议保留<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_COOKIE_HTTPONLY"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_COOKIE_HTTPONLY</span></tt></a> 设置为<tt class="docutils literal"><span class="pre">True</span></tt> 以防止从JavaScript 中访问存储的数据。</font></p>
</div>
<div class="admonition warning">
<p class="first admonition-title"><font id="33">警告</font></p>
<p><font id="34"><strong>如果SECRET_KEY 没有保密并且你正在使用</strong> </font><font id="35"><a class="reference internal" href="sessions.html#django.contrib.sessions.serializers.PickleSerializer" title="django.contrib.sessions.serializers.PickleSerializer"><tt class="xref py py-class docutils literal"><span class="pre">PickleSerializer</span></tt></a>，<strong>这可能导致远端执行任意的代码。</strong></font></p>
<p><font id="36">拥有<a class="reference internal" href="../../ref/settings.html#std:setting-SECRET_KEY"><tt class="xref std std-setting docutils literal"><span class="pre">SECRET_KEY</span></tt></a> 的攻击者不仅可以生成篡改的会话数据而你的站点将会信任这些数据，而且可以远程执行任何代码，就像数据是通过pickle 序列化过的一样。</font></p>
<p><font id="37">如果你使用基于Cookie 的会话，请格外注意你的安全秘钥对于任何可以远程访问的系统都是永远完全保密的。</font></p>
<p><font id="38"><strong>会话数据经过签名但没有加密。</strong></font></p>
<p><font id="39">如果使用基于Cookie的会话，则会话数据可以被客户端读取。</font></p>
<p><font id="40">MAC（消息认证码）被用来保护数据不被客户端修改，所以被篡改的会话数据将是变成不合法的。</font><font id="41">如果保存Cookie的客户端（例如你的浏览器）不能保存所有的会话Cookie或丢失数据，会话同样会变得不合法。</font><font id="42">尽管Django 对数据进行压缩，仍然完全有可能超过每个Cookie <a class="reference external" href="http://tools.ietf.org/html/rfc2965#section-5.3">常见的4096 个字节的限制</a>。</font></p>
<p><font id="43"><strong>没有更新保证</strong></font></p>
<p><font id="44">还要注意，虽然MAC可以保证数据的权威性（由你的站点生成，而不是任何其他人）和完整性（包含全部的数据并且是正确的），它不能保证是最新的，例如返回给你发送给客户端的最新的数据。</font><font id="45">这意味着对于某些会话数据的使用，基于Cookie 可能让你受到<a class="reference external" href="http://en.wikipedia.org/wiki/Replay_attack">重放攻击</a>。</font><font id="46">其它方式的会话后端在服务器端保存每个会话并在用户登出时使它无效，基于Cookie 的会话在用户登出时不会失效。</font><font id="47">因此，如果一个攻击者盗取用户的Cookie，它们可以使用这个Cookie 来以这个用户登录即使用户已登出。</font><font id="48">Cookies 只能被当做是“过期的”，如果它们比你的<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_COOKIE_AGE"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_COOKIE_AGE</span></tt></a>要旧。</font></p>
<p><font id="49"><strong>性能</strong></font></p>
<p class="last"><font id="50">最后，Cookie 的大小对<a class="reference external" href="http://yuiblog.com/blog/2007/03/01/performance-research-part-3/">你的网站的速度</a> 有影响。</font></p>
</div>
</div>
</div>
<div class="section" id="s-using-sessions-in-views">
<span id="using-sessions-in-views"></span><h2><font id="185">在视图中使用会话</font><a class="headerlink" href="sessions.html#using-sessions-in-views" title="Permalink to this headline">¶</a></h2>
<p><font id="51">当<tt class="docutils literal"><span class="pre">SessionMiddleware</span></tt> 激活时，每个<a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><tt class="xref py py-class docutils literal"><span class="pre">HttpRequest</span></tt></a> 对象 —— 传递给Django 视图函数的第一个参数 —— 将具有一个<tt class="docutils literal"><span class="pre">session</span></tt> 属性，它是一个类字典对象。</font></p>
<p><font id="52">你可以在你的视图中任何地方读取并写入 <tt class="docutils literal"><span class="pre">request.session</span></tt>。</font><font id="53">你可以多次编辑它。</font></p>
<dl class="class">
<dt id="django.contrib.sessions.backends.base.SessionBase">
<em class="property">class </em><tt class="descclassname">backends.base.</tt><tt class="descname">SessionBase</tt><a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="54">这是所有会话对象的基类。</font><font id="55">它具有以下标准的字典方法：</font></p>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.__getitem__">
<tt class="descname">__getitem__</tt>(<em>key</em>)<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.__getitem__" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="56">例如：<tt class="docutils literal"><span class="pre">fav_color</span> <span class="pre">=</span> <span class="pre">request.session['fav_color']</span></tt></font></p>
</dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.__setitem__">
<tt class="descname">__setitem__</tt>(<em>key</em>, <em>value</em>)<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.__setitem__" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="57">例如：<tt class="docutils literal"><span class="pre">request.session['fav_color']</span> <span class="pre">=</span> <span class="pre">'blue'</span></tt></font></p>
</dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.__delitem__">
<tt class="descname">__delitem__</tt>(<em>key</em>)<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.__delitem__" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="58">例如：<tt class="docutils literal"><span class="pre">del</span> <span class="pre">request.session['fav_color']</span></tt>。</font><font id="59">如果给出的<tt class="docutils literal"><span class="pre">key</span></tt> 在会话中不存在，将抛出 <tt class="docutils literal"><span class="pre">KeyError</span></tt>。</font></p>
</dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.__contains__">
<tt class="descname">__contains__</tt>(<em>key</em>)<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.__contains__" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="60">例如：<tt class="docutils literal"><span class="pre">'fav_color'</span> <span class="pre">in</span> <span class="pre">request.session</span></tt></font></p>
</dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.get">
<tt class="descname">get</tt>(<em>key</em>, <em>default=None</em>)<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.get" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="61">例如：<tt class="docutils literal"><span class="pre">fav_color</span> <span class="pre">=</span> <span class="pre">request.session.get('fav_color',</span> <span class="pre">'red')</span></tt></font></p>
</dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.pop">
<tt class="descname">pop</tt>(<em>key</em>)<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.pop" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="62">例如：<tt class="docutils literal"><span class="pre">fav_color</span> <span class="pre">=</span> <span class="pre">request.session.pop('fav_color')</span></tt></font></p>
</dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.keys">
<tt class="descname">keys</tt>()<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.keys" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.items">
<tt class="descname">items</tt>()<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.items" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.setdefault">
<tt class="descname">setdefault</tt>()<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.setdefault" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.clear">
<tt class="descname">clear</tt>()<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.clear" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="63">它还具有这些方法：</font></p>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.flush">
<tt class="descname">flush</tt>()<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.flush" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="64">删除当前的会话数据并删除会话的Cookie。</font><font id="65">这用于确保前面的会话数据不可以再次被用户的浏览器访问（例如，<a class="reference internal" href="../auth/default.html#django.contrib.auth.logout" title="django.contrib.auth.logout"><tt class="xref py py-func docutils literal"><span class="pre">django.contrib.auth.logout()</span></tt></a> 函数中就会调用它）。</font></p>
<div class="versionchanged">
<span class="title">Changed in Django 1.8:</span> <p><font id="66">删除会话Cookie 是Django 1.8 中的新行为。</font><font id="67">以前，该行为用于重新生成会话中的值，这个值会在Cookie 中发回给用户。</font></p>
</div>
</dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.set_test_cookie">
<tt class="descname">set_test_cookie</tt>()<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.set_test_cookie" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="68">设置一个测试的Cookie 来验证用户的浏览器是否支持Cookie。</font><font id="69">因为Cookie 的工作方式，只有到用户的下一个页面才能验证。</font><font id="70">更多信息参见下文的<a class="reference internal" href="sessions.html#setting-test-cookies">设置测试的Cookie</a>。</font></p>
</dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.test_cookie_worked">
<tt class="descname">test_cookie_worked</tt>()<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.test_cookie_worked" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="71">返回<tt class="docutils literal"><span class="pre">True</span></tt> 或<tt class="docutils literal"><span class="pre">False</span></tt>，取决于用户的浏览器时候接受测试的Cookie。</font><font id="72">因为Cookie的工作方式，你必须在前面一个单独的页面请求中调用<tt class="docutils literal"><span class="pre">set_test_cookie()</span></tt>。</font><font id="73">更多信息参见下文的<a class="reference internal" href="sessions.html#setting-test-cookies">设置测试的Cookie</a>。</font></p>
</dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.delete_test_cookie">
<tt class="descname">delete_test_cookie</tt>()<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.delete_test_cookie" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="74">删除测试的Cookie。</font><font id="75">使用这个函数来自己清理。</font></p>
</dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.set_expiry">
<tt class="descname">set_expiry</tt>(<em>value</em>)<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.set_expiry" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="76">设置会话的超时时间。</font><font id="77">你可以传递一系列不同的值：</font></p>
<ul class="simple">
<li><font id="214">如果<tt class="docutils literal"><span class="pre">value</span></tt> 是一个整数，会话将在这么多秒没有活动后过期。</font><font id="215">例如，调用<tt class="docutils literal"><span class="pre">request.session.set_expiry(300)</span></tt> 将使得会话在5分钟后过期。</font></li>
<li><font id="216">若果<tt class="docutils literal"><span class="pre">value</span></tt> 是一个 <tt class="docutils literal"><span class="pre">datetime</span></tt> 或<tt class="docutils literal"><span class="pre">timedelta</span></tt> 对象，会话将在这个指定的日期/时间过期。</font><font id="217">注意<tt class="docutils literal"><span class="pre">datetime</span></tt> 和<tt class="docutils literal"><span class="pre">timedelta</span></tt> 值只有在你使用<a class="reference internal" href="sessions.html#django.contrib.sessions.serializers.PickleSerializer" title="django.contrib.sessions.serializers.PickleSerializer"><tt class="xref py py-class docutils literal"><span class="pre">PickleSerializer</span></tt></a> 时才可序列化。</font></li>
<li><font id="218">如果<tt class="docutils literal"><span class="pre">value</span></tt> 为<tt class="docutils literal"><span class="pre">0</span></tt>，那么用户会话的Cookie将在用户的浏览器关闭时过期。</font></li>
<li><font id="219">如果<tt class="docutils literal"><span class="pre">value</span></tt> 为<tt class="docutils literal"><span class="pre">None</span></tt>，那么会话转向使用全局的会话过期策略。</font></li>
</ul>
<p><font id="78">过期的计算不考虑读取会话的操作。</font><font id="79">会话的过期从会话上次<em>修改</em>的时间开始计算。</font></p>
</dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.get_expiry_age">
<tt class="descname">get_expiry_age</tt>()<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.get_expiry_age" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="80">返回会话离过期的秒数。</font><font id="81">对于没有自定义过期的会话（或者设置为浏览器关闭时过期的会话），它将等于<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_COOKIE_AGE"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_COOKIE_AGE</span></tt></a>。</font></p>
<p><font id="82">该函数接收两个可选的关键字参数：</font></p>
<ul class="simple">
<li><font id="220"><tt class="docutils literal"><span class="pre">modification</span></tt>：会话的最后一次修改时间，类型为一个<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt></a> 对象。</font><font id="221">默认为当前的时间。</font></li>
<li><font id="222"><tt class="docutils literal"><span class="pre">expiry</span></tt>：会话的过期信息，类型为一个<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt></a> 对象、一个<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">整数</span></tt></a>（以秒为单位）或<tt class="docutils literal"><span class="pre">None</span></tt>。</font><font id="223">默认为通过<a class="reference internal" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.set_expiry" title="django.contrib.sessions.backends.base.SessionBase.set_expiry"><tt class="xref py py-meth docutils literal"><span class="pre">set_expiry()</span></tt></a>保存在会话中的值，如果没有则为<tt class="docutils literal"><span class="pre">None</span></tt>。</font></li>
</ul>
</dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.get_expiry_date">
<tt class="descname">get_expiry_date</tt>()<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.get_expiry_date" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="83">返回过期的日期。</font><font id="84">对于没有自定义过期的会话（或者设置为浏览器关闭时过期的会话），它将等于从现在开始<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_COOKIE_AGE"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_COOKIE_AGE</span></tt></a>秒后的日期。</font></p>
<p><font id="85">这个函数接受与<a class="reference internal" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.get_expiry_age" title="django.contrib.sessions.backends.base.SessionBase.get_expiry_age"><tt class="xref py py-meth docutils literal"><span class="pre">get_expiry_age()</span></tt></a>一样的关键字参数。</font></p>
</dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.get_expire_at_browser_close">
<tt class="descname">get_expire_at_browser_close</tt>()<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.get_expire_at_browser_close" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="86">返回<tt class="docutils literal"><span class="pre">True</span></tt> 或<tt class="docutils literal"><span class="pre">False</span></tt>，取决于用户的会话Cookie在用户浏览器关闭时会不会过期。</font></p>
</dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.clear_expired">
<tt class="descname">clear_expired</tt>()<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.clear_expired" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="87">从会话的存储中清除过期的会话。</font><font id="88">这个类方法被<a class="reference internal" href="../../ref/django-admin.html#django-admin-clearsessions"><tt class="xref std std-djadmin docutils literal"><span class="pre">clearsessions</span></tt></a>调用。</font></p>
</dd></dl>
<dl class="method">
<dt id="django.contrib.sessions.backends.base.SessionBase.cycle_key">
<tt class="descname">cycle_key</tt>()<a class="headerlink" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.cycle_key" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="89">创建一个新的会话，同时保留当前的会话数据。</font><font id="90"><a class="reference internal" href="../auth/default.html#django.contrib.auth.login" title="django.contrib.auth.login"><tt class="xref py py-func docutils literal"><span class="pre">django.contrib.auth.login()</span></tt></a> 调用这个方法来减缓会话的固定。</font></p>
</dd></dl>
</dd></dl>
<div class="section" id="s-session-serialization">
<span id="s-id1"></span><span id="session-serialization"></span><span id="id1"></span><h3><font id="199">会话的序列化</font><a class="headerlink" href="sessions.html#session-serialization" title="Permalink to this headline">¶</a></h3>
<p><font id="91">在1.6 版以前，在保存会话数据到后端之前Django 默认使用<a class="reference external" href="https://docs.python.org/3/library/pickle.html#module-pickle" title="(in Python v3.4)"><tt class="xref py py-mod docutils literal"><span class="pre">pickle</span></tt></a> 来序列化它们。</font><font id="92">如果你使用的是<a class="reference internal" href="sessions.html#cookie-session-backend"><em>签名的Cookie 会话后端</em></a> 并且<a class="reference internal" href="../../ref/settings.html#std:setting-SECRET_KEY"><tt class="xref std std-setting docutils literal"><span class="pre">SECRET_KEY</span></tt></a> 被攻击者知道（Django 本身没有漏洞会导致它被泄漏），攻击者就可以在会话中插入一个字符串，在unpickle 之后可以在服务器上执行任何代码。</font><font id="93">在因特网上这个攻击技术很简单并很容易查到。</font><font id="94">尽管Cookie 会话的存储对Cookie 保存的数据进行了签名以防止篡改，<a class="reference internal" href="../../ref/settings.html#std:setting-SECRET_KEY"><tt class="xref std std-setting docutils literal"><span class="pre">SECRET_KEY</span></tt></a> 的泄漏会立即使得可以执行远端的代码。</font></p>
<p><font id="95">这种攻击可以通过JSON而不是<a class="reference external" href="https://docs.python.org/3/library/pickle.html#module-pickle" title="(in Python v3.4)"><tt class="xref py py-mod docutils literal"><span class="pre">pickle</span></tt></a>序列化会话数据来减缓。</font><font id="96">为了帮助这个功能，Django 1.5.3 引入一个新的设置，<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_SERIALIZER"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_SERIALIZER</span></tt></a>，来自定义会话序列化的格式。</font><font id="97">为了向后兼容，这个设置在Django 1.5.x 中默认为<a class="reference internal" href="sessions.html#django.contrib.sessions.serializers.PickleSerializer" title="django.contrib.sessions.serializers.PickleSerializer"><tt class="xref py py-class docutils literal"><span class="pre">django.contrib.sessions.serializers.PickleSerializer</span></tt></a>，但是为了增强安全性，在Django 1.6 中默认为<a class="reference internal" href="sessions.html#django.contrib.sessions.serializers.JSONSerializer" title="django.contrib.sessions.serializers.JSONSerializer"><tt class="xref py py-class docutils literal"><span class="pre">django.contrib.sessions.serializers.JSONSerializer</span></tt></a>。</font><font id="98">即使在<a class="reference internal" href="sessions.html#custom-serializers"><em>编写你自己的序列化方法</em></a>讲述的说明中，我们也强烈建议依然使用JSON 序列化，<em>特别是在你使用的是Cookie 后端时</em>。</font></p>
<div class="section" id="s-bundled-serializers">
<span id="bundled-serializers"></span><h4><font id="208">绑定的序列化方法</font><a class="headerlink" href="sessions.html#bundled-serializers" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="django.contrib.sessions.serializers.JSONSerializer">
<em class="property">class </em><tt class="descclassname">serializers.</tt><tt class="descname">JSONSerializer</tt><a class="headerlink" href="sessions.html#django.contrib.sessions.serializers.JSONSerializer" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="99">对 <a class="reference internal" href="../signing.html#module-django.core.signing" title="django.core.signing: Django's signing framework."><tt class="xref py py-mod docutils literal"><span class="pre">django.core.signing</span></tt></a>中的JSON 序列化方法的一个包装。</font><font id="100">只可以序列基本的数据类型。</font></p>
<p><font id="101">另外，因为JSON 只支持字符串作为键，注意使用非字符串作为<tt class="docutils literal"><span class="pre">request.session</span></tt> 的键将不工作：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># initial assignment</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">'bar'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># subsequent requests following serialization &amp; deserialization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># of session data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># KeyError</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">'0'</span><span class="p">]</span>
<span class="go">'bar'</span>
</pre></div>
</div>
<p><font id="102">参见<a class="reference internal" href="sessions.html#custom-serializers"><em>编写你自己的序列化器</em></a> 一节以获得更多关于JSON 序列化的限制。</font></p>
</dd></dl>
<dl class="class">
<dt id="django.contrib.sessions.serializers.PickleSerializer">
<em class="property">class </em><tt class="descclassname">serializers.</tt><tt class="descname">PickleSerializer</tt><a class="headerlink" href="sessions.html#django.contrib.sessions.serializers.PickleSerializer" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="103">支持任意Python 对象，但是正如上面描述的，可能导致远端执行代码的漏洞，如果攻击者知道了<a class="reference internal" href="../../ref/settings.html#std:setting-SECRET_KEY"><tt class="xref std std-setting docutils literal"><span class="pre">SECRET_KEY</span></tt></a>。</font></p>
</dd></dl>
</div>
<div class="section" id="s-write-your-own-serializer">
<span id="s-custom-serializers"></span><span id="write-your-own-serializer"></span><span id="custom-serializers"></span><h4><font id="209">编写你自己的序列化器</font><a class="headerlink" href="sessions.html#write-your-own-serializer" title="Permalink to this headline">¶</a></h4>
<p><font id="104">注意，与<a class="reference internal" href="sessions.html#django.contrib.sessions.serializers.PickleSerializer" title="django.contrib.sessions.serializers.PickleSerializer"><tt class="xref py py-class docutils literal"><span class="pre">PickleSerializer</span></tt></a>不同，<a class="reference internal" href="sessions.html#django.contrib.sessions.serializers.JSONSerializer" title="django.contrib.sessions.serializers.JSONSerializer"><tt class="xref py py-class docutils literal"><span class="pre">JSONSerializer</span></tt></a> 不可以处理任意的Python 数据类型。</font><font id="105">这是常见的情况，需要在便利性和安全性之间权衡。</font><font id="106">如果你希望在JSON 格式的会话中存储更高级的数据类型比如<tt class="docutils literal"><span class="pre">datetime</span></tt> 和 <tt class="docutils literal"><span class="pre">Decimal</span></tt>，你需要编写一个自定义的序列化器（或者在保存它们到<tt class="docutils literal"><span class="pre">request.session</span></tt>中之前转换这些值到一个可JSON 序列化的对象）。</font><font id="107">虽然序列化这些值相当简单直接 （<tt class="docutils literal"><span class="pre">django.core.serializers.json.DateTimeAwareJSONEncoder</span></tt> 可能帮得上忙），编写一个解码器来可靠地取出相同的内容却能困难。</font><font id="108">例如，返回一个<tt class="docutils literal"><span class="pre">datetime</span></tt> 时，它可能实际上是与<tt class="docutils literal"><span class="pre">datetime</span></tt> 格式碰巧相同的一个字符串）。</font></p>
<p><font id="109">你的序列化类必须实现两个方法，<tt class="docutils literal"><span class="pre">dumps(self,</span> <span class="pre">obj)</span></tt> 和<tt class="docutils literal"><span class="pre">loads(self,</span> <span class="pre">data)</span></tt> 来分别序列化和去序列化会话数据的字典。</font></p>
</div>
</div>
<div class="section" id="s-session-object-guidelines">
<span id="session-object-guidelines"></span><h3><font id="200">会话对象指南</font><a class="headerlink" href="sessions.html#session-object-guidelines" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><font id="224">在<tt class="docutils literal"><span class="pre">request.session</span></tt> 上使用普通的Python 字符串作为字典的键。</font><font id="225">这主要是为了方便而不是一条必须遵守的规则。</font></li>
<li><font id="226">以一个下划线开始的会话字典的键被Django保留作为内部使用。</font></li>
<li><font id="227">不要新的对象覆盖<tt class="docutils literal"><span class="pre">request.session</span></tt>，且不要访问或设置它的属性。</font><font id="228">要像Python 字典一样使用它。</font></li>
</ul>
</div>
<div class="section" id="s-examples">
<span id="examples"></span><h3><font id="201">例子</font><a class="headerlink" href="sessions.html#examples" title="Permalink to this headline">¶</a></h3>
<p><font id="110">下面这个简单的视图在一个用户提交一个评论后设置<tt class="docutils literal"><span class="pre">has_commented</span></tt> 变量为<tt class="docutils literal"><span class="pre">True</span></tt>。</font><font id="111">它不允许一个用户多次提交评论：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">post_comment</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">new_comment</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'has_commented'</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">"You've already commented."</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">comments</span><span class="o">.</span><span class="n">Comment</span><span class="p">(</span><span class="n">comment</span><span class="o">=</span><span class="n">new_comment</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">'has_commented'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">'Thanks for your comment!'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="112">登录站点一个“成员”的最简单的视图：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">Member</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">'username'</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">password</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">'password'</span><span class="p">]:</span>
        <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">'member_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">id</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">"You're logged in."</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">"Your username and password didn't match."</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="113">...</font><font id="114">下面是登出一个成员的视图，已经上面的<tt class="docutils literal"><span class="pre">login()</span></tt>：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">'member_id'</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">"You're logged out."</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="115">标准的<a class="reference internal" href="../auth/default.html#django.contrib.auth.logout" title="django.contrib.auth.logout"><tt class="xref py py-meth docutils literal"><span class="pre">django.contrib.auth.logout()</span></tt></a> 函数实际上所做的内容比这个要多一点以防止意外的数据泄露。</font><font id="116">它调用的<tt class="docutils literal"><span class="pre">request.session</span></tt>的<a class="reference internal" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.flush" title="django.contrib.sessions.backends.base.SessionBase.flush"><tt class="xref py py-meth docutils literal"><span class="pre">flush()</span></tt></a>方法。</font><font id="117">我们使用这个例子来演示如何利用会话对象来工作，而不是一个完整的<tt class="docutils literal"><span class="pre">logout()</span></tt>实现。</font></p>
</div>
</div>
<div class="section" id="s-setting-test-cookies">
<span id="setting-test-cookies"></span><h2><font id="186">设置测试的Cookie</font><a class="headerlink" href="sessions.html#setting-test-cookies" title="Permalink to this headline">¶</a></h2>
<p><font id="118">为了方便，Django 提供一个简单的方法来测试用户的浏览器时候接受Cookie。</font><font id="119">只需在一个视图中调用<tt class="docutils literal"><span class="pre">request.session</span></tt>的<a class="reference internal" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.set_test_cookie" title="django.contrib.sessions.backends.base.SessionBase.set_test_cookie"><tt class="xref py py-meth docutils literal"><span class="pre">set_test_cookie()</span></tt></a>方法，并在接下来的视图中调用<a class="reference internal" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.test_cookie_worked" title="django.contrib.sessions.backends.base.SessionBase.test_cookie_worked"><tt class="xref py py-meth docutils literal"><span class="pre">test_cookie_worked()</span></tt></a> —— 不是在同一个视图中调用。</font></p>
<p><font id="120">由于Cookie的工作方式，在<tt class="docutils literal"><span class="pre">set_test_cookie()</span></tt> 和<tt class="docutils literal"><span class="pre">test_cookie_worked()</span></tt> 之间这种笨拙的分离是必要的。</font><font id="121">当你设置一个Cookie，直到浏览器的下一个请求你不可能真实知道一个浏览器是否接受了它。</font></p>
<p><font id="122">使用<a class="reference internal" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.delete_test_cookie" title="django.contrib.sessions.backends.base.SessionBase.delete_test_cookie"><tt class="xref py py-meth docutils literal"><span class="pre">delete_test_cookie()</span></tt></a> 来自己清除测试的Cookie是一个很好的实践。</font><font id="123">请在你已经验证测试的Cookie 已经工作后做这件事。</font></p>
<p><font id="124">下面是一个典型的使用示例：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">test_cookie_worked</span><span class="p">():</span>
            <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete_test_cookie</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">"You're logged in."</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">"Please enable cookies and try again."</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">set_test_cookie</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">'foo/login_form.html'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-using-sessions-out-of-views">
<span id="using-sessions-out-of-views"></span><h2><font id="187">在视图外使用会话</font><a class="headerlink" href="sessions.html#using-sessions-out-of-views" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title"><font id="125">注</font></p>
<p><font id="126">这一节中的示例直接从<tt class="docutils literal"><span class="pre">django.contrib.sessions.backends.db</span></tt>中导入<tt class="docutils literal"><span class="pre">SessionStore</span></tt> 对象。</font><font id="127">在你的代码中，你应该从<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_ENGINE"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_ENGINE</span></tt></a> 指定的会话引擎中导入<tt class="docutils literal"><span class="pre">SessionStore</span></tt>，如下所示：</font></p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">import_module</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">SessionStore</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">SESSION_ENGINE</span><span class="p">)</span><span class="o">.</span><span class="n">SessionStore</span>
</pre></div>
</div>
</div>
<p><font id="128">在视图的外面有一个API 可以使用来操作会话的数据：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.contrib.sessions.backends.db</span> <span class="kn">import</span> <span class="n">SessionStore</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SessionStore</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># stored as seconds since epoch since datetimes are not serializable in JSON.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s">'last_login'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1376587691</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">session_key</span>
<span class="go">'2b1189a188b44ad18c35e113ac6ceead'</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SessionStore</span><span class="p">(</span><span class="n">session_key</span><span class="o">=</span><span class="s">'2b1189a188b44ad18c35e113ac6ceead'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s">'last_login'</span><span class="p">]</span>
<span class="go">1376587691</span>
</pre></div>
</div>
<p><font id="129">为了减缓会话固话攻击，不存在的会话的键将重新生成：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.contrib.sessions.backends.db</span> <span class="kn">import</span> <span class="n">SessionStore</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SessionStore</span><span class="p">(</span><span class="n">session_key</span><span class="o">=</span><span class="s">'no-such-session-here'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">session_key</span>
<span class="go">'ff882814010ccbc3c870523934fee5a2'</span>
</pre></div>
</div>
<p><font id="130">如果你使用的是<tt class="docutils literal"><span class="pre">django.contrib.sessions.backends.db</span></tt> 后端，每个会话只是一个普通的Django 模型。</font><font id="131"><tt class="docutils literal"><span class="pre">Session</span></tt> 模型定义在 <tt class="docutils literal"><span class="pre">django/contrib/sessions/models.py</span></tt>中。</font><font id="132">因为它是一个普通的模型，你可以使用普通的Django 数据库API 来访问会话：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.contrib.sessions.models</span> <span class="kn">import</span> <span class="n">Session</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Session</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="s">'2b1189a188b44ad18c35e113ac6ceead'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">expire_date</span>
<span class="go">datetime.datetime(2005, 8, 20, 13, 35, 12)</span>
</pre></div>
</div>
<p><font id="133">注意，你需要调用<tt class="docutils literal"><span class="pre">get_decoded()</span></tt> 以获得会话的字典。</font><font id="134">这是必需的，因为字典是以编码后的格式保存的：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">session_data</span>
<span class="go">'KGRwMQpTJ19hdXRoX3VzZXJfaWQnCnAyCkkxCnMuMTExY2ZjODI2Yj...'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_decoded</span><span class="p">()</span>
<span class="go">{'user_id': 42}</span>
</pre></div>
</div>
</div>
<div class="section" id="s-when-sessions-are-saved">
<span id="when-sessions-are-saved"></span><h2><font id="188">会话何时保存</font><a class="headerlink" href="sessions.html#when-sessions-are-saved" title="Permalink to this headline">¶</a></h2>
<p><font id="135">默认情况下，Django 只有在会话被修改时才会保存会话到数据库中 —— 即它的字典中的任何值被赋值或删除时：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Session is modified.</span>
<span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">'foo'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'bar'</span>

<span class="c"># Session is modified.</span>
<span class="k">del</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">'foo'</span><span class="p">]</span>

<span class="c"># Session is modified.</span>
<span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">'foo'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c"># Gotcha: Session is NOT modified, because this alters</span>
<span class="c"># request.session['foo'] instead of request.session.</span>
<span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">'foo'</span><span class="p">][</span><span class="s">'bar'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'baz'</span>
</pre></div>
</div>
<p><font id="136">上面例子的最后一种情况，我们可以通过设置会话对象的<tt class="docutils literal"><span class="pre">modified</span></tt>属性显式地告诉会话对象它已经被修改过：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p><font id="137">若要修改这个默认的行为，可以设置 <a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_SAVE_EVERY_REQUEST"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_SAVE_EVERY_REQUEST</span></tt></a> 为<tt class="docutils literal"><span class="pre">True</span></tt>。</font><font id="138">当设置为<tt class="docutils literal"><span class="pre">True</span></tt>时，Django 将对每个请求保存会话到数据库中。</font></p>
<p><font id="139">注意会话的Cookie 只有在一个会话被创建或修改后才会发送。</font><font id="140">如果<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_SAVE_EVERY_REQUEST"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_SAVE_EVERY_REQUEST</span></tt></a> 为<tt class="docutils literal"><span class="pre">True</span></tt>，会话的Cookie 将在每个请求中发送。</font></p>
<p><font id="141">类似地，会话Cookie 的<tt class="docutils literal"><span class="pre">expires</span></tt> 部分在每次发送会话Cookie 时更新。</font></p>
<p><font id="142">如果响应的状态码时500，则会话不会被保存。</font></p>
</div>
<div class="section" id="s-browser-length-sessions-vs-persistent-sessions">
<span id="s-browser-length-vs-persistent-sessions"></span><span id="browser-length-sessions-vs-persistent-sessions"></span><span id="browser-length-vs-persistent-sessions"></span><h2><font id="189">浏览器时长的会话 VS. 持久的会话</font><a class="headerlink" href="sessions.html#browser-length-sessions-vs-persistent-sessions" title="Permalink to this headline">¶</a></h2>
<p><font id="143">你可以通过<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_EXPIRE_AT_BROWSER_CLOSE"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_EXPIRE_AT_BROWSER_CLOSE</span></tt></a>设置来控制会话框架使用浏览器时长的会话，还是持久的会话。</font></p>
<p><font id="144">默认情况下，<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_EXPIRE_AT_BROWSER_CLOSE"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_EXPIRE_AT_BROWSER_CLOSE</span></tt></a>设置为<tt class="docutils literal"><span class="pre">False</span></tt>，表示会话的Cookie 保存在用户的浏览器中的时间为<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_COOKIE_AGE"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_COOKIE_AGE</span></tt></a>。</font><font id="145">如果你不想让大家每次打开浏览器时都需要登录时可以这样使用。</font></p>
<p><font id="146">如果<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_EXPIRE_AT_BROWSER_CLOSE"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_EXPIRE_AT_BROWSER_CLOSE</span></tt></a> 设置为<tt class="docutils literal"><span class="pre">True</span></tt>，Django 将使用浏览器时长的Cookie —— 用户关闭他们的浏览器时立即过期。</font><font id="147">如果你想让大家在每次打开浏览器时都需要登录时可以这样使用。</font></p>
<p><font id="148">这个设置是一个全局的默认值，可以通过显式地调<tt class="docutils literal"><span class="pre">request.session</span></tt> 的<a class="reference internal" href="sessions.html#django.contrib.sessions.backends.base.SessionBase.set_expiry" title="django.contrib.sessions.backends.base.SessionBase.set_expiry"><tt class="xref py py-meth docutils literal"><span class="pre">set_expiry()</span></tt></a> 方法来覆盖，在上面的<a class="reference internal" href="sessions.html#using-sessions-in-views">在视图中使用会话</a>中有描述。</font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="149">注</font></p>
<p class="last"><font id="150">某些浏览器（例如Chrome）提供一种设置，允许用户在关闭并重新打开浏览器后继续使用会话。</font><font id="151">在某些情况下，这可能干扰<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_EXPIRE_AT_BROWSER_CLOSE"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_EXPIRE_AT_BROWSER_CLOSE</span></tt></a> 设置并导致会话在浏览器关闭后不会过期。</font><font id="152">在测试启用<a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_EXPIRE_AT_BROWSER_CLOSE"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_EXPIRE_AT_BROWSER_CLOSE</span></tt></a>设置的Django 应用时请注意这点。</font></p>
</div>
</div>
<div class="section" id="s-clearing-the-session-store">
<span id="clearing-the-session-store"></span><h2><font id="190">清除存储的会话</font><a class="headerlink" href="sessions.html#clearing-the-session-store" title="Permalink to this headline">¶</a></h2>
<p><font id="153">随着用户在你的网站上创建新的会话，会话数据可能会在你的会话存储仓库中积累。</font><font id="154">如果你正在使用数据库作为后端，<tt class="docutils literal"><span class="pre">django_session</span></tt> 数据库表将持续增长。</font><font id="155">如果你正在使用文件作为后端，你的临时目录包含的文件数量将持续增长。</font></p>
<p><font id="156">要理解这个问题，考虑一下数据库后端发生的情况。</font><font id="157">当一个用户登入时，Django 添加一行到<tt class="docutils literal"><span class="pre">django_session</span></tt> 数据库表中。</font><font id="158">每次会话数据更新时，Django 将更新这行。</font><font id="159">如果用户手工登出，Django 将删除这行。</font><font id="160">但是如果该用户<em>不</em>登出，该行将永远不会删除。</font><font id="161">以文件为后端的过程类似。</font></p>
<p><font id="162">Django <em>不</em>提供自动清除过期会话的功能。</font><font id="163">因此，定期地清除会话是你的任务。</font><font id="164">Django 提供一个清除用的管理命令来满足这个目的：<a class="reference internal" href="../../ref/django-admin.html#django-admin-clearsessions"><tt class="xref std std-djadmin docutils literal"><span class="pre">clearsessions</span></tt></a>。</font><font id="165">建议定义调用这个命令，例如作为一个每天运行的Cron 任务。</font></p>
<p><font id="166">注意，以缓存为后端不存在这个问题，因为缓存会自动删除过期的数据。</font><font id="167">以cookie 为后端也不存在这个问题，因为会话数据通过用户的浏览器保存。</font></p>
</div>
<div class="section" id="s-settings">
<span id="settings"></span><h2><font id="191">设置</font><a class="headerlink" href="sessions.html#settings" title="Permalink to this headline">¶</a></h2>
<p><font id="168">一些<a class="reference internal" href="../../ref/settings.html#settings-sessions"><em>Django 设置</em></a> 让你可以控制会话的行为：</font></p>
<ul class="simple">
<li><a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_CACHE_ALIAS"><font id="229">SESSION_CACHE_ALIAS</font></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_COOKIE_AGE"><font id="230">SESSION_COOKIE_AGE</font></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_COOKIE_DOMAIN"><font id="231">SESSION_COOKIE_DOMAIN</font></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_COOKIE_HTTPONLY"><font id="232">SESSION_COOKIE_HTTPONLY</font></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_COOKIE_NAME"><font id="233">SESSION_COOKIE_NAME</font></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_COOKIE_PATH"><font id="234">SESSION_COOKIE_PATH</font></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_COOKIE_SECURE"><font id="235">SESSION_COOKIE_SECURE</font></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_ENGINE"><font id="236">SESSION_ENGINE</font></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_EXPIRE_AT_BROWSER_CLOSE"><font id="237">SESSION_EXPIRE_AT_BROWSER_CLOSE</font></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_FILE_PATH"><font id="238">SESSION_FILE_PATH</font></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_SAVE_EVERY_REQUEST"><font id="239">SESSION_SAVE_EVERY_REQUEST</font></a></li>
</ul>
</div>
<div class="section" id="s-session-security">
<span id="s-topics-session-security"></span><span id="session-security"></span><span id="topics-session-security"></span><h2><font id="192">会话的安全</font><a class="headerlink" href="sessions.html#session-security" title="Permalink to this headline">¶</a></h2>
<p><font id="169">一个站点下的子域名能够在客户端为整个域名设置Cookie。</font><font id="170">如果子域名不收信任的用户控制且允许来自子域名的Cookie，那么可能发生会话固定。</font></p>
<p><font id="171">例如，一个攻击者可以登录<tt class="docutils literal"><span class="pre">good.example.com</span></tt>并为他的账号获取一个合法的会话。</font><font id="172">如果该攻击者具有<tt class="docutils literal"><span class="pre">bad.example.com</span></tt>的控制权，那么他可以使用这个域名来发送他的会话ID给你，因为子域名允许在<tt class="docutils literal"><span class="pre">*.example.com</span></tt>上设置Cookie。</font><font id="173">当你访问<tt class="docutils literal"><span class="pre">good.example.com</span></tt>时，你将被登录成攻击者而没有注意到并输入你的敏感的个人信息（例如，信用卡信息）到攻击者的账号中。</font></p>
<p><font id="174">另外一个可能的攻击是，如果<tt class="docutils literal"><span class="pre">good.example.com</span></tt>设置它的 <a class="reference internal" href="../../ref/settings.html#std:setting-SESSION_COOKIE_DOMAIN"><tt class="xref std std-setting docutils literal"><span class="pre">SESSION_COOKIE_DOMAIN</span></tt></a> 为<tt class="docutils literal"><span class="pre">".example.com"</span></tt> ，这将导致来自该站点的会话Cookie 被发送到<tt class="docutils literal"><span class="pre">bad.example.com</span></tt>。</font></p>
</div>
<div class="section" id="s-technical-details">
<span id="technical-details"></span><h2><font id="193">技术细节</font><a class="headerlink" href="sessions.html#technical-details" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><font id="240">当使用<a class="reference internal" href="sessions.html#django.contrib.sessions.serializers.JSONSerializer" title="django.contrib.sessions.serializers.JSONSerializer"><tt class="xref py py-class docutils literal"><span class="pre">JSONSerializer</span></tt></a>时，会话字典接收任何可<a class="reference external" href="https://docs.python.org/3/library/json.html#module-json" title="(in Python v3.4)"><tt class="xref py py-mod docutils literal"><span class="pre">json</span></tt></a> 序列化的值，当使用<a class="reference internal" href="sessions.html#django.contrib.sessions.serializers.PickleSerializer" title="django.contrib.sessions.serializers.PickleSerializer"><tt class="xref py py-class docutils literal"><span class="pre">PickleSerializer</span></tt></a>时接收任何pickleable 的Python对象。</font><font id="241">更多信息参见<a class="reference external" href="https://docs.python.org/3/library/pickle.html#module-pickle" title="(in Python v3.4)"><tt class="xref py py-mod docutils literal"><span class="pre">pickle</span></tt></a> 模块。</font></li>
<li><font id="242">会话数据存储在数据中名为<tt class="docutils literal"><span class="pre">django_session</span></tt> 的表中。</font></li>
<li><font id="243">Django 只发送它需要的Cookie。</font><font id="244">如果你没有设置任何会话数据，它将不会发送会话Cookie。</font></li>
</ul>
</div>
<div class="section" id="s-session-ids-in-urls">
<span id="session-ids-in-urls"></span><h2><font id="194">URL 中的会话ID</font><a class="headerlink" href="sessions.html#session-ids-in-urls" title="Permalink to this headline">¶</a></h2>
<p><font id="175">Django 会话框架完全地、唯一地基于Cookie。</font><font id="176">它不像PHP一样，实在没办法就把会话的ID放在URL 中。</font><font id="177">这是一个故意的设计。</font><font id="178">这个行为不仅使得URL变得丑陋，还使得你的网站易于受到通过"Referer" 头部窃取会话ID的攻击。</font></p>
</div>
</div>
</div>
</div>
</div>
<div class="yui-b" id="sidebar">
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
<h3><font id="202">目录</font></h3>
<ul>
<li><a class="reference internal" href="sessions.html#"><font id="245">如何使用会话</font></a><ul>
<li><a class="reference internal" href="sessions.html#enabling-sessions"><font id="246">启用会话</font></a></li>
<li><a class="reference internal" href="sessions.html#configuring-the-session-engine"><font id="247">配置会话引擎</font></a><ul>
<li><a class="reference internal" href="sessions.html#using-database-backed-sessions"><font id="248">使用数据库支持的会话</font></a></li>
<li><a class="reference internal" href="sessions.html#using-cached-sessions"><font id="249">使用基于缓存的会话</font></a></li>
<li><a class="reference internal" href="sessions.html#using-file-based-sessions"><font id="250">使用基于文件的会话</font></a></li>
<li><a class="reference internal" href="sessions.html#using-cookie-based-sessions"><font id="251">使用基于Cookie 的会话</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="sessions.html#using-sessions-in-views"><font id="252">在视图中使用会话</font></a><ul>
<li><a class="reference internal" href="sessions.html#session-serialization"><font id="253">会话的序列化</font></a><ul>
<li><a class="reference internal" href="sessions.html#bundled-serializers"><font id="254">绑定的序列化器</font></a></li>
<li><a class="reference internal" href="sessions.html#write-your-own-serializer"><font id="255">编写你自己的序列化器</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="sessions.html#session-object-guidelines"><font id="256">会话对象指南</font></a></li>
<li><a class="reference internal" href="sessions.html#examples"><font id="257">例子</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="sessions.html#setting-test-cookies"><font id="258">设置测试的Cookie</font></a></li>
<li><a class="reference internal" href="sessions.html#using-sessions-out-of-views"><font id="259">在视图外使用会话</font></a></li>
<li><a class="reference internal" href="sessions.html#when-sessions-are-saved"><font id="260">会话何时保存</font></a></li>
<li><a class="reference internal" href="sessions.html#browser-length-sessions-vs-persistent-sessions"><font id="261">浏览器时长的会话 VS. 持久的会话</font></a></li>
<li><a class="reference internal" href="sessions.html#clearing-the-session-store"><font id="262">清除存储的会话</font></a></li>
<li><a class="reference internal" href="sessions.html#settings"><font id="263">设置</font></a></li>
<li><a class="reference internal" href="sessions.html#session-security"><font id="264">会话安全性</font></a></li>
<li><a class="reference internal" href="sessions.html#technical-details"><font id="265">技术细节</font></a></li>
<li><a class="reference internal" href="sessions.html#session-ids-in-urls"><font id="266">URL 中的会话ID</font></a></li>
</ul>
</li>
</ul>
<h3><font id="203">浏览</font></h3>
<ul>
<li><font id="267">上一页：<a href="middleware.html">中间件</a></font></li>
<li><font id="268">下一页：<a href="../forms/index.html">使用表单</a></font></li>
</ul>
<h3><font id="204">你在这里：</font></h3>
<ul>
<li>
<a href="../../index.html"><font id="269">Django 1.8.2 文档</font></a>
<ul><li><a href="../index.html"><font id="270">使用 Django</font></a>
<ul><li><a href="index.html"><font id="271">处理 HTTP 请求</font></a>
<ul><li><font id="272">如何使用会话</font></li></ul>
</li></ul></li></ul>
</li>
</ul>
<h3><font id="205">本页</font></h3>
<ul class="this-page-menu">
<li><a href="http://python.usyiyi.cn/django/_sources/topics/http/sessions.txt" rel="nofollow"><font id="273">Show Source</font></a></li>
</ul>
<div id="searchbox" style="display: none">
<h3><font id="206">Quick search</font></h3>
<form action="http://python.usyiyi.cn/django/search.html" class="search" method="get">
<input name="q" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
<p class="searchtip" style="font-size: 90%"><font id="179"> Enter search terms or a module, class or function name. </font></p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>
</div>
<h3><font id="207">最后更新：</font></h3>
<p class="topless"><font id="180">May 13, 2015</font></p>
</div>
</div>
<div id="ft">
<div class="nav">
    « <a href="middleware.html" title="Middleware">previous</a>
     |
    <a accesskey="U" href="../index.html" title="Using Django">up</a>
   |
    <a href="../forms/index.html" title="Working with forms">next</a> »</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div id="disqus_thread"></div><br>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'djangocn'; // required: replace example with your forum shortname
    var disqus_identifier = '/django/topics/http/sessions';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<link href="http://python.usyiyi.cn/django/_static/ms_translator.css" rel="stylesheet" type="text/css"/>
<script src="http://python.usyiyi.cn/django/_static/ms_translator.js" type="text/javascript"></script>
<script src="http://python.usyiyi.cn/django/_static/jquery-ui-1.9.2.custom.min.js" type="text/javascript"></script>
<div id="MicrosoftTranslator" style="display:none; position: absolute; z-index: 2147483647; margin: 0px; border: 2px solid rgb(210, 210, 210); padding: 0px; color: rgb(0, 0, 0); background-color: rgb(230, 230, 230); font-family: Arial,Helvetica,Sans-Serif; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: normal; direction: ltr; text-align: left; left: 274px; top: 2048.03px; min-width: 400px;">
    <div id="MSTCClose" style="float: right;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/tooltip_close.gif">
      </a>
    </div>
    
    <div id="MSTCPopDown" style="float: right;" style="display: none;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/popdown.gif">
      </a>
    </div>
    <div id="MSTCPopUP" style="float: right;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/popup.gif">
      </a>
    </div>
    
    <div id="MSTCTitle" style="margin: 4px 4px 8px; font-weight: bold;">原文
    </div>
    
    <div style="direction: ltr; text-align: left;">
      <span id="MSTCOrigion" style="display: inline-block; margin: 0px 4px 4px;"> </span>
    </div>
    
    <div id="MicrosoftTranslatorCommunity" class="MSTCltr">
      <div id="MSTCContent">
        <a id="MSTCExpandLink">
          <span id="MSTCImprove">改进翻译</span>
          <span id="MSTCSuggest">最小化</span>
          <img src="http://python.usyiyi.cn/django/_static/ctftoggledown.gif" id="MSTCToggleDown">
          <img src="http://python.usyiyi.cn/django/_static/ctftoggleup.gif" id="MSTCToggleUp">
        </a>
        <div id="MSTCRootPanel">
          <span id="MSTCLoading" style="display: none;">正在加载...</span>
          <div style="display: none;" id="MSTCTransPanelError">
            <div class="MSTCTableRow">
              <div class="MSTCTransPanelExc MSTCTableCell">
                <img style="border-width:0px;" src="http://python.usyiyi.cn/django/_static/error_exclamation.gif" id="ExclamationImage">
              </div>
              <div class="MSTCTableCell">
                <span id="MSTCTransPanelErrorMsg"></span>
              </div>
            </div>
            <div class="MSTCTableRow">
              <div class="MSTCTableCell"></div>
              <div class="MSTCTableCell MSTCFlipHoriz">
                <input type="image" style="border-width:0px;" src="http://python.usyiyi.cn/django/_static/error_OK.gif" class="MSTCErrorButtons" id="MSTCOKImgBtn" name="MSTCOKImgBtn">
              </div>
            </div>
          </div>
          
          <div id="MSTCTransPanel">
          </div>
          
          <div id="MSTCPrevNextPanel">
            <a id="MSTCPrevLink" style='border-right-width: 1px;border-right-style: solid;padding-right: 5px;'>
              <span>上一页</span>
            </a>
            <a style='color: black; border-right-width: 1px;border-right-style: solid;padding-right: 5px;'>
              <span>第</span>
              <span id="MSTCPage"></span>
              <span>页</span>
            </a>
            <a id="MSTCNextLink" style='padding-left: 5px;'>
              <span>下一页</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>
</html>