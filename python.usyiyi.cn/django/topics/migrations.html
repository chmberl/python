<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>迁移 — Django 1.8.2 中文文档</title>
<link href="../_static/default.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.8.2.dev20150513143415',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<link href="../index.html" rel="top" title="Django 1.8.2.dev20150513143415 documentation"/>
<link href="index.html" rel="up" title="Using Django"/>
<link href="files.html" rel="next" title="Managing files"/>
<link href="class-based-views/mixins.html" rel="prev" title="Using mixins with class-based views"/>
<script src="http://python.usyiyi.cn/django/templatebuiltins.js" type="text/javascript"></script>
<script type="text/javascript">
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='http://python.usyiyi.cn/django/topics/&quot;&#32;+&#32;base&#32;+&#32;&quot;#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='http://python.usyiyi.cn/django/topics/&quot;&#32;+&#32;base&#32;+&#32;&quot;#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);
</script>
</head>
<body>
<div class="document">
<div class="yui-t6" id="custom-doc">
<div id="hd">
<h1><font id="184">Django 1.8.2.dev20150513143415 documentation</font></h1>
<div id="global-nav">
<a href="../index.html" title="Home page">Home</a>  |
        <a href="../contents.html" title="Table of contents">Table of contents</a>  |
        <a href="../genindex.html" title="Global index">Index</a>  |
        <a href="../py-modindex.html" title="Module index">Modules</a>
</div>
<div class="nav">
    « <a href="class-based-views/mixins.html" title="Using mixins with class-based views">previous</a>
     |
    <a accesskey="U" href="index.html" title="Using Django">up</a>
   |
    <a href="files.html" title="Managing files">next</a> »</div>
</div>
<div id="bd">
<div id="yui-main">
<div class="yui-b">
<div class="yui-g" id="topics-migrations">
<div class="section" id="s-module-django.db.migrations">
<span id="s-migrations"></span><span id="module-django.db.migrations"></span><span id="migrations"></span><h1><font id="185">迁移</font><a class="headerlink" href="migrations.html#module-django.db.migrations" title="Permalink to this headline">¶</a></h1>
<div class="versionadded">
<span class="title">New in Django 1.7.</span> </div>
<p><font id="1">Migrations are Django’s way of propagating changes you make to your models (adding a field, deleting a model, etc.) into your database schema. </font><font id="2">They’re designed to be mostly automatic, but you’ll need to know when to make migrations, when to run them, and the common problems you might run into.</font></p>
<div class="section" id="s-a-brief-history">
<span id="a-brief-history"></span><h2><font id="186">简短历史</font><a class="headerlink" href="migrations.html#a-brief-history" title="Permalink to this headline">¶</a></h2>
<p><font id="3">在 1.7版本之前, Django 只支持添加新模型到数据库；</font><font id="4">无法通过<tt class="docutils literal"><span class="pre">syncdb</span></tt>命令来修改或移除已存在的模型  (已被<a class="reference internal" href="../ref/django-admin.html#django-admin-migrate"><tt class="xref std std-djadmin docutils literal"><span class="pre">migrate</span></tt></a>代替)。</font></p>
<p><font id="5">第三方工具，最为显著的<a class="reference external" href="http://south.aeracode.org">South</a>, 为这些额外的功能提供支持, but it was considered important enough that support was brought into core Django.</font></p>
</div>
<div class="section" id="s-the-commands">
<span id="the-commands"></span><h2><font id="187">命令集</font><a class="headerlink" href="migrations.html#the-commands" title="Permalink to this headline">¶</a></h2>
<p><font id="6">There are several commands which you will use to interact with migrations and Django’s handling of database schema:</font></p>
<ul class="simple">
<li><font id="217"><a class="reference internal" href="../ref/django-admin.html#django-admin-migrate"><tt class="xref std std-djadmin docutils literal"><span class="pre">migrate</span></tt></a>, which is responsible for applying migrations, as well as unapplying and listing their status.</font></li>
<li><font id="218"><a class="reference internal" href="../ref/django-admin.html#django-admin-makemigrations"><tt class="xref std std-djadmin docutils literal"><span class="pre">makemigrations</span></tt></a>, which is responsible for creating new migrations based on the changes you have made to your models.</font></li>
<li><font id="219"><a class="reference internal" href="../ref/django-admin.html#django-admin-sqlmigrate"><tt class="xref std std-djadmin docutils literal"><span class="pre">sqlmigrate</span></tt></a>, which displays the SQL statements for a migration.</font></li>
</ul>
<p><font id="7">It’s worth noting that migrations are created and run on a per-app basis. </font><font id="8">In particular, it’s possible to have apps that <em>do not use migrations</em> (these are referred to as “unmigrated” apps) - these apps will instead mimic the legacy behavior of just adding new models.</font></p>
<p><font id="9">You should think of migrations as a version control system for your database schema. </font><font id="10"><tt class="docutils literal"><span class="pre">makemigrations</span></tt> is responsible for packaging up your model changes into individual migration files - analogous to commits - and <tt class="docutils literal"><span class="pre">migrate</span></tt> is responsible for applying those to your database.</font></p>
<p><font id="11">The migration files for each app live in a “migrations” directory inside of that app, and are designed to be committed to, and distributed as part of, its codebase. </font><font id="12">You should be making them once on your development machine and then running the same migrations on your colleagues’ machines, your staging machines, and eventually your production machines.</font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="13">Note</font></p>
<p class="last"><font id="14">It is possible to override the name of the package which contains the migrations on a per-app basis by modifying the <a class="reference internal" href="../ref/settings.html#std:setting-MIGRATION_MODULES"><tt class="xref std std-setting docutils literal"><span class="pre">MIGRATION_MODULES</span></tt></a> setting.</font></p>
</div>
<p><font id="15">Migrations will run the same way on the same dataset and produce consistent results, meaning that what you see in development and staging is, under the same circumstances, exactly what will happen in production.</font></p>
<p><font id="16">Django will make migrations for any change to your models or fields - even options that don’t affect the database - as the only way it can reconstruct a field correctly is to have all the changes in the history, and you might need those options in some data migrations later on (for example, if you’ve set custom validators).</font></p>
</div>
<div class="section" id="s-backend-support">
<span id="backend-support"></span><h2><font id="188">后台支持</font><a class="headerlink" href="migrations.html#backend-support" title="Permalink to this headline">¶</a></h2>
<p><font id="17">Migrations are supported on all backends that Django ships with, as well as any third-party backends if they have programmed in support for schema alteration (done via the <a class="reference internal" href="../ref/schema-editor.html"><em>SchemaEditor</em></a> class).</font></p>
<p><font id="18">However, some databases are more capable than others when it comes to schema migrations; </font><font id="19">some of the caveats are covered below.</font></p>
<div class="section" id="s-postgresql">
<span id="postgresql"></span><h3><font id="201">PostgreSQL</font><a class="headerlink" href="migrations.html#postgresql" title="Permalink to this headline">¶</a></h3>
<p><font id="20">PostgreSQL is the most capable of all the databases here in terms of schema support; </font><font id="21">the only caveat is that adding columns with default values will cause a full rewrite of the table, for a time proportional to its size.</font></p>
<p><font id="22">For this reason, it’s recommended you always create new columns with <tt class="docutils literal"><span class="pre">null=True</span></tt>, as this way they will be added immediately.</font></p>
</div>
<div class="section" id="s-mysql">
<span id="mysql"></span><h3><font id="202">MySQL</font><a class="headerlink" href="migrations.html#mysql" title="Permalink to this headline">¶</a></h3>
<p><font id="23">MySQL lacks support for transactions around schema alteration operations, meaning that if a migration fails to apply you will have to manually unpick the changes in order to try again (it’s impossible to roll back to an earlier point).</font></p>
<p><font id="24">In addition, MySQL will fully rewrite tables for almost every schema operation and generally takes a time proportional to the number of rows in the table to add or remove columns. </font><font id="25">On slower hardware this can be worse than a minute per million rows - adding a few columns to a table with just a few million rows could lock your site up for over ten minutes.</font></p>
<p><font id="26">Finally, MySQL has reasonably small limits on name lengths for columns, tables and indexes, as well as a limit on the combined size of all columns an index covers. </font><font id="27">This means that indexes that are possible on other backends will fail to be created under MySQL.</font></p>
</div>
<div class="section" id="s-sqlite">
<span id="sqlite"></span><h3><font id="203">SQLite</font><a class="headerlink" href="migrations.html#sqlite" title="Permalink to this headline">¶</a></h3>
<p><font id="28">SQLite has very little built-in schema alteration support, and so Django attempts to emulate it by:</font></p>
<ul class="simple">
<li><font id="220">Creating a new table with the new schema</font></li>
<li><font id="221">Copying the data across</font></li>
<li><font id="222">Dropping the old table</font></li>
<li><font id="223">Renaming the new table to match the original name</font></li>
</ul>
<p><font id="29">This process generally works well, but it can be slow and occasionally buggy. </font><font id="30">It is not recommended that you run and migrate SQLite in a production environment unless you are very aware of the risks and its limitations; </font><font id="31">the support Django ships with is designed to allow developers to use SQLite on their local machines to develop less complex Django projects without the need for a full database.</font></p>
</div>
</div>
<div class="section" id="s-workflow">
<span id="workflow"></span><h2><font id="189">工作流程</font><a class="headerlink" href="migrations.html#workflow" title="Permalink to this headline">¶</a></h2>
<p><font id="32">迁移工作很简单。 </font><font id="33">修改你的模型 -比如添加字段和移除一个模型 - 然后运行 <a class="reference internal" href="../ref/django-admin.html#django-admin-makemigrations"><tt class="xref std std-djadmin docutils literal"><span class="pre">makemigrations</span></tt></a>:</font></p>
<div class="highlight-python"><div class="highlight"><pre>$ python manage.py makemigrations
Migrations for 'books':
  0003_auto.py:
    - Alter field author on book
</pre></div>
</div>
<p><font id="34">Your models will be scanned and compared to the versions currently contained in your migration files, and then a new set of migrations will be written out. </font><font id="35">Make sure to read the output to see what <tt class="docutils literal"><span class="pre">makemigrations</span></tt> thinks you have changed - it’s not perfect, and for complex changes it might not be detecting what you expect.</font></p>
<p><font id="36">Once you have your new migration files, you should apply them to your database to make sure they work as expected:</font></p>
<div class="highlight-python"><div class="highlight"><pre>$ python manage.py migrate
Operations to perform:
  Synchronize unmigrated apps: sessions, admin, messages, auth, staticfiles, contenttypes
  Apply all migrations: books
Synchronizing apps without migrations:
  Creating tables...
  Installing custom SQL...
  Installing indexes...
Installed 0 object(s) from 0 fixture(s)
Running migrations:
  Applying books.0003_auto... OK
</pre></div>
</div>
<p><font id="37">The command runs in two stages; </font><font id="38">first, it synchronizes unmigrated apps (performing the same functionality that <tt class="docutils literal"><span class="pre">syncdb</span></tt> used to provide), and then it runs any migrations that have not yet been applied.</font></p>
<p><font id="39">Once the migration is applied, commit the migration and the models change to your version control system as a single commit - that way, when other developers (or your production servers) check out the code, they’ll get both the changes to your models and the accompanying migration at the same time.</font></p>
<div class="versionadded">
<span class="title">New in Django 1.8.</span> </div>
<p><font id="40">If you want to give the migration(s) a meaningful name instead of a generated one, you can use the <a class="reference internal" href="../ref/django-admin.html#django-admin-option---name"><tt class="xref std std-djadminopt docutils literal"><span class="pre">--name</span></tt></a> option:</font></p>
<div class="highlight-python"><div class="highlight"><pre>$ python manage.py makemigrations --name changed_my_model your_app_label
</pre></div>
</div>
<div class="section" id="s-version-control">
<span id="version-control"></span><h3><font id="204">版本控制</font><a class="headerlink" href="migrations.html#version-control" title="Permalink to this headline">¶</a></h3>
<p><font id="41">Because migrations are stored in version control, you’ll occasionally come across situations where you and another developer have both committed a migration to the same app at the same time, resulting in two migrations with the same number.</font></p>
<p><font id="42">Don’t worry - the numbers are just there for developers’ reference, Django just cares that each migration has a different name. </font><font id="43">Migrations specify which other migrations they depend on - including earlier migrations in the same app - in the file, so it’s possible to detect when there’s two new migrations for the same app that aren’t ordered.</font></p>
<p><font id="44">When this happens, Django will prompt you and give you some options. </font><font id="45">If it thinks it’s safe enough, it will offer to automatically linearize the two migrations for you. </font><font id="46">If not, you’ll have to go in and modify the migrations yourself - don’t worry, this isn’t difficult, and is explained more in <a class="reference internal" href="migrations.html#migration-files"><em>Migration files</em></a> below.</font></p>
</div>
</div>
<div class="section" id="s-dependencies">
<span id="dependencies"></span><h2><font id="190">依赖关系</font><a class="headerlink" href="migrations.html#dependencies" title="Permalink to this headline">¶</a></h2>
<p><font id="47">While migrations are per-app, the tables and relationships implied by your models are too complex to be created for just one app at a time. </font><font id="48">When you make a migration that requires something else to run - for example, you add a <tt class="docutils literal"><span class="pre">ForeignKey</span></tt> in your <tt class="docutils literal"><span class="pre">books</span></tt> app to your <tt class="docutils literal"><span class="pre">authors</span></tt> app - the resulting migration will contain a dependency on a migration in <tt class="docutils literal"><span class="pre">authors</span></tt>.</font></p>
<p><font id="49">This means that when you run the migrations, the <tt class="docutils literal"><span class="pre">authors</span></tt> migration runs first and creates the table the <tt class="docutils literal"><span class="pre">ForeignKey</span></tt> references, and then the migration that makes the <tt class="docutils literal"><span class="pre">ForeignKey</span></tt> column runs afterwards and creates the constraint. </font><font id="50">If this didn’t happen, the migration would try to create the <tt class="docutils literal"><span class="pre">ForeignKey</span></tt> column without the table it’s referencing existing and your database would throw an error.</font></p>
<p><font id="51">This dependency behavior affects most migration operations where you restrict to a single app. Restricting to a single app (either in <tt class="docutils literal"><span class="pre">makemigrations</span></tt> or <tt class="docutils literal"><span class="pre">migrate</span></tt>) is a best-efforts promise, and not a guarantee; </font><font id="52">any other apps that need to be used to get dependencies correct will be.</font></p>
<p id="unmigrated-dependencies"><font id="53">Be aware, however, that unmigrated apps cannot depend on migrated apps, by the very nature of not having migrations. </font><font id="54">This means that it is not generally possible to have an unmigrated app have a <tt class="docutils literal"><span class="pre">ForeignKey</span></tt> or <tt class="docutils literal"><span class="pre">ManyToManyField</span></tt> to a migrated app; </font><font id="55">some cases may work, but it will eventually fail.</font></p>
<div class="admonition warning">
<p class="first admonition-title"><font id="56">Warning</font></p>
<p class="last"><font id="57">Even if things appear to work with unmigrated apps depending on migrated apps, Django may not generate all the necessary foreign key constraints!</font></p>
</div>
<p><font id="58">This is particularly apparent if you use swappable models (e.g. <tt class="docutils literal"><span class="pre">AUTH_USER_MODEL</span></tt>), as every app that uses swappable models will need to have migrations if you’re unlucky. </font><font id="59">As time goes on, more and more third-party apps will get migrations, but in the meantime you can either give them migrations yourself (using <a class="reference internal" href="../ref/settings.html#std:setting-MIGRATION_MODULES"><tt class="xref std std-setting docutils literal"><span class="pre">MIGRATION_MODULES</span></tt></a> to store those modules outside of the app’s own module if you wish), or keep the app with your user model unmigrated.</font></p>
</div>
<div class="section" id="s-migration-files">
<span id="s-id1"></span><span id="migration-files"></span><span id="id1"></span><h2><font id="191">迁移文件</font><a class="headerlink" href="migrations.html#migration-files" title="Permalink to this headline">¶</a></h2>
<p><font id="60">Migrations are stored as an on-disk format, referred to here as “migration files”. </font><font id="61">These files are actually just normal Python files with an agreed-upon object layout, written in a declarative style.</font></p>
<p><font id="62">A basic migration file looks like this:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">migrations</span><span class="p">,</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Migration</span><span class="p">(</span><span class="n">migrations</span><span class="o">.</span><span class="n">Migration</span><span class="p">):</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">[(</span><span class="s">"migrations"</span><span class="p">,</span> <span class="s">"0001_initial"</span><span class="p">)]</span>

    <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">migrations</span><span class="o">.</span><span class="n">DeleteModel</span><span class="p">(</span><span class="s">"Tribble"</span><span class="p">),</span>
        <span class="n">migrations</span><span class="o">.</span><span class="n">AddField</span><span class="p">(</span><span class="s">"Author"</span><span class="p">,</span> <span class="s">"rating"</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p><font id="63">What Django looks for when it loads a migration file (as a Python module) is a subclass of <tt class="docutils literal"><span class="pre">django.db.migrations.Migration</span></tt> called <tt class="docutils literal"><span class="pre">Migration</span></tt>. </font><font id="64">It then inspects this object for four attributes, only two of which are used most of the time:</font></p>
<ul class="simple">
<li><font id="224"><tt class="docutils literal"><span class="pre">dependencies</span></tt>, a list of migrations this one depends on.</font></li>
<li><font id="225"><tt class="docutils literal"><span class="pre">operations</span></tt>, a list of <tt class="docutils literal"><span class="pre">Operation</span></tt> classes that define what this migration does.</font></li>
</ul>
<p><font id="65">The operations are the key; </font><font id="66">they are a set of declarative instructions which tell Django what schema changes need to be made. </font><font id="67">Django scans them and builds an in-memory representation of all of the schema changes to all apps, and uses this to generate the SQL which makes the schema changes.</font></p>
<p><font id="68">That in-memory structure is also used to work out what the differences are between your models and the current state of your migrations; </font><font id="69">Django runs through all the changes, in order, on an in-memory set of models to come up with the state of your models last time you ran <tt class="docutils literal"><span class="pre">makemigrations</span></tt>. </font><font id="70">It then uses these models to compare against the ones in your <tt class="docutils literal"><span class="pre">models.py</span></tt> files to work out what you have changed.</font></p>
<p><font id="71">You should rarely, if ever, need to edit migration files by hand, but it’s entirely possible to write them manually if you need to. </font><font id="72">Some of the more complex operations are not autodetectable and are only available via a hand-written migration, so don’t be scared about editing them if you have to.</font></p>
<div class="section" id="s-custom-fields">
<span id="custom-fields"></span><h3><font id="205">自定义字段</font><a class="headerlink" href="migrations.html#custom-fields" title="Permalink to this headline">¶</a></h3>
<p><font id="73">You can’t modify the number of positional arguments in an already migrated custom field without raising a <tt class="docutils literal"><span class="pre">TypeError</span></tt>. </font><font id="74">The old migration will call the modified <tt class="docutils literal"><span class="pre">__init__</span></tt> method with the old signature. </font><font id="75">So if you need a new argument, please create a keyword argument and add something like <tt class="docutils literal"><span class="pre">assert</span> <span class="pre">'argument_name'</span> <span class="pre">in</span> <span class="pre">kwargs</span></tt> in the constructor.</font></p>
</div>
<div class="section" id="s-model-managers">
<span id="s-using-managers-in-migrations"></span><span id="model-managers"></span><span id="using-managers-in-migrations"></span><h3><font id="206">Model managers</font><a class="headerlink" href="migrations.html#model-managers" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<span class="title">New in Django 1.8.</span> </div>
<p><font id="76">You can optionally serialize managers into migrations and have them available in <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunPython" title="django.db.migrations.operations.RunPython"><tt class="xref py py-class docutils literal"><span class="pre">RunPython</span></tt></a> operations. </font><font id="77">This is done by defining a <tt class="docutils literal"><span class="pre">use_in_migrations</span></tt> attribute on the manager class:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
    <span class="n">use_in_migrations</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="n">MyManager</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="78">If you are using the <a class="reference internal" href="db/managers.html#django.db.models.from_queryset" title="django.db.models.from_queryset"><tt class="xref py py-meth docutils literal"><span class="pre">from_queryset()</span></tt></a> function to dynamically generate a manager class, you need to inherit from the generated class to make it importable:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyManager</span><span class="p">(</span><span class="n">MyBaseManager</span><span class="o">.</span><span class="n">from_queryset</span><span class="p">(</span><span class="n">CustomQuerySet</span><span class="p">)):</span>
    <span class="n">use_in_migrations</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="n">MyManager</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="79">Please refer to the notes about <a class="reference internal" href="migrations.html#historical-models"><em>Historical models</em></a> in migrations to see the implications that come along.</font></p>
</div>
</div>
<div class="section" id="s-adding-migrations-to-apps">
<span id="adding-migrations-to-apps"></span><h2><font id="192">Adding migrations to apps</font><a class="headerlink" href="migrations.html#adding-migrations-to-apps" title="Permalink to this headline">¶</a></h2>
<p><font id="80">Adding migrations to new apps is straightforward - they come preconfigured to accept migrations, and so just run <a class="reference internal" href="../ref/django-admin.html#django-admin-makemigrations"><tt class="xref std std-djadmin docutils literal"><span class="pre">makemigrations</span></tt></a> once you’ve made some changes.</font></p>
<p><font id="81">If your app already has models and database tables, and doesn’t have migrations yet (for example, you created it against a previous Django version), you’ll need to convert it to use migrations; </font><font id="82">this is a simple process:</font></p>
<div class="highlight-python"><div class="highlight"><pre>$ python manage.py makemigrations your_app_label
</pre></div>
</div>
<p><font id="83">This will make a new initial migration for your app. </font><font id="84">Now, run <tt class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span> <span class="pre">--fake-initial</span></tt>, and Django will detect that you have an initial migration <em>and</em> that the tables it wants to create already exist, and will mark the migration as already applied. </font><font id="85">(Without the <a class="reference internal" href="../ref/django-admin.html#django-admin-option---fake-initial"><tt class="xref std std-djadminopt docutils literal"><span class="pre">--fake-initial</span></tt></a> flag, the <a class="reference internal" href="../ref/django-admin.html#django-admin-migrate"><tt class="xref std std-djadmin docutils literal"><span class="pre">migrate</span></tt></a> command would error out because the tables it wants to create already exist.)</font></p>
<p><font id="86">Note that this only works given two things:</font></p>
<ul class="simple">
<li><font id="226">You have not changed your models since you made their tables. </font><font id="227">For migrations to work, you must make the initial migration <em>first</em> and then make changes, as Django compares changes against migration files, not the database.</font></li>
<li><font id="228">You have not manually edited your database - Django won’t be able to detect that your database doesn’t match your models, you’ll just get errors when migrations try to modify those tables.</font></li>
</ul>
</div>
<div class="section" id="s-historical-models">
<span id="s-id2"></span><span id="historical-models"></span><span id="id2"></span><h2><font id="193">Historical models</font><a class="headerlink" href="migrations.html#historical-models" title="Permalink to this headline">¶</a></h2>
<p><font id="87">When you run migrations, Django is working from historical versions of your models stored in the migration files. </font><font id="88">If you write Python code using the <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunPython" title="django.db.migrations.operations.RunPython"><tt class="xref py py-class docutils literal"><span class="pre">RunPython</span></tt></a> operation, or if you have <tt class="docutils literal"><span class="pre">allow_migrate</span></tt> methods on your database routers, you will be exposed to these versions of your models.</font></p>
<p><font id="89">Because it’s impossible to serialize arbitrary Python code, these historical models will not have any custom methods that you have defined. </font><font id="90">They will, however, have the same fields, relationships, managers (limited to those with <tt class="docutils literal"><span class="pre">use_in_migrations</span> <span class="pre">=</span> <span class="pre">True</span></tt>) and <tt class="docutils literal"><span class="pre">Meta</span></tt> options (also versioned, so they may be different from your current ones).</font></p>
<div class="admonition warning">
<p class="first admonition-title"><font id="91">Warning</font></p>
<p class="last"><font id="92">This means that you will NOT have custom <tt class="docutils literal"><span class="pre">save()</span></tt> methods called on objects when you access them in migrations, and you will NOT have any custom constructors or instance methods. </font><font id="93">Plan appropriately!</font></p>
</div>
<p><font id="94">References to functions in field options such as <tt class="docutils literal"><span class="pre">upload_to</span></tt> and <tt class="docutils literal"><span class="pre">limit_choices_to</span></tt> and model manager declarations with managers having <tt class="docutils literal"><span class="pre">use_in_migrations</span> <span class="pre">=</span> <span class="pre">True</span></tt> are serialized in migrations, so the functions and classes will need to be kept around for as long as there is a migration referencing them. </font><font id="95">Any <a class="reference internal" href="../howto/custom-model-fields.html"><em>custom model fields</em></a> will also need to be kept, since these are imported directly by migrations.</font></p>
<p><font id="96">In addition, the base classes of the model are just stored as pointers, so you must always keep base classes around for as long as there is a migration that contains a reference to them. </font><font id="97">On the plus side, methods and managers from these base classes inherit normally, so if you absolutely need access to these you can opt to move them into a superclass.</font></p>
</div>
<div class="section" id="s-considerations-when-removing-model-fields">
<span id="s-migrations-removing-model-fields"></span><span id="considerations-when-removing-model-fields"></span><span id="migrations-removing-model-fields"></span><h2><font id="194">Considerations when removing model fields</font><a class="headerlink" href="migrations.html#considerations-when-removing-model-fields" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<span class="title">New in Django 1.8.</span> </div>
<p><font id="98">Similar to the “references to historical functions” considerations described in the previous section, removing custom model fields from your project or third-party app will cause a problem if they are referenced in old migrations.</font></p>
<p><font id="99">To help with this situation, Django provides some model field attributes to assist with model field deprecation using the <a class="reference internal" href="checks.html"><em>system checks framework</em></a>.</font></p>
<p><font id="100">Add the <tt class="docutils literal"><span class="pre">system_check_deprecated_details</span></tt> attribute to your model field similar to the following:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">IPAddressField</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="n">system_check_deprecated_details</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'msg'</span><span class="p">:</span> <span class="p">(</span>
            <span class="s">'IPAddressField has been deprecated. Support for it (except '</span>
            <span class="s">'in historical migrations) will be removed in Django 1.9.'</span>
        <span class="p">),</span>
        <span class="s">'hint'</span><span class="p">:</span> <span class="s">'Use GenericIPAddressField instead.'</span><span class="p">,</span>  <span class="c"># optional</span>
        <span class="s">'id'</span><span class="p">:</span> <span class="s">'fields.W900'</span><span class="p">,</span>  <span class="c"># pick a unique ID for your field.</span>
    <span class="p">}</span>
</pre></div>
</div>
<p><font id="101">After a deprecation period of your choosing (two major releases for fields in Django itself), change the <tt class="docutils literal"><span class="pre">system_check_deprecated_details</span></tt> attribute to <tt class="docutils literal"><span class="pre">system_check_removed_details</span></tt> and update the dictionary similar to:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">IPAddressField</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="n">system_check_removed_details</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'msg'</span><span class="p">:</span> <span class="p">(</span>
            <span class="s">'IPAddressField has been removed except for support in '</span>
            <span class="s">'historical migrations.'</span>
        <span class="p">),</span>
        <span class="s">'hint'</span><span class="p">:</span> <span class="s">'Use GenericIPAddressField instead.'</span><span class="p">,</span>
        <span class="s">'id'</span><span class="p">:</span> <span class="s">'fields.E900'</span><span class="p">,</span>  <span class="c"># pick a unique ID for your field.</span>
    <span class="p">}</span>
</pre></div>
</div>
<p><font id="102">You should keep the field’s methods that are required for it to operate in database migrations such as <tt class="docutils literal"><span class="pre">__init__()</span></tt>, <tt class="docutils literal"><span class="pre">deconstruct()</span></tt>, and <tt class="docutils literal"><span class="pre">get_internal_type()</span></tt>. </font><font id="103">Keep this stub field for as long as any migrations which reference the field exist. </font><font id="104">For example, after squashing migrations and removing the old ones, you should be able to remove the field completely.</font></p>
</div>
<div class="section" id="s-data-migrations">
<span id="s-id3"></span><span id="data-migrations"></span><span id="id3"></span><h2><font id="195">数据迁移</font><a class="headerlink" href="migrations.html#data-migrations" title="Permalink to this headline">¶</a></h2>
<p><font id="105">As well as changing the database schema, you can also use migrations to change the data in the database itself, in conjunction with the schema if you want.</font></p>
<p><font id="106">Migrations that alter data are usually called “data migrations”; </font><font id="107">they’re best written as separate migrations, sitting alongside your schema migrations.</font></p>
<p><font id="108">Django can’t automatically generate data migrations for you, as it does with schema migrations, but it’s not very hard to write them. </font><font id="109">Migration files in Django are made up of <a class="reference internal" href="../ref/migration-operations.html"><em>Operations</em></a>, and the main operation you use for data migrations is <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunPython" title="django.db.migrations.operations.RunPython"><tt class="xref py py-class docutils literal"><span class="pre">RunPython</span></tt></a>.</font></p>
<p><font id="110">To start, make an empty migration file you can work from (Django will put the file in the right place, suggest a name, and add dependencies for you):</font></p>
<div class="highlight-python"><div class="highlight"><pre>python manage.py makemigrations --empty yourappname
</pre></div>
</div>
<p><font id="111">Then, open up the file; </font><font id="112">it should look something like this:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">migrations</span>

<span class="k">class</span> <span class="nc">Migration</span><span class="p">(</span><span class="n">migrations</span><span class="o">.</span><span class="n">Migration</span><span class="p">):</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">'yourappname'</span><span class="p">,</span> <span class="s">'0001_initial'</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">]</span>
</pre></div>
</div>
<p><font id="113">Now, all you need to do is create a new function and have <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunPython" title="django.db.migrations.operations.RunPython"><tt class="xref py py-class docutils literal"><span class="pre">RunPython</span></tt></a> use it. </font><font id="114"><a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunPython" title="django.db.migrations.operations.RunPython"><tt class="xref py py-class docutils literal"><span class="pre">RunPython</span></tt></a> expects a callable as its argument which takes two arguments - the first is an <a class="reference internal" href="../ref/applications.html"><em>app registry</em></a> that has the historical versions of all your models loaded into it to match where in your history the migration sits, and the second is a <a class="reference internal" href="../ref/schema-editor.html"><em>SchemaEditor</em></a>, which you can use to manually effect database schema changes (but beware, doing this can confuse the migration autodetector!)</font></p>
<p><font id="115">Let’s write a simple migration that populates our new <tt class="docutils literal"><span class="pre">name</span></tt> field with the combined values of <tt class="docutils literal"><span class="pre">first_name</span></tt> and <tt class="docutils literal"><span class="pre">last_name</span></tt> (we’ve come to our senses and realized that not everyone has first and last names). </font><font id="116">All we need to do is use the historical model and iterate over the rows:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">migrations</span>

<span class="k">def</span> <span class="nf">combine_names</span><span class="p">(</span><span class="n">apps</span><span class="p">,</span> <span class="n">schema_editor</span><span class="p">):</span>
    <span class="c"># We can't import the Person model directly as it may be a newer</span>
    <span class="c"># version than this migration expects. We use the historical version.</span>
    <span class="n">Person</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s">"yourappname"</span><span class="p">,</span> <span class="s">"Person"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">person</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">person</span><span class="o">.</span><span class="n">last_name</span><span class="p">)</span>
        <span class="n">person</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Migration</span><span class="p">(</span><span class="n">migrations</span><span class="o">.</span><span class="n">Migration</span><span class="p">):</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">'yourappname'</span><span class="p">,</span> <span class="s">'0001_initial'</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">migrations</span><span class="o">.</span><span class="n">RunPython</span><span class="p">(</span><span class="n">combine_names</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p><font id="117">Once that’s done, we can just run <tt class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span></tt> as normal and the data migration will run in place alongside other migrations.</font></p>
<p><font id="118">You can pass a second callable to <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunPython" title="django.db.migrations.operations.RunPython"><tt class="xref py py-class docutils literal"><span class="pre">RunPython</span></tt></a> to run whatever logic you want executed when migrating backwards. </font><font id="119">If this callable is omitted, migrating backwards will raise an exception.</font></p>
<div class="section" id="s-accessing-models-from-other-apps">
<span id="accessing-models-from-other-apps"></span><h3><font id="207">Accessing models from other apps</font><a class="headerlink" href="migrations.html#accessing-models-from-other-apps" title="Permalink to this headline">¶</a></h3>
<p><font id="120">When writing a <tt class="docutils literal"><span class="pre">RunPython</span></tt> function that uses models from apps other than the one in which the migration is located, the migration’s <tt class="docutils literal"><span class="pre">dependencies</span></tt> attribute should include the latest migration of each app that is involved, otherwise you may get an error similar to: <tt class="docutils literal"><span class="pre">LookupError:</span> <span class="pre">No</span> <span class="pre">installed</span> <span class="pre">app</span> <span class="pre">with</span> <span class="pre">label</span> <span class="pre">'myappname'</span></tt> when you try to retrieve the model in the <tt class="docutils literal"><span class="pre">RunPython</span></tt> function using <tt class="docutils literal"><span class="pre">apps.get_model()</span></tt>.</font></p>
<p><font id="121">In the following example, we have a migration in <tt class="docutils literal"><span class="pre">app1</span></tt> which needs to use models in <tt class="docutils literal"><span class="pre">app2</span></tt>. </font><font id="122">We aren’t concerned with the details of <tt class="docutils literal"><span class="pre">move_m1</span></tt> other than the fact it will need to access models from both apps. </font><font id="123">Therefore we’ve added a dependency that specifies the last migration of <tt class="docutils literal"><span class="pre">app2</span></tt>:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Migration</span><span class="p">(</span><span class="n">migrations</span><span class="o">.</span><span class="n">Migration</span><span class="p">):</span>

    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">'app1'</span><span class="p">,</span> <span class="s">'0001_initial'</span><span class="p">),</span>
        <span class="c"># added dependency to enable using models from app2 in move_m1</span>
        <span class="p">(</span><span class="s">'app2'</span><span class="p">,</span> <span class="s">'0004_foobar'</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">migrations</span><span class="o">.</span><span class="n">RunPython</span><span class="p">(</span><span class="n">move_m1</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="s-more-advanced-migrations">
<span id="more-advanced-migrations"></span><h3><font id="208">更多高级迁移</font><a class="headerlink" href="migrations.html#more-advanced-migrations" title="Permalink to this headline">¶</a></h3>
<p><font id="124">If you’re interested in the more advanced migration operations, or want to be able to write your own, see the <a class="reference internal" href="../ref/migration-operations.html"><em>migration operations reference</em></a> and the “how-to” on <a class="reference internal" href="../howto/writing-migrations.html"><em>writing migrations</em></a>.</font></p>
</div>
</div>
<div class="section" id="s-squashing-migrations">
<span id="s-migration-squashing"></span><span id="squashing-migrations"></span><span id="migration-squashing"></span><h2><font id="196">Squashing migrations</font><a class="headerlink" href="migrations.html#squashing-migrations" title="Permalink to this headline">¶</a></h2>
<p><font id="125">You are encouraged to make migrations freely and not worry about how many you have; </font><font id="126">the migration code is optimized to deal with hundreds at a time without much slowdown. </font><font id="127">However, eventually you will want to move back from having several hundred migrations to just a few, and that’s where squashing comes in.</font></p>
<p><font id="128">Squashing is the act of reducing an existing set of many migrations down to one (or sometimes a few) migrations which still represent the same changes.</font></p>
<p><font id="129">Django does this by taking all of your existing migrations, extracting their <tt class="docutils literal"><span class="pre">Operation</span></tt>s and putting them all in sequence, and then running an optimizer over them to try and reduce the length of the list - for example, it knows that <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.CreateModel" title="django.db.migrations.operations.CreateModel"><tt class="xref py py-class docutils literal"><span class="pre">CreateModel</span></tt></a> and <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.DeleteModel" title="django.db.migrations.operations.DeleteModel"><tt class="xref py py-class docutils literal"><span class="pre">DeleteModel</span></tt></a> cancel each other out, and it knows that <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.AddField" title="django.db.migrations.operations.AddField"><tt class="xref py py-class docutils literal"><span class="pre">AddField</span></tt></a> can be rolled into <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.CreateModel" title="django.db.migrations.operations.CreateModel"><tt class="xref py py-class docutils literal"><span class="pre">CreateModel</span></tt></a>.</font></p>
<p><font id="130">Once the operation sequence has been reduced as much as possible - the amount possible depends on how closely intertwined your models are and if you have any <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunSQL" title="django.db.migrations.operations.RunSQL"><tt class="xref py py-class docutils literal"><span class="pre">RunSQL</span></tt></a> or <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunPython" title="django.db.migrations.operations.RunPython"><tt class="xref py py-class docutils literal"><span class="pre">RunPython</span></tt></a> operations (which can’t be optimized through) - Django will then write it back out into a new set of initial migration files.</font></p>
<p><font id="131">These files are marked to say they replace the previously-squashed migrations, so they can coexist with the old migration files, and Django will intelligently switch between them depending where you are in the history. </font><font id="132">If you’re still part-way through the set of migrations that you squashed, it will keep using them until it hits the end and then switch to the squashed history, while new installs will just use the new squashed migration and skip all the old ones.</font></p>
<p><font id="133">This enables you to squash and not mess up systems currently in production that aren’t fully up-to-date yet. </font><font id="134">The recommended process is to squash, keeping the old files, commit and release, wait until all systems are upgraded with the new release (or if you’re a third-party project, just ensure your users upgrade releases in order without skipping any), and then remove the old files, commit and do a second release.</font></p>
<p><font id="135">The command that backs all this is <a class="reference internal" href="../ref/django-admin.html#django-admin-squashmigrations"><tt class="xref std std-djadmin docutils literal"><span class="pre">squashmigrations</span></tt></a> - just pass it the app label and migration name you want to squash up to, and it’ll get to work:</font></p>
<div class="highlight-python"><div class="highlight"><pre>$ ./manage.py squashmigrations myapp 0004
Will squash the following migrations:
 - 0001_initial
 - 0002_some_change
 - 0003_another_change
 - 0004_undo_something
Do you wish to proceed? [yN] y
Optimizing...
  Optimized from 12 operations to 7 operations.
Created new squashed migration /home/andrew/Programs/DjangoTest/test/migrations/0001_squashed_0004_undo_somthing.py
  You should commit this migration but leave the old ones in place;
  the new migration will be used for new installs. Once you are sure
  all instances of the codebase have applied the migrations you squashed,
  you can delete them.
</pre></div>
</div>
<p><font id="136">Note that model interdependencies in Django can get very complex, and squashing may result in migrations that do not run; </font><font id="137">either mis-optimized (in which case you can try again with <tt class="docutils literal"><span class="pre">--no-optimize</span></tt>, though you should also report an issue), or with a <tt class="docutils literal"><span class="pre">CircularDependencyError</span></tt>, in which case you can manually resolve it.</font></p>
<p><font id="138">To manually resolve a <tt class="docutils literal"><span class="pre">CircularDependencyError</span></tt>, break out one of the ForeignKeys in the circular dependency loop into a separate migration, and move the dependency on the other app with it. </font><font id="139">If you’re unsure, see how makemigrations deals with the problem when asked to create brand new migrations from your models. </font><font id="140">In a future release of Django, squashmigrations will be updated to attempt to resolve these errors itself.</font></p>
<p><font id="141">Once you’ve squashed your migration, you should then commit it alongside the migrations it replaces and distribute this change to all running instances of your application, making sure that they run <tt class="docutils literal"><span class="pre">migrate</span></tt> to store the change in their database.</font></p>
<p><font id="142">After this has been done, you must then transition the squashed migration to a normal initial migration, by:</font></p>
<ul class="simple">
<li><font id="229">Deleting all the migration files it replaces</font></li>
<li><font id="230">Removing the <tt class="docutils literal"><span class="pre">replaces</span></tt> argument in the <tt class="docutils literal"><span class="pre">Migration</span></tt> class of the squashed migration (this is how Django tells that it is a squashed migration)</font></li>
</ul>
<div class="admonition note">
<p class="first admonition-title"><font id="143">Note</font></p>
<p class="last"><font id="144">Once you’ve squashed a migration, you should not then re-squash that squashed migration until you have fully transitioned it to a normal migration.</font></p>
</div>
</div>
<div class="section" id="s-serializing-values">
<span id="s-migration-serializing"></span><span id="serializing-values"></span><span id="migration-serializing"></span><h2><font id="197">序列化值</font><a class="headerlink" href="migrations.html#serializing-values" title="Permalink to this headline">¶</a></h2>
<p><font id="145">Migrations are just Python files containing the old definitions of your models - thus, to write them, Django must take the current state of your models and serialize them out into a file.</font></p>
<p><font id="146">While Django can serialize most things, there are some things that we just can’t serialize out into a valid Python representation - there’s no Python standard for how a value can be turned back into code (<tt class="docutils literal"><span class="pre">repr()</span></tt> only works for basic values, and doesn’t specify import paths).</font></p>
<p><font id="147">Django can serialize the following:</font></p>
<ul class="simple">
<li><font id="231"><tt class="docutils literal"><span class="pre">int</span></tt>, <tt class="docutils literal"><span class="pre">long</span></tt>, <tt class="docutils literal"><span class="pre">float</span></tt>, <tt class="docutils literal"><span class="pre">bool</span></tt>, <tt class="docutils literal"><span class="pre">str</span></tt>, <tt class="docutils literal"><span class="pre">unicode</span></tt>, <tt class="docutils literal"><span class="pre">bytes</span></tt>, <tt class="docutils literal"><span class="pre">None</span></tt></font></li>
<li><font id="232"><tt class="docutils literal"><span class="pre">list</span></tt>, <tt class="docutils literal"><span class="pre">set</span></tt>, <tt class="docutils literal"><span class="pre">tuple</span></tt>, <tt class="docutils literal"><span class="pre">dict</span></tt></font></li>
<li><font id="233"><tt class="docutils literal"><span class="pre">datetime.date</span></tt>, <tt class="docutils literal"><span class="pre">datetime.time</span></tt>, and <tt class="docutils literal"><span class="pre">datetime.datetime</span></tt> instances (include those that are timezone-aware)</font></li>
<li><font id="234"><tt class="docutils literal"><span class="pre">decimal.</span></tt></font><font id="235">Decimal instances</font></li>
<li><font id="236">Any Django field</font></li>
<li><font id="237">Any function or method reference (e.g. <tt class="docutils literal"><span class="pre">datetime.datetime.today</span></tt>) (must be in module’s top-level scope)</font></li>
<li><font id="238">Any class reference (must be in module’s top-level scope)</font></li>
<li><font id="239">Anything with a custom <tt class="docutils literal"><span class="pre">deconstruct()</span></tt> method (<a class="reference internal" href="migrations.html#custom-deconstruct-method"><em>see below</em></a>)</font></li>
</ul>
<div class="versionchanged">
<span class="title">Changed in Django 1.7.1:</span> <p><font id="148">Support for serializing timezone-aware datetimes was added.</font></p>
</div>
<p><font id="149">Django can serialize the following on Python 3 only:</font></p>
<ul class="simple">
<li><font id="240">Unbound methods used from within the class body (see below)</font></li>
</ul>
<p><font id="150">Django cannot serialize:</font></p>
<ul class="simple">
<li><font id="241">Nested classes</font></li>
<li><font id="242">Arbitrary class instances (e.g. <tt class="docutils literal"><span class="pre">MyClass(4.3,</span> <span class="pre">5.7)</span></tt>)</font></li>
<li><font id="243">Lambdas</font></li>
</ul>
<p><font id="151">Due to the fact <tt class="docutils literal"><span class="pre">__qualname__</span></tt> was only introduced in Python 3, Django can only serialize the following pattern (an unbound method used within the class body) on Python 3, and will fail to serialize a reference to it on Python 2:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">upload_to</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"something dynamic"</span>

    <span class="n">my_file</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FileField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="n">upload_to</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="152">If you are using Python 2, we recommend you move your methods for upload_to and similar arguments that accept callables (e.g. <tt class="docutils literal"><span class="pre">default</span></tt>) to live in the main module body, rather than the class body.</font></p>
<div class="section" id="s-adding-a-deconstruct-method">
<span id="s-custom-deconstruct-method"></span><span id="adding-a-deconstruct-method"></span><span id="custom-deconstruct-method"></span><h3><font id="209">Adding a deconstruct() method</font><a class="headerlink" href="migrations.html#adding-a-deconstruct-method" title="Permalink to this headline">¶</a></h3>
<p><font id="153">You can let Django serialize your own custom class instances by giving the class a <tt class="docutils literal"><span class="pre">deconstruct()</span></tt> method. </font><font id="154">It takes no arguments, and should return a tuple of three things <tt class="docutils literal"><span class="pre">(path,</span> <span class="pre">args,</span> <span class="pre">kwargs)</span></tt>:</font></p>
<ul class="simple">
<li><font id="244"><tt class="docutils literal"><span class="pre">path</span></tt> should be the Python path to the class, with the class name included as the last part (for example, <tt class="docutils literal"><span class="pre">myapp.custom_things.</span></tt></font><font id="245">MyClass). </font><font id="246">If your class is not available at the top level of a module it is not serializable.</font></li>
<li><font id="247"><tt class="docutils literal"><span class="pre">args</span></tt> should be a list of positional arguments to pass to your class’ <tt class="docutils literal"><span class="pre">__init__</span></tt> method. </font><font id="248">Everything in this list should itself be serializable.</font></li>
<li><font id="249"><tt class="docutils literal"><span class="pre">kwargs</span></tt> should be a dict of keyword arguments to pass to your class’ <tt class="docutils literal"><span class="pre">__init__</span></tt> method. </font><font id="250">Every value should itself be serializable.</font></li>
</ul>
<div class="admonition note">
<p class="first admonition-title"><font id="155">Note</font></p>
<p class="last"><font id="156">This return value is different from the <tt class="docutils literal"><span class="pre">deconstruct()</span></tt> method <a class="reference internal" href="../howto/custom-model-fields.html#custom-field-deconstruct-method"><em>for custom fields</em></a> which returns a tuple of four items.</font></p>
</div>
<p><font id="157">Django will write out the value as an instantiation of your class with the given arguments, similar to the way it writes out references to Django fields.</font></p>
<p><font id="158">To prevent a new migration from being created each time <a class="reference internal" href="../ref/django-admin.html#django-admin-makemigrations"><tt class="xref std std-djadmin docutils literal"><span class="pre">makemigrations</span></tt></a> is run, you should also add a <tt class="docutils literal"><span class="pre">__eq__()</span></tt> method to the decorated class. </font><font id="159">This function will be called by Django’s migration framework to detect changes between states.</font></p>
<p><font id="160">As long as all of the arguments to your class’ constructor are themselves serializable, you can use the <tt class="docutils literal"><span class="pre">@deconstructible</span></tt> class decorator from <tt class="docutils literal"><span class="pre">django.utils.deconstruct</span></tt> to add the <tt class="docutils literal"><span class="pre">deconstruct()</span></tt> method:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.utils.deconstruct</span> <span class="kn">import</span> <span class="n">deconstructible</span>

<span class="nd">@deconstructible</span>
<span class="k">class</span> <span class="nc">MyCustomClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="n">foo</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">foo</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">foo</span>
</pre></div>
</div>
<p><font id="161">The decorator adds logic to capture and preserve the arguments on their way into your constructor, and then returns those arguments exactly when deconstruct() is called.</font></p>
</div>
</div>
<div class="section" id="s-supporting-python-2-and-3">
<span id="supporting-python-2-and-3"></span><h2><font id="198">Python 2 和 3 支持</font><a class="headerlink" href="migrations.html#supporting-python-2-and-3" title="Permalink to this headline">¶</a></h2>
<p><font id="162">In order to generate migrations that support both Python 2 and 3, all string literals used in your models and fields (e.g. <tt class="docutils literal"><span class="pre">verbose_name</span></tt>, <tt class="docutils literal"><span class="pre">related_name</span></tt>, etc.), must be consistently either bytestrings or text (unicode) strings in both Python 2 and 3 (rather than bytes in Python 2 and text in Python 3, the default situation for unmarked string literals.) </font><font id="163">Otherwise running <a class="reference internal" href="../ref/django-admin.html#django-admin-makemigrations"><tt class="xref std std-djadmin docutils literal"><span class="pre">makemigrations</span></tt></a> under Python 3 will generate spurious new migrations to convert all these string attributes to text.</font></p>
<p><font id="164">The easiest way to achieve this is to follow the advice in Django’s <a class="reference internal" href="python3.html"><em>Python 3 porting guide</em></a> and make sure that all your modules begin with <tt class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">unicode_literals</span></tt>, so that all unmarked string literals are always unicode, regardless of Python version. </font><font id="165">When you add this to an app with existing migrations generated on Python 2, your next run of <a class="reference internal" href="../ref/django-admin.html#django-admin-makemigrations"><tt class="xref std std-djadmin docutils literal"><span class="pre">makemigrations</span></tt></a> on Python 3 will likely generate many changes as it converts all the bytestring attributes to text strings; </font><font id="166">this is normal and should only happen once.</font></p>
</div>
<div class="section" id="s-supporting-multiple-django-versions">
<span id="supporting-multiple-django-versions"></span><h2><font id="199">多Django版本支持</font><a class="headerlink" href="migrations.html#supporting-multiple-django-versions" title="Permalink to this headline">¶</a></h2>
<p><font id="167">If you are the maintainer of a third-party app with models, you may need to ship migrations that support multiple Django versions. </font><font id="168">In this case, you should always run <a class="reference internal" href="../ref/django-admin.html#django-admin-makemigrations"><tt class="xref std std-djadmin docutils literal"><span class="pre">makemigrations</span></tt></a> <strong>with the lowest Django version you wish to support</strong>.</font></p>
<p><font id="169">The migrations system will maintain backwards-compatibility according to the same policy as the rest of Django, so migration files generated on Django X.Y should run unchanged on Django X.Y+1. </font><font id="170">The migrations system does not promise forwards-compatibility, however. </font><font id="171">New features may be added, and migration files generated with newer versions of Django may not work on older versions.</font></p>
</div>
<div class="section" id="s-upgrading-from-south">
<span id="s-id4"></span><span id="upgrading-from-south"></span><span id="id4"></span><h2><font id="200">从 South 升级</font><a class="headerlink" href="migrations.html#upgrading-from-south" title="Permalink to this headline">¶</a></h2>
<p><font id="172">如果你有使用 <a class="reference external" href="http://south.aeracode.org">South</a>创建的迁移, 使用<tt class="docutils literal"><span class="pre">django.db.migrations</span></tt>升级的过程非常简单：</font></p>
<ul class="simple">
<li><font id="251">确认所有的安装都以South创建的迁移完全更新。</font></li>
<li><font id="252">从<a class="reference internal" href="../ref/settings.html#std:setting-INSTALLED_APPS"><tt class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a>中移除 <tt class="docutils literal"><span class="pre">'south'</span></tt></font></li>
<li><font id="253">删除你所有的迁移文件（编号标识的），但不能删除所在目录或 <tt class="docutils literal"><span class="pre">__init__.py</span></tt> - 也需确认删除 <tt class="docutils literal"><span class="pre">.pyc</span></tt> 文件。</font></li>
<li><font id="254">运行 <tt class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">makemigrations</span></tt>. </font><font id="255">Django should see the empty migration directories and make new initial migrations in the new format.</font></li>
<li><font id="256">Run <tt class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span> <span class="pre">--fake-initial</span></tt>. </font><font id="257">Django will see that the tables for the initial migrations already exist and mark them as applied without running them. </font><font id="258">(Django won’t check that the table schema match your models, just that the right table names exist).</font></li>
</ul>
<p><font id="173">That’s it! </font><font id="174">The only complication is if you have a circular dependency loop of foreign keys; </font><font id="175">in this case, <tt class="docutils literal"><span class="pre">makemigrations</span></tt> might make more than one initial migration, and you’ll need to mark them all as applied using:</font></p>
<div class="highlight-python"><div class="highlight"><pre>python manage.py migrate --fake yourappnamehere
</pre></div>
</div>
<div class="versionchanged">
<span class="title">Changed in Django 1.8:</span> <p><font id="176">The <a class="reference internal" href="../ref/django-admin.html#django-admin-option---fake-initial"><tt class="xref std std-djadminopt docutils literal"><span class="pre">--fake-initial</span></tt></a> flag was added to <a class="reference internal" href="../ref/django-admin.html#django-admin-migrate"><tt class="xref std std-djadmin docutils literal"><span class="pre">migrate</span></tt></a>; </font><font id="177">previously, initial migrations were always automatically fake-applied if existing tables were detected.</font></p>
</div>
<div class="section" id="s-libraries-third-party-apps">
<span id="libraries-third-party-apps"></span><h3><font id="210">库/第三方应用</font><a class="headerlink" href="migrations.html#libraries-third-party-apps" title="Permalink to this headline">¶</a></h3>
<p><font id="178">If you are a library or app maintainer, and wish to support both South migrations (for Django 1.6 and below) and Django migrations (for 1.7 and above) you should keep two parallel migration sets in your app, one in each format.</font></p>
<p><font id="179">To aid in this, South 1.0 will automatically look for South-format migrations in a <tt class="docutils literal"><span class="pre">south_migrations</span></tt> directory first, before looking in <tt class="docutils literal"><span class="pre">migrations</span></tt>, meaning that users’ projects will transparently use the correct set as long as you put your South migrations in the <tt class="docutils literal"><span class="pre">south_migrations</span></tt> directory and your Django migrations in the <tt class="docutils literal"><span class="pre">migrations</span></tt> directory.</font></p>
<p><font id="180">更多信息请参考 <a class="reference external" href="http://south.readthedocs.org/en/latest/releasenotes/1.0.html#library-migration-path">South 1.0 发布说明</a>.</font></p>
<div class="admonition seealso">
<p class="first admonition-title"><font id="181">参考</font></p>
<dl class="last docutils">
<dt><a class="reference internal" href="../ref/migration-operations.html"><em>The Migrations Operations Reference</em></a></dt>
<dd>Covers the schema operations API, special operations, and writing your
own operations.</dd>
<dt><a class="reference internal" href="../howto/writing-migrations.html"><em>The Writing Migrations “how-to”</em></a></dt>
<dd>Explains how to structure and write database migrations for different
scenarios you might encounter.</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="yui-b" id="sidebar">
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
<h3><font id="211">Table Of Contents</font></h3>
<ul>
<li><a class="reference internal" href="migrations.html#"><font id="259">迁移</font></a><ul>
<li><a class="reference internal" href="migrations.html#a-brief-history"><font id="260">简短历史</font></a></li>
<li><a class="reference internal" href="migrations.html#the-commands"><font id="261">命令集</font></a></li>
<li><a class="reference internal" href="migrations.html#backend-support"><font id="262">后台支持</font></a><ul>
<li><a class="reference internal" href="migrations.html#postgresql"><font id="263">PostgreSQL</font></a></li>
<li><a class="reference internal" href="migrations.html#mysql"><font id="264">MySQL</font></a></li>
<li><a class="reference internal" href="migrations.html#sqlite"><font id="265">SQLite</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="migrations.html#workflow"><font id="266">Workflow</font></a><ul>
<li><a class="reference internal" href="migrations.html#version-control"><font id="267">Version control</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="migrations.html#dependencies"><font id="268">Dependencies</font></a></li>
<li><a class="reference internal" href="migrations.html#migration-files"><font id="269">Migration files</font></a><ul>
<li><a class="reference internal" href="migrations.html#custom-fields"><font id="270">Custom fields</font></a></li>
<li><a class="reference internal" href="migrations.html#model-managers"><font id="271">Model managers</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="migrations.html#adding-migrations-to-apps"><font id="272">Adding migrations to apps</font></a></li>
<li><a class="reference internal" href="migrations.html#historical-models"><font id="273">Historical models</font></a></li>
<li><a class="reference internal" href="migrations.html#considerations-when-removing-model-fields"><font id="274">Considerations when removing model fields</font></a></li>
<li><a class="reference internal" href="migrations.html#data-migrations"><font id="275">Data Migrations</font></a><ul>
<li><a class="reference internal" href="migrations.html#accessing-models-from-other-apps"><font id="276">Accessing models from other apps</font></a></li>
<li><a class="reference internal" href="migrations.html#more-advanced-migrations"><font id="277">More advanced migrations</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="migrations.html#squashing-migrations"><font id="278">Squashing migrations</font></a></li>
<li><a class="reference internal" href="migrations.html#serializing-values"><font id="279">Serializing values</font></a><ul>
<li><a class="reference internal" href="migrations.html#adding-a-deconstruct-method"><font id="280">Adding a deconstruct() method</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="migrations.html#supporting-python-2-and-3"><font id="281">Supporting Python 2 and 3</font></a></li>
<li><a class="reference internal" href="migrations.html#supporting-multiple-django-versions"><font id="282">Supporting multiple Django versions</font></a></li>
<li><a class="reference internal" href="migrations.html#upgrading-from-south"><font id="283">Upgrading from South</font></a><ul>
<li><a class="reference internal" href="migrations.html#libraries-third-party-apps"><font id="284">Libraries/Third-party Apps</font></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><font id="212">Browse</font></h3>
<ul>
<li><font id="285">Prev: <a href="class-based-views/mixins.html">Using mixins with class-based views</a></font></li>
<li><font id="286">Next: <a href="files.html">Managing files</a></font></li>
</ul>
<h3><font id="213">You are here:</font></h3>
<ul>
<li>
<a href="../index.html"><font id="287">Django 1.8.2.dev20150513143415 documentation</font></a>
<ul><li><a href="index.html"><font id="288">Using Django</font></a>
<ul><li><font id="289">Migrations</font></li></ul>
</li></ul>
</li>
</ul>
<h3><font id="214">This Page</font></h3>
<ul class="this-page-menu">
<li><a href="http://python.usyiyi.cn/django/_sources/topics/migrations.txt" rel="nofollow"><font id="290">Show Source</font></a></li>
</ul>
<div id="searchbox" style="display: none">
<h3><font id="215">Quick search</font></h3>
<form action="http://python.usyiyi.cn/django/search.html" class="search" method="get">
<input name="q" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
<p class="searchtip" style="font-size: 90%"><font id="182"> Enter search terms or a module, class or function name. </font></p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>
</div>
<h3><font id="216">Last update:</font></h3>
<p class="topless"><font id="183">May 13, 2015</font></p>
</div>
</div>
<div id="ft">
<div class="nav">
    « <a href="class-based-views/mixins.html" title="Using mixins with class-based views">previous</a>
     |
    <a accesskey="U" href="index.html" title="Using Django">up</a>
   |
    <a href="files.html" title="Managing files">next</a> »</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div id="disqus_thread"></div><br>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'djangocn'; // required: replace example with your forum shortname
    var disqus_identifier = '/django/topics/migrations';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<link href="http://python.usyiyi.cn/django/_static/ms_translator.css" rel="stylesheet" type="text/css"/>
<script src="http://python.usyiyi.cn/django/_static/ms_translator.js" type="text/javascript"></script>
<script src="http://python.usyiyi.cn/django/_static/jquery-ui-1.9.2.custom.min.js" type="text/javascript"></script>
<div id="MicrosoftTranslator" style="display:none; position: absolute; z-index: 2147483647; margin: 0px; border: 2px solid rgb(210, 210, 210); padding: 0px; color: rgb(0, 0, 0); background-color: rgb(230, 230, 230); font-family: Arial,Helvetica,Sans-Serif; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: normal; direction: ltr; text-align: left; left: 274px; top: 2048.03px; min-width: 400px;">
    <div id="MSTCClose" style="float: right;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/tooltip_close.gif">
      </a>
    </div>
    
    <div id="MSTCPopDown" style="float: right;" style="display: none;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/popdown.gif">
      </a>
    </div>
    <div id="MSTCPopUP" style="float: right;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/popup.gif">
      </a>
    </div>
    
    <div id="MSTCTitle" style="margin: 4px 4px 8px; font-weight: bold;">原文
    </div>
    
    <div style="direction: ltr; text-align: left;">
      <span id="MSTCOrigion" style="display: inline-block; margin: 0px 4px 4px;"> </span>
    </div>
    
    <div id="MicrosoftTranslatorCommunity" class="MSTCltr">
      <div id="MSTCContent">
        <a id="MSTCExpandLink">
          <span id="MSTCImprove">改进翻译</span>
          <span id="MSTCSuggest">最小化</span>
          <img src="http://python.usyiyi.cn/django/_static/ctftoggledown.gif" id="MSTCToggleDown">
          <img src="http://python.usyiyi.cn/django/_static/ctftoggleup.gif" id="MSTCToggleUp">
        </a>
        <div id="MSTCRootPanel">
          <span id="MSTCLoading" style="display: none;">正在加载...</span>
          <div style="display: none;" id="MSTCTransPanelError">
            <div class="MSTCTableRow">
              <div class="MSTCTransPanelExc MSTCTableCell">
                <img style="border-width:0px;" src="http://python.usyiyi.cn/django/_static/error_exclamation.gif" id="ExclamationImage">
              </div>
              <div class="MSTCTableCell">
                <span id="MSTCTransPanelErrorMsg"></span>
              </div>
            </div>
            <div class="MSTCTableRow">
              <div class="MSTCTableCell"></div>
              <div class="MSTCTableCell MSTCFlipHoriz">
                <input type="image" style="border-width:0px;" src="http://python.usyiyi.cn/django/_static/error_OK.gif" class="MSTCErrorButtons" id="MSTCOKImgBtn" name="MSTCOKImgBtn">
              </div>
            </div>
          </div>
          
          <div id="MSTCTransPanel">
          </div>
          
          <div id="MSTCPrevNextPanel">
            <a id="MSTCPrevLink" style='border-right-width: 1px;border-right-style: solid;padding-right: 5px;'>
              <span>上一页</span>
            </a>
            <a style='color: black; border-right-width: 1px;border-right-style: solid;padding-right: 5px;'>
              <span>第</span>
              <span id="MSTCPage"></span>
              <span>页</span>
            </a>
            <a id="MSTCNextLink" style='padding-left: 5px;'>
              <span>下一页</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>
</html>