<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>模型实例参考 — Django 1.8.2 中文文档</title>
<link href="../../_static/default.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.8.2.dev20150513143415',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
<script src="../../_static/jquery.js" type="text/javascript"></script>
<script src="../../_static/underscore.js" type="text/javascript"></script>
<script src="../../_static/doctools.js" type="text/javascript"></script>
<link href="../../index.html" rel="top" title="Django 1.8.2.dev20150513143415 documentation"/>
<link href="index.html" rel="up" title="Models"/>
<link href="querysets.html" rel="next" title="QuerySet API reference"/>
<link href="options.html" rel="prev" title="Model Meta options"/>
<script src="http://python.usyiyi.cn/django/templatebuiltins.js" type="text/javascript"></script>
<script type="text/javascript">
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='http://python.usyiyi.cn/django/ref/models/&quot;&#32;+&#32;base&#32;+&#32;&quot;#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='http://python.usyiyi.cn/django/ref/models/&quot;&#32;+&#32;base&#32;+&#32;&quot;#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);
</script>
</head>
<body>
<div class="document">
<div class="yui-t6" id="custom-doc">
<div id="hd">
<h1><font id="219">Django 1.8.2 文档</font></h1>
<div id="global-nav">
<a href="../../index.html" title="Home page">Home</a>  |
        <a href="../../contents.html" title="Table of contents">Table of contents</a>  |
        <a href="../../genindex.html" title="Global index">Index</a>  |
        <a href="../../py-modindex.html" title="Module index">Modules</a>
</div>
<div class="nav">
    « <a href="options.html" title='Model &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;Meta&lt;/span&gt;&lt;/tt&gt; options'>previous</a>
     |
    <a accesskey="U" href="../index.html" title="API Reference">up</a>
   |
    <a href="querysets.html" title="QuerySet API reference">next</a> »</div>
</div>
<div id="bd">
<div id="yui-main">
<div class="yui-b">
<div class="yui-g" id="ref-models-instances">
<div class="section" id="s-model-instance-reference">
<span id="model-instance-reference"></span><h1><font id="220">模型实例参考</font><a class="headerlink" href="instances.html#model-instance-reference" title="Permalink to this headline">¶</a></h1>
<p><font id="1">该文档详细描述<tt class="docutils literal"><span class="pre">模型</span></tt> 的API。</font><font id="2">它建立在<a class="reference internal" href="../../topics/db/models.html"><em>模型</em></a> 和<a class="reference internal" href="../../topics/db/queries.html"><em>执行查询</em></a> 的资料之上， 所以在阅读这篇文档之前，你可能会想要先阅读并理解那两篇文档。</font></p>
<p><font id="3">我们将用<a class="reference internal" href="../../topics/db/queries.html"><em>执行查询</em></a>中所展现的&nbsp;<a class="reference internal" href="../../topics/db/queries.html#queryset-model-example"><em>博客应用模型</em></a> 来贯穿这篇参考文献。</font></p>
<div class="section" id="s-creating-objects">
<span id="creating-objects"></span><h2><font id="221">创建对象</font><a class="headerlink" href="instances.html#creating-objects" title="Permalink to this headline">¶</a></h2>
<p><font id="4">要创建模型的一个新实例，只需要像其它Python 类一样实例化它：</font></p>
<dl class="class">
<dt id="django.db.models.Model">
<em class="property">class </em><tt class="descname">Model</tt>(<em>**kwargs</em>)<a class="headerlink" href="instances.html#django.db.models.Model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="5">关键字参数就是在你的模型中定义的字段的名字。</font><font id="6">注意，实例化一个模型不会访问数据库；</font><font id="7">若要保存，你需要<a class="reference internal" href="instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a> 一下。</font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="8">注</font></p>
<p><font id="9">也许你会想通过重写 <tt class="docutils literal"><span class="pre">__init__</span></tt> 方法来自定义模型。</font><font id="10">无论如何，如果你这么做了，小心不要改变了调用签名——任何改变都可能阻碍模型实例被保存。</font><font id="11">尝试使用下面这些方法之一，而不是重写<tt class="docutils literal"><span class="pre">__init__</span></tt>：</font></p>
<ol class="last arabic">
<li><p class="first"><font id="12">在模型类中增加一个类方法：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="n">book</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="c"># do something with the book</span>
        <span class="k">return</span> <span class="n">book</span>

<span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">"Pride and Prejudice"</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first"><font id="13">在自定义管理器中添加一个方法（推荐）：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">BookManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">create_book</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="n">book</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="c"># do something with the book</span>
        <span class="k">return</span> <span class="n">book</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">BookManager</span><span class="p">()</span>

<span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_book</span><span class="p">(</span><span class="s">"Pride and Prejudice"</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="s-customizing-model-loading">
<span id="customizing-model-loading"></span><h3><font id="230">自定义模型加载</font><a class="headerlink" href="instances.html#customizing-model-loading" title="Permalink to this headline">¶</a></h3>
<dl class="classmethod">
<dt id="django.db.models.Model.from_db">
<em class="property">classmethod </em><tt class="descclassname">Model.</tt><tt class="descname">from_db</tt>(<em>db</em>, <em>field_names</em>, <em>values</em>)<a class="headerlink" href="instances.html#django.db.models.Model.from_db" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<div class="versionadded">
<span class="title">New in Django 1.8.</span> </div>
<p><font id="14"><tt class="docutils literal"><span class="pre">from_db()</span></tt> 方法用于自定义从数据库加载时模型实例的创建。</font></p>
<p><font id="15"><tt class="docutils literal"><span class="pre">db</span></tt> 参数包含数据库的别名，<tt class="docutils literal"><span class="pre">field_names</span></tt> 包含所有加载的字段的名称，<tt class="docutils literal"><span class="pre">values</span></tt> 包含<tt class="docutils literal"><span class="pre">field_names</span></tt> 中每个字段加载的值。</font><font id="16"><tt class="docutils literal"><span class="pre">field_names</span></tt> 与<tt class="docutils literal"><span class="pre">values</span></tt> 的顺序相同，所以可以使用<tt class="docutils literal"><span class="pre">cls(**(zip(field_names,</span> <span class="pre">values)))</span></tt> 来实例化对象。</font><font id="17">如果模型的所有字段都提供，会保证 <tt class="docutils literal"><span class="pre">values</span></tt> 的顺序与<tt class="docutils literal"><span class="pre">__init__()</span></tt> 所期望的一致。</font><font id="18">这表示此时实例可以通过<tt class="docutils literal"><span class="pre">cls(*values)</span></tt> 创建。</font><font id="19">可以通过<tt class="docutils literal"><span class="pre">cls._deferred</span></tt> 来检查是否提供所有的字段 —— 如果为 <tt class="docutils literal"><span class="pre">False</span></tt>，那么所有的字段都已经从数据库中加载。</font></p>
<p><font id="20">除了创建新模型之前，<tt class="docutils literal"><span class="pre">from_db()</span></tt> 必须设置新实例<tt class="docutils literal"><span class="pre">_state</span></tt> 属性中的<tt class="docutils literal"><span class="pre">adding</span></tt> 和 <tt class="docutils literal"><span class="pre">db</span></tt> 标志位。</font></p>
<p><font id="21">下面的示例演示如何保存从数据库中加载进来的字段原始值：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_db</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="c"># default implementation of from_db() (could be replaced</span>
    <span class="c"># with super())</span>
    <span class="k">if</span> <span class="n">cls</span><span class="o">.</span><span class="n">_deferred</span><span class="p">:</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="o">**</span><span class="nb">zip</span><span class="p">(</span><span class="n">field_names</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">)</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">adding</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db</span>
    <span class="c"># customization to store the original field values on the instance</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">_loaded_values</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">field_names</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">instance</span>

<span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c"># Check how the current values differ from ._loaded_values. For example,</span>
    <span class="c"># prevent changing the creator_id of the model. (This example doesn't</span>
    <span class="c"># support cases where 'creator_id' is deferred).</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">adding</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">creator_id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_values</span><span class="p">[</span><span class="s">'creator_id'</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">"Updating the value of creator isn't allowed"</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="22">上面的示例演示<tt class="docutils literal"><span class="pre">from_db()</span></tt> 的完整实现。</font><font id="23">当然在这里的<tt class="docutils literal"><span class="pre">from_db()</span></tt> 中完全可以只用<tt class="docutils literal"><span class="pre">super()</span></tt> 调用。&nbsp;</font></p>
</div>
</div>
<div class="section" id="s-refreshing-objects-from-database">
<span id="refreshing-objects-from-database"></span><h2><font id="222">从数据库更新对象</font><a class="headerlink" href="instances.html#refreshing-objects-from-database" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="django.db.models.Model.refresh_from_db">
<tt class="descclassname">Model.</tt><tt class="descname">refresh_from_db</tt>(<em>using=None</em>, <em>fields=None</em>, <em>**kwargs</em>)<a class="headerlink" href="instances.html#django.db.models.Model.refresh_from_db" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<div class="versionadded">
<span class="title">New in Django 1.8.</span> </div>
<p><font id="24">如果你需要从数据库重新加载模型的一个值，你可以使用 <tt class="docutils literal"><span class="pre">refresh_from_db()</span></tt> 方法。</font><font id="25">当不带参数调用这个方法时，将完成以下的动作：</font></p>
<ol class="arabic simple">
<li><font id="251">模型的所有非延迟字段都更新成数据库中的当前值。</font></li>
<li><font id="252">之前加载的关联实例，如果关联的值不再合法，将从重新加载的实例中删除。</font><font id="253">例如，如果重新加载的实例有一个外键到另外一个模型<tt class="docutils literal"><span class="pre">Author</span></tt>，那么如果 <tt class="docutils literal"><span class="pre">obj.author_id</span> <span class="pre">!=</span> <span class="pre">obj.author.id</span></tt>，<tt class="docutils literal"><span class="pre">obj.author</span></tt> 将被扔掉并在下次访问它时根据<tt class="docutils literal"><span class="pre">obj.author_id</span></tt> 的值重新加载。</font></li>
</ol>
<p><font id="26">注意，只有本模型的字段会从数据库重新加载。</font><font id="27">其它依赖数据库的值不会重新加载，例如聚合的结果。</font></p>
<p><font id="28">重新加载使用的数据库与实例加载时使用的数据库相同，如果实例不是从数据库加载的则使用默认的数据库。</font><font id="29">可以使用<tt class="docutils literal"><span class="pre">using</span></tt> 参数来强制指定重新加载的数据库。</font></p>
<p><font id="30">可以回使用<tt class="docutils literal"><span class="pre">fields</span></tt> 参数强制设置加载的字段。</font></p>
<p><font id="31">例如，要测试<tt class="docutils literal"><span class="pre">update()</span></tt> 调用是否得到预期的更新，可以编写类似下面的测试：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_update_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">'val'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c"># At this point obj.val is still 1, but the value in the database</span>
    <span class="c"># was updated to 2. The object's updated value needs to be reloaded</span>
    <span class="c"># from the database.</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="32">注意，当访问延迟的字段时，延迟字段的加载会通过这个方法加载。</font><font id="33">所以可以自定义延迟加载的行为。</font><font id="34">下面的实例演示如何在重新加载一个延迟字段时重新加载所有的实例字段：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ExampleModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">refresh_from_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># fields contains the name of the deferred field to be</span>
        <span class="c"># loaded.</span>
        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="n">deferred_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_deferred_fields</span><span class="p">()</span>
            <span class="c"># If any deferred field is going to be loaded</span>
            <span class="k">if</span> <span class="n">fields</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">deferred_fields</span><span class="p">):</span>
                <span class="c"># then load all of them</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">deferred_fields</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExampleModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">(</span><span class="n">using</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="django.db.models.Model.get_deferred_fields">
<tt class="descclassname">Model.</tt><tt class="descname">get_deferred_fields</tt>()<a class="headerlink" href="instances.html#django.db.models.Model.get_deferred_fields" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<div class="versionadded">
<span class="title">New in Django 1.8.</span> </div>
<p><font id="35">一个辅助方法，它返回一个集合，包含模型当前所有延迟字段的属性名称。</font></p>
</div>
<div class="section" id="s-validating-objects">
<span id="s-id1"></span><span id="validating-objects"></span><span id="id1"></span><h2><font id="223">验证对象</font><a class="headerlink" href="instances.html#validating-objects" title="Permalink to this headline">¶</a></h2>
<p><font id="36">验证一个模型涉及三个步骤：</font></p>
<ol class="arabic simple">
<li><font id="254">验证模型的字段 —— <a class="reference internal" href="instances.html#django.db.models.Model.clean_fields" title="django.db.models.Model.clean_fields"><tt class="xref py py-meth docutils literal"><span class="pre">Model.clean_fields()</span></tt></a></font></li>
<li><font id="255">验证模型的完整性 —— <a class="reference internal" href="instances.html#django.db.models.Model.clean" title="django.db.models.Model.clean"><tt class="xref py py-meth docutils literal"><span class="pre">Model.clean()</span></tt></a></font></li>
<li><font id="256">验证模型的唯一性 —— <a class="reference internal" href="instances.html#django.db.models.Model.validate_unique" title="django.db.models.Model.validate_unique"><tt class="xref py py-meth docutils literal"><span class="pre">Model.validate_unique()</span></tt></a></font></li>
</ol>
<p><font id="37">当你调用模型的<a class="reference internal" href="instances.html#django.db.models.Model.full_clean" title="django.db.models.Model.full_clean"><tt class="xref py py-meth docutils literal"><span class="pre">full_clean()</span></tt></a> 方法时，这三个方法都将执行。</font></p>
<p><font id="38">当你使用<a class="reference internal" href="../../topics/forms/modelforms.html#django.forms.ModelForm" title="django.forms.ModelForm"><tt class="xref py py-class docutils literal"><span class="pre">ModelForm</span></tt></a>时，<a class="reference internal" href="../forms/api.html#django.forms.Form.is_valid" title="django.forms.Form.is_valid"><tt class="xref py py-meth docutils literal"><span class="pre">is_valid()</span></tt></a> 将为表单中的所有字段执行这些验证。</font><font id="39">更多信息参见<a class="reference internal" href="../../topics/forms/modelforms.html"><em>ModelForm 文档</em></a>。 </font><font id="40">如果你计划自己处理验证出现的错误，或者你已经将需要验证的字段从<a class="reference internal" href="../../topics/forms/modelforms.html#django.forms.ModelForm" title="django.forms.ModelForm"><tt class="xref py py-class docutils literal"><span class="pre">ModelForm</span></tt></a> 中去除掉，你只需调用模型的<a class="reference internal" href="instances.html#django.db.models.Model.full_clean" title="django.db.models.Model.full_clean"><tt class="xref py py-meth docutils literal"><span class="pre">full_clean()</span></tt></a> 方法。</font></p>
<dl class="method">
<dt id="django.db.models.Model.full_clean">
<tt class="descclassname">Model.</tt><tt class="descname">full_clean</tt>(<em>exclude=None</em>, <em>validate_unique=True</em>)<a class="headerlink" href="instances.html#django.db.models.Model.full_clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="41">该方法按顺序调用<a class="reference internal" href="instances.html#django.db.models.Model.clean_fields" title="django.db.models.Model.clean_fields"><tt class="xref py py-meth docutils literal"><span class="pre">Model.clean_fields()</span></tt></a>、<a class="reference internal" href="instances.html#django.db.models.Model.clean" title="django.db.models.Model.clean"><tt class="xref py py-meth docutils literal"><span class="pre">Model.clean()</span></tt></a> 和<a class="reference internal" href="instances.html#django.db.models.Model.validate_unique" title="django.db.models.Model.validate_unique"><tt class="xref py py-meth docutils literal"><span class="pre">Model.validate_unique()</span></tt></a>（如果<tt class="docutils literal"><span class="pre">validate_unique</span></tt> 为<tt class="docutils literal"><span class="pre">True</span></tt>），并引发一个<a class="reference internal" href="../exceptions.html#django.core.exceptions.ValidationError" title="django.core.exceptions.ValidationError"><tt class="xref py py-exc docutils literal"><span class="pre">ValidationError</span></tt></a>，该异常的<tt class="docutils literal"><span class="pre">message_dict</span></tt> 属性包含三个步骤的所有错误。</font></p>
<p><font id="42">可选的<tt class="docutils literal"><span class="pre">exclude</span></tt> 参数用来提供一个可以从验证和清除中排除的字段名称的列表。</font><font id="43"><a class="reference internal" href="../../topics/forms/modelforms.html#django.forms.ModelForm" title="django.forms.ModelForm"><tt class="xref py py-class docutils literal"><span class="pre">ModelForm</span></tt></a> 使用这个参数来排除表单中没有出现的字段，使它们不需要验证，因为用户无法修正这些字段的错误。</font></p>
<p><font id="44">注意，当你调用模型的<a class="reference internal" href="instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a> 方法时，<tt class="docutils literal"><span class="pre">full_clean()</span></tt> <em>不会</em> 自动调用。</font><font id="45">如果你想一步就可以为你手工创建的模型运行验证，你需要手工调用它。</font><font id="46">例如：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ValidationError</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">article</span><span class="o">.</span><span class="n">full_clean</span><span class="p">()</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c"># Do something based on the errors contained in e.message_dict.</span>
    <span class="c"># Display them to a user, or handle them programmatically.</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p><font id="47"><tt class="docutils literal"><span class="pre">full_clean()</span></tt> 第一步执行的是验证每个字段。</font></p>
<dl class="method">
<dt id="django.db.models.Model.clean_fields">
<tt class="descclassname">Model.</tt><tt class="descname">clean_fields</tt>(<em>exclude=None</em>)<a class="headerlink" href="instances.html#django.db.models.Model.clean_fields" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="48">这个方法将验证模型的所有字段。</font><font id="49">可选的<tt class="docutils literal"><span class="pre">exclude</span></tt> 参数让你提供一个字段名称列表来从验证中排除。</font><font id="50">如果有字段验证失败，它将引发一个<a class="reference internal" href="../exceptions.html#django.core.exceptions.ValidationError" title="django.core.exceptions.ValidationError"><tt class="xref py py-exc docutils literal"><span class="pre">ValidationError</span></tt></a>。</font></p>
<p><font id="51"><tt class="docutils literal"><span class="pre">full_clean()</span></tt> 第二步执行的是调用<a class="reference internal" href="instances.html#django.db.models.Model.clean" title="django.db.models.Model.clean"><tt class="xref py py-meth docutils literal"><span class="pre">Model.clean()</span></tt></a>。</font><font id="52">如要实现模型自定义的验证，应该覆盖这个方法。</font></p>
<dl class="method">
<dt id="django.db.models.Model.clean">
<tt class="descclassname">Model.</tt><tt class="descname">clean</tt>()<a class="headerlink" href="instances.html#django.db.models.Model.clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="53">应该用这个方法来提供自定义的模型验证，以及修改模型的属性。</font><font id="54">例如，你可以使用它来给一个字段自动提供值，或者用于多个字段需要一起验证的情形：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Don't allow draft entries to have a pub_date.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s">'draft'</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s">'Draft entries may not have a publication date.'</span><span class="p">)</span>
        <span class="c"># Set the pub_date for published items if it hasn't been set already.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s">'published'</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="55">然而请注意，和<a class="reference internal" href="instances.html#django.db.models.Model.full_clean" title="django.db.models.Model.full_clean"><tt class="xref py py-meth docutils literal"><span class="pre">Model.full_clean()</span></tt></a> 类似，调用模型的<a class="reference internal" href="instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a> 方法时不会引起<tt class="docutils literal"><span class="pre">clean()</span></tt> 方法的调用。</font></p>
<p><font id="56">在上面的示例中，<tt class="docutils literal"><span class="pre">Model.clean()</span></tt> 引发的<a class="reference internal" href="../exceptions.html#django.core.exceptions.ValidationError" title="django.core.exceptions.ValidationError"><tt class="xref py py-exc docutils literal"><span class="pre">ValidationError</span></tt></a> 异常通过一个字符串实例化，所以它将被保存在一个特殊的错误字典键<a class="reference internal" href="../exceptions.html#django.core.exceptions.NON_FIELD_ERRORS" title="django.core.exceptions.NON_FIELD_ERRORS"><tt class="xref py py-data docutils literal"><span class="pre">NON_FIELD_ERRORS</span></tt></a>中。</font><font id="57">这个键用于整个模型出现的错误而不是一个特定字段出现的错误：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">NON_FIELD_ERRORS</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">article</span><span class="o">.</span><span class="n">full_clean</span><span class="p">()</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">non_field_errors</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">message_dict</span><span class="p">[</span><span class="n">NON_FIELD_ERRORS</span><span class="p">]</span>
</pre></div>
</div>
<p><font id="58">若要引发一个特定字段的异常，可以使用一个字典实例化<a class="reference internal" href="../exceptions.html#django.core.exceptions.ValidationError" title="django.core.exceptions.ValidationError"><tt class="xref py py-exc docutils literal"><span class="pre">ValidationError</span></tt></a>，其中字典的键为字段的名称。</font><font id="59">我们可以更新前面的例子，只引发<tt class="docutils literal"><span class="pre">pub_date</span></tt> 字段上的异常：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Don't allow draft entries to have a pub_date.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s">'draft'</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">({</span><span class="s">'pub_date'</span><span class="p">:</span> <span class="s">'Draft entries may not have a publication date.'</span><span class="p">})</span>
        <span class="o">...</span>
</pre></div>
</div>
<p><font id="60">最后，<tt class="docutils literal"><span class="pre">full_clean()</span></tt> 将检查模型的唯一性约束。</font></p>
<dl class="method">
<dt id="django.db.models.Model.validate_unique">
<tt class="descclassname">Model.</tt><tt class="descname">validate_unique</tt>(<em>exclude=None</em>)<a class="headerlink" href="instances.html#django.db.models.Model.validate_unique" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="61">该方法与<a class="reference internal" href="instances.html#django.db.models.Model.clean_fields" title="django.db.models.Model.clean_fields"><tt class="xref py py-meth docutils literal"><span class="pre">clean_fields()</span></tt></a> 类似，只是验证的是模型的所有唯一性约束而不是单个字段的值。</font><font id="62">可选的<tt class="docutils literal"><span class="pre">exclude</span></tt> 参数允许你提供一个字段名称的列表来从验证中排除。</font><font id="63">如果有字段验证失败，将引发一个 <a class="reference internal" href="../exceptions.html#django.core.exceptions.ValidationError" title="django.core.exceptions.ValidationError"><tt class="xref py py-exc docutils literal"><span class="pre">ValidationError</span></tt></a>。</font></p>
<p><font id="64">注意，如果你提供一个<tt class="docutils literal"><span class="pre">exclude</span></tt> 参数给<tt class="docutils literal"><span class="pre">validate_unique()</span></tt>，任何涉及到其中一个字段的<a class="reference internal" href="options.html#django.db.models.Options.unique_together" title="django.db.models.Options.unique_together"><tt class="xref py py-attr docutils literal"><span class="pre">unique_together</span></tt></a> 约束将不检查。</font></p>
</div>
<div class="section" id="s-saving-objects">
<span id="saving-objects"></span><h2><font id="224">对象保存</font><a class="headerlink" href="instances.html#saving-objects" title="Permalink to this headline">¶</a></h2>
<p><font id="65">将一个对象保存到数据库，需要调用&nbsp;<tt class="docutils literal"><span class="pre">save()</span></tt>方法：</font></p>
<dl class="method">
<dt id="django.db.models.Model.save">
<tt class="descclassname">Model.</tt><tt class="descname">save</tt>(<span class="optional">[</span><em>force_insert=False</em>, <em>force_update=False</em>, <em>using=DEFAULT_DB_ALIAS</em>, <em>update_fields=None</em><span class="optional">]</span>)<a class="headerlink" href="instances.html#django.db.models.Model.save" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="66">如果你想要自定义保存的动作，你可以重写&nbsp;<tt class="docutils literal"><span class="pre">save()</span></tt> 方法。</font><font id="67">请看 <a class="reference internal" href="../../topics/db/models.html#overriding-model-methods"><em>重写预定义的模型方法</em></a> 了解更多细节。</font></p>
<p><font id="68">模型保存过程还有一些细节的地方要注意；</font><font id="69">请看下面的章节。</font></p>
<div class="section" id="s-auto-incrementing-primary-keys">
<span id="auto-incrementing-primary-keys"></span><h3><font id="231">自增的主键</font><a class="headerlink" href="instances.html#auto-incrementing-primary-keys" title="Permalink to this headline">¶</a></h3>
<p><font id="70">如果模型具有一个<a class="reference internal" href="fields.html#django.db.models.AutoField" title="django.db.models.AutoField"><tt class="xref py py-class docutils literal"><span class="pre">AutoField</span></tt></a> —— 一个自增的主键 —— 那么该自增的值将在第一次调用对象的<tt class="docutils literal"><span class="pre">save()</span></tt> 时计算并保存：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Cheddar Talk'</span><span class="p">,</span> <span class="n">tagline</span><span class="o">=</span><span class="s">'Thoughts on cheese.'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span><span class="o">.</span><span class="n">id</span>     <span class="c"># Returns None, because b doesn't have an ID yet.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span><span class="o">.</span><span class="n">id</span>     <span class="c"># Returns the ID of your new object.</span>
</pre></div>
</div>
<p><font id="71">在调用<tt class="docutils literal"><span class="pre">save()</span></tt> 之前无法知道ID 的值，因为这个值是通过数据库而不是Django 计算。</font></p>
<p><font id="72">为了方便，默认情况下每个模型都有一个<a class="reference internal" href="fields.html#django.db.models.AutoField" title="django.db.models.AutoField"><tt class="xref py py-class docutils literal"><span class="pre">AutoField</span></tt></a> 叫做<tt class="docutils literal"><span class="pre">id</span></tt>，除非你显式指定模型某个字段的 <tt class="docutils literal"><span class="pre">primary_key=True</span></tt>。</font><font id="73">更多细节参见<a class="reference internal" href="fields.html#django.db.models.AutoField" title="django.db.models.AutoField"><tt class="xref py py-class docutils literal"><span class="pre">AutoField</span></tt></a> 的文档。</font></p>
<div class="section" id="s-the-pk-property">
<span id="the-pk-property"></span><h4><font id="248"><tt class="docutils literal"><span class="pre">pk</span></tt> 属性</font><a class="headerlink" href="instances.html#the-pk-property" title="Permalink to this headline">¶</a></h4>
<dl class="attribute">
<dt id="django.db.models.Model.pk">
<tt class="descclassname">Model.</tt><tt class="descname">pk</tt><a class="headerlink" href="instances.html#django.db.models.Model.pk" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="74">无论你是自己定义还是让Django 为你提供一个主键字段， 每个模型都将具有一个属性叫做<tt class="docutils literal"><span class="pre">pk</span></tt>。</font><font id="75">它的行为类似模型的一个普通属性，但实际上是模型主键字段属性的别名。</font><font id="76">你可以读取并设置它的值，就和其它属性一样，它会更新模型中正确的值。</font></p>
</div>
<div class="section" id="s-explicitly-specifying-auto-primary-key-values">
<span id="explicitly-specifying-auto-primary-key-values"></span><h4><font id="249">显式指定自增主键的值</font><a class="headerlink" href="instances.html#explicitly-specifying-auto-primary-key-values" title="Permalink to this headline">¶</a></h4>
<p><font id="77">如果模型具有一个<a class="reference internal" href="fields.html#django.db.models.AutoField" title="django.db.models.AutoField"><tt class="xref py py-class docutils literal"><span class="pre">AutoField</span></tt></a>，但是你想在保存时显式定义一个新的对象ID，你只需要在保存之前显式指定它而不用依赖ID 自动分配的值：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b3</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'Cheddar Talk'</span><span class="p">,</span> <span class="n">tagline</span><span class="o">=</span><span class="s">'Thoughts on cheese.'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b3</span><span class="o">.</span><span class="n">id</span>     <span class="c"># Returns 3.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b3</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b3</span><span class="o">.</span><span class="n">id</span>     <span class="c"># Returns 3.</span>
</pre></div>
</div>
<p><font id="78">如果你手工赋值一个自增主键的值，请确保不要使用一个已经存在的主键值！</font><font id="79">如果你使用数据库中已经存在的主键值创建一个新的对象，Django 将假设你正在修改这个已存在的记录而不是创建一个新的记录。</font></p>
<p><font id="80">接着上面的<tt class="docutils literal"><span class="pre">'Cheddar</span> <span class="pre">Talk'</span></tt> 博客示例，下面这个例子将覆盖数据库中之前的记录：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">b4</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'Not Cheddar'</span><span class="p">,</span> <span class="n">tagline</span><span class="o">=</span><span class="s">'Anything but cheese.'</span><span class="p">)</span>
<span class="n">b4</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c"># Overrides the previous blog with ID=3!</span>
</pre></div>
</div>
<p><font id="81">出现这种情况的原因，请参见下面的<a class="reference internal" href="instances.html#how-django-knows-to-update-vs-insert">Django 如何知道是UPDATE 还是INSERT</a>。</font></p>
<p><font id="82">显式指定自增主键的值对于批量保存对象最有用，但你必须有信心不会有主键冲突。</font></p>
</div>
</div>
<div class="section" id="s-what-happens-when-you-save">
<span id="what-happens-when-you-save"></span><h3><font id="232">当你保存时，发生了什么？</font><a class="headerlink" href="instances.html#what-happens-when-you-save" title="Permalink to this headline">¶</a></h3>
<p><font id="83">当你保存一个对象时，Django 执行以下步骤：</font></p>
<ol class="arabic">
<li><p class="first"><font id="84"><strong>发出一个pre-save 信号。</strong> </font><font id="85">发送一个<a class="reference internal" href="../signals.html#django.db.models.signals.pre_save" title="django.db.models.signals.pre_save"><tt class="xref py py-attr docutils literal"><span class="pre">django.db.models.signals.pre_save</span></tt></a> <a class="reference internal" href="../signals.html"><em>信号</em></a>，以允许监听该信号的函数完成一些自定义的动作。</font></p>
</li>
<li><p class="first"><font id="86"><strong>预处理数据。</strong> </font><font id="87">如果需要，对对象的每个字段进行自动转换。</font></p>
<p><font id="88">大部分字段<em>不</em>需要预处理 —— 字段的数据将保持原样。</font><font id="89">预处理只用于具有特殊行为的字段。</font><font id="90">例如，如果你的模型具有一个<tt class="docutils literal"><span class="pre">auto_now=True</span></tt> 的<a class="reference internal" href="fields.html#django.db.models.DateField" title="django.db.models.DateField"><tt class="xref py py-class docutils literal"><span class="pre">DateField</span></tt></a>，那么预处理阶段将修改对象中的数据以确保该日期字段包含当前的时间戳。</font><font id="91">（我们的文档还没有所有具有这种“特殊行为”字段的一个列表。）</font></p>
</li>
<li><p class="first"><font id="92"><strong>准备数据库数据。</strong> </font><font id="93">要求每个字段提供的当前值是能够写入到数据库中的类型。</font></p>
<p><font id="94">大部分字段<em>不</em>需要数据准备。</font><font id="95">简单的数据类型，例如整数和字符串，是可以直接写入的Python 对象。</font><font id="96">但是，复杂的数据类型通常需要一些改动。</font></p>
<p><font id="97">例如，<a class="reference internal" href="fields.html#django.db.models.DateField" title="django.db.models.DateField"><tt class="xref py py-class docutils literal"><span class="pre">DateField</span></tt></a> 字段使用Python 的 <tt class="docutils literal"><span class="pre">datetime</span></tt> 对象来保存数据。</font><font id="98">数据库保存的不是<tt class="docutils literal"><span class="pre">datetime</span></tt> 对象，所以该字段的值必须转换成ISO兼容的日期字符串才能插入到数据库中。</font></p>
</li>
<li><p class="first"><font id="99"><strong>插入数据到数据库中。</strong> </font><font id="100">将预处理过、准备好的数据组织成一个SQL 语句用于插入数据库。</font></p>
</li>
<li><p class="first"><font id="101"><strong>发出一个post-save 信号。</strong> </font><font id="102">发送一个<a class="reference internal" href="../signals.html#django.db.models.signals.post_save" title="django.db.models.signals.post_save"><tt class="xref py py-attr docutils literal"><span class="pre">django.db.models.signals.post_save</span></tt></a> 信号，以允许监听听信号的函数完成一些自定义的动作。</font></p>
</li>
</ol>
</div>
<div class="section" id="s-how-django-knows-to-update-vs-insert">
<span id="how-django-knows-to-update-vs-insert"></span><h3><font id="233">Django 如何知道是UPDATE 还是INSERT</font><a class="headerlink" href="instances.html#how-django-knows-to-update-vs-insert" title="Permalink to this headline">¶</a></h3>
<p><font id="103">你可能已经注意到Django 数据库对象使用同一个<tt class="docutils literal"><span class="pre">save()</span></tt> 方法来创建和改变对象。</font><font id="104">Django 对<tt class="docutils literal"><span class="pre">INSERT</span></tt> 和<tt class="docutils literal"><span class="pre">UPDATE</span></tt> SQL 语句的使用进行抽象。</font><font id="105">当你调用<tt class="docutils literal"><span class="pre">save()</span></tt> 时，Django 使用下面的算法：</font></p>
<ul class="simple">
<li><font id="257">如果对象的主键属性为一个求值为<tt class="docutils literal"><span class="pre">True</span></tt> 的值（例如，非<tt class="docutils literal"><span class="pre">None</span></tt> 值或非空字符串），Django 将执行<tt class="docutils literal"><span class="pre">UPDATE</span></tt>。</font></li>
<li><font id="258">如果对象的主键属性<em>没有</em>设置或者<tt class="docutils literal"><span class="pre">UPDATE</span></tt> 没有更新任何记录，Django 将执行<tt class="docutils literal"><span class="pre">INSERT</span></tt>。</font></li>
</ul>
<p><font id="106">现在应该明白了，当保存一个新的对象时，如果不能保证主键的值没有使用，你应该注意不要显式指定主键值。</font><font id="107">关于这个细微差别的更多信息，参见上文的<a class="reference internal" href="instances.html#explicitly-specifying-auto-primary-key-values">显示指定主键的值</a> 和下文的<a class="reference internal" href="instances.html#forcing-an-insert-or-update">强制使用INSERT 或UPDATE</a>。</font></p>
<p><font id="108">在Django 1.5 和更早的版本中，在设置主键的值时，Django 会作一个 <tt class="docutils literal"><span class="pre">SELECT</span></tt>。</font><font id="109">如果<tt class="docutils literal"><span class="pre">SELECT</span></tt> 找到一行，那么Django 执行<tt class="docutils literal"><span class="pre">UPDATE</span></tt>，否则执行<tt class="docutils literal"><span class="pre">INSERT</span></tt>。</font><font id="110">旧的算法导致<tt class="docutils literal"><span class="pre">UPDATE</span></tt> 情况下多一次查询。</font><font id="111">有极少数的情况，数据库不会报告有一行被更新，即使数据库包含该对象的主键值。</font><font id="112">有个例子是PostgreSQL 的<tt class="docutils literal"><span class="pre">ON</span> <span class="pre">UPDATE</span></tt> 触发器，它返回<tt class="docutils literal"><span class="pre">NULL</span></tt>。</font><font id="113">在这些情况下，可能要通过将<a class="reference internal" href="options.html#django.db.models.Options.select_on_save" title="django.db.models.Options.select_on_save"><tt class="xref py py-attr docutils literal"><span class="pre">select_on_save</span></tt></a> 选项设置为<tt class="docutils literal"><span class="pre">True</span></tt> 以启用旧的算法。</font></p>
<div class="section" id="s-forcing-an-insert-or-update">
<span id="s-ref-models-force-insert"></span><span id="forcing-an-insert-or-update"></span><span id="ref-models-force-insert"></span><h4><font id="250">强制使用INSERT 或UPDATE</font><a class="headerlink" href="instances.html#forcing-an-insert-or-update" title="Permalink to this headline">¶</a></h4>
<p><font id="114">在一些很少见的场景中，需要强制<a class="reference internal" href="instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a> 方法执行SQL 的 <tt class="docutils literal"><span class="pre">INSERT</span></tt> 而不能执行<tt class="docutils literal"><span class="pre">UPDATE</span></tt>。</font><font id="115">或者相反：更新一行而不是插入一个新行。</font><font id="116">在这些情况下，你可以传递<tt class="docutils literal"><span class="pre">force_insert=True</span></tt> 或 <tt class="docutils literal"><span class="pre">force_update=True</span></tt> 参数给<a class="reference internal" href="instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a> 方法。</font><font id="117">显然，两个参数都传递是错误的：你不可能同时插入<em>和</em>更新！</font></p>
<p><font id="118">你应该极少需要使用这些参数。</font><font id="119">Django 几乎始终会完成正确的事情，覆盖它将导致错误难以跟踪。</font><font id="120">这个功能只用于高级用法。</font></p>
<p><font id="121">使用<tt class="docutils literal"><span class="pre">update_fields</span></tt> 将强制使用类似<tt class="docutils literal"><span class="pre">force_update</span></tt> 的更新操作。</font></p>
</div>
</div>
<div class="section" id="s-updating-attributes-based-on-existing-fields">
<span id="s-ref-models-field-updates-using-f-expressions"></span><span id="updating-attributes-based-on-existing-fields"></span><span id="ref-models-field-updates-using-f-expressions"></span><h3><font id="234">基于已存在字段值的属性更新</font><a class="headerlink" href="instances.html#updating-attributes-based-on-existing-fields" title="Permalink to this headline">¶</a></h3>
<p><font id="122">有时候你需要在一个字段上执行简单的算法操作，例如增加或者减少当前值。</font><font id="123">实现这点的简单方法是像下面这样：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">product</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Venezuelan Beaver Cheese'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">product</span><span class="o">.</span><span class="n">number_sold</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="124">如果从数据库中读取的旧的<tt class="docutils literal"><span class="pre">number_sold</span></tt> 值为10，那么写回到数据库中的值将为11。</font></p>
<p><font id="125">通过将更新基于原始字段的值而不是显式赋予一个新值，这个过程可以<a class="reference internal" href="expressions.html#avoiding-race-conditions-using-f"><em>避免竞态条件</em></a>而且更快。</font><font id="126">Django 提供<a class="reference internal" href="expressions.html#django.db.models.F" title="django.db.models.F"><tt class="xref py py-class docutils literal"><span class="pre">F</span> <span class="pre">表达式</span></tt></a> 用于这种类型的相对更新。</font><font id="127">利用<a class="reference internal" href="expressions.html#django.db.models.F" title="django.db.models.F"><tt class="xref py py-class docutils literal"><span class="pre">F</span> <span class="pre">表达式</span></tt></a>，前面的示例可以表示成：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">F</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">product</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Venezuelan Beaver Cheese'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">product</span><span class="o">.</span><span class="n">number_sold</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="s">'number_sold'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="128">更多细节，请参见<a class="reference internal" href="expressions.html#django.db.models.F" title="django.db.models.F"><tt class="xref py py-class docutils literal"><span class="pre">F</span> <span class="pre">表达式</span></tt></a> 和它们<a class="reference internal" href="../../topics/db/queries.html#topics-db-queries-update"><em>在更新查询中的用法</em></a>。</font></p>
</div>
<div class="section" id="s-specifying-which-fields-to-save">
<span id="specifying-which-fields-to-save"></span><h3><font id="235">指定要保存的字段</font><a class="headerlink" href="instances.html#specifying-which-fields-to-save" title="Permalink to this headline">¶</a></h3>
<p><font id="129">如果传递给<tt class="docutils literal"><span class="pre">save()</span></tt> 的<tt class="docutils literal"><span class="pre">update_fields</span></tt> 关键字参数一个字段名称列表，那么将只有该列表中的字段会被更新。</font><font id="130">如果你想更新对象的一个或几个字段，这可能是你想要的。</font><font id="131">不让模型的所有字段都更新将会带来一些轻微的性能提升。</font><font id="132">例如：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">product</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">'Name changed again'</span>
<span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s">'name'</span><span class="p">])</span>
</pre></div>
</div>
<p><font id="133"><tt class="docutils literal"><span class="pre">update_fields</span></tt> 参数可以是任何包含字符串的可迭代对象。</font><font id="134">空的<tt class="docutils literal"><span class="pre">update_fields</span></tt> 可迭代对象将会忽略保存。</font><font id="135">如果为None 值，将执行所有字段上的更新。</font></p>
<p><font id="136">指定<tt class="docutils literal"><span class="pre">update_fields</span></tt> 将强制使用更新操作。</font></p>
<p><font id="137">当保存通过延迟模型加载（<a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.only" title="django.db.models.query.QuerySet.only"><tt class="xref py py-meth docutils literal"><span class="pre">only()</span></tt></a> 或<a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.defer" title="django.db.models.query.QuerySet.defer"><tt class="xref py py-meth docutils literal"><span class="pre">defer()</span></tt></a>）进行访问的模型时，只有从数据库中加载的字段才会得到更新。</font><font id="138">这种情况下，有个自动的<tt class="docutils literal"><span class="pre">update_fields</span></tt>。</font><font id="139">如果你赋值或者改变延迟字段的值，该字段将会添加到更新的字段中。</font></p>
</div>
</div>
<div class="section" id="s-deleting-objects">
<span id="deleting-objects"></span><h2><font id="225">删除对象</font><a class="headerlink" href="instances.html#deleting-objects" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="django.db.models.Model.delete">
<tt class="descclassname">Model.</tt><tt class="descname">delete</tt>(<span class="optional">[</span><em>using=DEFAULT_DB_ALIAS</em><span class="optional">]</span>)<a class="headerlink" href="instances.html#django.db.models.Model.delete" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="140">发出一个SQL <tt class="docutils literal"><span class="pre">DELETE</span></tt> 操作。</font><font id="141">它只在数据库中删除这个对象；</font><font id="142">其Python 实例仍将存在并持有各个字段的数据。</font></p>
<p><font id="143">更多细节，包括如何批量删除对象，请参见<a class="reference internal" href="../../topics/db/queries.html#topics-db-queries-delete"><em>删除对象</em></a>。</font></p>
<p><font id="144">如果你想自定义删除的行为，你可以覆盖<tt class="docutils literal"><span class="pre">delete()</span></tt> 方法。</font><font id="145">详见<a class="reference internal" href="../../topics/db/models.html#overriding-model-methods"><em>覆盖预定义的模型方法</em></a>。</font></p>
</div>
<div class="section" id="s-pickling-objects">
<span id="pickling-objects"></span><h2><font id="226">Pickling 对象</font><a class="headerlink" href="instances.html#pickling-objects" title="Permalink to this headline">¶</a></h2>
<p><font id="146">当你<a class="reference external" href="https://docs.python.org/3/library/pickle.html#module-pickle" title="(in Python v3.4)"><tt class="xref py py-mod docutils literal"><span class="pre">pickle</span></tt></a> 一个模型时，它的当前状态是pickled。</font><font id="147">当你unpickle 它时，它将包含pickle 时模型的实例，而不是数据库中的当前数据。</font></p>
<div class="admonition-you-can-t-share-pickles-between-versions admonition">
<p class="first admonition-title"><font id="148">你不可以在不同版本之间共享pickles</font></p>
<p><font id="149">模型的Pickles 只对于产生它们的Django 版本有效。</font><font id="150">如果你使用Django 版本N pickle，不能保证Django 版本N+1 可以读取这个pickle。</font><font id="151">Pickles 不应该作为长期的归档策略。</font></p>
<div class="versionadded">
<span class="title">New in Django 1.8.</span> </div>
<p class="last"><font id="152">因为pickle 兼容性的错误很难诊断例如一个悄无声息损坏的对象，当你unpickle 模型使用的Django 版本与pickle 时的不同将引发一个<tt class="docutils literal"><span class="pre">RuntimeWarning</span></tt>。</font></p>
</div>
</div>
<div class="section" id="s-other-model-instance-methods">
<span id="s-model-instance-methods"></span><span id="other-model-instance-methods"></span><span id="model-instance-methods"></span><h2><font id="227">其它的模型实例方法</font><a class="headerlink" href="instances.html#other-model-instance-methods" title="Permalink to this headline">¶</a></h2>
<p><font id="153">有几个实例方法具有特殊的目的。</font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="154">注</font></p>
<p class="last"><font id="155">在Python 3 上，因为所有的字段都原生被认为是Unicode，只需使用<tt class="docutils literal"><span class="pre">__str__()</span></tt> 方法（<tt class="docutils literal"><span class="pre">__unicode__()</span></tt> 方法被废弃）。</font><font id="156">如果你想与Python 2 兼容，你可以使用<a class="reference internal" href="http://python.usyiyi.cn/django/ref/utils.html#django.utils.encoding.python_2_unicode_compatible" title="django.utils.encoding.python_2_unicode_compatible"><tt class="xref py py-func docutils literal"><span class="pre">python_2_unicode_compatible()</span></tt></a> 装饰你的模型类。</font></p>
</div>
<div class="section" id="s-unicode">
<span id="unicode"></span><h3><font id="236">__unicode__</font><a class="headerlink" href="instances.html#unicode" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="django.db.models.Model.__unicode__">
<tt class="descclassname">Model.</tt><tt class="descname">__unicode__</tt>()<a class="headerlink" href="instances.html#django.db.models.Model.__unicode__" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="157"><tt class="docutils literal"><span class="pre">__unicode__()</span></tt> 方法在每当你对一个对象调用<tt class="docutils literal"><span class="pre">unicode()</span></tt> 时调用。</font><font id="158">Django 在许多地方都使用<tt class="docutils literal"><span class="pre">unicode(obj)</span></tt>（或者相关的函数 <a class="reference internal" href="instances.html#django.db.models.Model.__str__" title="django.db.models.Model.__str__"><tt class="xref py py-meth docutils literal"><span class="pre">str(obj)</span></tt></a>）。</font><font id="159">最明显的是在Django 的Admin 站点显示一个对象和在模板中插入对象的值的时候。</font><font id="160">所以，你应该始终让<tt class="docutils literal"><span class="pre">__unicode__()</span></tt> 方法返回模型的一个友好的、人类可读的形式。</font></p>
<p><font id="161">例如：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u'</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="162">如果你定义了模型的<tt class="docutils literal"><span class="pre">__unicode__()</span></tt> 方法且没有定义<a class="reference internal" href="instances.html#django.db.models.Model.__str__" title="django.db.models.Model.__str__"><tt class="xref py py-meth docutils literal"><span class="pre">__str__()</span></tt></a> 方法，Django 将自动提供一个 <a class="reference internal" href="instances.html#django.db.models.Model.__str__" title="django.db.models.Model.__str__"><tt class="xref py py-meth docutils literal"><span class="pre">__str__()</span></tt></a>，它调用<tt class="docutils literal"><span class="pre">__unicode__()</span></tt> 并转换结果为一个UTF-8 编码的字符串。</font><font id="163">下面是一个建议的开发实践：只定义<tt class="docutils literal"><span class="pre">__unicode__()</span></tt> 并让Django 在需要时负责字符串的转换。</font></p>
</div>
<div class="section" id="s-str">
<span id="str"></span><h3><font id="237">__str__</font><a class="headerlink" href="instances.html#str" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="django.db.models.Model.__str__">
<tt class="descclassname">Model.</tt><tt class="descname">__str__</tt>()<a class="headerlink" href="instances.html#django.db.models.Model.__str__" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="164"><tt class="docutils literal"><span class="pre">__str__()</span></tt> 方法在每当你对一个对象调用<tt class="docutils literal"><span class="pre">str()</span></tt> 时调用。</font><font id="165">在Python 3 中，Django 在许多地方使用<tt class="docutils literal"><span class="pre">str(obj)</span></tt>。 </font><font id="166">最明显的是在Django 的Admin 站点显示一个对象和在模板中插入对象的值的时候。 </font><font id="167">所以，你应该始终让<tt class="docutils literal"><span class="pre">__str__()</span></tt> 方法返回模型的一个友好的、人类可读的形式。</font></p>
<p><font id="168">例如：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">'</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="169">在Python 2 中，Django 内部对<tt class="docutils literal"><span class="pre">__str__</span></tt> 的直接使用主要在随处可见的模型的<tt class="docutils literal"><span class="pre">repr()</span></tt> 输出中（例如，调试时的输出）。</font><font id="170">如果已经有合适的<a class="reference internal" href="instances.html#django.db.models.Model.__unicode__" title="django.db.models.Model.__unicode__"><tt class="xref py py-meth docutils literal"><span class="pre">__unicode__()</span></tt></a> 方法就不需要<tt class="docutils literal"><span class="pre">__str__()</span></tt> 了。</font></p>
<p><font id="171">前面<a class="reference internal" href="instances.html#django.db.models.Model.__unicode__" title="django.db.models.Model.__unicode__"><tt class="xref py py-meth docutils literal"><span class="pre">__unicode__()</span></tt></a> 的示例可以使用<tt class="docutils literal"><span class="pre">__str__()</span></tt> 这样类似地编写：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils.encoding</span> <span class="kn">import</span> <span class="n">force_bytes</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Note use of django.utils.encoding.force_bytes() here because</span>
        <span class="c"># first_name and last_name will be unicode strings.</span>
        <span class="k">return</span> <span class="n">force_bytes</span><span class="p">(</span><span class="s">'</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="s-eq">
<span id="eq"></span><h3><font id="238">__eq__</font><a class="headerlink" href="instances.html#eq" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="django.db.models.Model.__eq__">
<tt class="descclassname">Model.</tt><tt class="descname">__eq__</tt>()<a class="headerlink" href="instances.html#django.db.models.Model.__eq__" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="172">定义这个方法是为了让具有相同主键的相同实类的实例是相等的。</font><font id="173">对于代理模型，实类是模型第一个非代理父类；</font><font id="174">对于其它模型，它的实类就是模型类自己。</font></p>
<p><font id="175">例如：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyProxyModel</span><span class="p">(</span><span class="n">MyModel</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">class</span> <span class="nc">MultitableInherited</span><span class="p">(</span><span class="n">MyModel</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">MyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">MyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">MyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">MyProxyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">MyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">MultitableInherited</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">MyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">MyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionchanged">
<span class="title">Changed in Django 1.7:</span> <p><font id="176">在之前的版本中，只有类和主键都完全相同的实例才是相等的。</font></p>
</div>
</div>
<div class="section" id="s-hash">
<span id="hash"></span><h3><font id="239">__hash__</font><a class="headerlink" href="instances.html#hash" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="django.db.models.Model.__hash__">
<tt class="descclassname">Model.</tt><tt class="descname">__hash__</tt>()<a class="headerlink" href="instances.html#django.db.models.Model.__hash__" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="177"><tt class="docutils literal"><span class="pre">__hash__</span></tt> 方法基于实例主键的值。</font><font id="178">它等同于hash(obj.pk)。</font><font id="179">如果实例的主键还没有值，将引发一个<tt class="docutils literal"><span class="pre">TypeError</span></tt>（否则，<tt class="docutils literal"><span class="pre">__hash__</span></tt> 方法在实例保存的前后将返回不同的值，而改变一个实例的<tt class="docutils literal"><span class="pre">__hash__</span></tt> 值<a class="reference external" href="https://docs.python.org/reference/datamodel.html#object.__hash__">在Python 中是禁止的</a>）。</font></p>
<div class="versionchanged">
<span class="title">Changed in Django 1.7:</span> <p><font id="180">在之前的版本中，主键没有值的实例是可以哈希的。</font></p>
</div>
</div>
<div class="section" id="s-get-absolute-url">
<span id="get-absolute-url"></span><h3><font id="240">get_absolute_url</font><a class="headerlink" href="instances.html#get-absolute-url" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="django.db.models.Model.get_absolute_url">
<tt class="descclassname">Model.</tt><tt class="descname">get_absolute_url</tt>()<a class="headerlink" href="instances.html#django.db.models.Model.get_absolute_url" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="181"><tt class="docutils literal"><span class="pre">get_absolute_url()</span></tt> 方法告诉Django 如何计算对象的标准URL。</font><font id="182">对于调用者，该方法返回的字符串应该可以通过HTTP 引用到这个对象。</font></p>
<p><font id="183">例如：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">"/people/</span><span class="si">%i</span><span class="s">/"</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</div>
<p><font id="184">（虽然这段代码正确又简单，这并不是编写这个方法可移植性最好的方式。</font><font id="185">通常使用<a class="reference internal" href="../urlresolvers.html#django.core.urlresolvers.reverse" title="django.core.urlresolvers.reverse"><tt class="xref py py-func docutils literal"><span class="pre">reverse()</span></tt></a> 函数是最好的方式。）</font></p>
<p><font id="186">例如：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
    <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'people.views.details'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>
</pre></div>
</div>
<p><font id="187">Django 使用<tt class="docutils literal"><span class="pre">get_absolute_url()</span></tt> 的一个地方是在Admin 应用中。</font><font id="188">如果对象定义该方法，对象编辑页面将具有一个“View on site”链接，可以将你直接导入由<tt class="docutils literal"><span class="pre">get_absolute_url()</span></tt> 提供的对象公开视图。</font></p>
<p><font id="189">类似地，Django 的另外一些小功能，例如<a class="reference internal" href="../contrib/syndication.html"><em>syndication feed 框架</em></a> 也使用<tt class="docutils literal"><span class="pre">get_absolute_url()</span></tt>。 </font><font id="190">如果模型的每个实例都具有一个唯一的URL 是合理的，你应该定义<tt class="docutils literal"><span class="pre">get_absolute_url()</span></tt>。</font></p>
<div class="admonition warning">
<p class="first admonition-title"><font id="191">警告</font></p>
<p><font id="192">你应该避免从没有验证过的用户输入构建URL，以减少有害的链接和重定向：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">'/</span><span class="si">%s</span><span class="s">/'</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p class="last"><font id="193">如果<tt class="docutils literal"><span class="pre">self.name</span></tt> 为<tt class="docutils literal"><span class="pre">'/example.com'</span></tt>，将返回 <tt class="docutils literal"><span class="pre">'//example.com/'</span></tt>， 而它是一个合法的相对URL而不是期望的<tt class="docutils literal"><span class="pre">'/%2Fexample.com/'</span></tt>。</font></p>
</div>
<p><font id="194">在模板中使用<tt class="docutils literal"><span class="pre">get_absolute_url()</span></tt> 而不是硬编码对象的URL 是很好的实践。</font><font id="195">例如，下面的模板代码很糟糕：</font></p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="c">&lt;!-- BAD template code. Avoid! --&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/people/</span><span class="cp">{{</span> <span class="nv">object.id</span> <span class="cp">}}</span><span class="s">/"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">object.name</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>
<p><font id="196">下面的模板代码要好多了：</font></p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">object.get_absolute_url</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">object.name</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>
<p><font id="197">如果你改变了对象的URL 结构，即使是一些简单的拼写错误，你不需要检查每个可能创建该URL 的地方。</font><font id="198">在<tt class="docutils literal"><span class="pre">get_absolute_url()</span></tt> 中定义一次，然后在其它代码调用它。</font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="199">注</font></p>
<p><font id="200"><tt class="docutils literal"><span class="pre">get_absolute_url()</span></tt> 返回的字符串<strong>必须</strong>只包含ASCII 字符（URI 规范<span class="target" id="index-0"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc2396.html"><strong>RFC 2396</strong></a> 的要求），并且如需要必须要URL-encoded。</font></p>
<p class="last"><font id="201">&nbsp;代码和模板中对<tt class="docutils literal"><span class="pre">get_absolute_url()</span></tt> 的调用应该可以直接使用而不用做进一步处理。</font><font id="202">你可能想使用<tt class="docutils literal"><span class="pre">django.utils.encoding.iri_to_uri()</span></tt> 函数来帮助你解决这个问题，如果你正在使用ASCII 范围之外的Unicode 字符串。</font></p>
</div>
</div>
</div>
<div class="section" id="s-extra-instance-methods">
<span id="extra-instance-methods"></span><h2><font id="228">额外的实例方法</font><a class="headerlink" href="instances.html#extra-instance-methods" title="Permalink to this headline">¶</a></h2>
<p><font id="203">除了<a class="reference internal" href="instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a>、<a class="reference internal" href="instances.html#django.db.models.Model.delete" title="django.db.models.Model.delete"><tt class="xref py py-meth docutils literal"><span class="pre">delete()</span></tt></a>之外，模型的对象还可能具有以下一些方法：</font></p>
<dl class="method">
<dt id="django.db.models.Model.get_FOO_display">
<tt class="descclassname">Model.</tt><tt class="descname">get_FOO_display</tt>()<a class="headerlink" href="instances.html#django.db.models.Model.get_FOO_display" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="204">对于每个具有<a class="reference internal" href="fields.html#django.db.models.Field.choices" title="django.db.models.Field.choices"><tt class="xref py py-attr docutils literal"><span class="pre">choices</span></tt></a> 的字段，每个对象将具有一个<tt class="docutils literal"><span class="pre">get_FOO_display()</span></tt> 方法，其中<tt class="docutils literal"><span class="pre">FOO</span></tt> 为该字段的名称。</font><font id="205">这个方法返回该字段对“人类可读”的值。</font></p>
<p><font id="206">例如：</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">SHIRT_SIZES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s">'S'</span><span class="p">,</span> <span class="s">'Small'</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'M'</span><span class="p">,</span> <span class="s">'Medium'</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'L'</span><span class="p">,</span> <span class="s">'Large'</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">shirt_size</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">SHIRT_SIZES</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"Fred Flintstone"</span><span class="p">,</span> <span class="n">shirt_size</span><span class="o">=</span><span class="s">"L"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">shirt_size</span>
<span class="go">'L'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">get_shirt_size_display</span><span class="p">()</span>
<span class="go">'Large'</span>
</pre></div>
</div>
<dl class="method">
<dt id="django.db.models.Model.get_next_by_FOO">
<tt class="descclassname">Model.</tt><tt class="descname">get_next_by_FOO</tt>(<em>**kwargs</em>)<a class="headerlink" href="instances.html#django.db.models.Model.get_next_by_FOO" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="method">
<dt id="django.db.models.Model.get_previous_by_FOO">
<tt class="descclassname">Model.</tt><tt class="descname">get_previous_by_FOO</tt>(<em>**kwargs</em>)<a class="headerlink" href="instances.html#django.db.models.Model.get_previous_by_FOO" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="207">如果<a class="reference internal" href="fields.html#django.db.models.DateField" title="django.db.models.DateField"><tt class="xref py py-class docutils literal"><span class="pre">DateField</span></tt></a> 和<a class="reference internal" href="fields.html#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><tt class="xref py py-class docutils literal"><span class="pre">DateTimeField</span></tt></a>没有设置 <a class="reference internal" href="fields.html#django.db.models.Field.null" title="django.db.models.Field.null"><tt class="xref py py-attr docutils literal"><span class="pre">null=True</span></tt></a>，那么该对象将具有<tt class="docutils literal"><span class="pre">get_next_by_FOO()</span></tt> 和<tt class="docutils literal"><span class="pre">get_previous_by_FOO()</span></tt> 方法，其中<tt class="docutils literal"><span class="pre">FOO</span></tt> 为字段的名称。</font><font id="208">它根据日期字段返回下一个和上一个对象，并适时引发一个<a class="reference internal" href="instances.html#django.db.models.Model.DoesNotExist" title="django.db.models.Model.DoesNotExist"><tt class="xref py py-exc docutils literal"><span class="pre">DoesNotExist</span></tt></a>。</font></p>
<p><font id="209">这两个方法都将使用模型默认的管理器来执行查询。</font><font id="210">如果你需要使用自定义的管理器或者你需要自定义的筛选，这个两个方法还接受可选的参数，它们应该用<a class="reference internal" href="querysets.html#field-lookups"><em>字段查询</em></a> 中提到的格式。</font></p>
<p><font id="211">注意，对于完全相同的日期，这些方法还将利用主键来进行查找。</font><font id="212">这保证不会有记录遗漏或重复。</font><font id="213">这还意味着你不可以在未保存的对象上使用这些方法。</font></p>
</div>
<div class="section" id="s-other-attributes">
<span id="other-attributes"></span><h2><font id="229">其它属性</font><a class="headerlink" href="instances.html#other-attributes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="s-doesnotexist">
<span id="doesnotexist"></span><h3><font id="241">DoesNotExist</font><a class="headerlink" href="instances.html#doesnotexist" title="Permalink to this headline">¶</a></h3>
<dl class="exception">
<dt id="django.db.models.Model.DoesNotExist">
<em class="property">exception </em><tt class="descclassname">Model.</tt><tt class="descname">DoesNotExist</tt><a class="headerlink" href="instances.html#django.db.models.Model.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="214">ORM 在好几个地方会引发这个异常，例如<a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.get" title="django.db.models.query.QuerySet.get"><tt class="xref py py-meth docutils literal"><span class="pre">QuerySet.get()</span></tt></a> 根据给定的查询参数找不到对象时。</font></p>
<p><font id="215">Django 为每个类提供一个<tt class="docutils literal"><span class="pre">DoesNotExist</span></tt> 异常属性是为了区别找不到的对象所属的类，并让你可以利用<tt class="docutils literal"><span class="pre">try/except</span></tt>捕获一个特定模型的类。</font><font id="216">这个异常是<a class="reference internal" href="../exceptions.html#django.core.exceptions.ObjectDoesNotExist" title="django.core.exceptions.ObjectDoesNotExist"><tt class="xref py py-exc docutils literal"><span class="pre">django.core.exceptions.ObjectDoesNotExist</span></tt></a> 的子类。</font></p>
</dd></dl>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="yui-b" id="sidebar">
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
<h3><font id="242">目录</font></h3>
<ul>
<li><a class="reference internal" href="instances.html#"><font id="259">模型实例参考</font></a><ul>
<li><a class="reference internal" href="instances.html#creating-objects"><font id="260">创建对象</font></a><ul>
<li><a class="reference internal" href="instances.html#customizing-model-loading"><font id="261">自定义模型加载</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="instances.html#refreshing-objects-from-database"><font id="262">从数据库中更新对象</font></a></li>
<li><a class="reference internal" href="instances.html#validating-objects"><font id="263">验证对象</font></a></li>
<li><a class="reference internal" href="instances.html#saving-objects"><font id="264">保存对象</font></a><ul>
<li><a class="reference internal" href="instances.html#auto-incrementing-primary-keys"><font id="265">自增的主键</font></a><ul>
<li><a class="reference internal" href="instances.html#the-pk-property"><font id="266"><tt class="docutils literal"><span class="pre">pk</span></tt> 属性</font></a></li>
<li><a class="reference internal" href="instances.html#explicitly-specifying-auto-primary-key-values"><font id="267">显式指定自增主键的值</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="instances.html#what-happens-when-you-save"><font id="268">保存时发生了什么？</font></a></li>
<li><a class="reference internal" href="instances.html#how-django-knows-to-update-vs-insert"><font id="269">Django 如何知道UPDATE 还是INSERT</font></a><ul>
<li><a class="reference internal" href="instances.html#forcing-an-insert-or-update"><font id="270">强制使用INSERT 或UPDATE</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="instances.html#updating-attributes-based-on-existing-fields"><font id="271">基于已存在的字段值更新属性</font></a></li>
<li><a class="reference internal" href="instances.html#specifying-which-fields-to-save"><font id="272">指定保存的字段</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="instances.html#deleting-objects"><font id="273">删除对象</font></a></li>
<li><a class="reference internal" href="instances.html#pickling-objects"><font id="274">Pickling 对象</font></a></li>
<li><a class="reference internal" href="instances.html#other-model-instance-methods"><font id="275">其它的模型实例方法</font></a><ul>
<li><a class="reference internal" href="instances.html#unicode"><font id="276">__unicode__</font></a></li>
<li><a class="reference internal" href="instances.html#str"><font id="277">__str__</font></a></li>
<li><a class="reference internal" href="instances.html#eq"><font id="278">__eq__</font></a></li>
<li><a class="reference internal" href="instances.html#hash"><font id="279">__hash__</font></a></li>
<li><a class="reference internal" href="instances.html#get-absolute-url"><font id="280">get_absolute_url</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="instances.html#extra-instance-methods"><font id="281">额外的实例方法</font></a></li>
<li><a class="reference internal" href="instances.html#other-attributes"><font id="282">其它属性</font></a><ul>
<li><a class="reference internal" href="instances.html#doesnotexist"><font id="283">DoesNotExist</font></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><font id="243">浏览</font></h3>
<ul>
<li><font id="284">上一页：<a href="options.html">模型的<tt class="docutils literal"><span class="pre">元</span></tt>选项</a></font></li>
<li><font id="285">下一页：<a href="querysets.html">查询集API 参考</a></font></li>
</ul>
<h3><font id="244">你在这里：</font></h3>
<ul>
<li>
<a href="../../index.html"><font id="286">Django 1.8.2 文档</font></a>
<ul><li><a href="../index.html"><font id="287">API 参考</font></a>
<ul><li><a href="index.html"><font id="288">模型</font></a>
<ul><li><font id="289">模型实例参考</font></li></ul>
</li></ul></li></ul>
</li>
</ul>
<h3><font id="245">本页</font></h3>
<ul class="this-page-menu">
<li><a href="http://python.usyiyi.cn/django/_sources/ref/models/instances.txt" rel="nofollow"><font id="290">Show Source</font></a></li>
</ul>
<div id="searchbox" style="display: none">
<h3><font id="246">Quick search</font></h3>
<form action="http://python.usyiyi.cn/django/search.html" class="search" method="get">
<input name="q" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
<p class="searchtip" style="font-size: 90%"><font id="217"> Enter search terms or a module, class or function name. </font></p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>
</div>
<h3><font id="247">最后更新：</font></h3>
<p class="topless"><font id="218">May 13, 2015</font></p>
</div>
</div>
<div id="ft">
<div class="nav">
    « <a href="options.html" title='Model &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;Meta&lt;/span&gt;&lt;/tt&gt; options'>previous</a>
     |
    <a accesskey="U" href="../index.html" title="API Reference">up</a>
   |
    <a href="querysets.html" title="QuerySet API reference">next</a> »</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div id="disqus_thread"></div><br>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'djangocn'; // required: replace example with your forum shortname
    var disqus_identifier = '/django/ref/models/instances';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<link href="http://python.usyiyi.cn/django/_static/ms_translator.css" rel="stylesheet" type="text/css"/>
<script src="http://python.usyiyi.cn/django/_static/ms_translator.js" type="text/javascript"></script>
<script src="http://python.usyiyi.cn/django/_static/jquery-ui-1.9.2.custom.min.js" type="text/javascript"></script>
<div id="MicrosoftTranslator" style="display:none; position: absolute; z-index: 2147483647; margin: 0px; border: 2px solid rgb(210, 210, 210); padding: 0px; color: rgb(0, 0, 0); background-color: rgb(230, 230, 230); font-family: Arial,Helvetica,Sans-Serif; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: normal; direction: ltr; text-align: left; left: 274px; top: 2048.03px; min-width: 400px;">
    <div id="MSTCClose" style="float: right;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/tooltip_close.gif">
      </a>
    </div>
    
    <div id="MSTCPopDown" style="float: right;" style="display: none;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/popdown.gif">
      </a>
    </div>
    <div id="MSTCPopUP" style="float: right;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/popup.gif">
      </a>
    </div>
    
    <div id="MSTCTitle" style="margin: 4px 4px 8px; font-weight: bold;">原文
    </div>
    
    <div style="direction: ltr; text-align: left;">
      <span id="MSTCOrigion" style="display: inline-block; margin: 0px 4px 4px;"> </span>
    </div>
    
    <div id="MicrosoftTranslatorCommunity" class="MSTCltr">
      <div id="MSTCContent">
        <a id="MSTCExpandLink">
          <span id="MSTCImprove">改进翻译</span>
          <span id="MSTCSuggest">最小化</span>
          <img src="http://python.usyiyi.cn/django/_static/ctftoggledown.gif" id="MSTCToggleDown">
          <img src="http://python.usyiyi.cn/django/_static/ctftoggleup.gif" id="MSTCToggleUp">
        </a>
        <div id="MSTCRootPanel">
          <span id="MSTCLoading" style="display: none;">正在加载...</span>
          <div style="display: none;" id="MSTCTransPanelError">
            <div class="MSTCTableRow">
              <div class="MSTCTransPanelExc MSTCTableCell">
                <img style="border-width:0px;" src="http://python.usyiyi.cn/django/_static/error_exclamation.gif" id="ExclamationImage">
              </div>
              <div class="MSTCTableCell">
                <span id="MSTCTransPanelErrorMsg"></span>
              </div>
            </div>
            <div class="MSTCTableRow">
              <div class="MSTCTableCell"></div>
              <div class="MSTCTableCell MSTCFlipHoriz">
                <input type="image" style="border-width:0px;" src="http://python.usyiyi.cn/django/_static/error_OK.gif" class="MSTCErrorButtons" id="MSTCOKImgBtn" name="MSTCOKImgBtn">
              </div>
            </div>
          </div>
          
          <div id="MSTCTransPanel">
          </div>
          
          <div id="MSTCPrevNextPanel">
            <a id="MSTCPrevLink" style='border-right-width: 1px;border-right-style: solid;padding-right: 5px;'>
              <span>上一页</span>
            </a>
            <a style='color: black; border-right-width: 1px;border-right-style: solid;padding-right: 5px;'>
              <span>第</span>
              <span id="MSTCPage"></span>
              <span>页</span>
            </a>
            <a id="MSTCNextLink" style='padding-left: 5px;'>
              <span>下一页</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>
</html>