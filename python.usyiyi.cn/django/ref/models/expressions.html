<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Query Expressions — Django 1.8.2 中文文档</title>
<link href="../../_static/default.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.8.2.dev20150513143415',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
<script src="../../_static/jquery.js" type="text/javascript"></script>
<script src="../../_static/underscore.js" type="text/javascript"></script>
<script src="../../_static/doctools.js" type="text/javascript"></script>
<link href="../../index.html" rel="top" title="Django 1.8.2.dev20150513143415 documentation"/>
<link href="index.html" rel="up" title="Models"/>
<link href="conditional-expressions.html" rel="next" title="Conditional Expressions"/>
<link href="lookups.html" rel="prev" title="Lookup API reference"/>
<script src="http://python.usyiyi.cn/django/templatebuiltins.js" type="text/javascript"></script>
<script type="text/javascript">
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='http://python.usyiyi.cn/django/ref/models/&quot;&#32;+&#32;base&#32;+&#32;&quot;#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='http://python.usyiyi.cn/django/ref/models/&quot;&#32;+&#32;base&#32;+&#32;&quot;#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);
</script>
</head>
<body>
<div class="document">
<div class="yui-t6" id="custom-doc">
<div id="hd">
<h1><font id="147">Django 1.8.2.dev20150513143415 documentation</font></h1>
<div id="global-nav">
<a href="../../index.html" title="Home page">Home</a>  |
        <a href="../../contents.html" title="Table of contents">Table of contents</a>  |
        <a href="../../genindex.html" title="Global index">Index</a>  |
        <a href="../../py-modindex.html" title="Module index">Modules</a>
</div>
<div class="nav">
    « <a href="lookups.html" title="Lookup API reference">previous</a>
     |
    <a accesskey="U" href="../index.html" title="API Reference">up</a>
   |
    <a href="conditional-expressions.html" title="Conditional Expressions">next</a> »</div>
</div>
<div id="bd">
<div id="yui-main">
<div class="yui-b">
<div class="yui-g" id="ref-models-expressions">
<div class="section" id="s-query-expressions">
<span id="query-expressions"></span><h1><font id="148">Query Expressions</font><a class="headerlink" href="expressions.html#query-expressions" title="Permalink to this headline">¶</a></h1>
<p><font id="1">Query expressions describe a value or a computation that can be used as part of a filter, order by, annotation, or aggregate. </font><font id="2">There are a number of built-in expressions (documented below) that can be used to help you write queries. </font><font id="3">Expressions can be combined, or in some cases nested, to form more complex computations.</font></p>
<div class="section" id="s-supported-arithmetic">
<span id="supported-arithmetic"></span><h2><font id="149">Supported arithmetic</font><a class="headerlink" href="expressions.html#supported-arithmetic" title="Permalink to this headline">¶</a></h2>
<p><font id="4">Django supports addition, subtraction, multiplication, division, modulo arithmetic, and the power operator on query expressions, using Python constants, variables, and even other expressions.</font></p>
<div class="versionadded">
<span class="title">New in Django 1.7:</span> <p><font id="5">Support for the power operator <tt class="docutils literal"><span class="pre">**</span></tt> was added.</font></p>
</div>
</div>
<div class="section" id="s-some-examples">
<span id="some-examples"></span><h2><font id="150">Some examples</font><a class="headerlink" href="expressions.html#some-examples" title="Permalink to this headline">¶</a></h2>
<div class="versionchanged">
<span class="title">Changed in Django 1.8:</span> <p><font id="6">Some of the examples rely on functionality that is new in Django 1.8.</font></p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">F</span><span class="p">,</span> <span class="n">Count</span>
<span class="kn">from</span> <span class="nn">django.db.models.functions</span> <span class="kn">import</span> <span class="n">Length</span>

<span class="c"># Find companies that have more employees than chairs.</span>
<span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">num_employees__gt</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">'num_chairs'</span><span class="p">))</span>

<span class="c"># Find companies that have at least twice as many employees</span>
<span class="c"># as chairs. Both the querysets below are equivalent.</span>
<span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">num_employees__gt</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">'num_chairs'</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
    <span class="n">num_employees__gt</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">'num_chairs'</span><span class="p">)</span> <span class="o">+</span> <span class="n">F</span><span class="p">(</span><span class="s">'num_chairs'</span><span class="p">))</span>

<span class="c"># How many chairs are needed for each company to seat all employees?</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">company</span> <span class="o">=</span> <span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
<span class="o">...</span>    <span class="n">num_employees__gt</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">'num_chairs'</span><span class="p">))</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
<span class="o">...</span>    <span class="n">chairs_needed</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">'num_employees'</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="p">(</span><span class="s">'num_chairs'</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">company</span><span class="o">.</span><span class="n">num_employees</span>
<span class="mi">120</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">company</span><span class="o">.</span><span class="n">num_chairs</span>
<span class="mi">50</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">company</span><span class="o">.</span><span class="n">chairs_needed</span>
<span class="mi">70</span>

<span class="c"># Annotate models with an aggregated value. Both forms</span>
<span class="c"># below are equivalent.</span>
<span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">num_products</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">'products'</span><span class="p">))</span>
<span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">num_products</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">'products'</span><span class="p">)))</span>

<span class="c"># Aggregates can contain complex computations also</span>
<span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">num_offerings</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">'products'</span><span class="p">)</span> <span class="o">+</span> <span class="n">F</span><span class="p">(</span><span class="s">'services'</span><span class="p">)))</span>

<span class="c"># Expressions can also be used in order_by()</span>
<span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Length</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span><span class="o">.</span><span class="n">asc</span><span class="p">())</span>
<span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Length</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="s-built-in-expressions">
<span id="built-in-expressions"></span><h2><font id="151">Built-in Expressions</font><a class="headerlink" href="expressions.html#built-in-expressions" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title"><font id="7">Note</font></p>
<p class="last"><font id="8">These expressions are defined in <tt class="docutils literal"><span class="pre">django.db.models.expressions</span></tt> and <tt class="docutils literal"><span class="pre">django.db.models.aggregates</span></tt>, but for convenience they’re available and usually imported from <a class="reference internal" href="../../topics/db/models.html#module-django.db.models" title="django.db.models"><tt class="xref py py-mod docutils literal"><span class="pre">django.db.models</span></tt></a>.</font></p>
</div>
<div class="section" id="s-f-expressions">
<span id="f-expressions"></span><h3><font id="153"><tt class="docutils literal"><span class="pre">F()</span></tt> expressions</font><a class="headerlink" href="expressions.html#f-expressions" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="django.db.models.F">
<em class="property">class </em><tt class="descname">F</tt><a class="headerlink" href="expressions.html#django.db.models.F" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="9">An <tt class="docutils literal"><span class="pre">F()</span></tt> object represents the value of a model field or annotated column. </font><font id="10">It makes it possible to refer to model field values and perform database operations using them without actually having to pull them out of the database into Python memory.</font></p>
<p><font id="11">Instead, Django uses the <tt class="docutils literal"><span class="pre">F()</span></tt> object to generate a SQL expression that describes the required operation at the database level.</font></p>
<p><font id="12">This is easiest to understand through an example. </font><font id="13">Normally, one might do something like this:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Tintin filed a news story!</span>
<span class="n">reporter</span> <span class="o">=</span> <span class="n">Reporters</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Tintin'</span><span class="p">)</span>
<span class="n">reporter</span><span class="o">.</span><span class="n">stories_filed</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">reporter</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="14">Here, we have pulled the value of <tt class="docutils literal"><span class="pre">reporter.stories_filed</span></tt> from the database into memory and manipulated it using familiar Python operators, and then saved the object back to the database. </font><font id="15">But instead we could also have done:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">F</span>

<span class="n">reporter</span> <span class="o">=</span> <span class="n">Reporters</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Tintin'</span><span class="p">)</span>
<span class="n">reporter</span><span class="o">.</span><span class="n">stories_filed</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="s">'stories_filed'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">reporter</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="16">Although <tt class="docutils literal"><span class="pre">reporter.stories_filed</span> <span class="pre">=</span> <span class="pre">F('stories_filed')</span> <span class="pre">+</span> <span class="pre">1</span></tt> looks like a normal Python assignment of value to an instance attribute, in fact it’s an SQL construct describing an operation on the database.</font></p>
<p><font id="17">When Django encounters an instance of <tt class="docutils literal"><span class="pre">F()</span></tt>, it overrides the standard Python operators to create an encapsulated SQL expression; </font><font id="18">in this case, one which instructs the database to increment the database field represented by <tt class="docutils literal"><span class="pre">reporter.stories_filed</span></tt>.</font></p>
<p><font id="19">Whatever value is or was on <tt class="docutils literal"><span class="pre">reporter.stories_filed</span></tt>, Python never gets to know about it - it is dealt with entirely by the database. </font><font id="20">All Python does, through Django’s <tt class="docutils literal"><span class="pre">F()</span></tt> class, is create the SQL syntax to refer to the field and describe the operation.</font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="21">Note</font></p>
<p><font id="22">In order to access the new value that has been saved in this way, the object will need to be reloaded:</font></p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">reporter</span> <span class="o">=</span> <span class="n">Reporters</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">reporter</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><font id="23">As well as being used in operations on single instances as above, <tt class="docutils literal"><span class="pre">F()</span></tt> can be used on <tt class="docutils literal"><span class="pre">QuerySets</span></tt> of object instances, with <tt class="docutils literal"><span class="pre">update()</span></tt>. </font><font id="24">This reduces the two queries we were using above - the <tt class="docutils literal"><span class="pre">get()</span></tt> and the <a class="reference internal" href="instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a> - to just one:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">reporter</span> <span class="o">=</span> <span class="n">Reporters</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'Tintin'</span><span class="p">)</span>
<span class="n">reporter</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">stories_filed</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">'stories_filed'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="25">We can also use <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.update" title="django.db.models.query.QuerySet.update"><tt class="xref py py-meth docutils literal"><span class="pre">update()</span></tt></a> to increment the field value on multiple objects - which could be very much faster than pulling them all into Python from the database, looping over them, incrementing the field value of each one, and saving each one back to the database:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Reporter</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">stories_filed</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">'stories_filed'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="26"><tt class="docutils literal"><span class="pre">F()</span></tt> therefore can offer performance advantages by:</font></p>
<ul class="simple">
<li><font id="171">getting the database, rather than Python, to do work</font></li>
<li><font id="172">reducing the number of queries some operations require</font></li>
</ul>
<div class="section" id="s-avoiding-race-conditions-using-f">
<span id="s-id1"></span><span id="avoiding-race-conditions-using-f"></span><span id="id1"></span><h4><font id="168">Avoiding race conditions using <tt class="docutils literal"><span class="pre">F()</span></tt></font><a class="headerlink" href="expressions.html#avoiding-race-conditions-using-f" title="Permalink to this headline">¶</a></h4>
<p><font id="27">Another useful benefit of <tt class="docutils literal"><span class="pre">F()</span></tt> is that having the database - rather than Python - update a field’s value avoids a <em>race condition</em>.</font></p>
<p><font id="28">If two Python threads execute the code in the first example above, one thread could retrieve, increment, and save a field’s value after the other has retrieved it from the database. </font><font id="29">The value that the second thread saves will be based on the original value; </font><font id="30">the work of the first thread will simply be lost.</font></p>
<p><font id="31">If the database is responsible for updating the field, the process is more robust: it will only ever update the field based on the value of the field in the database when the <a class="reference internal" href="instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a> or <tt class="docutils literal"><span class="pre">update()</span></tt> is executed, rather than based on its value when the instance was retrieved.</font></p>
</div>
<div class="section" id="s-using-f-in-filters">
<span id="using-f-in-filters"></span><h4><font id="169">Using <tt class="docutils literal"><span class="pre">F()</span></tt> in filters</font><a class="headerlink" href="expressions.html#using-f-in-filters" title="Permalink to this headline">¶</a></h4>
<p><font id="32"><tt class="docutils literal"><span class="pre">F()</span></tt> is also very useful in <tt class="docutils literal"><span class="pre">QuerySet</span></tt> filters, where they make it possible to filter a set of objects against criteria based on their field values, rather than on Python values.</font></p>
<p><font id="33">This is documented in <a class="reference internal" href="../../topics/db/queries.html#using-f-expressions-in-filters"><em>using F() expressions in queries</em></a>.</font></p>
</div>
<div class="section" id="s-using-f-with-annotations">
<span id="s-id2"></span><span id="using-f-with-annotations"></span><span id="id2"></span><h4><font id="170">Using <tt class="docutils literal"><span class="pre">F()</span></tt> with annotations</font><a class="headerlink" href="expressions.html#using-f-with-annotations" title="Permalink to this headline">¶</a></h4>
<p><font id="34"><tt class="docutils literal"><span class="pre">F()</span></tt> can be used to create dynamic fields on your models by combining different fields with arithmetic:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">company</span> <span class="o">=</span> <span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="n">chairs_needed</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">'num_employees'</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="p">(</span><span class="s">'num_chairs'</span><span class="p">))</span>
</pre></div>
</div>
<p><font id="35">If the fields that you’re combining are of different types you’ll need to tell Django what kind of field will be returned. </font><font id="36">Since <tt class="docutils literal"><span class="pre">F()</span></tt> does not directly support <tt class="docutils literal"><span class="pre">output_field</span></tt> you will need to wrap the expression with <a class="reference internal" href="expressions.html#django.db.models.ExpressionWrapper" title="django.db.models.ExpressionWrapper"><tt class="xref py py-class docutils literal"><span class="pre">ExpressionWrapper</span></tt></a>:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">DateTimeField</span><span class="p">,</span> <span class="n">ExpressionWrapper</span><span class="p">,</span> <span class="n">F</span>

<span class="n">Ticket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="n">expires</span><span class="o">=</span><span class="n">ExpressionWrapper</span><span class="p">(</span>
        <span class="n">F</span><span class="p">(</span><span class="s">'active_at'</span><span class="p">)</span> <span class="o">+</span> <span class="n">F</span><span class="p">(</span><span class="s">'duration'</span><span class="p">),</span> <span class="n">output_field</span><span class="o">=</span><span class="n">DateTimeField</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-func-expressions">
<span id="s-id3"></span><span id="func-expressions"></span><span id="id3"></span><h3><font id="154"><tt class="docutils literal"><span class="pre">Func()</span></tt> expressions</font><a class="headerlink" href="expressions.html#func-expressions" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<span class="title">New in Django 1.8.</span> </div>
<p><font id="37"><tt class="docutils literal"><span class="pre">Func()</span></tt> expressions are the base type of all expressions that involve database functions like <tt class="docutils literal"><span class="pre">COALESCE</span></tt> and <tt class="docutils literal"><span class="pre">LOWER</span></tt>, or aggregates like <tt class="docutils literal"><span class="pre">SUM</span></tt>. </font><font id="38">They can be used directly:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Func</span><span class="p">,</span> <span class="n">F</span>

<span class="n">queryset</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">field_lower</span><span class="o">=</span><span class="n">Func</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">'field'</span><span class="p">),</span> <span class="n">function</span><span class="o">=</span><span class="s">'LOWER'</span><span class="p">))</span>
</pre></div>
</div>
<p><font id="39">or they can be used to build a library of database functions:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Lower</span><span class="p">(</span><span class="n">Func</span><span class="p">):</span>
    <span class="n">function</span> <span class="o">=</span> <span class="s">'LOWER'</span>

<span class="n">queryset</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">field_lower</span><span class="o">=</span><span class="n">Lower</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">'field'</span><span class="p">)))</span>
</pre></div>
</div>
<p><font id="40">But both cases will result in a queryset where each model is annotated with an extra attribute <tt class="docutils literal"><span class="pre">field_lower</span></tt> produced, roughly, from the following SQL:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT
    ...
    LOWER("app_label"."field") as "field_lower"
</pre></div>
</div>
<p><font id="41">See <a class="reference internal" href="database-functions.html"><em>Database Functions</em></a> for a list of built-in database functions.</font></p>
<p><font id="42">The <tt class="docutils literal"><span class="pre">Func</span></tt> API is as follows:</font></p>
<dl class="class">
<dt id="django.db.models.Func">
<em class="property">class </em><tt class="descname">Func</tt>(<em>*expressions</em>, <em>**extra</em>)<a class="headerlink" href="expressions.html#django.db.models.Func" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="django.db.models.Func.function">
<tt class="descname">function</tt><a class="headerlink" href="expressions.html#django.db.models.Func.function" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="43">A class attribute describing the function that will be generated. </font><font id="44">Specifically, the <tt class="docutils literal"><span class="pre">function</span></tt> will be interpolated as the <tt class="docutils literal"><span class="pre">function</span></tt> placeholder within <a class="reference internal" href="expressions.html#django.db.models.Func.template" title="django.db.models.Func.template"><tt class="xref py py-attr docutils literal"><span class="pre">template</span></tt></a>. </font><font id="45">Defaults to <tt class="docutils literal"><span class="pre">None</span></tt>.</font></p>
</dd></dl>
<dl class="attribute">
<dt id="django.db.models.Func.template">
<tt class="descname">template</tt><a class="headerlink" href="expressions.html#django.db.models.Func.template" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="46">A class attribute, as a format string, that describes the SQL that is generated for this function. </font><font id="47">Defaults to <tt class="docutils literal"><span class="pre">'%(function)s(%(expressions)s)'</span></tt>.</font></p>
</dd></dl>
<dl class="attribute">
<dt id="django.db.models.Func.arg_joiner">
<tt class="descname">arg_joiner</tt><a class="headerlink" href="expressions.html#django.db.models.Func.arg_joiner" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="48">A class attribute that denotes the character used to join the list of <tt class="docutils literal"><span class="pre">expressions</span></tt> together. </font><font id="49">Defaults to <tt class="docutils literal"><span class="pre">',</span> <span class="pre">'</span></tt>.</font></p>
</dd></dl>
</dd></dl>
<p><font id="50">The <tt class="docutils literal"><span class="pre">*expressions</span></tt> argument is a list of positional expressions that the function will be applied to. </font><font id="51">The expressions will be converted to strings, joined together with <tt class="docutils literal"><span class="pre">arg_joiner</span></tt>, and then interpolated into the <tt class="docutils literal"><span class="pre">template</span></tt> as the <tt class="docutils literal"><span class="pre">expressions</span></tt> placeholder.</font></p>
<p><font id="52">Positional arguments can be expressions or Python values. </font><font id="53">Strings are assumed to be column references and will be wrapped in <tt class="docutils literal"><span class="pre">F()</span></tt> expressions while other values will be wrapped in <tt class="docutils literal"><span class="pre">Value()</span></tt> expressions.</font></p>
<p><font id="54">The <tt class="docutils literal"><span class="pre">**extra</span></tt> kwargs are <tt class="docutils literal"><span class="pre">key=value</span></tt> pairs that can be interpolated into the <tt class="docutils literal"><span class="pre">template</span></tt> attribute. </font><font id="55">Note that the keywords <tt class="docutils literal"><span class="pre">function</span></tt> and <tt class="docutils literal"><span class="pre">template</span></tt> can be used to replace the <tt class="docutils literal"><span class="pre">function</span></tt> and <tt class="docutils literal"><span class="pre">template</span></tt> attributes respectively, without having to define your own class. </font><font id="56"><tt class="docutils literal"><span class="pre">output_field</span></tt> can be used to define the expected return type.</font></p>
</div>
<div class="section" id="s-aggregate-expressions">
<span id="aggregate-expressions"></span><h3><font id="155"><tt class="docutils literal"><span class="pre">Aggregate()</span></tt> expressions</font><a class="headerlink" href="expressions.html#aggregate-expressions" title="Permalink to this headline">¶</a></h3>
<p><font id="57">An aggregate expression is a special case of a <a class="reference internal" href="expressions.html#func-expressions"><em>Func() expression</em></a> that informs the query that a <tt class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></tt> clause is required. </font><font id="58">All of the <a class="reference internal" href="querysets.html#aggregation-functions"><em>aggregate functions</em></a>, like <tt class="docutils literal"><span class="pre">Sum()</span></tt> and <tt class="docutils literal"><span class="pre">Count()</span></tt>, inherit from <tt class="docutils literal"><span class="pre">Aggregate()</span></tt>.</font></p>
<p><font id="59">Since <tt class="docutils literal"><span class="pre">Aggregate</span></tt>s are expressions and wrap expressions, you can represent some complex computations:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Count</span>

<span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="n">managers_required</span><span class="o">=</span><span class="p">(</span><span class="n">Count</span><span class="p">(</span><span class="s">'num_employees'</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">Count</span><span class="p">(</span><span class="s">'num_managers'</span><span class="p">))</span>
</pre></div>
</div>
<p><font id="60">The <tt class="docutils literal"><span class="pre">Aggregate</span></tt> API is as follows:</font></p>
<dl class="class">
<dt id="django.db.models.Aggregate">
<em class="property">class </em><tt class="descname">Aggregate</tt>(<em>expression</em>, <em>output_field=None</em>, <em>**extra</em>)<a class="headerlink" href="expressions.html#django.db.models.Aggregate" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="django.db.models.Aggregate.template">
<tt class="descname">template</tt><a class="headerlink" href="expressions.html#django.db.models.Aggregate.template" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="61">A class attribute, as a format string, that describes the SQL that is generated for this aggregate. </font><font id="62">Defaults to <tt class="docutils literal"><span class="pre">'%(function)s(</span> <span class="pre">%(expressions)s</span> <span class="pre">)'</span></tt>.</font></p>
</dd></dl>
<dl class="attribute">
<dt id="django.db.models.Aggregate.function">
<tt class="descname">function</tt><a class="headerlink" href="expressions.html#django.db.models.Aggregate.function" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="63">A class attribute describing the aggregate function that will be generated. </font><font id="64">Specifically, the <tt class="docutils literal"><span class="pre">function</span></tt> will be interpolated as the <tt class="docutils literal"><span class="pre">function</span></tt> placeholder within <a class="reference internal" href="expressions.html#django.db.models.Aggregate.template" title="django.db.models.Aggregate.template"><tt class="xref py py-attr docutils literal"><span class="pre">template</span></tt></a>. </font><font id="65">Defaults to <tt class="docutils literal"><span class="pre">None</span></tt>.</font></p>
</dd></dl>
</dd></dl>
<p><font id="66">The <tt class="docutils literal"><span class="pre">expression</span></tt> argument can be the name of a field on the model, or another expression. </font><font id="67">It will be converted to a string and used as the <tt class="docutils literal"><span class="pre">expressions</span></tt> placeholder within the <tt class="docutils literal"><span class="pre">template</span></tt>.</font></p>
<p><font id="68">The <tt class="docutils literal"><span class="pre">output_field</span></tt> argument requires a model field instance, like <tt class="docutils literal"><span class="pre">IntegerField()</span></tt> or <tt class="docutils literal"><span class="pre">BooleanField()</span></tt>, into which Django will load the value after it’s retrieved from the database. </font><font id="69">Usually no arguments are needed when instantiating the model field as any arguments relating to data validation (<tt class="docutils literal"><span class="pre">max_length</span></tt>, <tt class="docutils literal"><span class="pre">max_digits</span></tt>, etc.) will not be enforced on the expression’s output value.</font></p>
<p><font id="70">Note that <tt class="docutils literal"><span class="pre">output_field</span></tt> is only required when Django is unable to determine what field type the result should be. </font><font id="71">Complex expressions that mix field types should define the desired <tt class="docutils literal"><span class="pre">output_field</span></tt>. </font><font id="72">For example, adding an <tt class="docutils literal"><span class="pre">IntegerField()</span></tt> and a <tt class="docutils literal"><span class="pre">FloatField()</span></tt> together should probably have <tt class="docutils literal"><span class="pre">output_field=FloatField()</span></tt> defined.</font></p>
<div class="versionchanged">
<span class="title">Changed in Django 1.8:</span> <p><font id="73"><tt class="docutils literal"><span class="pre">output_field</span></tt> is a new parameter.</font></p>
</div>
<p><font id="74">The <tt class="docutils literal"><span class="pre">**extra</span></tt> kwargs are <tt class="docutils literal"><span class="pre">key=value</span></tt> pairs that can be interpolated into the <tt class="docutils literal"><span class="pre">template</span></tt> attribute.</font></p>
<div class="versionadded">
<span class="title">New in Django 1.8:</span> <p><font id="75">Aggregate functions can now use arithmetic and reference multiple model fields in a single function.</font></p>
</div>
</div>
<div class="section" id="s-creating-your-own-aggregate-functions">
<span id="creating-your-own-aggregate-functions"></span><h3><font id="156">Creating your own Aggregate Functions</font><a class="headerlink" href="expressions.html#creating-your-own-aggregate-functions" title="Permalink to this headline">¶</a></h3>
<p><font id="76">Creating your own aggregate is extremely easy. </font><font id="77">At a minimum, you need to define <tt class="docutils literal"><span class="pre">function</span></tt>, but you can also completely customize the SQL that is generated. </font><font id="78">Here’s a brief example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Aggregate</span>

<span class="k">class</span> <span class="nc">Count</span><span class="p">(</span><span class="n">Aggregate</span><span class="p">):</span>
    <span class="c"># supports COUNT(distinct field)</span>
    <span class="n">function</span> <span class="o">=</span> <span class="s">'COUNT'</span>
    <span class="n">template</span> <span class="o">=</span> <span class="s">'</span><span class="si">%(function)s</span><span class="s">(</span><span class="si">%(distinct)s%(expressions)s</span><span class="s">)'</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">distinct</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Count</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">expression</span><span class="p">,</span>
            <span class="n">distinct</span><span class="o">=</span><span class="s">'DISTINCT '</span> <span class="k">if</span> <span class="n">distinct</span> <span class="k">else</span> <span class="s">''</span><span class="p">,</span>
            <span class="n">output_field</span><span class="o">=</span><span class="n">IntegerField</span><span class="p">(),</span>
            <span class="o">**</span><span class="n">extra</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-value-expressions">
<span id="value-expressions"></span><h3><font id="157"><tt class="docutils literal"><span class="pre">Value()</span></tt> expressions</font><a class="headerlink" href="expressions.html#value-expressions" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="django.db.models.Value">
<em class="property">class </em><tt class="descname">Value</tt>(<em>value</em>, <em>output_field=None</em>)<a class="headerlink" href="expressions.html#django.db.models.Value" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="79">A <tt class="docutils literal"><span class="pre">Value()</span></tt> object represents the smallest possible component of an expression: a simple value. </font><font id="80">When you need to represent the value of an integer, boolean, or string within an expression, you can wrap that value within a <tt class="docutils literal"><span class="pre">Value()</span></tt>.</font></p>
<p><font id="81">You will rarely need to use <tt class="docutils literal"><span class="pre">Value()</span></tt> directly. </font><font id="82">When you write the expression <tt class="docutils literal"><span class="pre">F('field')</span> <span class="pre">+</span> <span class="pre">1</span></tt>, Django implicitly wraps the <tt class="docutils literal"><span class="pre">1</span></tt> in a <tt class="docutils literal"><span class="pre">Value()</span></tt>, allowing simple values to be used in more complex expressions.</font></p>
<p><font id="83">The <tt class="docutils literal"><span class="pre">value</span></tt> argument describes the value to be included in the expression, such as <tt class="docutils literal"><span class="pre">1</span></tt>, <tt class="docutils literal"><span class="pre">True</span></tt>, or <tt class="docutils literal"><span class="pre">None</span></tt>. </font><font id="84">Django knows how to convert these Python values into their corresponding database type.</font></p>
<p><font id="85">The <tt class="docutils literal"><span class="pre">output_field</span></tt> argument should be a model field instance, like <tt class="docutils literal"><span class="pre">IntegerField()</span></tt> or <tt class="docutils literal"><span class="pre">BooleanField()</span></tt>, into which Django will load the value after it’s retrieved from the database. </font><font id="86">Usually no arguments are needed when instantiating the model field as any arguments relating to data validation (<tt class="docutils literal"><span class="pre">max_length</span></tt>, <tt class="docutils literal"><span class="pre">max_digits</span></tt>, etc.) will not be enforced on the expression’s output value.</font></p>
</div>
<div class="section" id="s-expressionwrapper-expressions">
<span id="expressionwrapper-expressions"></span><h3><font id="158"><tt class="docutils literal"><span class="pre">ExpressionWrapper()</span></tt> expressions</font><a class="headerlink" href="expressions.html#expressionwrapper-expressions" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="django.db.models.ExpressionWrapper">
<em class="property">class </em><tt class="descname">ExpressionWrapper</tt>(<em>expression</em>, <em>output_field</em>)<a class="headerlink" href="expressions.html#django.db.models.ExpressionWrapper" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<div class="versionadded">
<span class="title">New in Django 1.8.</span> </div>
<p><font id="87"><tt class="docutils literal"><span class="pre">ExpressionWrapper</span></tt> simply surrounds another expression and provides access to properties, such as <tt class="docutils literal"><span class="pre">output_field</span></tt>, that may not be available on other expressions. </font><font id="88"><tt class="docutils literal"><span class="pre">ExpressionWrapper</span></tt> is necessary when using arithmetic on <tt class="docutils literal"><span class="pre">F()</span></tt> expressions with different types as described in <a class="reference internal" href="expressions.html#using-f-with-annotations"><em>Using F() with annotations</em></a>.</font></p>
</div>
<div class="section" id="s-conditional-expressions">
<span id="conditional-expressions"></span><h3><font id="159">Conditional expressions</font><a class="headerlink" href="expressions.html#conditional-expressions" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<span class="title">New in Django 1.8.</span> </div>
<p><font id="89">Conditional expressions allow you to use <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#if" title="(in Python v3.4)"><tt class="xref std std-keyword docutils literal"><span class="pre">if</span></tt></a> ... </font><font id="90"><a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#elif" title="(in Python v3.4)"><tt class="xref std std-keyword docutils literal"><span class="pre">elif</span></tt></a> ... </font><font id="91"><a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#else" title="(in Python v3.4)"><tt class="xref std std-keyword docutils literal"><span class="pre">else</span></tt></a> logic in queries. </font><font id="92">Django natively supports SQL <tt class="docutils literal"><span class="pre">CASE</span></tt> expressions. </font><font id="93">For more details see <a class="reference internal" href="conditional-expressions.html"><em>Conditional Expressions</em></a>.</font></p>
</div>
</div>
<div class="section" id="s-technical-information">
<span id="technical-information"></span><h2><font id="152">Technical Information</font><a class="headerlink" href="expressions.html#technical-information" title="Permalink to this headline">¶</a></h2>
<p><font id="94">Below you’ll find technical implementation details that may be useful to library authors. </font><font id="95">The technical API and examples below will help with creating generic query expressions that can extend the built-in functionality that Django provides.</font></p>
<div class="section" id="s-expression-api">
<span id="expression-api"></span><h3><font id="160">Expression API</font><a class="headerlink" href="expressions.html#expression-api" title="Permalink to this headline">¶</a></h3>
<p><font id="96">Query expressions implement the <a class="reference internal" href="lookups.html#query-expression"><em>query expression API</em></a>, but also expose a number of extra methods and attributes listed below. </font><font id="97">All query expressions must inherit from <tt class="docutils literal"><span class="pre">Expression()</span></tt> or a relevant subclass.</font></p>
<p><font id="98">When a query expression wraps another expression, it is responsible for calling the appropriate methods on the wrapped expression.</font></p>
<dl class="class">
<dt id="django.db.models.Expression">
<em class="property">class </em><tt class="descname">Expression</tt><a class="headerlink" href="expressions.html#django.db.models.Expression" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="django.db.models.Expression.contains_aggregate">
<tt class="descname">contains_aggregate</tt><a class="headerlink" href="expressions.html#django.db.models.Expression.contains_aggregate" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="99">Tells Django that this expression contains an aggregate and that a <tt class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></tt> clause needs to be added to the query.</font></p>
</dd></dl>
<dl class="method">
<dt id="django.db.models.Expression.resolve_expression">
<tt class="descname">resolve_expression</tt>(<em>query=None</em>, <em>allow_joins=True</em>, <em>reuse=None</em>, <em>summarize=False</em>)<a class="headerlink" href="expressions.html#django.db.models.Expression.resolve_expression" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="100">Provides the chance to do any pre-processing or validation of the expression before it’s added to the query. </font><font id="101"><tt class="docutils literal"><span class="pre">resolve_expression()</span></tt> must also be called on any nested expressions. </font><font id="102">A <tt class="docutils literal"><span class="pre">copy()</span></tt> of <tt class="docutils literal"><span class="pre">self</span></tt> should be returned with any necessary transformations.</font></p>
<p><font id="103"><tt class="docutils literal"><span class="pre">query</span></tt> is the backend query implementation.</font></p>
<p><font id="104"><tt class="docutils literal"><span class="pre">allow_joins</span></tt> is a boolean that allows or denies the use of joins in the query.</font></p>
<p><font id="105"><tt class="docutils literal"><span class="pre">reuse</span></tt> is a set of reusable joins for multi-join scenarios.</font></p>
<p><font id="106"><tt class="docutils literal"><span class="pre">summarize</span></tt> is a boolean that, when <tt class="docutils literal"><span class="pre">True</span></tt>, signals that the query being computed is a terminal aggregate query.</font></p>
</dd></dl>
<dl class="method">
<dt id="django.db.models.Expression.get_source_expressions">
<tt class="descname">get_source_expressions</tt>()<a class="headerlink" href="expressions.html#django.db.models.Expression.get_source_expressions" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="107">Returns an ordered list of inner expressions. </font><font id="108">For example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Sum</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">'foo'</span><span class="p">))</span><span class="o">.</span><span class="n">get_source_expressions</span><span class="p">()</span>
<span class="go">[F('foo')]</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="django.db.models.Expression.set_source_expressions">
<tt class="descname">set_source_expressions</tt>(<em>expressions</em>)<a class="headerlink" href="expressions.html#django.db.models.Expression.set_source_expressions" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="109">Takes a list of expressions and stores them such that <tt class="docutils literal"><span class="pre">get_source_expressions()</span></tt> can return them.</font></p>
</dd></dl>
<dl class="method">
<dt id="django.db.models.Expression.relabeled_clone">
<tt class="descname">relabeled_clone</tt>(<em>change_map</em>)<a class="headerlink" href="expressions.html#django.db.models.Expression.relabeled_clone" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="110">Returns a clone (copy) of <tt class="docutils literal"><span class="pre">self</span></tt>, with any column aliases relabeled. </font><font id="111">Column aliases are renamed when subqueries are created. </font><font id="112"><tt class="docutils literal"><span class="pre">relabeled_clone()</span></tt> should also be called on any nested expressions and assigned to the clone.</font></p>
<p><font id="113"><tt class="docutils literal"><span class="pre">change_map</span></tt> is a dictionary mapping old aliases to new aliases.</font></p>
<p><font id="114">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">relabeled_clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change_map</span><span class="p">):</span>
    <span class="n">clone</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">clone</span><span class="o">.</span><span class="n">expression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">relabeled_clone</span><span class="p">(</span><span class="n">change_map</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">clone</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="django.db.models.Expression.convert_value">
<tt class="descname">convert_value</tt>(<em>self</em>, <em>value</em>, <em>expression</em>, <em>connection</em>, <em>context</em>)<a class="headerlink" href="expressions.html#django.db.models.Expression.convert_value" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="115">A hook allowing the expression to coerce <tt class="docutils literal"><span class="pre">value</span></tt> into a more appropriate type.</font></p>
</dd></dl>
<dl class="method">
<dt id="django.db.models.Expression.refs_aggregate">
<tt class="descname">refs_aggregate</tt>(<em>existing_aggregates</em>)<a class="headerlink" href="expressions.html#django.db.models.Expression.refs_aggregate" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="116">Returns a tuple containing the <tt class="docutils literal"><span class="pre">(aggregate,</span> <span class="pre">lookup_path)</span></tt> of the first aggregate that this expression (or any nested expression) references, or <tt class="docutils literal"><span class="pre">(False,</span> <span class="pre">())</span></tt> if no aggregate is referenced. </font><font id="117">For example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">queryset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">num_chairs__gt</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">'sum__employees'</span><span class="p">))</span>
</pre></div>
</div>
<p><font id="118">The <tt class="docutils literal"><span class="pre">F()</span></tt> expression here references a previous <tt class="docutils literal"><span class="pre">Sum()</span></tt> computation which means that this filter expression should be added to the <tt class="docutils literal"><span class="pre">HAVING</span></tt> clause rather than the <tt class="docutils literal"><span class="pre">WHERE</span></tt> clause.</font></p>
<p><font id="119">In the majority of cases, returning the result of <tt class="docutils literal"><span class="pre">refs_aggregate</span></tt> on any nested expression should be appropriate, as the necessary built-in expressions will return the correct values.</font></p>
</dd></dl>
<dl class="method">
<dt id="django.db.models.Expression.get_group_by_cols">
<tt class="descname">get_group_by_cols</tt>()<a class="headerlink" href="expressions.html#django.db.models.Expression.get_group_by_cols" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="120">Responsible for returning the list of columns references by this expression. </font><font id="121"><tt class="docutils literal"><span class="pre">get_group_by_cols()</span></tt> should be called on any nested expressions. </font><font id="122"><tt class="docutils literal"><span class="pre">F()</span></tt> objects, in particular, hold a reference to a column.</font></p>
</dd></dl>
<dl class="method">
<dt id="django.db.models.Expression.asc">
<tt class="descname">asc</tt>()<a class="headerlink" href="expressions.html#django.db.models.Expression.asc" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="123">Returns the expression ready to be sorted in ascending order.</font></p>
</dd></dl>
<dl class="method">
<dt id="django.db.models.Expression.desc">
<tt class="descname">desc</tt>()<a class="headerlink" href="expressions.html#django.db.models.Expression.desc" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="124">Returns the expression ready to be sorted in descending order.</font></p>
</dd></dl>
<dl class="method">
<dt id="django.db.models.Expression.reverse_ordering">
<tt class="descname">reverse_ordering</tt>()<a class="headerlink" href="expressions.html#django.db.models.Expression.reverse_ordering" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="125">Returns <tt class="docutils literal"><span class="pre">self</span></tt> with any modifications required to reverse the sort order within an <tt class="docutils literal"><span class="pre">order_by</span></tt> call. </font><font id="126">As an example, an expression implementing <tt class="docutils literal"><span class="pre">NULLS</span> <span class="pre">LAST</span></tt> would change its value to be <tt class="docutils literal"><span class="pre">NULLS</span> <span class="pre">FIRST</span></tt>. </font><font id="127">Modifications are only required for expressions that implement sort order like <tt class="docutils literal"><span class="pre">OrderBy</span></tt>. </font><font id="128">This method is called when <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.reverse" title="django.db.models.query.QuerySet.reverse"><tt class="xref py py-meth docutils literal"><span class="pre">reverse()</span></tt></a> is called on a queryset.</font></p>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="s-writing-your-own-query-expressions">
<span id="writing-your-own-query-expressions"></span><h3><font id="161">Writing your own Query Expressions</font><a class="headerlink" href="expressions.html#writing-your-own-query-expressions" title="Permalink to this headline">¶</a></h3>
<p><font id="129">You can write your own query expression classes that use, and can integrate with, other query expressions. </font><font id="130">Let’s step through an example by writing an implementation of the <tt class="docutils literal"><span class="pre">COALESCE</span></tt> SQL function, without using the built-in <a class="reference internal" href="expressions.html#func-expressions"><em>Func() expressions</em></a>.</font></p>
<p><font id="131">The <tt class="docutils literal"><span class="pre">COALESCE</span></tt> SQL function is defined as taking a list of columns or values. </font><font id="132">It will return the first column or value that isn’t <tt class="docutils literal"><span class="pre">NULL</span></tt>.</font></p>
<p><font id="133">We’ll start by defining the template to be used for SQL generation and an <tt class="docutils literal"><span class="pre">__init__()</span></tt> method to set some attributes:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Expression</span>

<span class="k">class</span> <span class="nc">Coalesce</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="n">template</span> <span class="o">=</span> <span class="s">'COALESCE( </span><span class="si">%(expressions)s</span><span class="s"> )'</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expressions</span><span class="p">,</span> <span class="n">output_field</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">(</span><span class="n">Coalesce</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">output_field</span><span class="o">=</span><span class="n">output_field</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expressions</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">'expressions must have at least 2 elements'</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">expression</span> <span class="ow">in</span> <span class="n">expressions</span><span class="p">:</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="s">'resolve_expression'</span><span class="p">):</span>
              <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">'</span><span class="si">%r</span><span class="s"> is not an Expression'</span> <span class="o">%</span> <span class="n">expression</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">expressions</span> <span class="o">=</span> <span class="n">expressions</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">extra</span> <span class="o">=</span> <span class="n">extra</span>
</pre></div>
</div>
<p><font id="134">We do some basic validation on the parameters, including requiring at least 2 columns or values, and ensuring they are expressions. </font><font id="135">We are requiring <tt class="docutils literal"><span class="pre">output_field</span></tt> here so that Django knows what kind of model field to assign the eventual result to.</font></p>
<p><font id="136">Now we implement the pre-processing and validation. </font><font id="137">Since we do not have any of our own validation at this point, we just delegate to the nested expressions:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">resolve_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">allow_joins</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">reuse</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">summarize</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">is_summary</span> <span class="o">=</span> <span class="n">summarize</span>
    <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">expression</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expressions</span><span class="p">):</span>
        <span class="n">c</span><span class="o">.</span><span class="n">expressions</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">resolve_expression</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">allow_joins</span><span class="p">,</span> <span class="n">reuse</span><span class="p">,</span> <span class="n">summarize</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">c</span>
</pre></div>
</div>
<p><font id="138">Next, we write the method responsible for generating the SQL:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">as_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
    <span class="n">sql_expressions</span><span class="p">,</span> <span class="n">sql_params</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">expression</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expressions</span><span class="p">:</span>
        <span class="n">sql</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
        <span class="n">sql_expressions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
        <span class="n">sql_params</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">extra</span><span class="p">[</span><span class="s">'expressions'</span><span class="p">]</span> <span class="o">=</span> <span class="s">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sql_expressions</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra</span><span class="p">,</span> <span class="n">sql_params</span>

<span class="k">def</span> <span class="nf">as_oracle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Example of vendor specific handling (Oracle in this case).</span>
<span class="sd">    Let's make the function name lowercase.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s">'coalesce( </span><span class="si">%(expressions)s</span><span class="s"> )'</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_sql</span><span class="p">(</span><span class="n">compiler</span><span class="p">,</span> <span class="n">connection</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="139">We generate the SQL for each of the <tt class="docutils literal"><span class="pre">expressions</span></tt> by using the <tt class="docutils literal"><span class="pre">compiler.compile()</span></tt> method, and join the result together with commas. </font><font id="140">Then the template is filled out with our data and the SQL and parameters are returned.</font></p>
<p><font id="141">We’ve also defined a custom implementation that is specific to the Oracle backend. </font><font id="142">The <tt class="docutils literal"><span class="pre">as_oracle()</span></tt> function will be called instead of <tt class="docutils literal"><span class="pre">as_sql()</span></tt> if the Oracle backend is in use.</font></p>
<p><font id="143">Finally, we implement the rest of the methods that allow our query expression to play nice with other query expressions:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_source_expressions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expressions</span>

<span class="k">def</span> <span class="nf">set_source_expressions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expressions</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">expressions</span> <span class="o">=</span> <span class="n">expressions</span>
</pre></div>
</div>
<p><font id="144">Let’s see how it works:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">F</span><span class="p">,</span> <span class="n">Value</span><span class="p">,</span> <span class="n">CharField</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qs</span> <span class="o">=</span> <span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
<span class="gp">... </span>   <span class="n">tagline</span><span class="o">=</span><span class="n">Coalesce</span><span class="p">([</span>
<span class="gp">... </span>       <span class="n">F</span><span class="p">(</span><span class="s">'motto'</span><span class="p">),</span>
<span class="gp">... </span>       <span class="n">F</span><span class="p">(</span><span class="s">'ticker_name'</span><span class="p">),</span>
<span class="gp">... </span>       <span class="n">F</span><span class="p">(</span><span class="s">'description'</span><span class="p">),</span>
<span class="gp">... </span>       <span class="n">Value</span><span class="p">(</span><span class="s">'No Tagline'</span><span class="p">)</span>
<span class="gp">... </span>       <span class="p">],</span> <span class="n">output_field</span><span class="o">=</span><span class="n">CharField</span><span class="p">()))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">qs</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">tagline</span><span class="p">))</span>
<span class="gp">...</span>
<span class="go">Google: Do No Evil</span>
<span class="go">Apple: AAPL</span>
<span class="go">Yahoo: Internet Company</span>
<span class="go">Django Software Foundation: No Tagline</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="yui-b" id="sidebar">
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
<h3><font id="162">Table Of Contents</font></h3>
<ul>
<li><a class="reference internal" href="expressions.html#"><font id="173">Query Expressions</font></a><ul>
<li><a class="reference internal" href="expressions.html#supported-arithmetic"><font id="174">Supported arithmetic</font></a></li>
<li><a class="reference internal" href="expressions.html#some-examples"><font id="175">Some examples</font></a></li>
<li><a class="reference internal" href="expressions.html#built-in-expressions"><font id="176">Built-in Expressions</font></a><ul>
<li><a class="reference internal" href="expressions.html#f-expressions"><font id="177"><tt class="docutils literal"><span class="pre">F()</span></tt> expressions</font></a><ul>
<li><a class="reference internal" href="expressions.html#avoiding-race-conditions-using-f"><font id="178">Avoiding race conditions using <tt class="docutils literal"><span class="pre">F()</span></tt></font></a></li>
<li><a class="reference internal" href="expressions.html#using-f-in-filters"><font id="179">Using <tt class="docutils literal"><span class="pre">F()</span></tt> in filters</font></a></li>
<li><a class="reference internal" href="expressions.html#using-f-with-annotations"><font id="180">Using <tt class="docutils literal"><span class="pre">F()</span></tt> with annotations</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="expressions.html#func-expressions"><font id="181"><tt class="docutils literal"><span class="pre">Func()</span></tt> expressions</font></a></li>
<li><a class="reference internal" href="expressions.html#aggregate-expressions"><font id="182"><tt class="docutils literal"><span class="pre">Aggregate()</span></tt> expressions</font></a></li>
<li><a class="reference internal" href="expressions.html#creating-your-own-aggregate-functions"><font id="183">Creating your own Aggregate Functions</font></a></li>
<li><a class="reference internal" href="expressions.html#value-expressions"><font id="184"><tt class="docutils literal"><span class="pre">Value()</span></tt> expressions</font></a></li>
<li><a class="reference internal" href="expressions.html#expressionwrapper-expressions"><font id="185"><tt class="docutils literal"><span class="pre">ExpressionWrapper()</span></tt> expressions</font></a></li>
<li><a class="reference internal" href="expressions.html#conditional-expressions"><font id="186">Conditional expressions</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="expressions.html#technical-information"><font id="187">Technical Information</font></a><ul>
<li><a class="reference internal" href="expressions.html#expression-api"><font id="188">Expression API</font></a></li>
<li><a class="reference internal" href="expressions.html#writing-your-own-query-expressions"><font id="189">Writing your own Query Expressions</font></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><font id="163">Browse</font></h3>
<ul>
<li><font id="190">Prev: <a href="lookups.html">Lookup API reference</a></font></li>
<li><font id="191">Next: <a href="conditional-expressions.html">Conditional Expressions</a></font></li>
</ul>
<h3><font id="164">You are here:</font></h3>
<ul>
<li>
<a href="../../index.html"><font id="192">Django 1.8.2.dev20150513143415 documentation</font></a>
<ul><li><a href="../index.html"><font id="193">API Reference</font></a>
<ul><li><a href="index.html"><font id="194">Models</font></a>
<ul><li><font id="195">Query Expressions</font></li></ul>
</li></ul></li></ul>
</li>
</ul>
<h3><font id="165">This Page</font></h3>
<ul class="this-page-menu">
<li><a href="http://python.usyiyi.cn/django/_sources/ref/models/expressions.txt" rel="nofollow"><font id="196">Show Source</font></a></li>
</ul>
<div id="searchbox" style="display: none">
<h3><font id="166">Quick search</font></h3>
<form action="http://python.usyiyi.cn/django/search.html" class="search" method="get">
<input name="q" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
<p class="searchtip" style="font-size: 90%"><font id="145"> Enter search terms or a module, class or function name. </font></p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>
</div>
<h3><font id="167">Last update:</font></h3>
<p class="topless"><font id="146">May 13, 2015</font></p>
</div>
</div>
<div id="ft">
<div class="nav">
    « <a href="lookups.html" title="Lookup API reference">previous</a>
     |
    <a accesskey="U" href="../index.html" title="API Reference">up</a>
   |
    <a href="conditional-expressions.html" title="Conditional Expressions">next</a> »</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div id="disqus_thread"></div><br>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'djangocn'; // required: replace example with your forum shortname
    var disqus_identifier = '/django/ref/models/expressions';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<link href="http://python.usyiyi.cn/django/_static/ms_translator.css" rel="stylesheet" type="text/css"/>
<script src="http://python.usyiyi.cn/django/_static/ms_translator.js" type="text/javascript"></script>
<script src="http://python.usyiyi.cn/django/_static/jquery-ui-1.9.2.custom.min.js" type="text/javascript"></script>
<div id="MicrosoftTranslator" style="display:none; position: absolute; z-index: 2147483647; margin: 0px; border: 2px solid rgb(210, 210, 210); padding: 0px; color: rgb(0, 0, 0); background-color: rgb(230, 230, 230); font-family: Arial,Helvetica,Sans-Serif; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: normal; direction: ltr; text-align: left; left: 274px; top: 2048.03px; min-width: 400px;">
    <div id="MSTCClose" style="float: right;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/tooltip_close.gif">
      </a>
    </div>
    
    <div id="MSTCPopDown" style="float: right;" style="display: none;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/popdown.gif">
      </a>
    </div>
    <div id="MSTCPopUP" style="float: right;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/popup.gif">
      </a>
    </div>
    
    <div id="MSTCTitle" style="margin: 4px 4px 8px; font-weight: bold;">原文
    </div>
    
    <div style="direction: ltr; text-align: left;">
      <span id="MSTCOrigion" style="display: inline-block; margin: 0px 4px 4px;"> </span>
    </div>
    
    <div id="MicrosoftTranslatorCommunity" class="MSTCltr">
      <div id="MSTCContent">
        <a id="MSTCExpandLink">
          <span id="MSTCImprove">改进翻译</span>
          <span id="MSTCSuggest">最小化</span>
          <img src="http://python.usyiyi.cn/django/_static/ctftoggledown.gif" id="MSTCToggleDown">
          <img src="http://python.usyiyi.cn/django/_static/ctftoggleup.gif" id="MSTCToggleUp">
        </a>
        <div id="MSTCRootPanel">
          <span id="MSTCLoading" style="display: none;">正在加载...</span>
          <div style="display: none;" id="MSTCTransPanelError">
            <div class="MSTCTableRow">
              <div class="MSTCTransPanelExc MSTCTableCell">
                <img style="border-width:0px;" src="http://python.usyiyi.cn/django/_static/error_exclamation.gif" id="ExclamationImage">
              </div>
              <div class="MSTCTableCell">
                <span id="MSTCTransPanelErrorMsg"></span>
              </div>
            </div>
            <div class="MSTCTableRow">
              <div class="MSTCTableCell"></div>
              <div class="MSTCTableCell MSTCFlipHoriz">
                <input type="image" style="border-width:0px;" src="http://python.usyiyi.cn/django/_static/error_OK.gif" class="MSTCErrorButtons" id="MSTCOKImgBtn" name="MSTCOKImgBtn">
              </div>
            </div>
          </div>
          
          <div id="MSTCTransPanel">
          </div>
          
          <div id="MSTCPrevNextPanel">
            <a id="MSTCPrevLink" style='border-right-width: 1px;border-right-style: solid;padding-right: 5px;'>
              <span>上一页</span>
            </a>
            <a style='color: black; border-right-width: 1px;border-right-style: solid;padding-right: 5px;'>
              <span>第</span>
              <span id="MSTCPage"></span>
              <span>页</span>
            </a>
            <a id="MSTCNextLink" style='padding-left: 5px;'>
              <span>下一页</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>
</html>