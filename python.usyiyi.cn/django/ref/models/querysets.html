<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>QuerySet API 参考 — Django 1.8.2 中文文档</title>
<link href="../../_static/default.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.8.2.dev20150513143415',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
<script src="../../_static/jquery.js" type="text/javascript"></script>
<script src="../../_static/underscore.js" type="text/javascript"></script>
<script src="../../_static/doctools.js" type="text/javascript"></script>
<link href="../../index.html" rel="top" title="Django 1.8.2.dev20150513143415 documentation"/>
<link href="index.html" rel="up" title="Models"/>
<link href="lookups.html" rel="next" title="Lookup API reference"/>
<link href="instances.html" rel="prev" title="Model instance reference"/>
<script src="http://python.usyiyi.cn/django/templatebuiltins.js" type="text/javascript"></script>
<script type="text/javascript">
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='http://python.usyiyi.cn/django/ref/models/&quot;&#32;+&#32;base&#32;+&#32;&quot;#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='http://python.usyiyi.cn/django/ref/models/&quot;&#32;+&#32;base&#32;+&#32;&quot;#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);
</script>
</head>
<body>
<div class="document">
<div class="yui-t6" id="custom-doc">
<div id="hd">
<h1><font id="840">Django 1.8.2 文档</font></h1>
<div id="global-nav">
<a href="../../index.html" title="Home page">Home</a>  |
        <a href="../../contents.html" title="Table of contents">Table of contents</a>  |
        <a href="../../genindex.html" title="Global index">Index</a>  |
        <a href="../../py-modindex.html" title="Module index">Modules</a>
</div>
<div class="nav">
    « <a href="instances.html" title="Model instance reference">previous</a>
     |
    <a accesskey="U" href="../index.html" title="API Reference">up</a>
   |
    <a href="lookups.html" title="Lookup API reference">next</a> »</div>
</div>
<div id="bd">
<div id="yui-main">
<div class="yui-b">
<div class="yui-g" id="ref-models-querysets">
<div class="section" id="s-queryset-api-reference">
<span id="queryset-api-reference"></span><h1><font id="841">QuerySet API reference</font><a class="headerlink" href="querysets.html#queryset-api-reference" title="Permalink to this headline">¶</a></h1>
<p><font id="1">本文档描述了 <tt class="docutils literal"><span class="pre">QuerySet</span></tt> API的细节. </font><font id="2">它建立在<a class="reference internal" href="../../topics/db/models.html"><em>model</em></a> 和<a class="reference internal" href="../../topics/db/queries.html"><em>database query</em></a>指南的基础上，所以在阅读本文档之前，你也许需要首先阅读这两部分的文档。</font></p>
<p><font id="3">本文档将一贯地使用 在<a class="reference internal" href="../../topics/db/queries.html"><em>database query guide</em></a>中创建的<a class="reference internal" href="../../topics/db/queries.html#queryset-model-example"><em>example Weblog models</em></a> 例子。</font></p>
<div class="section" id="s-when-querysets-are-evaluated">
<span id="s-id1"></span><span id="when-querysets-are-evaluated"></span><span id="id1"></span><h2><font id="842">什么时候QuerySets会被求值(evaluated)</font><a class="headerlink" href="querysets.html#when-querysets-are-evaluated" title="Permalink to this headline">¶</a></h2>
<p><font id="4">在Django内部(Internally), 一个 <tt class="docutils literal"><span class="pre">QuerySet</span></tt>(查询集)不用真正的操作数据库就可以被创建，筛选，分片和传递(generally passed around)。</font><font id="5">在你对queryset做求值(evaluate)操作之前，实际上没有做任何实际的数据库操作。</font></p>
<p><font id="6">你可以使用下列方法 对<tt class="docutils literal"><span class="pre">QuerySet</span></tt> 求值：</font></p>
<ul>
<li><p class="first"><font id="7"><strong>迭代(Iteration).</strong></font><font id="8"><tt class="docutils literal"><span class="pre">QuerySet</span></tt> 是可迭代的，当你使用一个queryset进行迭代时，就会执行实际的数据库操作。</font><font id="9">例如， 下面的语句会将数据库中所有文章的标题打印出来。</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">headline</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="10">注意：不要使用上面的语句来验证记录在数据库中是否存在。</font><font id="11">使用 <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.exists" title="django.db.models.query.QuerySet.exists"><tt class="xref py py-meth docutils literal"><span class="pre">exists()</span></tt></a>方法更高效。</font></p>
</li>
<li><p class="first"><font id="12"><strong>分片(Slicing).</strong> </font><font id="13">正如在 <a class="reference internal" href="../../topics/db/queries.html#limiting-querysets"><em>Limiting QuerySets</em></a>中解释的那样， 可以使用python的序列分片语法对一个 <tt class="docutils literal"><span class="pre">QuerySet</span></tt> 进行分片。</font><font id="14">Slicing an unevaluated <tt class="docutils literal"><span class="pre">QuerySet</span></tt> usually returns another unevaluated <tt class="docutils literal"><span class="pre">QuerySet</span></tt>, but Django will execute the database query if you use the “step” parameter of slice syntax, and will return a list. </font><font id="15">Slicing a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> that has been evaluated also returns a list.</font></p>
<p><font id="16">Also note that even though slicing an unevaluated <tt class="docutils literal"><span class="pre">QuerySet</span></tt> returns another unevaluated <tt class="docutils literal"><span class="pre">QuerySet</span></tt>, modifying it further (e.g., adding more filters, or modifying ordering) is not allowed, since that does not translate well into SQL and it would not have a clear meaning either.</font></p>
</li>
<li><p class="first"><font id="17"><strong>序列化/缓存(Pickling/Caching).</strong> </font><font id="18">See the following section for details of what is involved when <a class="reference internal" href="querysets.html#pickling-querysets">pickling QuerySets</a>. </font><font id="19">The important thing for the purposes of this section is that the results are read from the database.</font></p>
</li>
<li><p class="first"><font id="20"><strong>repr().</strong> </font><font id="21">A <tt class="docutils literal"><span class="pre">QuerySet</span></tt> is evaluated when you call <tt class="docutils literal"><span class="pre">repr()</span></tt> on it. </font><font id="22">This is for convenience in the Python interactive interpreter, so you can immediately see your results when using the API interactively.</font></p>
</li>
<li><p class="first"><font id="23"><strong>len().</strong> </font><font id="24">A <tt class="docutils literal"><span class="pre">QuerySet</span></tt> is evaluated when you call <tt class="docutils literal"><span class="pre">len()</span></tt> on it. </font><font id="25">This, as you might expect, returns the length of the result list.</font></p>
<p><font id="26">Note: If you only need to determine the number of records in the set (and don’t need the actual objects), it’s much more efficient to handle a count at the database level using SQL’s <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">COUNT(*)</span></tt>. </font><font id="27">Django provides a <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.count" title="django.db.models.query.QuerySet.count"><tt class="xref py py-meth docutils literal"><span class="pre">count()</span></tt></a> method for precisely this reason.</font></p>
</li>
<li><p class="first"><font id="28"><strong>list().</strong> </font><font id="29">Force evaluation of a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> by calling <tt class="docutils literal"><span class="pre">list()</span></tt> on it. </font><font id="30">For example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">entry_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
</pre></div>
</div>
</li>
<li><p class="first"><font id="31"><strong>bool().</strong> </font><font id="32">Testing a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> in a boolean context, such as using <tt class="docutils literal"><span class="pre">bool()</span></tt>, <tt class="docutils literal"><span class="pre">or</span></tt>, <tt class="docutils literal"><span class="pre">and</span></tt> or an <tt class="docutils literal"><span class="pre">if</span></tt> statement, will cause the query to be executed. </font><font id="33">If there is at least one result, the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> is <tt class="docutils literal"><span class="pre">True</span></tt>, otherwise <tt class="docutils literal"><span class="pre">False</span></tt>. </font><font id="34">For example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline</span><span class="o">=</span><span class="s">"Test"</span><span class="p">):</span>
   <span class="k">print</span><span class="p">(</span><span class="s">"There is at least one Entry with the headline Test"</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="35">Note: If you only want to determine if at least one result exists (and don’t need the actual objects), it’s more efficient to use <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.exists" title="django.db.models.query.QuerySet.exists"><tt class="xref py py-meth docutils literal"><span class="pre">exists()</span></tt></a>.</font></p>
</li>
</ul>
<div class="section" id="s-pickling-querysets">
<span id="s-id2"></span><span id="pickling-querysets"></span><span id="id2"></span><h3><font id="845">序列化 QuerySets</font><a class="headerlink" href="querysets.html#pickling-querysets" title="Permalink to this headline">¶</a></h3>
<p><font id="36">If you <a class="reference external" href="https://docs.python.org/3/library/pickle.html#module-pickle" title="(in Python v3.4)"><tt class="xref py py-mod docutils literal"><span class="pre">pickle</span></tt></a> a <tt class="docutils literal"><span class="pre">QuerySet</span></tt>, this will force all the results to be loaded into memory prior to pickling. </font><font id="37">Pickling is usually used as a precursor to caching and when the cached queryset is reloaded, you want the results to already be present and ready for use (reading from the database can take some time, defeating the purpose of caching). </font><font id="38">This means that when you unpickle a <tt class="docutils literal"><span class="pre">QuerySet</span></tt>, it contains the results at the moment it was pickled, rather than the results that are currently in the database.</font></p>
<p><font id="39">If you only want to pickle the necessary information to recreate the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> from the database at a later time, pickle the <tt class="docutils literal"><span class="pre">query</span></tt> attribute of the <tt class="docutils literal"><span class="pre">QuerySet</span></tt>. </font><font id="40">You can then recreate the original <tt class="docutils literal"><span class="pre">QuerySet</span></tt> (without any results loaded) using some code like this:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>     <span class="c"># Assuming 's' is the pickled string.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qs</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qs</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">query</span>            <span class="c"># Restore the original 'query'.</span>
</pre></div>
</div>
<p><font id="41">The <tt class="docutils literal"><span class="pre">query</span></tt> attribute is an opaque object. </font><font id="42">It represents the internals of the query construction and is not part of the public API. </font><font id="43">However, it is safe (and fully supported) to pickle and unpickle the attribute’s contents as described here.</font></p>
<div class="admonition-you-can-t-share-pickles-between-versions admonition">
<p class="first admonition-title"><font id="44">You can’t share pickles between versions</font></p>
<p><font id="45">Pickles of <tt class="docutils literal"><span class="pre">QuerySets</span></tt> are only valid for the version of Django that was used to generate them. </font><font id="46">If you generate a pickle using Django version N, there is no guarantee that pickle will be readable with Django version N+1. </font><font id="47">Pickles should not be used as part of a long-term archival strategy.</font></p>
<div class="versionadded">
<span class="title">New in Django 1.8.</span> </div>
<p class="last"><font id="48">Since pickle compatibility errors can be difficult to diagnose, such as silently corrupted objects, a <tt class="docutils literal"><span class="pre">RuntimeWarning</span></tt> is raised when you try to unpickle a queryset in a Django version that is different than the one in which it was pickled.</font></p>
</div>
</div>
</div>
<div class="section" id="s-queryset-api">
<span id="s-id3"></span><span id="queryset-api"></span><span id="id3"></span><h2><font id="843">QuerySet API</font><a class="headerlink" href="querysets.html#queryset-api" title="Permalink to this headline">¶</a></h2>
<p><font id="49">Here’s the formal declaration of a <tt class="docutils literal"><span class="pre">QuerySet</span></tt>:</font></p>
<dl class="class">
<dt id="django.db.models.query.QuerySet">
<em class="property">class </em><tt class="descname">QuerySet</tt>(<span class="optional">[</span><em>model=None</em>, <em>query=None</em>, <em>using=None</em><span class="optional">]</span>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/db/models/query.html#QuerySet"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="querysets.html#django.db.models.query.QuerySet" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="50">Usually when you’ll interact with a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> you’ll use it by <a class="reference internal" href="../../topics/db/queries.html#chaining-filters"><em>chaining filters</em></a>. </font><font id="51">To make this work, most <tt class="docutils literal"><span class="pre">QuerySet</span></tt> methods return new querysets. </font><font id="52">These methods are covered in detail later in this section.</font></p>
<p><font id="53">The <tt class="docutils literal"><span class="pre">QuerySet</span></tt> class has two public attributes you can use for introspection:</font></p>
<dl class="attribute">
<dt id="django.db.models.query.QuerySet.ordered">
<tt class="descname">ordered</tt><a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/db/models/query.html#QuerySet.ordered"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.ordered" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="54"><tt class="docutils literal"><span class="pre">True</span></tt> if the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> is ordered — i.e. has an <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.order_by" title="django.db.models.query.QuerySet.order_by"><tt class="xref py py-meth docutils literal"><span class="pre">order_by()</span></tt></a> clause or a default ordering on the model. </font><font id="55"><tt class="docutils literal"><span class="pre">False</span></tt> otherwise.</font></p>
</dd></dl>
<dl class="attribute">
<dt id="django.db.models.query.QuerySet.db">
<tt class="descname">db</tt><a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/db/models/query.html#QuerySet.db"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.db" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="56">The database that will be used if this query is executed now.</font></p>
</dd></dl>
<div class="admonition note">
<p class="first admonition-title"><font id="57">Note</font></p>
<p class="last"><font id="58">The <tt class="docutils literal"><span class="pre">query</span></tt> parameter to <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet" title="django.db.models.query.QuerySet"><tt class="xref py py-class docutils literal"><span class="pre">QuerySet</span></tt></a> exists so that specialized query subclasses such as <a class="reference internal" href="../contrib/gis/geoquerysets.html#django.contrib.gis.db.models.GeoQuerySet" title="django.contrib.gis.db.models.GeoQuerySet"><tt class="xref py py-class docutils literal"><span class="pre">GeoQuerySet</span></tt></a> can reconstruct internal query state. </font><font id="59">The value of the parameter is an opaque representation of that query state and is not part of a public API. </font><font id="60">To put it simply: if you need to ask, you don’t need to use it.</font></p>
</div>
</dd></dl>
<div class="section" id="s-methods-that-return-new-querysets">
<span id="methods-that-return-new-querysets"></span><h3><font id="846">返回新的QuerySets的方法</font><a class="headerlink" href="querysets.html#methods-that-return-new-querysets" title="Permalink to this headline">¶</a></h3>
<p><font id="61">Django 提供了一系列 的<tt class="docutils literal"><span class="pre">QuerySet</span></tt>筛选方法，用于改变 <tt class="docutils literal"><span class="pre">QuerySet</span></tt> 返回的结果类型或者执行SQL查询的方式。</font></p>
<div class="section" id="s-filter">
<span id="filter"></span><h4><font id="858">filter</font><a class="headerlink" href="querysets.html#filter" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.filter">
<tt class="descname">filter</tt>(<em>**kwargs</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.filter" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="62">Returns a new <tt class="docutils literal"><span class="pre">QuerySet</span></tt> containing objects that match the given lookup parameters.</font></p>
<p><font id="63">The lookup parameters (<tt class="docutils literal"><span class="pre">**kwargs</span></tt>) should be in the format described in <a class="reference internal" href="querysets.html#id4">Field lookups</a> below. </font><font id="64">Multiple parameters are joined via <tt class="docutils literal"><span class="pre">AND</span></tt> in the underlying SQL statement.</font></p>
<p><font id="65">If you need to execute more complex queries (for example, queries with <tt class="docutils literal"><span class="pre">OR</span></tt> statements), you can use <a class="reference internal" href="querysets.html#django.db.models.Q" title="django.db.models.Q"><tt class="xref py py-class docutils literal"><span class="pre">Q</span> <span class="pre">objects</span></tt></a>.</font></p>
</div>
<div class="section" id="s-exclude">
<span id="exclude"></span><h4><font id="859">exclude</font><a class="headerlink" href="querysets.html#exclude" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.exclude">
<tt class="descname">exclude</tt>(<em>**kwargs</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.exclude" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="66">Returns a new <tt class="docutils literal"><span class="pre">QuerySet</span></tt> containing objects that do <em>not</em> match the given lookup parameters.</font></p>
<p><font id="67">The lookup parameters (<tt class="docutils literal"><span class="pre">**kwargs</span></tt>) should be in the format described in <a class="reference internal" href="querysets.html#id4">Field lookups</a> below. </font><font id="68">Multiple parameters are joined via <tt class="docutils literal"><span class="pre">AND</span></tt> in the underlying SQL statement, and the whole thing is enclosed in a <tt class="docutils literal"><span class="pre">NOT()</span></tt>.</font></p>
<p><font id="69">This example excludes all entries whose <tt class="docutils literal"><span class="pre">pub_date</span></tt> is later than 2005-1-3 AND whose <tt class="docutils literal"><span class="pre">headline</span></tt> is “Hello”:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">pub_date__gt</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">headline</span><span class="o">=</span><span class="s">'Hello'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="70">In SQL terms, that evaluates to:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ...
WHERE NOT (pub_date &gt; '2005-1-3' AND headline = 'Hello')
</pre></div>
</div>
<p><font id="71">This example excludes all entries whose <tt class="docutils literal"><span class="pre">pub_date</span></tt> is later than 2005-1-3 OR whose headline is “Hello”:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">pub_date__gt</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">headline</span><span class="o">=</span><span class="s">'Hello'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="72">In SQL terms, that evaluates to:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ...
WHERE NOT pub_date &gt; '2005-1-3'
AND NOT headline = 'Hello'
</pre></div>
</div>
<p><font id="73">Note the second example is more restrictive.</font></p>
<p><font id="74">If you need to execute more complex queries (for example, queries with <tt class="docutils literal"><span class="pre">OR</span></tt> statements), you can use <a class="reference internal" href="querysets.html#django.db.models.Q" title="django.db.models.Q"><tt class="xref py py-class docutils literal"><span class="pre">Q</span> <span class="pre">objects</span></tt></a>.</font></p>
</div>
<div class="section" id="s-annotate">
<span id="annotate"></span><h4><font id="860">annotate</font><a class="headerlink" href="querysets.html#annotate" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.annotate">
<tt class="descname">annotate</tt>(<em>*args</em>, <em>**kwargs</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.annotate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="75">Annotates each object in the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> with the provided list of <a class="reference internal" href="expressions.html"><em>query expressions</em></a>. </font><font id="76">An expression may be a simple value, a reference to a field on the model (or any related models), or an aggregate expression (averages, sums, etc) that has been computed over the objects that are related to the objects in the <tt class="docutils literal"><span class="pre">QuerySet</span></tt>.</font></p>
<div class="versionadded">
<span class="title">New in Django 1.8:</span> <p><font id="77">Previous versions of Django only allowed aggregate functions to be used as annotations. </font><font id="78">It is now possible to annotate a model with all kinds of expressions.</font></p>
</div>
<p><font id="79">Each argument to <tt class="docutils literal"><span class="pre">annotate()</span></tt> is an annotation that will be added to each object in the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> that is returned.</font></p>
<p><font id="80">The aggregation functions that are provided by Django are described in <a class="reference internal" href="querysets.html#id5">Aggregation Functions</a> below.</font></p>
<p><font id="81">Annotations specified using keyword arguments will use the keyword as the alias for the annotation. </font><font id="82">Anonymous arguments will have an alias generated for them based upon the name of the aggregate function and the model field that is being aggregated. </font><font id="83">Only aggregate expressions that reference a single field can be anonymous arguments. </font><font id="84">Everything else must be a keyword argument.</font></p>
<p><font id="85">For example, if you were manipulating a list of blogs, you may want to determine how many entries have been made in each blog:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Count</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">Count</span><span class="p">(</span><span class="s">'entry'</span><span class="p">))</span>
<span class="go"># The name of the first blog</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="go">'Blogasaurus'</span>
<span class="go"># The number of entries on the first blog</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">entry__count</span>
<span class="go">42</span>
</pre></div>
</div>
<p><font id="86">The <tt class="docutils literal"><span class="pre">Blog</span></tt> model doesn’t define an <tt class="docutils literal"><span class="pre">entry__count</span></tt> attribute by itself, but by using a keyword argument to specify the aggregate function, you can control the name of the annotation:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">number_of_entries</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">'entry'</span><span class="p">))</span>
<span class="go"># The number of entries on the first blog, using the name provided</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">number_of_entries</span>
<span class="go">42</span>
</pre></div>
</div>
<p><font id="87">For an in-depth discussion of aggregation, see <a class="reference internal" href="../../topics/db/aggregation.html"><em>the topic guide on Aggregation</em></a>.</font></p>
</div>
<div class="section" id="s-order-by">
<span id="order-by"></span><h4><font id="861">order_by</font><a class="headerlink" href="querysets.html#order-by" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.order_by">
<tt class="descname">order_by</tt>(<em>*fields</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.order_by" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="88">By default, results returned by a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> are ordered by the ordering tuple given by the <tt class="docutils literal"><span class="pre">ordering</span></tt> option in the model’s <tt class="docutils literal"><span class="pre">Meta</span></tt>. </font><font id="89">You can override this on a per-<tt class="docutils literal"><span class="pre">QuerySet</span></tt> basis by using the <tt class="docutils literal"><span class="pre">order_by</span></tt> method.</font></p>
<p><font id="90">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__year</span><span class="o">=</span><span class="mi">2005</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-pub_date'</span><span class="p">,</span> <span class="s">'headline'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="91">The result above will be ordered by <tt class="docutils literal"><span class="pre">pub_date</span></tt> descending, then by <tt class="docutils literal"><span class="pre">headline</span></tt> ascending. </font><font id="1046">Ascending order is implied. To order randomly, use <tt class="docutils literal"><span class="pre">"?"</span></tt>, like so:</font><font id="1047">Each <tt class="docutils literal"><span class="pre">datetime.date</span></tt> object in the result list is “truncated” to the given <tt class="docutils literal"><span class="pre">type</span></tt>.</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'?'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="92">Note: <tt class="docutils literal"><span class="pre">order_by('?')</span></tt> queries may be expensive and slow, depending on the database backend you’re using.</font></p>
<p><font id="93">To order by a field in a different model, use the same syntax as when you are querying across model relations. </font><font id="94">That is, the name of the field, followed by a double underscore (<tt class="docutils literal"><span class="pre">__</span></tt>), followed by the name of the field in the new model, and so on for as many models as you want to join. </font><font id="95">For example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'blog__name'</span><span class="p">,</span> <span class="s">'headline'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="96">If you try to order by a field that is a relation to another model, Django will use the default ordering on the related model, or order by the related model’s primary key if there is no <a class="reference internal" href="options.html#django.db.models.Options.ordering" title="django.db.models.Options.ordering"><tt class="xref py py-attr docutils literal"><span class="pre">Meta.ordering</span></tt></a> specified. </font><font id="97">For example, since the <tt class="docutils literal"><span class="pre">Blog</span></tt> model has no default ordering specified:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'blog'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="98">...is identical to:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'blog__id'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="99">If <tt class="docutils literal"><span class="pre">Blog</span></tt> had <tt class="docutils literal"><span class="pre">ordering</span> <span class="pre">=</span> <span class="pre">['name']</span></tt>, then the first queryset would be identical to:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'blog__name'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="100">It is also possible to order a queryset by a related field, without incurring the cost of a JOIN, by referring to the <tt class="docutils literal"><span class="pre">_id</span></tt> of the related field:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># No Join</span>
<span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'blog_id'</span><span class="p">)</span>

<span class="c"># Join</span>
<span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'blog__id'</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<span class="title">New in Django 1.7:</span> <p><font id="101">The ability to order a queryset by a related field, without incurring the cost of a JOIN was added.</font></p>
</div>
<p><font id="102">You can also order by <a class="reference internal" href="expressions.html"><em>query expressions</em></a> by calling <tt class="docutils literal"><span class="pre">asc()</span></tt> or <tt class="docutils literal"><span class="pre">desc()</span></tt> on the expression:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Coalesce</span><span class="p">(</span><span class="s">'summary'</span><span class="p">,</span> <span class="s">'headline'</span><span class="p">)</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span>
</pre></div>
</div>
<div class="versionadded">
<span class="title">New in Django 1.8:</span> <p><font id="103">Ordering by query expressions was added.</font></p>
</div>
<p><font id="104">Be cautious when ordering by fields in related models if you are also using <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.distinct" title="django.db.models.query.QuerySet.distinct"><tt class="xref py py-meth docutils literal"><span class="pre">distinct()</span></tt></a>. </font><font id="105">See the note in <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.distinct" title="django.db.models.query.QuerySet.distinct"><tt class="xref py py-meth docutils literal"><span class="pre">distinct()</span></tt></a> for an explanation of how related model ordering can change the expected results.</font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="106">Note</font></p>
<p><font id="107">It is permissible to specify a multi-valued field to order the results by (for example, a <a class="reference internal" href="fields.html#django.db.models.ManyToManyField" title="django.db.models.ManyToManyField"><tt class="xref py py-class docutils literal"><span class="pre">ManyToManyField</span></tt></a> field, or the reverse relation of a <a class="reference internal" href="fields.html#django.db.models.ForeignKey" title="django.db.models.ForeignKey"><tt class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></tt></a> field).</font></p>
<p><font id="108">Consider this case:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Event</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
   <span class="n">parent</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">'self'</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'children'</span><span class="p">)</span>
   <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>

<span class="n">Event</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'children__date'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="109">Here, there could potentially be multiple ordering data for each <tt class="docutils literal"><span class="pre">Event</span></tt>; </font><font id="110">each <tt class="docutils literal"><span class="pre">Event</span></tt> with multiple <tt class="docutils literal"><span class="pre">children</span></tt> will be returned multiple times into the new <tt class="docutils literal"><span class="pre">QuerySet</span></tt> that <tt class="docutils literal"><span class="pre">order_by()</span></tt> creates. </font><font id="111">In other words, using <tt class="docutils literal"><span class="pre">order_by()</span></tt> on the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> could return more items than you were working on to begin with - which is probably neither expected nor useful.</font></p>
<p class="last"><font id="112">Thus, take care when using multi-valued field to order the results. </font><font id="113"><strong>If</strong> you can be sure that there will only be one ordering piece of data for each of the items you’re ordering, this approach should not present problems. </font><font id="114">If not, make sure the results are what you expect.</font></p>
</div>
<p><font id="115">There’s no way to specify whether ordering should be case sensitive. </font><font id="116">With respect to case-sensitivity, Django will order results however your database backend normally orders them.</font></p>
<p><font id="117">You can order by a field converted to lowercase with <a class="reference internal" href="database-functions.html#django.db.models.functions.Lower" title="django.db.models.functions.Lower"><tt class="xref py py-class docutils literal"><span class="pre">Lower</span></tt></a> which will achieve case-consistent ordering:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Lower</span><span class="p">(</span><span class="s">'headline'</span><span class="p">)</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span>
</pre></div>
</div>
<div class="versionadded">
<span class="title">New in Django 1.8:</span> <p><font id="118">The ability to order by expressions like <tt class="docutils literal"><span class="pre">Lower</span></tt> was added.</font></p>
</div>
<p><font id="119">If you don’t want any ordering to be applied to a query, not even the default ordering, call <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.order_by" title="django.db.models.query.QuerySet.order_by"><tt class="xref py py-meth docutils literal"><span class="pre">order_by()</span></tt></a> with no parameters.</font></p>
<p><font id="120">You can tell if a query is ordered or not by checking the <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.ordered" title="django.db.models.query.QuerySet.ordered"><tt class="xref py py-attr docutils literal"><span class="pre">QuerySet.ordered</span></tt></a> attribute, which will be <tt class="docutils literal"><span class="pre">True</span></tt> if the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> has been ordered in any way.</font></p>
<p><font id="121">Each <tt class="docutils literal"><span class="pre">order_by()</span></tt> call will clear any previous ordering. </font><font id="122">For example, this query will be ordered by <tt class="docutils literal"><span class="pre">pub_date</span></tt> and not <tt class="docutils literal"><span class="pre">headline</span></tt>:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'headline'</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'pub_date'</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title"><font id="123">Warning</font></p>
<p class="last"><font id="124">Ordering is not a free operation. </font><font id="125">Each field you add to the ordering incurs a cost to your database. </font><font id="126">Each foreign key you add will implicitly include all of its default orderings as well.</font></p>
</div>
</div>
<div class="section" id="s-reverse">
<span id="reverse"></span><h4><font id="862">reverse</font><a class="headerlink" href="querysets.html#reverse" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.reverse">
<tt class="descname">reverse</tt>()<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.reverse" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="127">Use the <tt class="docutils literal"><span class="pre">reverse()</span></tt> method to reverse the order in which a queryset’s elements are returned. </font><font id="128">Calling <tt class="docutils literal"><span class="pre">reverse()</span></tt> a second time restores the ordering back to the normal direction.</font></p>
<p><font id="129">To retrieve the “last” five items in a queryset, you could do this:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">my_queryset</span><span class="o">.</span><span class="n">reverse</span><span class="p">()[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
<p><font id="130">Note that this is not quite the same as slicing from the end of a sequence in Python. </font><font id="131">The above example will return the last item first, then the penultimate item and so on. </font><font id="132">If we had a Python sequence and looked at <tt class="docutils literal"><span class="pre">seq[-5:]</span></tt>, we would see the fifth-last item first. </font><font id="133">Django doesn’t support that mode of access (slicing from the end), because it’s not possible to do it efficiently in SQL.</font></p>
<p><font id="134">Also, note that <tt class="docutils literal"><span class="pre">reverse()</span></tt> should generally only be called on a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> which has a defined ordering (e.g., when querying against a model which defines a default ordering, or when using <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.order_by" title="django.db.models.query.QuerySet.order_by"><tt class="xref py py-meth docutils literal"><span class="pre">order_by()</span></tt></a>). </font><font id="135">If no such ordering is defined for a given <tt class="docutils literal"><span class="pre">QuerySet</span></tt>, calling <tt class="docutils literal"><span class="pre">reverse()</span></tt> on it has no real effect (the ordering was undefined prior to calling <tt class="docutils literal"><span class="pre">reverse()</span></tt>, and will remain undefined afterward).</font></p>
</div>
<div class="section" id="s-distinct">
<span id="distinct"></span><h4><font id="863">distinct</font><a class="headerlink" href="querysets.html#distinct" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.distinct">
<tt class="descname">distinct</tt>(<span class="optional">[</span><em>*fields</em><span class="optional">]</span>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.distinct" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="136">Returns a new <tt class="docutils literal"><span class="pre">QuerySet</span></tt> that uses <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">DISTINCT</span></tt> in its SQL query. </font><font id="137">This eliminates duplicate rows from the query results.</font></p>
<p><font id="138">By default, a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> will not eliminate duplicate rows. </font><font id="139">In practice, this is rarely a problem, because simple queries such as <tt class="docutils literal"><span class="pre">Blog.objects.all()</span></tt> don’t introduce the possibility of duplicate result rows. </font><font id="140">However, if your query spans multiple tables, it’s possible to get duplicate results when a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> is evaluated. </font><font id="141">That’s when you’d use <tt class="docutils literal"><span class="pre">distinct()</span></tt>.</font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="142">Note</font></p>
<p><font id="143">Any fields used in an <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.order_by" title="django.db.models.query.QuerySet.order_by"><tt class="xref py py-meth docutils literal"><span class="pre">order_by()</span></tt></a> call are included in the SQL <tt class="docutils literal"><span class="pre">SELECT</span></tt> columns. </font><font id="144">This can sometimes lead to unexpected results when used in conjunction with <tt class="docutils literal"><span class="pre">distinct()</span></tt>. </font><font id="145">If you order by fields from a related model, those fields will be added to the selected columns and they may make otherwise duplicate rows appear to be distinct. </font><font id="146">Since the extra columns don’t appear in the returned results (they are only there to support ordering), it sometimes looks like non-distinct results are being returned.</font></p>
<p><font id="147">Similarly, if you use a <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.values" title="django.db.models.query.QuerySet.values"><tt class="xref py py-meth docutils literal"><span class="pre">values()</span></tt></a> query to restrict the columns selected, the columns used in any <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.order_by" title="django.db.models.query.QuerySet.order_by"><tt class="xref py py-meth docutils literal"><span class="pre">order_by()</span></tt></a> (or default model ordering) will still be involved and may affect uniqueness of the results.</font></p>
<p class="last"><font id="148">The moral here is that if you are using <tt class="docutils literal"><span class="pre">distinct()</span></tt> be careful about ordering by related models. </font><font id="149">Similarly, when using <tt class="docutils literal"><span class="pre">distinct()</span></tt> and <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.values" title="django.db.models.query.QuerySet.values"><tt class="xref py py-meth docutils literal"><span class="pre">values()</span></tt></a> together, be careful when ordering by fields not in the <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.values" title="django.db.models.query.QuerySet.values"><tt class="xref py py-meth docutils literal"><span class="pre">values()</span></tt></a> call.</font></p>
</div>
<p><font id="150">On PostgreSQL only, you can pass positional arguments (<tt class="docutils literal"><span class="pre">*fields</span></tt>) in order to specify the names of fields to which the <tt class="docutils literal"><span class="pre">DISTINCT</span></tt> should apply. </font><font id="151">This translates to a <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">DISTINCT</span> <span class="pre">ON</span></tt> SQL query. </font><font id="152">Here’s the difference. </font><font id="153">For a normal <tt class="docutils literal"><span class="pre">distinct()</span></tt> call, the database compares <em>each</em> field in each row when determining which rows are distinct. </font><font id="154">For a <tt class="docutils literal"><span class="pre">distinct()</span></tt> call with specified field names, the database will only compare the specified field names.</font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="155">Note</font></p>
<p><font id="156">When you specify field names, you <em>must</em> provide an <tt class="docutils literal"><span class="pre">order_by()</span></tt> in the <tt class="docutils literal"><span class="pre">QuerySet</span></tt>, and the fields in <tt class="docutils literal"><span class="pre">order_by()</span></tt> must start with the fields in <tt class="docutils literal"><span class="pre">distinct()</span></tt>, in the same order.</font></p>
<p class="last"><font id="157">For example, <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">DISTINCT</span> <span class="pre">ON</span> <span class="pre">(a)</span></tt> gives you the first row for each value in column <tt class="docutils literal"><span class="pre">a</span></tt>. </font><font id="158">If you don’t specify an order, you’ll get some arbitrary row.</font></p>
</div>
<p><font id="159">Examples (those after the first will only work on PostgreSQL):</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
<span class="go">[...]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'pub_date'</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">'pub_date'</span><span class="p">)</span>
<span class="go">[...]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'blog'</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">'blog'</span><span class="p">)</span>
<span class="go">[...]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'author'</span><span class="p">,</span> <span class="s">'pub_date'</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">'author'</span><span class="p">,</span> <span class="s">'pub_date'</span><span class="p">)</span>
<span class="go">[...]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'blog__name'</span><span class="p">,</span> <span class="s">'mod_date'</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">'blog__name'</span><span class="p">,</span> <span class="s">'mod_date'</span><span class="p">)</span>
<span class="go">[...]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'author'</span><span class="p">,</span> <span class="s">'pub_date'</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">'author'</span><span class="p">)</span>
<span class="go">[...]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title"><font id="160">Note</font></p>
<p><font id="161">Keep in mind that <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.order_by" title="django.db.models.query.QuerySet.order_by"><tt class="xref py py-meth docutils literal"><span class="pre">order_by()</span></tt></a> uses any default related model ordering that has been defined. </font><font id="162">You might have to explicitly order by the relation <tt class="docutils literal"><span class="pre">_id</span></tt> or referenced field to make sure the <tt class="docutils literal"><span class="pre">DISTINCT</span> <span class="pre">ON</span></tt> expressions match those at the beginning of the <tt class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></tt> clause. </font><font id="163">For example, if the <tt class="docutils literal"><span class="pre">Blog</span></tt> model defined an <a class="reference internal" href="options.html#django.db.models.Options.ordering" title="django.db.models.Options.ordering"><tt class="xref py py-attr docutils literal"><span class="pre">ordering</span></tt></a> by <tt class="docutils literal"><span class="pre">name</span></tt>:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'blog'</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">'blog'</span><span class="p">)</span>
</pre></div>
</div>
<p class="last"><font id="164">...wouldn’t work because the query would be ordered by <tt class="docutils literal"><span class="pre">blog__name</span></tt> thus mismatching the <tt class="docutils literal"><span class="pre">DISTINCT</span> <span class="pre">ON</span></tt> expression. </font><font id="165">You’d have to explicitly order by the relation <cite>_id</cite> field (<tt class="docutils literal"><span class="pre">blog_id</span></tt> in this case) or the referenced one (<tt class="docutils literal"><span class="pre">blog__pk</span></tt>) to make sure both expressions match.</font></p>
</div>
</div>
<div class="section" id="s-values">
<span id="values"></span><h4><font id="864">values</font><a class="headerlink" href="querysets.html#values" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.values">
<tt class="descname">values</tt>(<em>*fields</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.values" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="166">Returns a <tt class="docutils literal"><span class="pre">ValuesQuerySet</span></tt> — a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> subclass that returns dictionaries when used as an iterable, rather than model-instance objects.</font></p>
<p><font id="167">Each of those dictionaries represents an object, with the keys corresponding to the attribute names of model objects.</font></p>
<p><font id="168">This example compares the dictionaries of <tt class="docutils literal"><span class="pre">values()</span></tt> with the normal model objects:</font></p>
<div class="highlight-python"><div class="highlight"><pre># This list contains a Blog object.
&gt;&gt;&gt; Blog.objects.filter(name__startswith='Beatles')
[&lt;Blog: Beatles Blog&gt;]

# This list contains a dictionary.
&gt;&gt;&gt; Blog.objects.filter(name__startswith='Beatles').values()
[{'id': 1, 'name': 'Beatles Blog', 'tagline': 'All the latest Beatles news.'}]
</pre></div>
</div>
<p><font id="169">The <tt class="docutils literal"><span class="pre">values()</span></tt> method takes optional positional arguments, <tt class="docutils literal"><span class="pre">*fields</span></tt>, which specify field names to which the <tt class="docutils literal"><span class="pre">SELECT</span></tt> should be limited. </font><font id="170">If you specify the fields, each dictionary will contain only the field keys/values for the fields you specify. </font><font id="171">If you don’t specify the fields, each dictionary will contain a key and value for every field in the database table.</font></p>
<p><font id="172">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="go">[{'id': 1, 'name': 'Beatles Blog', 'tagline': 'All the latest Beatles news.'}],</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">)</span>
<span class="go">[{'id': 1, 'name': 'Beatles Blog'}]</span>
</pre></div>
</div>
<p><font id="173">A few subtleties that are worth mentioning:</font></p>
<ul>
<li><p class="first"><font id="174">If you have a field called <tt class="docutils literal"><span class="pre">foo</span></tt> that is a <a class="reference internal" href="fields.html#django.db.models.ForeignKey" title="django.db.models.ForeignKey"><tt class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></tt></a>, the default <tt class="docutils literal"><span class="pre">values()</span></tt> call will return a dictionary key called <tt class="docutils literal"><span class="pre">foo_id</span></tt>, since this is the name of the hidden model attribute that stores the actual value (the <tt class="docutils literal"><span class="pre">foo</span></tt> attribute refers to the related model). </font><font id="175">When you are calling <tt class="docutils literal"><span class="pre">values()</span></tt> and passing in field names, you can pass in either <tt class="docutils literal"><span class="pre">foo</span></tt> or <tt class="docutils literal"><span class="pre">foo_id</span></tt> and you will get back the same thing (the dictionary key will match the field name you passed in).</font></p>
<p><font id="176">For example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="go">[{'blog_id': 1, 'headline': 'First Entry', ...}, ...]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">'blog'</span><span class="p">)</span>
<span class="go">[{'blog': 1}, ...]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">'blog_id'</span><span class="p">)</span>
<span class="go">[{'blog_id': 1}, ...]</span>
</pre></div>
</div>
</li>
<li><p class="first"><font id="177">When using <tt class="docutils literal"><span class="pre">values()</span></tt> together with <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.distinct" title="django.db.models.query.QuerySet.distinct"><tt class="xref py py-meth docutils literal"><span class="pre">distinct()</span></tt></a>, be aware that ordering can affect the results. </font><font id="178">See the note in <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.distinct" title="django.db.models.query.QuerySet.distinct"><tt class="xref py py-meth docutils literal"><span class="pre">distinct()</span></tt></a> for details.</font></p>
</li>
<li><p class="first"><font id="179">If you use a <tt class="docutils literal"><span class="pre">values()</span></tt> clause after an <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.extra" title="django.db.models.query.QuerySet.extra"><tt class="xref py py-meth docutils literal"><span class="pre">extra()</span></tt></a> call, any fields defined by a <tt class="docutils literal"><span class="pre">select</span></tt> argument in the <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.extra" title="django.db.models.query.QuerySet.extra"><tt class="xref py py-meth docutils literal"><span class="pre">extra()</span></tt></a> must be explicitly included in the <tt class="docutils literal"><span class="pre">values()</span></tt> call. </font><font id="180">Any <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.extra" title="django.db.models.query.QuerySet.extra"><tt class="xref py py-meth docutils literal"><span class="pre">extra()</span></tt></a> call made after a <tt class="docutils literal"><span class="pre">values()</span></tt> call will have its extra selected fields ignored.</font></p>
</li>
<li><p class="first"><font id="181">Calling <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.only" title="django.db.models.query.QuerySet.only"><tt class="xref py py-meth docutils literal"><span class="pre">only()</span></tt></a> and <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.defer" title="django.db.models.query.QuerySet.defer"><tt class="xref py py-meth docutils literal"><span class="pre">defer()</span></tt></a> after <tt class="docutils literal"><span class="pre">values()</span></tt> doesn’t make sense, so doing so will raise a <tt class="docutils literal"><span class="pre">NotImplementedError</span></tt>.</font></p>
</li>
</ul>
<div class="versionadded">
<span class="title">New in Django 1.7:</span> <p><font id="182">The last point above is new. </font><font id="183">Previously, calling <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.only" title="django.db.models.query.QuerySet.only"><tt class="xref py py-meth docutils literal"><span class="pre">only()</span></tt></a> and <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.defer" title="django.db.models.query.QuerySet.defer"><tt class="xref py py-meth docutils literal"><span class="pre">defer()</span></tt></a> after <tt class="docutils literal"><span class="pre">values()</span></tt> was allowed, but it either crashed or returned incorrect results.</font></p>
</div>
<p><font id="184">A <tt class="docutils literal"><span class="pre">ValuesQuerySet</span></tt> is useful when you know you’re only going to need values from a small number of the available fields and you won’t need the functionality of a model instance object. </font><font id="185">It’s more efficient to select only the fields you need to use.</font></p>
<p><font id="186">Finally, note that a <tt class="docutils literal"><span class="pre">ValuesQuerySet</span></tt> is a subclass of <tt class="docutils literal"><span class="pre">QuerySet</span></tt> and it implements most of the same methods. </font><font id="187">You can call <tt class="docutils literal"><span class="pre">filter()</span></tt> on it, <tt class="docutils literal"><span class="pre">order_by()</span></tt>, etc. </font><font id="188">That means that these two calls are identical:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span>
<span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="189">The people who made Django prefer to put all the SQL-affecting methods first, followed (optionally) by any output-affecting methods (such as <tt class="docutils literal"><span class="pre">values()</span></tt>), but it doesn’t really matter. </font><font id="190">This is your chance to really flaunt your individualism.</font></p>
<p><font id="191">You can also refer to fields on related models with reverse relations through <tt class="docutils literal"><span class="pre">OneToOneField</span></tt>, <tt class="docutils literal"><span class="pre">ForeignKey</span></tt> and <tt class="docutils literal"><span class="pre">ManyToManyField</span></tt> attributes:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'entry__headline'</span><span class="p">)</span>
<span class="p">[{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'My blog'</span><span class="p">,</span> <span class="s">'entry__headline'</span><span class="p">:</span> <span class="s">'An entry'</span><span class="p">},</span>
     <span class="p">{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'My blog'</span><span class="p">,</span> <span class="s">'entry__headline'</span><span class="p">:</span> <span class="s">'Another entry'</span><span class="p">},</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title"><font id="192">Warning</font></p>
<p class="last"><font id="193">Because <a class="reference internal" href="fields.html#django.db.models.ManyToManyField" title="django.db.models.ManyToManyField"><tt class="xref py py-class docutils literal"><span class="pre">ManyToManyField</span></tt></a> attributes and reverse relations can have multiple related rows, including these can have a multiplier effect on the size of your result set. </font><font id="194">This will be especially pronounced if you include multiple such fields in your <tt class="docutils literal"><span class="pre">values()</span></tt> query, in which case all possible combinations will be returned.</font></p>
</div>
</div>
<div class="section" id="s-values-list">
<span id="values-list"></span><h4><font id="865">values_list</font><a class="headerlink" href="querysets.html#values-list" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.values_list">
<tt class="descname">values_list</tt>(<em>*fields</em>, <em>flat=False</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.values_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="195">This is similar to <tt class="docutils literal"><span class="pre">values()</span></tt> except that instead of returning dictionaries, it returns tuples when iterated over. </font><font id="196">Each tuple contains the value from the respective field passed into the <tt class="docutils literal"><span class="pre">values_list()</span></tt> call — so the first item is the first field, etc. </font><font id="197">For example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'headline'</span><span class="p">)</span>
<span class="go">[(1, 'First entry'), ...]</span>
</pre></div>
</div>
<p><font id="198">If you only pass in a single field, you can also pass in the <tt class="docutils literal"><span class="pre">flat</span></tt> parameter. </font><font id="199">If <tt class="docutils literal"><span class="pre">True</span></tt>, this will mean the returned results are single values, rather than one-tuples. </font><font id="200">An example should make the difference clearer:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span>
<span class="go">[(1,), (2,), (3,), ...]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span>
<span class="go">[1, 2, 3, ...]</span>
</pre></div>
</div>
<p><font id="201">It is an error to pass in <tt class="docutils literal"><span class="pre">flat</span></tt> when there is more than one field.</font></p>
<p><font id="202">If you don’t pass any values to <tt class="docutils literal"><span class="pre">values_list()</span></tt>, it will return all the fields in the model, in the order they were declared.</font></p>
<p><font id="203">Note that this method returns a <tt class="docutils literal"><span class="pre">ValuesListQuerySet</span></tt>. </font><font id="204">This class behaves like a list. </font><font id="205">Most of the time this is enough, but if you require an actual Python list object, you can simply call <tt class="docutils literal"><span class="pre">list()</span></tt> on it, which will evaluate the queryset.</font></p>
</div>
<div class="section" id="s-dates">
<span id="dates"></span><h4><font id="866">dates</font><a class="headerlink" href="querysets.html#dates" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.dates">
<tt class="descname">dates</tt>(<em>field</em>, <em>kind</em>, <em>order='ASC'</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.dates" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="206">Returns a <tt class="docutils literal"><span class="pre">DateQuerySet</span></tt> — a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> that evaluates to a list of <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">datetime.date</span></tt></a> objects representing all available dates of a particular kind within the contents of the <tt class="docutils literal"><span class="pre">QuerySet</span></tt>.</font></p>
<p><font id="207"><tt class="docutils literal"><span class="pre">field</span></tt> should be the name of a <tt class="docutils literal"><span class="pre">DateField</span></tt> of your model. <tt class="docutils literal"><span class="pre">kind</span></tt> should be either <tt class="docutils literal"><span class="pre">"year"</span></tt>, <tt class="docutils literal"><span class="pre">"month"</span></tt> or <tt class="docutils literal"><span class="pre">"day"</span></tt>. </font><font id="1047">Each <tt class="docutils literal"><span class="pre">datetime.date</span></tt> object in the result list is “truncated” to the given <tt class="docutils literal"><span class="pre">type</span></tt>.</font></p>
<ul class="simple">
<li><font id="930"><tt class="docutils literal"><span class="pre">"year"</span></tt> returns a list of all distinct year values for the field.</font></li>
<li><font id="931"><tt class="docutils literal"><span class="pre">"month"</span></tt> returns a list of all distinct year/month values for the field.</font></li>
<li><font id="932"><tt class="docutils literal"><span class="pre">"day"</span></tt> returns a list of all distinct year/month/day values for the field.</font></li>
</ul>
<p><font id="208"><tt class="docutils literal"><span class="pre">order</span></tt>, which defaults to <tt class="docutils literal"><span class="pre">'ASC'</span></tt>, should be either <tt class="docutils literal"><span class="pre">'ASC'</span></tt> or <tt class="docutils literal"><span class="pre">'DESC'</span></tt>. </font><font id="209">This specifies how to order the results.</font></p>
<p><font id="210">Examples:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">dates</span><span class="p">(</span><span class="s">'pub_date'</span><span class="p">,</span> <span class="s">'year'</span><span class="p">)</span>
<span class="go">[datetime.date(2005, 1, 1)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">dates</span><span class="p">(</span><span class="s">'pub_date'</span><span class="p">,</span> <span class="s">'month'</span><span class="p">)</span>
<span class="go">[datetime.date(2005, 2, 1), datetime.date(2005, 3, 1)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">dates</span><span class="p">(</span><span class="s">'pub_date'</span><span class="p">,</span> <span class="s">'day'</span><span class="p">)</span>
<span class="go">[datetime.date(2005, 2, 20), datetime.date(2005, 3, 20)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">dates</span><span class="p">(</span><span class="s">'pub_date'</span><span class="p">,</span> <span class="s">'day'</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s">'DESC'</span><span class="p">)</span>
<span class="go">[datetime.date(2005, 3, 20), datetime.date(2005, 2, 20)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__contains</span><span class="o">=</span><span class="s">'Lennon'</span><span class="p">)</span><span class="o">.</span><span class="n">dates</span><span class="p">(</span><span class="s">'pub_date'</span><span class="p">,</span> <span class="s">'day'</span><span class="p">)</span>
<span class="go">[datetime.date(2005, 3, 20)]</span>
</pre></div>
</div>
</div>
<div class="section" id="s-datetimes">
<span id="datetimes"></span><h4><font id="867">datetimes</font><a class="headerlink" href="querysets.html#datetimes" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.datetimes">
<tt class="descname">datetimes</tt>(<em>field_name</em>, <em>kind</em>, <em>order='ASC'</em>, <em>tzinfo=None</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.datetimes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="211">Returns a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> that evaluates to a list of <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">datetime.datetime</span></tt></a> objects representing all available dates of a particular kind within the contents of the <tt class="docutils literal"><span class="pre">QuerySet</span></tt>.</font></p>
<p><font id="212"><tt class="docutils literal"><span class="pre">field_name</span></tt> should be the name of a <tt class="docutils literal"><span class="pre">DateTimeField</span></tt> of your model.</font></p>
<p><font id="213"><tt class="docutils literal"><span class="pre">kind</span></tt> should be either <tt class="docutils literal"><span class="pre">"year"</span></tt>, <tt class="docutils literal"><span class="pre">"month"</span></tt>, <tt class="docutils literal"><span class="pre">"day"</span></tt>, <tt class="docutils literal"><span class="pre">"hour"</span></tt>, <tt class="docutils literal"><span class="pre">"minute"</span></tt> or <tt class="docutils literal"><span class="pre">"second"</span></tt>. </font><font id="1048">Each <tt class="docutils literal"><span class="pre">datetime.datetime</span></tt> object in the result list is “truncated” to the given <tt class="docutils literal"><span class="pre">type</span></tt>.</font></p>
<p><font id="214"><tt class="docutils literal"><span class="pre">order</span></tt>, which defaults to <tt class="docutils literal"><span class="pre">'ASC'</span></tt>, should be either <tt class="docutils literal"><span class="pre">'ASC'</span></tt> or <tt class="docutils literal"><span class="pre">'DESC'</span></tt>. </font><font id="215">This specifies how to order the results.</font></p>
<p><font id="216"><tt class="docutils literal"><span class="pre">tzinfo</span></tt> defines the time zone to which datetimes are converted prior to truncation. </font><font id="217">Indeed, a given datetime has different representations depending on the time zone in use. </font><font id="218">This parameter must be a <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.tzinfo" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">datetime.tzinfo</span></tt></a> object. </font><font id="219">If it’s <tt class="docutils literal"><span class="pre">None</span></tt>, Django uses the <a class="reference internal" href="../../topics/i18n/timezones.html#default-current-time-zone"><em>current time zone</em></a>. </font><font id="220">It has no effect when <a class="reference internal" href="../settings.html#std:setting-USE_TZ"><tt class="xref std std-setting docutils literal"><span class="pre">USE_TZ</span></tt></a> is <tt class="docutils literal"><span class="pre">False</span></tt>.</font></p>
<div class="admonition note" id="database-time-zone-definitions">
<p class="first admonition-title"><font id="221">Note</font></p>
<p><font id="222">This function performs time zone conversions directly in the database. </font><font id="223">As a consequence, your database must be able to interpret the value of <tt class="docutils literal"><span class="pre">tzinfo.tzname(None)</span></tt>. </font><font id="224">This translates into the following requirements:</font></p>
<ul class="last simple">
<li><font id="933">SQLite: install <a class="reference external" href="http://pytz.sourceforge.net/">pytz</a> — conversions are actually performed in Python.</font></li>
<li><font id="934">PostgreSQL: no requirements (see <a class="reference external" href="http://www.postgresql.org/docs/current/static/datatype-datetime.html#DATATYPE-TIMEZONES">Time Zones</a>).</font></li>
<li><font id="935">Oracle: no requirements (see <a class="reference external" href="http://docs.oracle.com/cd/B19306_01/server.102/b14225/ch4datetime.htm#i1006667">Choosing a Time Zone File</a>).</font></li>
<li><font id="936">MySQL: install <a class="reference external" href="http://pytz.sourceforge.net/">pytz</a> and load the time zone tables with <a class="reference external" href="http://dev.mysql.com/doc/refman/5.6/en/mysql-tzinfo-to-sql.html">mysql_tzinfo_to_sql</a>.</font></li>
</ul>
</div>
</div>
<div class="section" id="s-none">
<span id="none"></span><h4><font id="868">none</font><a class="headerlink" href="querysets.html#none" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.none">
<tt class="descname">none</tt>()<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.none" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="225">Calling none() will create a queryset that never returns any objects and no query will be executed when accessing the results. </font><font id="226">A qs.none() queryset is an instance of <tt class="docutils literal"><span class="pre">EmptyQuerySet</span></tt>.</font></p>
<p><font id="227">Examples:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.db.models.query</span> <span class="kn">import</span> <span class="n">EmptyQuerySet</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">(),</span> <span class="n">EmptyQuerySet</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="s-all">
<span id="all"></span><h4><font id="869">all</font><a class="headerlink" href="querysets.html#all" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.all">
<tt class="descname">all</tt>()<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.all" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="228">Returns a <em>copy</em> of the current <tt class="docutils literal"><span class="pre">QuerySet</span></tt> (or <tt class="docutils literal"><span class="pre">QuerySet</span></tt> subclass). </font><font id="229">This can be useful in situations where you might want to pass in either a model manager or a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> and do further filtering on the result. </font><font id="230">After calling <tt class="docutils literal"><span class="pre">all()</span></tt> on either object, you’ll definitely have a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> to work with.</font></p>
<p><font id="231">When a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> is <a class="reference internal" href="querysets.html#when-querysets-are-evaluated"><em>evaluated</em></a>, it typically caches its results. </font><font id="232">If the data in the database might have changed since a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> was evaluated, you can get updated results for the same query by calling <tt class="docutils literal"><span class="pre">all()</span></tt> on a previously evaluated <tt class="docutils literal"><span class="pre">QuerySet</span></tt>.</font></p>
</div>
<div class="section" id="s-select-related">
<span id="select-related"></span><h4><font id="870">select_related</font><a class="headerlink" href="querysets.html#select-related" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.select_related">
<tt class="descname">select_related</tt>(<em>*fields</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.select_related" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="233">Returns a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> that will “follow” foreign-key relationships, selecting additional related-object data when it executes its query. </font><font id="234">This is a performance booster which results in a single more complex query but means later use of foreign-key relationships won’t require database queries.</font></p>
<p><font id="235">The following examples illustrate the difference between plain lookups and <tt class="docutils literal"><span class="pre">select_related()</span></tt> lookups. </font><font id="236">Here’s standard lookup:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Hits the database.</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c"># Hits the database again to get the related Blog object.</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">blog</span>
</pre></div>
</div>
<p><font id="237">And here’s <tt class="docutils literal"><span class="pre">select_related</span></tt> lookup:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Hits the database.</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s">'blog'</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c"># Doesn't hit the database, because e.blog has been prepopulated</span>
<span class="c"># in the previous query.</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">blog</span>
</pre></div>
</div>
<p><font id="238">You can use <tt class="docutils literal"><span class="pre">select_related()</span></tt> with any queryset of objects:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>

<span class="c"># Find all the blogs with entries scheduled to be published in the future.</span>
<span class="n">blogs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__gt</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s">'blog'</span><span class="p">):</span>
    <span class="c"># Without select_related(), this would make a database query for each</span>
    <span class="c"># loop iteration in order to fetch the related blog for each entry.</span>
    <span class="n">blogs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">blog</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="239">The order of <tt class="docutils literal"><span class="pre">filter()</span></tt> and <tt class="docutils literal"><span class="pre">select_related()</span></tt> chaining isn’t important. </font><font id="240">These querysets are equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__gt</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s">'blog'</span><span class="p">)</span>
<span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s">'blog'</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__gt</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</pre></div>
</div>
<p><font id="241">You can follow foreign keys in a similar way to querying them. </font><font id="242">If you have the following models:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">City</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="n">hometown</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">City</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="243">... then a call to <tt class="docutils literal"><span class="pre">Book.objects.select_related('author__hometown').get(id=4)</span></tt> will cache the related <tt class="docutils literal"><span class="pre">Person</span></tt> <em>and</em> the related <tt class="docutils literal"><span class="pre">City</span></tt>:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">b</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s">'author__hometown'</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">author</span>         <span class="c"># Doesn't hit the database.</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">hometown</span>       <span class="c"># Doesn't hit the database.</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="c"># No select_related() in this example.</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">author</span>         <span class="c"># Hits the database.</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">hometown</span>       <span class="c"># Hits the database.</span>
</pre></div>
</div>
<p><font id="244">You can refer to any <a class="reference internal" href="fields.html#django.db.models.ForeignKey" title="django.db.models.ForeignKey"><tt class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></tt></a> or <a class="reference internal" href="fields.html#django.db.models.OneToOneField" title="django.db.models.OneToOneField"><tt class="xref py py-class docutils literal"><span class="pre">OneToOneField</span></tt></a> relation in the list of fields passed to <tt class="docutils literal"><span class="pre">select_related()</span></tt>.</font></p>
<p><font id="245">You can also refer to the reverse direction of a <a class="reference internal" href="fields.html#django.db.models.OneToOneField" title="django.db.models.OneToOneField"><tt class="xref py py-class docutils literal"><span class="pre">OneToOneField</span></tt></a> in the list of fields passed to <tt class="docutils literal"><span class="pre">select_related</span></tt> — that is, you can traverse a <a class="reference internal" href="fields.html#django.db.models.OneToOneField" title="django.db.models.OneToOneField"><tt class="xref py py-class docutils literal"><span class="pre">OneToOneField</span></tt></a> back to the object on which the field is defined. </font><font id="246">Instead of specifying the field name, use the <a class="reference internal" href="fields.html#django.db.models.ForeignKey.related_name" title="django.db.models.ForeignKey.related_name"><tt class="xref py py-attr docutils literal"><span class="pre">related_name</span></tt></a> for the field on the related object.</font></p>
<p><font id="247">There may be some situations where you wish to call <tt class="docutils literal"><span class="pre">select_related()</span></tt> with a lot of related objects, or where you don’t know all of the relations. </font><font id="248">In these cases it is possible to call <tt class="docutils literal"><span class="pre">select_related()</span></tt> with no arguments. </font><font id="249">This will follow all non-null foreign keys it can find - nullable foreign keys must be specified. </font><font id="250">This is not recommended in most cases as it is likely to make the underlying query more complex, and return more data, than is actually needed.</font></p>
<p><font id="251">If you need to clear the list of related fields added by past calls of <tt class="docutils literal"><span class="pre">select_related</span></tt> on a <tt class="docutils literal"><span class="pre">QuerySet</span></tt>, you can pass <tt class="docutils literal"><span class="pre">None</span></tt> as a parameter:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">without_relations</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="252">Chaining <tt class="docutils literal"><span class="pre">select_related</span></tt> calls works in a similar way to other methods - that is that <tt class="docutils literal"><span class="pre">select_related('foo',</span> <span class="pre">'bar')</span></tt> is equivalent to <tt class="docutils literal"><span class="pre">select_related('foo').select_related('bar')</span></tt>.</font></p>
<div class="versionchanged">
<span class="title">Changed in Django 1.7:</span> <p><font id="253">Previously the latter would have been equivalent to <tt class="docutils literal"><span class="pre">select_related('bar')</span></tt>.</font></p>
</div>
</div>
<div class="section" id="s-prefetch-related">
<span id="prefetch-related"></span><h4><font id="871">prefetch_related</font><a class="headerlink" href="querysets.html#prefetch-related" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.prefetch_related">
<tt class="descname">prefetch_related</tt>(<em>*lookups</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.prefetch_related" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="254">Returns a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> that will automatically retrieve, in a single batch, related objects for each of the specified lookups.</font></p>
<p><font id="255">This has a similar purpose to <tt class="docutils literal"><span class="pre">select_related</span></tt>, in that both are designed to stop the deluge of database queries that is caused by accessing related objects, but the strategy is quite different.</font></p>
<p><font id="256"><tt class="docutils literal"><span class="pre">select_related</span></tt> works by creating an SQL join and including the fields of the related object in the <tt class="docutils literal"><span class="pre">SELECT</span></tt> statement. </font><font id="257">For this reason, <tt class="docutils literal"><span class="pre">select_related</span></tt> gets the related objects in the same database query. </font><font id="258">However, to avoid the much larger result set that would result from joining across a ‘many’ relationship, <tt class="docutils literal"><span class="pre">select_related</span></tt> is limited to single-valued relationships - foreign key and one-to-one.</font></p>
<p><font id="259"><tt class="docutils literal"><span class="pre">prefetch_related</span></tt>, on the other hand, does a separate lookup for each relationship, and does the ‘joining’ in Python. </font><font id="260">This allows it to prefetch many-to-many and many-to-one objects, which cannot be done using <tt class="docutils literal"><span class="pre">select_related</span></tt>, in addition to the foreign key and one-to-one relationships that are supported by <tt class="docutils literal"><span class="pre">select_related</span></tt>. </font><font id="261">It also supports prefetching of <a class="reference internal" href="../contrib/contenttypes.html#django.contrib.contenttypes.fields.GenericRelation" title="django.contrib.contenttypes.fields.GenericRelation"><tt class="xref py py-class docutils literal"><span class="pre">GenericRelation</span></tt></a> and <a class="reference internal" href="../contrib/contenttypes.html#django.contrib.contenttypes.fields.GenericForeignKey" title="django.contrib.contenttypes.fields.GenericForeignKey"><tt class="xref py py-class docutils literal"><span class="pre">GenericForeignKey</span></tt></a>.</font></p>
<p><font id="262">For example, suppose you have these models:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Topping</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Pizza</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">toppings</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Topping</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>              <span class="c"># __unicode__ on Python 2</span>
        <span class="k">return</span> <span class="s">"</span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topping</span><span class="o">.</span><span class="n">name</span>
                                                 <span class="k">for</span> <span class="n">topping</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">toppings</span><span class="o">.</span><span class="n">all</span><span class="p">()))</span>
</pre></div>
</div>
<p><font id="263">and run:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Pizza</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">["Hawaiian (ham, pineapple)", "Seafood (prawns, smoked salmon)"...</span>
</pre></div>
</div>
<p><font id="264">The problem with this is that every time <tt class="docutils literal"><span class="pre">Pizza.__str__()</span></tt> asks for <tt class="docutils literal"><span class="pre">self.toppings.all()</span></tt> it has to query the database, so <tt class="docutils literal"><span class="pre">Pizza.objects.all()</span></tt> will run a query on the Toppings table for <strong>every</strong> item in the Pizza <tt class="docutils literal"><span class="pre">QuerySet</span></tt>.</font></p>
<p><font id="265">We can reduce to just two queries using <tt class="docutils literal"><span class="pre">prefetch_related</span></tt>:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Pizza</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="s">'toppings'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="266">This implies a <tt class="docutils literal"><span class="pre">self.toppings.all()</span></tt> for each <tt class="docutils literal"><span class="pre">Pizza</span></tt>; </font><font id="267">now each time <tt class="docutils literal"><span class="pre">self.toppings.all()</span></tt> is called, instead of having to go to the database for the items, it will find them in a prefetched <tt class="docutils literal"><span class="pre">QuerySet</span></tt> cache that was populated in a single query.</font></p>
<p><font id="268">That is, all the relevant toppings will have been fetched in a single query, and used to make <tt class="docutils literal"><span class="pre">QuerySets</span></tt> that have a pre-filled cache of the relevant results; </font><font id="269">these <tt class="docutils literal"><span class="pre">QuerySets</span></tt> are then used in the <tt class="docutils literal"><span class="pre">self.toppings.all()</span></tt> calls.</font></p>
<p><font id="270">The additional queries in <tt class="docutils literal"><span class="pre">prefetch_related()</span></tt> are executed after the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> has begun to be evaluated and the primary query has been executed.</font></p>
<p><font id="271">Note that the result cache of the primary <tt class="docutils literal"><span class="pre">QuerySet</span></tt> and all specified related objects will then be fully loaded into memory. </font><font id="272">This changes the typical behavior of <tt class="docutils literal"><span class="pre">QuerySets</span></tt>, which normally try to avoid loading all objects into memory before they are needed, even after a query has been executed in the database.</font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="273">Note</font></p>
<p><font id="274">Remember that, as always with <tt class="docutils literal"><span class="pre">QuerySets</span></tt>, any subsequent chained methods which imply a different database query will ignore previously cached results, and retrieve data using a fresh database query. </font><font id="275">So, if you write the following:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pizzas</span> <span class="o">=</span> <span class="n">Pizza</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="s">'toppings'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">pizza</span><span class="o">.</span><span class="n">toppings</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">spicy</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span> <span class="k">for</span> <span class="n">pizza</span> <span class="ow">in</span> <span class="n">pizzas</span><span class="p">]</span>
</pre></div>
</div>
<p class="last"><font id="276">...then the fact that <tt class="docutils literal"><span class="pre">pizza.toppings.all()</span></tt> has been prefetched will not help you. </font><font id="277">The <tt class="docutils literal"><span class="pre">prefetch_related('toppings')</span></tt> implied <tt class="docutils literal"><span class="pre">pizza.toppings.all()</span></tt>, but <tt class="docutils literal"><span class="pre">pizza.toppings.filter()</span></tt> is a new and different query. </font><font id="278">The prefetched cache can’t help here; </font><font id="279">in fact it hurts performance, since you have done a database query that you haven’t used. </font><font id="280">So use this feature with caution!</font></p>
</div>
<p><font id="281">You can also use the normal join syntax to do related fields of related fields. </font><font id="282">Suppose we have an additional model to the example above:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Restaurant</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">pizzas</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToMany</span><span class="p">(</span><span class="n">Pizza</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'restaurants'</span><span class="p">)</span>
    <span class="n">best_pizza</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Pizza</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'championed_by'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="283">The following are all legal:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="s">'pizzas__toppings'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="284">This will prefetch all pizzas belonging to restaurants, and all toppings belonging to those pizzas. </font><font id="285">This will result in a total of 3 database queries - one for the restaurants, one for the pizzas, and one for the toppings.</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="s">'best_pizza__toppings'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="286">This will fetch the best pizza and all the toppings for the best pizza for each restaurant. </font><font id="287">This will be done in 3 database queries - one for the restaurants, one for the ‘best pizzas’, and one for one for the toppings.</font></p>
<p><font id="288">Of course, the <tt class="docutils literal"><span class="pre">best_pizza</span></tt> relationship could also be fetched using <tt class="docutils literal"><span class="pre">select_related</span></tt> to reduce the query count to 2:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s">'best_pizza'</span><span class="p">)</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="s">'best_pizza__toppings'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="289">Since the prefetch is executed after the main query (which includes the joins needed by <tt class="docutils literal"><span class="pre">select_related</span></tt>), it is able to detect that the <tt class="docutils literal"><span class="pre">best_pizza</span></tt> objects have already been fetched, and it will skip fetching them again.</font></p>
<p><font id="290">Chaining <tt class="docutils literal"><span class="pre">prefetch_related</span></tt> calls will accumulate the lookups that are prefetched. </font><font id="291">To clear any <tt class="docutils literal"><span class="pre">prefetch_related</span></tt> behavior, pass <tt class="docutils literal"><span class="pre">None</span></tt> as a parameter:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">non_prefetched</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="292">One difference to note when using <tt class="docutils literal"><span class="pre">prefetch_related</span></tt> is that objects created by a query can be shared between the different objects that they are related to i.e. a single Python model instance can appear at more than one point in the tree of objects that are returned. </font><font id="293">This will normally happen with foreign key relationships. </font><font id="294">Typically this behavior will not be a problem, and will in fact save both memory and CPU time.</font></p>
<p><font id="295">While <tt class="docutils literal"><span class="pre">prefetch_related</span></tt> supports prefetching <tt class="docutils literal"><span class="pre">GenericForeignKey</span></tt> relationships, the number of queries will depend on the data. </font><font id="296">Since a <tt class="docutils literal"><span class="pre">GenericForeignKey</span></tt> can reference data in multiple tables, one query per table referenced is needed, rather than one query for all the items. </font><font id="297">There could be additional queries on the <tt class="docutils literal"><span class="pre">ContentType</span></tt> table if the relevant rows have not already been fetched.</font></p>
<p><font id="298"><tt class="docutils literal"><span class="pre">prefetch_related</span></tt> in most cases will be implemented using an SQL query that uses the ‘IN’ operator. </font><font id="299">This means that for a large <tt class="docutils literal"><span class="pre">QuerySet</span></tt> a large ‘IN’ clause could be generated, which, depending on the database, might have performance problems of its own when it comes to parsing or executing the SQL query. </font><font id="300">Always profile for your use case!</font></p>
<p><font id="301">Note that if you use <tt class="docutils literal"><span class="pre">iterator()</span></tt> to run the query, <tt class="docutils literal"><span class="pre">prefetch_related()</span></tt> calls will be ignored since these two optimizations do not make sense together.</font></p>
<div class="versionadded">
<span class="title">New in Django 1.7.</span> </div>
<p><font id="302">You can use the <a class="reference internal" href="querysets.html#django.db.models.Prefetch" title="django.db.models.Prefetch"><tt class="xref py py-class docutils literal"><span class="pre">Prefetch</span></tt></a> object to further control the prefetch operation.</font></p>
<p><font id="303">In its simplest form <tt class="docutils literal"><span class="pre">Prefetch</span></tt> is equivalent to the traditional string based lookups:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="n">Prefetch</span><span class="p">(</span><span class="s">'pizzas__toppings'</span><span class="p">))</span>
</pre></div>
</div>
<p><font id="304">You can provide a custom queryset with the optional <tt class="docutils literal"><span class="pre">queryset</span></tt> argument. </font><font id="305">This can be used to change the default ordering of the queryset:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Prefetch</span><span class="p">(</span><span class="s">'pizzas__toppings'</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">Toppings</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'name'</span><span class="p">)))</span>
</pre></div>
</div>
<p><font id="306">Or to call <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.select_related" title="django.db.models.query.QuerySet.select_related"><tt class="xref py py-meth docutils literal"><span class="pre">select_related()</span></tt></a> when applicable to reduce the number of queries even further:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Pizza</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Prefetch</span><span class="p">(</span><span class="s">'restaurants'</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s">'best_pizza'</span><span class="p">)))</span>
</pre></div>
</div>
<p><font id="307">You can also assign the prefetched result to a custom attribute with the optional <tt class="docutils literal"><span class="pre">to_attr</span></tt> argument. </font><font id="308">The result will be stored directly in a list.</font></p>
<p><font id="309">This allows prefetching the same relation multiple times with a different <tt class="docutils literal"><span class="pre">QuerySet</span></tt>; </font><font id="310">for instance:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">vegetarian_pizzas</span> <span class="o">=</span> <span class="n">Pizza</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">vegetarian</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Prefetch</span><span class="p">(</span><span class="s">'pizzas'</span><span class="p">,</span> <span class="n">to_attr</span><span class="o">=</span><span class="s">'menu'</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">Prefetch</span><span class="p">(</span><span class="s">'pizzas'</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">vegetarian_pizzas</span><span class="p">,</span> <span class="n">to_attr</span><span class="o">=</span><span class="s">'vegetarian_menu'</span><span class="p">))</span>
</pre></div>
</div>
<p><font id="311">Lookups created with custom <tt class="docutils literal"><span class="pre">to_attr</span></tt> can still be traversed as usual by other lookups:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">vegetarian_pizzas</span> <span class="o">=</span> <span class="n">Pizza</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">vegetarian</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Prefetch</span><span class="p">(</span><span class="s">'pizzas'</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">vegetarian_pizzas</span><span class="p">,</span> <span class="n">to_attr</span><span class="o">=</span><span class="s">'vegetarian_menu'</span><span class="p">),</span>
<span class="gp">... </span>    <span class="s">'vegetarian_menu__toppings'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="312">Using <tt class="docutils literal"><span class="pre">to_attr</span></tt> is recommended when filtering down the prefetch result as it is less ambiguous than storing a filtered result in the related manager’s cache:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">queryset</span> <span class="o">=</span> <span class="n">Pizza</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">vegetarian</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Recommended:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">restaurants</span> <span class="o">=</span> <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Prefetch</span><span class="p">(</span><span class="s">'pizzas'</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">queryset</span><span class="p">,</span> <span class="n">to_attr</span><span class="o">=</span><span class="s">'vegetarian_pizzas'</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vegetarian_pizzas</span> <span class="o">=</span> <span class="n">restaurants</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vegetarian_pizzas</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Not recommended:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">restaurants</span> <span class="o">=</span> <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Prefetch</span><span class="p">(</span><span class="s">'pizzas'</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">queryset</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vegetarian_pizzas</span> <span class="o">=</span> <span class="n">restaurants</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pizzas</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="313">Custom prefetching also works with single related relations like forward <tt class="docutils literal"><span class="pre">ForeignKey</span></tt> or <tt class="docutils literal"><span class="pre">OneToOneField</span></tt>. </font><font id="314">Generally you’ll want to use <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.select_related" title="django.db.models.query.QuerySet.select_related"><tt class="xref py py-meth docutils literal"><span class="pre">select_related()</span></tt></a> for these relations, but there are a number of cases where prefetching with a custom <tt class="docutils literal"><span class="pre">QuerySet</span></tt> is useful:</font></p>
<ul>
<li><p class="first"><font id="315">You want to use a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> that performs further prefetching on related models.</font></p>
</li>
<li><p class="first"><font id="316">You want to prefetch only a subset of the related objects.</font></p>
</li>
<li><p class="first"><font id="317">You want to use performance optimization techniques like <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.defer" title="django.db.models.query.QuerySet.defer"><tt class="xref py py-meth docutils literal"><span class="pre">deferred</span> <span class="pre">fields</span></tt></a>:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">queryset</span> <span class="o">=</span> <span class="n">Pizza</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">restaurants</span> <span class="o">=</span> <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Prefetch</span><span class="p">(</span><span class="s">'best_pizza'</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">queryset</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title"><font id="318">Note</font></p>
<p><font id="319">The ordering of lookups matters.</font></p>
<p><font id="320">Take the following examples:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">prefetch_related</span><span class="p">(</span><span class="s">'pizzas__toppings'</span><span class="p">,</span> <span class="s">'pizzas'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="321">This works even though it’s unordered because <tt class="docutils literal"><span class="pre">'pizzas__toppings'</span></tt> already contains all the needed information, therefore the second argument <tt class="docutils literal"><span class="pre">'pizzas'</span></tt> is actually redundant.</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">prefetch_related</span><span class="p">(</span><span class="s">'pizzas__toppings'</span><span class="p">,</span> <span class="n">Prefetch</span><span class="p">(</span><span class="s">'pizzas'</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">Pizza</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()))</span>
</pre></div>
</div>
<p><font id="322">This will raise a <tt class="docutils literal"><span class="pre">ValueError</span></tt> because of the attempt to redefine the queryset of a previously seen lookup. </font><font id="323">Note that an implicit queryset was created to traverse <tt class="docutils literal"><span class="pre">'pizzas'</span></tt> as part of the <tt class="docutils literal"><span class="pre">'pizzas__toppings'</span></tt> lookup.</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">prefetch_related</span><span class="p">(</span><span class="s">'pizza_list__toppings'</span><span class="p">,</span> <span class="n">Prefetch</span><span class="p">(</span><span class="s">'pizzas'</span><span class="p">,</span> <span class="n">to_attr</span><span class="o">=</span><span class="s">'pizza_list'</span><span class="p">))</span>
</pre></div>
</div>
<p><font id="324">This will trigger an <tt class="docutils literal"><span class="pre">AttributeError</span></tt> because <tt class="docutils literal"><span class="pre">'pizza_list'</span></tt> doesn’t exist yet when <tt class="docutils literal"><span class="pre">'pizza_list__toppings'</span></tt> is being processed.</font></p>
<p class="last"><font id="325">This consideration is not limited to the use of <tt class="docutils literal"><span class="pre">Prefetch</span></tt> objects. </font><font id="326">Some advanced techniques may require that the lookups be performed in a specific order to avoid creating extra queries; </font><font id="327">therefore it’s recommended to always carefully order <tt class="docutils literal"><span class="pre">prefetch_related</span></tt> arguments.</font></p>
</div>
</div>
<div class="section" id="s-extra">
<span id="extra"></span><h4><font id="872">extra</font><a class="headerlink" href="querysets.html#extra" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.extra">
<tt class="descname">extra</tt>(<em>select=None</em>, <em>where=None</em>, <em>params=None</em>, <em>tables=None</em>, <em>order_by=None</em>, <em>select_params=None</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.extra" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="328">Sometimes, the Django query syntax by itself can’t easily express a complex <tt class="docutils literal"><span class="pre">WHERE</span></tt> clause. </font><font id="329">For these edge cases, Django provides the <tt class="docutils literal"><span class="pre">extra()</span></tt> <tt class="docutils literal"><span class="pre">QuerySet</span></tt> modifier — a hook for injecting specific clauses into the SQL generated by a <tt class="docutils literal"><span class="pre">QuerySet</span></tt>.</font></p>
<div class="admonition warning">
<p class="first admonition-title"><font id="330">Warning</font></p>
<p class="last"><font id="331">You should be very careful whenever you use <tt class="docutils literal"><span class="pre">extra()</span></tt>. </font><font id="332">Every time you use it, you should escape any parameters that the user can control by using <tt class="docutils literal"><span class="pre">params</span></tt> in order to protect against SQL injection attacks . </font><font id="333">Please read more about <a class="reference internal" href="../../topics/security.html#sql-injection-protection"><em>SQL injection protection</em></a>.</font></p>
</div>
<p><font id="334">By definition, these extra lookups may not be portable to different database engines (because you’re explicitly writing SQL code) and violate the DRY principle, so you should avoid them if possible.</font></p>
<p><font id="335">Specify one or more of <tt class="docutils literal"><span class="pre">params</span></tt>, <tt class="docutils literal"><span class="pre">select</span></tt>, <tt class="docutils literal"><span class="pre">where</span></tt> or <tt class="docutils literal"><span class="pre">tables</span></tt>. </font><font id="336">None of the arguments is required, but you should use at least one of them.</font></p>
<ul>
<li><p class="first"><font id="337"><tt class="docutils literal"><span class="pre">select</span></tt></font></p>
<p><font id="338">The <tt class="docutils literal"><span class="pre">select</span></tt> argument lets you put extra fields in the <tt class="docutils literal"><span class="pre">SELECT</span></tt> clause. </font><font id="339">It should be a dictionary mapping attribute names to SQL clauses to use to calculate that attribute.</font></p>
<p><font id="340">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span><span class="n">select</span><span class="o">=</span><span class="p">{</span><span class="s">'is_recent'</span><span class="p">:</span> <span class="s">"pub_date &gt; '2006-01-01'"</span><span class="p">})</span>
</pre></div>
</div>
<p><font id="341">As a result, each <tt class="docutils literal"><span class="pre">Entry</span></tt> object will have an extra attribute, <tt class="docutils literal"><span class="pre">is_recent</span></tt>, a boolean representing whether the entry’s <tt class="docutils literal"><span class="pre">pub_date</span></tt> is greater than Jan. 1, 2006.</font></p>
<p><font id="342">Django inserts the given SQL snippet directly into the <tt class="docutils literal"><span class="pre">SELECT</span></tt> statement, so the resulting SQL of the above example would be something like:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT blog_entry.*, (pub_date &gt; '2006-01-01') AS is_recent
FROM blog_entry;
</pre></div>
</div>
<p><font id="343">The next example is more advanced; </font><font id="344">it does a subquery to give each resulting <tt class="docutils literal"><span class="pre">Blog</span></tt> object an <tt class="docutils literal"><span class="pre">entry_count</span></tt> attribute, an integer count of associated <tt class="docutils literal"><span class="pre">Entry</span></tt> objects:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span>
    <span class="n">select</span><span class="o">=</span><span class="p">{</span>
        <span class="s">'entry_count'</span><span class="p">:</span> <span class="s">'SELECT COUNT(*) FROM blog_entry WHERE blog_entry.blog_id = blog_blog.id'</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p><font id="345">In this particular case, we’re exploiting the fact that the query will already contain the <tt class="docutils literal"><span class="pre">blog_blog</span></tt> table in its <tt class="docutils literal"><span class="pre">FROM</span></tt> clause.</font></p>
<p><font id="346">The resulting SQL of the above example would be:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT blog_blog.*, (SELECT COUNT(*) FROM blog_entry WHERE blog_entry.blog_id = blog_blog.id) AS entry_count
FROM blog_blog;
</pre></div>
</div>
<p><font id="347">Note that the parentheses required by most database engines around subqueries are not required in Django’s <tt class="docutils literal"><span class="pre">select</span></tt> clauses. </font><font id="348">Also note that some database backends, such as some MySQL versions, don’t support subqueries.</font></p>
<p><font id="349">In some rare cases, you might wish to pass parameters to the SQL fragments in <tt class="docutils literal"><span class="pre">extra(select=...)</span></tt>. </font><font id="350">For this purpose, use the <tt class="docutils literal"><span class="pre">select_params</span></tt> parameter. </font><font id="351">Since <tt class="docutils literal"><span class="pre">select_params</span></tt> is a sequence and the <tt class="docutils literal"><span class="pre">select</span></tt> attribute is a dictionary, some care is required so that the parameters are matched up correctly with the extra select pieces. </font><font id="352">In this situation, you should use a <a class="reference external" href="https://docs.python.org/3/library/collections.html#collections.OrderedDict" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">collections.</span></tt></a></font><font id="353">OrderedDict for the <tt class="docutils literal"><span class="pre">select</span></tt> value, not just a normal Python dictionary.</font></p>
<p><font id="354">This will work, for example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span>
    <span class="n">select</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">([(</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'</span><span class="si">%s</span><span class="s">'</span><span class="p">),</span> <span class="p">(</span><span class="s">'b'</span><span class="p">,</span> <span class="s">'</span><span class="si">%s</span><span class="s">'</span><span class="p">)]),</span>
    <span class="n">select_params</span><span class="o">=</span><span class="p">(</span><span class="s">'one'</span><span class="p">,</span> <span class="s">'two'</span><span class="p">))</span>
</pre></div>
</div>
<p><font id="355">If you need to use a literal <tt class="docutils literal"><span class="pre">%s</span></tt> inside your select string, use the sequence <tt class="docutils literal"><span class="pre">%%s</span></tt>.</font></p>
<div class="versionchanged">
<span class="title">Changed in Django 1.8:</span> <p><font id="356">Prior to 1.8, you were unable to escape a literal <tt class="docutils literal"><span class="pre">%s</span></tt>.</font></p>
</div>
</li>
<li><p class="first"><font id="357"><tt class="docutils literal"><span class="pre">where</span></tt> / <tt class="docutils literal"><span class="pre">tables</span></tt></font></p>
<p><font id="358">You can define explicit SQL <tt class="docutils literal"><span class="pre">WHERE</span></tt> clauses — perhaps to perform non-explicit joins — by using <tt class="docutils literal"><span class="pre">where</span></tt>. </font><font id="359">You can manually add tables to the SQL <tt class="docutils literal"><span class="pre">FROM</span></tt> clause by using <tt class="docutils literal"><span class="pre">tables</span></tt>.</font></p>
<p><font id="360"><tt class="docutils literal"><span class="pre">where</span></tt> and <tt class="docutils literal"><span class="pre">tables</span></tt> both take a list of strings. </font><font id="361">All <tt class="docutils literal"><span class="pre">where</span></tt> parameters are “AND”ed to any other search criteria.</font></p>
<p><font id="362">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="p">[</span><span class="s">"foo='a' OR bar = 'a'"</span><span class="p">,</span> <span class="s">"baz = 'a'"</span><span class="p">])</span>
</pre></div>
</div>
<p><font id="363">...translates (roughly) into the following SQL:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT * FROM blog_entry WHERE (foo='a' OR bar='a') AND (baz='a')
</pre></div>
</div>
<p><font id="364">Be careful when using the <tt class="docutils literal"><span class="pre">tables</span></tt> parameter if you’re specifying tables that are already used in the query. </font><font id="365">When you add extra tables via the <tt class="docutils literal"><span class="pre">tables</span></tt> parameter, Django assumes you want that table included an extra time, if it is already included. </font><font id="366">That creates a problem, since the table name will then be given an alias. </font><font id="367">If a table appears multiple times in an SQL statement, the second and subsequent occurrences must use aliases so the database can tell them apart. </font><font id="368">If you’re referring to the extra table you added in the extra <tt class="docutils literal"><span class="pre">where</span></tt> parameter this is going to cause errors.</font></p>
<p><font id="369">Normally you’ll only be adding extra tables that don’t already appear in the query. </font><font id="370">However, if the case outlined above does occur, there are a few solutions. </font><font id="371">First, see if you can get by without including the extra table and use the one already in the query. </font><font id="372">If that isn’t possible, put your <tt class="docutils literal"><span class="pre">extra()</span></tt> call at the front of the queryset construction so that your table is the first use of that table. </font><font id="373">Finally, if all else fails, look at the query produced and rewrite your <tt class="docutils literal"><span class="pre">where</span></tt> addition to use the alias given to your extra table. </font><font id="374">The alias will be the same each time you construct the queryset in the same way, so you can rely upon the alias name to not change.</font></p>
</li>
<li><p class="first"><font id="375"><tt class="docutils literal"><span class="pre">order_by</span></tt></font></p>
<p><font id="376">If you need to order the resulting queryset using some of the new fields or tables you have included via <tt class="docutils literal"><span class="pre">extra()</span></tt> use the <tt class="docutils literal"><span class="pre">order_by</span></tt> parameter to <tt class="docutils literal"><span class="pre">extra()</span></tt> and pass in a sequence of strings. </font><font id="377">These strings should either be model fields (as in the normal <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.order_by" title="django.db.models.query.QuerySet.order_by"><tt class="xref py py-meth docutils literal"><span class="pre">order_by()</span></tt></a> method on querysets), of the form <tt class="docutils literal"><span class="pre">table_name.column_name</span></tt> or an alias for a column that you specified in the <tt class="docutils literal"><span class="pre">select</span></tt> parameter to <tt class="docutils literal"><span class="pre">extra()</span></tt>.</font></p>
<p><font id="378">For example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">q</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span><span class="n">select</span><span class="o">=</span><span class="p">{</span><span class="s">'is_recent'</span><span class="p">:</span> <span class="s">"pub_date &gt; '2006-01-01'"</span><span class="p">})</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span><span class="n">order_by</span> <span class="o">=</span> <span class="p">[</span><span class="s">'-is_recent'</span><span class="p">])</span>
</pre></div>
</div>
<p><font id="379">This would sort all the items for which <tt class="docutils literal"><span class="pre">is_recent</span></tt> is true to the front of the result set (<tt class="docutils literal"><span class="pre">True</span></tt> sorts before <tt class="docutils literal"><span class="pre">False</span></tt> in a descending ordering).</font></p>
<p><font id="380">This shows, by the way, that you can make multiple calls to <tt class="docutils literal"><span class="pre">extra()</span></tt> and it will behave as you expect (adding new constraints each time).</font></p>
</li>
<li><p class="first"><font id="381"><tt class="docutils literal"><span class="pre">params</span></tt></font></p>
<p><font id="382">The <tt class="docutils literal"><span class="pre">where</span></tt> parameter described above may use standard Python database string placeholders — <tt class="docutils literal"><span class="pre">'%s'</span></tt> to indicate parameters the database engine should automatically quote. </font><font id="383">The <tt class="docutils literal"><span class="pre">params</span></tt> argument is a list of any extra parameters to be substituted.</font></p>
<p><font id="384">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="p">[</span><span class="s">'headline=</span><span class="si">%s</span><span class="s">'</span><span class="p">],</span> <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s">'Lennon'</span><span class="p">])</span>
</pre></div>
</div>
<p><font id="385">Always use <tt class="docutils literal"><span class="pre">params</span></tt> instead of embedding values directly into <tt class="docutils literal"><span class="pre">where</span></tt> because <tt class="docutils literal"><span class="pre">params</span></tt> will ensure values are quoted correctly according to your particular backend. </font><font id="386">For example, quotes will be escaped correctly.</font></p>
<p><font id="387">Bad:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="p">[</span><span class="s">"headline='Lennon'"</span><span class="p">])</span>
</pre></div>
</div>
<p><font id="388">Good:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="p">[</span><span class="s">'headline=</span><span class="si">%s</span><span class="s">'</span><span class="p">],</span> <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s">'Lennon'</span><span class="p">])</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title"><font id="389">Warning</font></p>
<p class="last"><font id="390">If you are performing queries on MySQL, note that MySQL’s silent type coercion may cause unexpected results when mixing types. </font><font id="391">If you query on a string type column, but with an integer value, MySQL will coerce the types of all values in the table to an integer before performing the comparison. </font><font id="392">For example, if your table contains the values <tt class="docutils literal"><span class="pre">'abc'</span></tt>, <tt class="docutils literal"><span class="pre">'def'</span></tt> and you query for <tt class="docutils literal"><span class="pre">WHERE</span> <span class="pre">mycolumn=0</span></tt>, both rows will match. </font><font id="393">To prevent this, perform the correct typecasting before using the value in a query.</font></p>
</div>
</div>
<div class="section" id="s-defer">
<span id="defer"></span><h4><font id="873">defer</font><a class="headerlink" href="querysets.html#defer" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.defer">
<tt class="descname">defer</tt>(<em>*fields</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.defer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="394">In some complex data-modeling situations, your models might contain a lot of fields, some of which could contain a lot of data (for example, text fields), or require expensive processing to convert them to Python objects. </font><font id="395">If you are using the results of a queryset in some situation where you don’t know if you need those particular fields when you initially fetch the data, you can tell Django not to retrieve them from the database.</font></p>
<p><font id="396">This is done by passing the names of the fields to not load to <tt class="docutils literal"><span class="pre">defer()</span></tt>:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="s">"headline"</span><span class="p">,</span> <span class="s">"body"</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="397">A queryset that has deferred fields will still return model instances. </font><font id="398">Each deferred field will be retrieved from the database if you access that field (one at a time, not all the deferred fields at once).</font></p>
<p><font id="399">You can make multiple calls to <tt class="docutils literal"><span class="pre">defer()</span></tt>. </font><font id="400">Each call adds new fields to the deferred set:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Defers both the body and headline fields.</span>
<span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="s">"body"</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">rating</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="s">"headline"</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="401">The order in which fields are added to the deferred set does not matter. </font><font id="402">Calling <tt class="docutils literal"><span class="pre">defer()</span></tt> with a field name that has already been deferred is harmless (the field will still be deferred).</font></p>
<p><font id="403">You can defer loading of fields in related models (if the related models are loading via <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.select_related" title="django.db.models.query.QuerySet.select_related"><tt class="xref py py-meth docutils literal"><span class="pre">select_related()</span></tt></a>) by using the standard double-underscore notation to separate related fields:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">()</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="s">"entry__headline"</span><span class="p">,</span> <span class="s">"entry__body"</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="404">If you want to clear the set of deferred fields, pass <tt class="docutils literal"><span class="pre">None</span></tt> as a parameter to <tt class="docutils literal"><span class="pre">defer()</span></tt>:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Load all fields immediately.</span>
<span class="n">my_queryset</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="405">Some fields in a model won’t be deferred, even if you ask for them. </font><font id="406">You can never defer the loading of the primary key. </font><font id="407">If you are using <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.select_related" title="django.db.models.query.QuerySet.select_related"><tt class="xref py py-meth docutils literal"><span class="pre">select_related()</span></tt></a> to retrieve related models, you shouldn’t defer the loading of the field that connects from the primary model to the related one, doing so will result in an error.</font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="408">Note</font></p>
<p><font id="409">The <tt class="docutils literal"><span class="pre">defer()</span></tt> method (and its cousin, <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.only" title="django.db.models.query.QuerySet.only"><tt class="xref py py-meth docutils literal"><span class="pre">only()</span></tt></a>, below) are only for advanced use-cases. </font><font id="410">They provide an optimization for when you have analyzed your queries closely and understand <em>exactly</em> what information you need and have measured that the difference between returning the fields you need and the full set of fields for the model will be significant.</font></p>
<p><font id="411">Even if you think you are in the advanced use-case situation, <strong>only use defer() when you cannot, at queryset load time, determine if you will need the extra fields or not</strong>. </font><font id="412">If you are frequently loading and using a particular subset of your data, the best choice you can make is to normalize your models and put the non-loaded data into a separate model (and database table). </font><font id="413">If the columns <em>must</em> stay in the one table for some reason, create a model with <tt class="docutils literal"><span class="pre">Meta.managed</span> <span class="pre">=</span> <span class="pre">False</span></tt> (see the <a class="reference internal" href="options.html#django.db.models.Options.managed" title="django.db.models.Options.managed"><tt class="xref py py-attr docutils literal"><span class="pre">managed</span> <span class="pre">attribute</span></tt></a> documentation) containing just the fields you normally need to load and use that where you might otherwise call <tt class="docutils literal"><span class="pre">defer()</span></tt>. </font><font id="414">This makes your code more explicit to the reader, is slightly faster and consumes a little less memory in the Python process.</font></p>
<p><font id="415">For example, both of these models use the same underlying database table:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">CommonlyUsedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">managed</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">'app_largetable'</span>

<span class="k">class</span> <span class="nc">ManagedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">'app_largetable'</span>

<span class="c"># Two equivalent QuerySets:</span>
<span class="n">CommonlyUsedModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">ManagedModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="s">'f2'</span><span class="p">)</span>
</pre></div>
</div>
<p class="last"><font id="416">If many fields need to be duplicated in the unmanaged model, it may be best to create an abstract model with the shared fields and then have the unmanaged and managed models inherit from the abstract model.</font></p>
</div>
<div class="admonition note">
<p class="first admonition-title"><font id="417">Note</font></p>
<p class="last"><font id="418">When calling <a class="reference internal" href="instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a> for instances with deferred fields, only the loaded fields will be saved. </font><font id="419">See <a class="reference internal" href="instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a> for more details.</font></p>
</div>
</div>
<div class="section" id="s-only">
<span id="only"></span><h4><font id="874">only</font><a class="headerlink" href="querysets.html#only" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.only">
<tt class="descname">only</tt>(<em>*fields</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.only" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="420">The <tt class="docutils literal"><span class="pre">only()</span></tt> method is more or less the opposite of <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.defer" title="django.db.models.query.QuerySet.defer"><tt class="xref py py-meth docutils literal"><span class="pre">defer()</span></tt></a>. </font><font id="421">You call it with the fields that should <em>not</em> be deferred when retrieving a model. </font><font id="422">If you have a model where almost all the fields need to be deferred, using <tt class="docutils literal"><span class="pre">only()</span></tt> to specify the complementary set of fields can result in simpler code.</font></p>
<p><font id="423">Suppose you have a model with fields <tt class="docutils literal"><span class="pre">name</span></tt>, <tt class="docutils literal"><span class="pre">age</span></tt> and <tt class="docutils literal"><span class="pre">biography</span></tt>. </font><font id="424">The following two querysets are the same, in terms of deferred fields:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="s">"age"</span><span class="p">,</span> <span class="s">"biography"</span><span class="p">)</span>
<span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="425">Whenever you call <tt class="docutils literal"><span class="pre">only()</span></tt> it <em>replaces</em> the set of fields to load immediately. </font><font id="426">The method’s name is mnemonic: <strong>only</strong> those fields are loaded immediately; </font><font id="427">the remainder are deferred. </font><font id="428">Thus, successive calls to <tt class="docutils literal"><span class="pre">only()</span></tt> result in only the final fields being considered:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># This will defer all fields except the headline.</span>
<span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s">"body"</span><span class="p">,</span> <span class="s">"rating"</span><span class="p">)</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s">"headline"</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="429">Since <tt class="docutils literal"><span class="pre">defer()</span></tt> acts incrementally (adding fields to the deferred list), you can combine calls to <tt class="docutils literal"><span class="pre">only()</span></tt> and <tt class="docutils literal"><span class="pre">defer()</span></tt> and things will behave logically:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Final result is that everything except "headline" is deferred.</span>
<span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s">"headline"</span><span class="p">,</span> <span class="s">"body"</span><span class="p">)</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="s">"body"</span><span class="p">)</span>

<span class="c"># Final result loads headline and body immediately (only() replaces any</span>
<span class="c"># existing set of fields).</span>
<span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="s">"body"</span><span class="p">)</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s">"headline"</span><span class="p">,</span> <span class="s">"body"</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="430">All of the cautions in the note for the <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.defer" title="django.db.models.query.QuerySet.defer"><tt class="xref py py-meth docutils literal"><span class="pre">defer()</span></tt></a> documentation apply to <tt class="docutils literal"><span class="pre">only()</span></tt> as well. </font><font id="431">Use it cautiously and only after exhausting your other options.</font></p>
<p><font id="432">Using <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.only" title="django.db.models.query.QuerySet.only"><tt class="xref py py-meth docutils literal"><span class="pre">only()</span></tt></a> and omitting a field requested using <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.select_related" title="django.db.models.query.QuerySet.select_related"><tt class="xref py py-meth docutils literal"><span class="pre">select_related()</span></tt></a> is an error as well.</font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="433">Note</font></p>
<p class="last"><font id="434">When calling <a class="reference internal" href="instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a> for instances with deferred fields, only the loaded fields will be saved. </font><font id="435">See <a class="reference internal" href="instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a> for more details.</font></p>
</div>
</div>
<div class="section" id="s-using">
<span id="using"></span><h4><font id="875">using</font><a class="headerlink" href="querysets.html#using" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.using">
<tt class="descname">using</tt>(<em>alias</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.using" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="436">This method is for controlling which database the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> will be evaluated against if you are using more than one database. </font><font id="437">The only argument this method takes is the alias of a database, as defined in <a class="reference internal" href="../settings.html#std:setting-DATABASES"><tt class="xref std std-setting docutils literal"><span class="pre">DATABASES</span></tt></a>.</font></p>
<p><font id="438">For example:</font></p>
<div class="highlight-python"><div class="highlight"><pre># queries the database with the 'default' alias.
&gt;&gt;&gt; Entry.objects.all()

# queries the database with the 'backup' alias
&gt;&gt;&gt; Entry.objects.using('backup')
</pre></div>
</div>
</div>
<div class="section" id="s-select-for-update">
<span id="select-for-update"></span><h4><font id="876">select_for_update</font><a class="headerlink" href="querysets.html#select-for-update" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.select_for_update">
<tt class="descname">select_for_update</tt>(<em>nowait=False</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.select_for_update" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="439">Returns a queryset that will lock rows until the end of the transaction, generating a <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">...</span> </tt></font><font id="440"><span class="pre">FOR</span> </font><font id="441"><span class="pre">UPDATE</span> </font><font id="442">SQL statement on supported databases.</font></p>
<p><font id="443">For example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">entries</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_for_update</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="444">All matched entries will be locked until the end of the transaction block, meaning that other transactions will be prevented from changing or acquiring locks on them.</font></p>
<p><font id="445">Usually, if another transaction has already acquired a lock on one of the selected rows, the query will block until the lock is released. </font><font id="446">If this is not the behavior you want, call <tt class="docutils literal"><span class="pre">select_for_update(nowait=True)</span></tt>. </font><font id="447">This will make the call non-blocking. </font><font id="448">If a conflicting lock is already acquired by another transaction, <a class="reference internal" href="../exceptions.html#django.db.DatabaseError" title="django.db.DatabaseError"><tt class="xref py py-exc docutils literal"><span class="pre">DatabaseError</span></tt></a> will be raised when the queryset is evaluated.</font></p>
<p><font id="449">Currently, the <tt class="docutils literal"><span class="pre">postgresql_psycopg2</span></tt>, <tt class="docutils literal"><span class="pre">oracle</span></tt>, and <tt class="docutils literal"><span class="pre">mysql</span></tt> database backends support <tt class="docutils literal"><span class="pre">select_for_update()</span></tt>. </font><font id="450">However, MySQL has no support for the <tt class="docutils literal"><span class="pre">nowait</span></tt> argument. </font><font id="451">Obviously, users of external third-party backends should check with their backend’s documentation for specifics in those cases.</font></p>
<p><font id="452">Passing <tt class="docutils literal"><span class="pre">nowait=True</span></tt> to <tt class="docutils literal"><span class="pre">select_for_update()</span></tt> using database backends that do not support <tt class="docutils literal"><span class="pre">nowait</span></tt>, such as MySQL, will cause a <a class="reference internal" href="../exceptions.html#django.db.DatabaseError" title="django.db.DatabaseError"><tt class="xref py py-exc docutils literal"><span class="pre">DatabaseError</span></tt></a> to be raised. </font><font id="453">This is in order to prevent code unexpectedly blocking.</font></p>
<p><font id="454">Evaluating a queryset with <tt class="docutils literal"><span class="pre">select_for_update()</span></tt> in autocommit mode is a <a class="reference internal" href="../exceptions.html#django.db.transaction.TransactionManagementError" title="django.db.transaction.TransactionManagementError"><tt class="xref py py-exc docutils literal"><span class="pre">TransactionManagementError</span></tt></a> error because the rows are not locked in that case. </font><font id="455">If allowed, this would facilitate data corruption and could easily be caused by calling code that expects to be run in a transaction outside of one.</font></p>
<p><font id="456">Using <tt class="docutils literal"><span class="pre">select_for_update()</span></tt> on backends which do not support <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">...</span> </tt></font><font id="457"><span class="pre">FOR</span> </font><font id="458"><span class="pre">UPDATE</span> </font><font id="459">(such as SQLite) will have no effect.</font></p>
<div class="versionchanged">
<span class="title">Changed in Django 1.6.3:</span> <p><font id="460">It is now an error to execute a query with <tt class="docutils literal"><span class="pre">select_for_update()</span></tt> in autocommit mode. </font><font id="461">With earlier releases in the 1.6 series it was a no-op.</font></p>
</div>
<div class="admonition warning">
<p class="first admonition-title"><font id="462">Warning</font></p>
<p class="last"><font id="463">Although <tt class="docutils literal"><span class="pre">select_for_update()</span></tt> normally fails in autocommit mode, since <a class="reference internal" href="../../topics/testing/tools.html#django.test.TestCase" title="django.test.TestCase"><tt class="xref py py-class docutils literal"><span class="pre">TestCase</span></tt></a> automatically wraps each test in a transaction, calling <tt class="docutils literal"><span class="pre">select_for_update()</span></tt> in a <tt class="docutils literal"><span class="pre">TestCase</span></tt> even outside an <a class="reference internal" href="../../topics/db/transactions.html#django.db.transaction.atomic" title="django.db.transaction.atomic"><tt class="xref py py-func docutils literal"><span class="pre">atomic()</span></tt></a> block will (perhaps unexpectedly) pass without raising a <tt class="docutils literal"><span class="pre">TransactionManagementError</span></tt>. </font><font id="464">To properly test <tt class="docutils literal"><span class="pre">select_for_update()</span></tt> you should use <a class="reference internal" href="../../topics/testing/tools.html#django.test.TransactionTestCase" title="django.test.TransactionTestCase"><tt class="xref py py-class docutils literal"><span class="pre">TransactionTestCase</span></tt></a>.</font></p>
</div>
</div>
<div class="section" id="s-raw">
<span id="raw"></span><h4><font id="877">raw</font><a class="headerlink" href="querysets.html#raw" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.raw">
<tt class="descname">raw</tt>(<em>raw_query</em>, <em>params=None</em>, <em>translations=None</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.raw" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<div class="versionchanged">
<span class="title">Changed in Django 1.7:</span> <p><font id="465"><tt class="docutils literal"><span class="pre">raw</span></tt> was moved to the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> class. </font><font id="466">It was previously only on <a class="reference internal" href="../../topics/db/managers.html#django.db.models.Manager" title="django.db.models.Manager"><tt class="xref py py-class docutils literal"><span class="pre">Manager</span></tt></a>.</font></p>
</div>
<p><font id="467">Takes a raw SQL query, executes it, and returns a <tt class="docutils literal"><span class="pre">django.db.models.query.RawQuerySet</span></tt> instance. </font><font id="468">This <tt class="docutils literal"><span class="pre">RawQuerySet</span></tt> instance can be iterated over just like an normal <tt class="docutils literal"><span class="pre">QuerySet</span></tt> to provide object instances.</font></p>
<p><font id="469">See the <a class="reference internal" href="../../topics/db/sql.html"><em>Performing raw SQL queries</em></a> for more information.</font></p>
<div class="admonition warning">
<p class="first admonition-title"><font id="470">Warning</font></p>
<p class="last"><font id="471"><tt class="docutils literal"><span class="pre">raw()</span></tt> always triggers a new query and doesn’t account for previous filtering. </font><font id="472">As such, it should generally be called from the <tt class="docutils literal"><span class="pre">Manager</span></tt> or from a fresh <tt class="docutils literal"><span class="pre">QuerySet</span></tt> instance.</font></p>
</div>
</div>
</div>
<div class="section" id="s-methods-that-do-not-return-querysets">
<span id="methods-that-do-not-return-querysets"></span><h3><font id="847">不会返回QuerySets的方法</font><a class="headerlink" href="querysets.html#methods-that-do-not-return-querysets" title="Permalink to this headline">¶</a></h3>
<p><font id="473">The following <tt class="docutils literal"><span class="pre">QuerySet</span></tt> methods evaluate the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> and return something <em>other than</em> a <tt class="docutils literal"><span class="pre">QuerySet</span></tt>.</font></p>
<p><font id="474">These methods do not use a cache (see <a class="reference internal" href="../../topics/db/queries.html#caching-and-querysets"><em>Caching and QuerySets</em></a>). </font><font id="475">这些方法每次被调用的时候都会查询数据库。</font></p>
<div class="section" id="s-get">
<span id="get"></span><h4><font id="878">get</font><a class="headerlink" href="querysets.html#get" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.get">
<tt class="descname">get</tt>(<em>**kwargs</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="476">返回按照查询参数匹配到的对象，参数的格式应该符合 <a class="reference internal" href="querysets.html#id4">Field lookups</a>的要求.</font></p>
<p><font id="477">如果匹配到的对象个数不只一个的话，<tt class="docutils literal"><span class="pre">get()</span></tt> 将会触发<a class="reference internal" href="../exceptions.html#django.core.exceptions.MultipleObjectsReturned" title="django.core.exceptions.MultipleObjectsReturned"><tt class="xref py py-exc docutils literal"><span class="pre">MultipleObjectsReturned</span></tt></a> 异常. </font><font id="478"><a class="reference internal" href="../exceptions.html#django.core.exceptions.MultipleObjectsReturned" title="django.core.exceptions.MultipleObjectsReturned"><tt class="xref py py-exc docutils literal"><span class="pre">MultipleObjectsReturned</span></tt></a> 异常是模型类的属性.</font></p>
<p><font id="479">如果根据给出的参数匹配不到对象的话，<tt class="docutils literal"><span class="pre">get()</span></tt> 将触发<a class="reference internal" href="instances.html#django.db.models.Model.DoesNotExist" title="django.db.models.Model.DoesNotExist"><tt class="xref py py-exc docutils literal"><span class="pre">DoesNotExist</span></tt></a> 异常. </font><font id="480">这个异常是模型类的属性. </font><font id="481">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s">'foo'</span><span class="p">)</span> <span class="c"># raises Entry.DoesNotExist</span>
</pre></div>
</div>
<p><font id="482">The <a class="reference internal" href="instances.html#django.db.models.Model.DoesNotExist" title="django.db.models.Model.DoesNotExist"><tt class="xref py py-exc docutils literal"><span class="pre">DoesNotExist</span></tt></a> exception inherits from <a class="reference internal" href="../exceptions.html#django.core.exceptions.ObjectDoesNotExist" title="django.core.exceptions.ObjectDoesNotExist"><tt class="xref py py-exc docutils literal"><span class="pre">django.core.exceptions.ObjectDoesNotExist</span></tt></a>, so you can target multiple <a class="reference internal" href="instances.html#django.db.models.Model.DoesNotExist" title="django.db.models.Model.DoesNotExist"><tt class="xref py py-exc docutils literal"><span class="pre">DoesNotExist</span></tt></a> exceptions. </font><font id="483">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ObjectDoesNotExist</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Either the entry or blog doesn't exist."</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-create">
<span id="create"></span><h4><font id="879">create</font><a class="headerlink" href="querysets.html#create" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.create">
<tt class="descname">create</tt>(<em>**kwargs</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.create" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="484">一个在一步操作中同时创建对象并且保存的便捷方法. </font><font id="485">Thus:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s">"Bruce"</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s">"Springsteen"</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="486">and:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s">"Bruce"</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s">"Springsteen"</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">force_insert</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="487">are equivalent.</font></p>
<p><font id="488">参数 <a class="reference internal" href="instances.html#ref-models-force-insert"><em>force_insert</em></a> 在其他的文档中有介绍, 它意味着一个新的对象一定会被创建. </font><font id="489">正常情况中，你不必要担心这点. </font><font id="490">然而, 如果你的model中有一个你手动设置主键， 并且这个值已经存在于数据库中, 调用 <tt class="docutils literal"><span class="pre">create()</span></tt>将会失败并且触发 <a class="reference internal" href="../exceptions.html#django.db.IntegrityError" title="django.db.IntegrityError"><tt class="xref py py-exc docutils literal"><span class="pre">IntegrityError</span></tt></a> 因为主键必须是唯一的. </font><font id="491">如果你手动设置了主键，做好异常处理的准备.</font></p>
</div>
<div class="section" id="s-get-or-create">
<span id="get-or-create"></span><h4><font id="880">get_or_create</font><a class="headerlink" href="querysets.html#get-or-create" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.get_or_create">
<tt class="descname">get_or_create</tt>(<em>defaults=None</em>, <em>**kwargs</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.get_or_create" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="492">一个通过给出的 <tt class="docutils literal"><span class="pre">kwargs</span></tt>(如果你的model中的所有field都有默认值的话，关键字可能为空)来查询对象的便捷方法 , 如果需要的话创建一个对象。</font></p>
<p><font id="493">返回一个由 <tt class="docutils literal"><span class="pre">(object,</span> <span class="pre">created)</span></tt>组成的元组, 元组中的 <tt class="docutils literal"><span class="pre">object</span></tt> 是一个查询到的或者是被创建的对象， <tt class="docutils literal"><span class="pre">created</span></tt> 是一个标示是否创建了新的对象的布尔值.</font></p>
<p><font id="494">This is meant as a shortcut to boilerplatish code. </font><font id="495">For example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s">'John'</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s">'Lennon'</span><span class="p">)</span>
<span class="k">except</span> <span class="n">Person</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s">'John'</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s">'Lennon'</span><span class="p">,</span> <span class="n">birthday</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="496">如果model的field数量较大的话，这种模式就变的非常不易用了. </font><font id="497">上面的示例可以用<tt class="docutils literal"><span class="pre">get_or_create()</span></tt>重写 &nbsp;:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">obj</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s">'John'</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s">'Lennon'</span><span class="p">,</span>
                  <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s">'birthday'</span><span class="p">:</span> <span class="n">date</span><span class="p">(</span><span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">)})</span>
</pre></div>
</div>
<p><font id="498">任何传递给 <tt class="docutils literal"><span class="pre">get_or_create()</span></tt>的关键字参数 — <em>除了一个可选的</em> <tt class="docutils literal"><span class="pre">defaults</span></tt> — 都将传递给<a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.get" title="django.db.models.query.QuerySet.get"><tt class="xref py py-meth docutils literal"><span class="pre">get()</span></tt></a>调用 . </font><font id="499">如果查找到一个对象, <tt class="docutils literal"><span class="pre">get_or_create()</span></tt> 返回一个包含匹配到的object以及 <tt class="docutils literal"><span class="pre">False</span></tt>组成的元组. </font><font id="500">如果查找到的对象超过一个以上, <tt class="docutils literal"><span class="pre">get_or_create</span></tt> 将触发<a class="reference internal" href="../exceptions.html#django.core.exceptions.MultipleObjectsReturned" title="django.core.exceptions.MultipleObjectsReturned"><tt class="xref py py-exc docutils literal"><span class="pre">MultipleObjectsReturned</span></tt></a>. </font><font id="501">&nbsp;<em>如果查找不到对象</em> , <tt class="docutils literal"><span class="pre">get_or_create()</span></tt> 将会实例化并且保存一个新的对象, 返回一个由新的object以及<tt class="docutils literal"><span class="pre">True</span></tt>组成的元组. </font><font id="502">新的对象将会大概按照以下的逻辑创建:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s">'__'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">}</span>
<span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
<span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="503">In English, that means start with any non-<tt class="docutils literal"><span class="pre">'defaults'</span></tt> keyword argument that doesn’t contain a double underscore (which would indicate a non-exact lookup). </font><font id="504">Then add the contents of <tt class="docutils literal"><span class="pre">defaults</span></tt>, overriding any keys if necessary, and use the result as the keyword arguments to the model class. </font><font id="505">As hinted at above, this is a simplification of the algorithm that is used, but it contains all the pertinent details. </font><font id="506">The internal implementation has some more error-checking than this and handles some extra edge-conditions; </font><font id="507">if you’re interested, read the code.</font></p>
<p><font id="508">如果你有一个名为 <tt class="docutils literal"><span class="pre">defaults</span></tt>的字段，并且想用 <tt class="docutils literal"><span class="pre">get_or_create()</span></tt>查询这个字段, 就像下面示例中用<tt class="docutils literal"><span class="pre">'defaults__exact'</span></tt>:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Foo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">defaults__exact</span><span class="o">=</span><span class="s">'bar'</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s">'defaults'</span><span class="p">:</span> <span class="s">'baz'</span><span class="p">})</span>
</pre></div>
</div>
<p><font id="509">当你使用手动指定主键的时候，<tt class="docutils literal"><span class="pre">get_or_create()</span></tt> 方法将会有与 <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.create" title="django.db.models.query.QuerySet.create"><tt class="xref py py-meth docutils literal"><span class="pre">create()</span></tt></a>一样的表现. </font><font id="510">如果需要创建一个对象，并且它的主键以及在数据库中存在了的话 , &nbsp;<a class="reference internal" href="../exceptions.html#django.db.IntegrityError" title="django.db.IntegrityError"><tt class="xref py py-exc docutils literal"><span class="pre">IntegrityError</span></tt></a>异常将会被触发.</font></p>
<p><font id="511">This method is atomic assuming correct usage, correct database configuration, and correct behavior of the underlying database. </font><font id="512">However, if uniqueness is not enforced at the database level for the <tt class="docutils literal"><span class="pre">kwargs</span></tt> used in a <tt class="docutils literal"><span class="pre">get_or_create</span></tt> call (see <a class="reference internal" href="fields.html#django.db.models.Field.unique" title="django.db.models.Field.unique"><tt class="xref py py-attr docutils literal"><span class="pre">unique</span></tt></a> or <a class="reference internal" href="options.html#django.db.models.Options.unique_together" title="django.db.models.Options.unique_together"><tt class="xref py py-attr docutils literal"><span class="pre">unique_together</span></tt></a>), this method is prone to a race-condition which can result in multiple rows with the same parameters being inserted simultaneously.</font></p>
<p><font id="513">If you are using MySQL, be sure to use the <tt class="docutils literal"><span class="pre">READ</span> <span class="pre">COMMITTED</span></tt> isolation level rather than <tt class="docutils literal"><span class="pre">REPEATABLE</span> <span class="pre">READ</span></tt> (the default), otherwise you may see cases where <tt class="docutils literal"><span class="pre">get_or_create</span></tt> will raise an <a class="reference internal" href="../exceptions.html#django.db.IntegrityError" title="django.db.IntegrityError"><tt class="xref py py-exc docutils literal"><span class="pre">IntegrityError</span></tt></a> but the object won’t appear in a subsequent <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.get" title="django.db.models.query.QuerySet.get"><tt class="xref py py-meth docutils literal"><span class="pre">get()</span></tt></a> call.</font></p>
<p><font id="514">Finally, a word on using <tt class="docutils literal"><span class="pre">get_or_create()</span></tt> in Django views. </font><font id="515">Please make sure to use it only in <tt class="docutils literal"><span class="pre">POST</span></tt> requests unless you have a good reason not to. </font><font id="516"><tt class="docutils literal"><span class="pre">GET</span></tt> requests shouldn’t have any effect on data. </font><font id="517">Instead, use <tt class="docutils literal"><span class="pre">POST</span></tt> whenever a request to a page has a side effect on your data. </font><font id="518">For more, see <a class="reference external" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.1.1">Safe methods</a> in the HTTP spec.</font></p>
<div class="admonition warning">
<p class="first admonition-title"><font id="519">Warning</font></p>
<p><font id="520">You can use <tt class="docutils literal"><span class="pre">get_or_create()</span></tt> through <a class="reference internal" href="fields.html#django.db.models.ManyToManyField" title="django.db.models.ManyToManyField"><tt class="xref py py-class docutils literal"><span class="pre">ManyToManyField</span></tt></a> attributes and reverse relations. </font><font id="521">In that case you will restrict the queries inside the context of that relation. </font><font id="522">That could lead you to some integrity problems if you don’t use it consistently.</font></p>
<p><font id="523">Being the following models:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Chapter</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
    <span class="n">chapters</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Chapter</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="524">You can use <tt class="docutils literal"><span class="pre">get_or_create()</span></tt> through Book’s chapters field, but it only fetches inside the context of that book:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Ulysses"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">chapters</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Telemachus"</span><span class="p">)</span>
<span class="go">(&lt;Chapter: Telemachus&gt;, True)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">chapters</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Telemachus"</span><span class="p">)</span>
<span class="go">(&lt;Chapter: Telemachus&gt;, False)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chapter</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Chapter 1"</span><span class="p">)</span>
<span class="go">&lt;Chapter: Chapter 1&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">chapters</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Chapter 1"</span><span class="p">)</span>
<span class="go"># Raises IntegrityError</span>
</pre></div>
</div>
<p class="last"><font id="525">This is happening because it’s trying to get or create “Chapter 1” through the book “Ulysses”, but it can’t do any of them: the relation can’t fetch that chapter because it isn’t related to that book, but it can’t create it either because <tt class="docutils literal"><span class="pre">title</span></tt> field should be unique.</font></p>
</div>
</div>
<div class="section" id="s-update-or-create">
<span id="update-or-create"></span><h4><font id="881">update_or_create</font><a class="headerlink" href="querysets.html#update-or-create" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.update_or_create">
<tt class="descname">update_or_create</tt>(<em>defaults=None</em>, <em>**kwargs</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.update_or_create" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<div class="versionadded">
<span class="title">New in Django 1.7.</span> </div>
<p><font id="526">一个通过给出的<tt class="docutils literal"><span class="pre">kwargs</span></tt>来更新对象的便捷方法 , 如果需要的话创建一个对象 . </font><font id="527">参数 <tt class="docutils literal"><span class="pre">defaults</span></tt> 是一个由 (field, value) 对组成的字典，用于更新对象.</font></p>
<p><font id="528">返回一个由 <tt class="docutils literal"><span class="pre">(object,</span> <span class="pre">created)</span></tt>组成的元组, 元组中的 &nbsp;<tt class="docutils literal"><span class="pre">object</span></tt> 是一个创建的或者是被更新的对象， &nbsp;<tt class="docutils literal"><span class="pre">created</span></tt> 是一个标示是否创建了新的对象的布尔值 .</font></p>
<p><font id="529"><tt class="docutils literal"><span class="pre">update_or_create</span></tt> 方法尝试通过给出的<tt class="docutils literal"><span class="pre">kwargs</span></tt>去从数据库中获取匹配的对象 . </font><font id="530">如果找到匹配的对象，它将会依据<tt class="docutils literal"><span class="pre">defaults</span></tt>字典给出的值更新字段.</font></p>
<p><font id="531">This is meant as a shortcut to boilerplatish code. </font><font id="532">For example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s">'John'</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s">'Lennon'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">updated_values</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="k">except</span> <span class="n">Person</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
    <span class="n">updated_values</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">'first_name'</span><span class="p">:</span> <span class="s">'John'</span><span class="p">,</span> <span class="s">'last_name'</span><span class="p">:</span> <span class="s">'Lennon'</span><span class="p">})</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="o">**</span><span class="n">updated_values</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="533">如果model的field数量较大的话，这种模式就变的非常不易用了.&nbsp;</font><font id="534">上面的示例可以用 <tt class="docutils literal"><span class="pre">update_or_create()</span></tt> 重写:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">obj</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">update_or_create</span><span class="p">(</span>
    <span class="n">first_name</span><span class="o">=</span><span class="s">'John'</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s">'Lennon'</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="n">updated_values</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="535">For detailed description how names passed in <tt class="docutils literal"><span class="pre">kwargs</span></tt> are resolved see <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.get_or_create" title="django.db.models.query.QuerySet.get_or_create"><tt class="xref py py-meth docutils literal"><span class="pre">get_or_create()</span></tt></a>.</font></p>
<p><font id="536">As described above in <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.get_or_create" title="django.db.models.query.QuerySet.get_or_create"><tt class="xref py py-meth docutils literal"><span class="pre">get_or_create()</span></tt></a>, this method is prone to a race-condition which can result in multiple rows being inserted simultaneously if uniqueness is not enforced at the database level.</font></p>
</div>
<div class="section" id="s-bulk-create">
<span id="bulk-create"></span><h4><font id="882">bulk_create</font><a class="headerlink" href="querysets.html#bulk-create" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.bulk_create">
<tt class="descname">bulk_create</tt>(<em>objs</em>, <em>batch_size=None</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.bulk_create" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="537">This method inserts the provided list of objects into the database in an efficient manner (generally only 1 query, no matter how many objects there are):</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">bulk_create</span><span class="p">([</span>
<span class="gp">... </span>    <span class="n">Entry</span><span class="p">(</span><span class="n">headline</span><span class="o">=</span><span class="s">"Django 1.0 Released"</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">Entry</span><span class="p">(</span><span class="n">headline</span><span class="o">=</span><span class="s">"Django 1.1 Announced"</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">Entry</span><span class="p">(</span><span class="n">headline</span><span class="o">=</span><span class="s">"Breaking: Django is awesome"</span><span class="p">)</span>
<span class="gp">... </span><span class="p">])</span>
</pre></div>
</div>
<p><font id="538">This has a number of caveats though:</font></p>
<ul class="simple">
<li><font id="937">The model’s <tt class="docutils literal"><span class="pre">save()</span></tt> method will not be called, and the <tt class="docutils literal"><span class="pre">pre_save</span></tt> and <tt class="docutils literal"><span class="pre">post_save</span></tt> signals will not be sent.</font></li>
<li><font id="938">It does not work with child models in a multi-table inheritance scenario.</font></li>
<li><font id="939">If the model’s primary key is an <a class="reference internal" href="fields.html#django.db.models.AutoField" title="django.db.models.AutoField"><tt class="xref py py-class docutils literal"><span class="pre">AutoField</span></tt></a> it does not retrieve and set the primary key attribute, as <tt class="docutils literal"><span class="pre">save()</span></tt> does.</font></li>
<li><font id="940">It does not work with many-to-many relationships.</font></li>
</ul>
<p><font id="539">The <tt class="docutils literal"><span class="pre">batch_size</span></tt> parameter controls how many objects are created in single query. </font><font id="540">The default is to create all objects in one batch, except for SQLite where the default is such that at most 999 variables per query are used.</font></p>
</div>
<div class="section" id="s-count">
<span id="count"></span><h4><font id="883">count</font><a class="headerlink" href="querysets.html#count" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.count">
<tt class="descname">count</tt>()<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.count" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="541">Returns an integer representing the number of objects in the database matching the <tt class="docutils literal"><span class="pre">QuerySet</span></tt>. </font><font id="542">The <tt class="docutils literal"><span class="pre">count()</span></tt> method never raises exceptions.</font></p>
<p><font id="543">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Returns the total number of entries in the database.</span>
<span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="c"># Returns the number of entries whose headline contains 'Lennon'</span>
<span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__contains</span><span class="o">=</span><span class="s">'Lennon'</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="544">A <tt class="docutils literal"><span class="pre">count()</span></tt> call performs a <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">COUNT(*)</span></tt> behind the scenes, so you should always use <tt class="docutils literal"><span class="pre">count()</span></tt> rather than loading all of the record into Python objects and calling <tt class="docutils literal"><span class="pre">len()</span></tt> on the result (unless you need to load the objects into memory anyway, in which case <tt class="docutils literal"><span class="pre">len()</span></tt> will be faster).</font></p>
<p><font id="545">Depending on which database you’re using (e.g. PostgreSQL vs. MySQL), <tt class="docutils literal"><span class="pre">count()</span></tt> may return a long integer instead of a normal Python integer. </font><font id="546">This is an underlying implementation quirk that shouldn’t pose any real-world problems.</font></p>
<p><font id="547">Note that if you want the number of items in a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> and are also retrieving model instances from it (for example, by iterating over it), it’s probably more efficient to use <tt class="docutils literal"><span class="pre">len(queryset)</span></tt> which won’t cause an extra database query like <tt class="docutils literal"><span class="pre">count()</span></tt> would.</font></p>
</div>
<div class="section" id="s-in-bulk">
<span id="in-bulk"></span><h4><font id="884">in_bulk</font><a class="headerlink" href="querysets.html#in-bulk" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.in_bulk">
<tt class="descname">in_bulk</tt>(<em>id_list</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.in_bulk" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="548">Takes a list of primary-key values and returns a dictionary mapping each primary-key value to an instance of the object with the given ID.</font></p>
<p><font id="549">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">in_bulk</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
<span class="go">{1: &lt;Blog: Beatles Blog&gt;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">in_bulk</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="go">{1: &lt;Blog: Beatles Blog&gt;, 2: &lt;Blog: Cheddar Talk&gt;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">in_bulk</span><span class="p">([])</span>
<span class="go">{}</span>
</pre></div>
</div>
<p><font id="550">If you pass <tt class="docutils literal"><span class="pre">in_bulk()</span></tt> an empty list, you’ll get an empty dictionary.</font></p>
</div>
<div class="section" id="s-iterator">
<span id="iterator"></span><h4><font id="885">iterator</font><a class="headerlink" href="querysets.html#iterator" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.iterator">
<tt class="descname">iterator</tt>()<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.iterator" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="551">Evaluates the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> (by performing the query) and returns an iterator (see <span class="target" id="index-0"></span><a class="pep reference external" href="http://www.python.org/dev/peps/pep-0234"><strong>PEP 234</strong></a>) over the results. </font><font id="552">A <tt class="docutils literal"><span class="pre">QuerySet</span></tt> typically caches its results internally so that repeated evaluations do not result in additional queries. </font><font id="553">In contrast, <tt class="docutils literal"><span class="pre">iterator()</span></tt> will read results directly, without doing any caching at the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> level (internally, the default iterator calls <tt class="docutils literal"><span class="pre">iterator()</span></tt> and caches the return value). </font><font id="554">For a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> which returns a large number of objects that you only need to access once, this can result in better performance and a significant reduction in memory.</font></p>
<p><font id="555">Note that using <tt class="docutils literal"><span class="pre">iterator()</span></tt> on a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> which has already been evaluated will force it to evaluate again, repeating the query.</font></p>
<p><font id="556">Also, use of <tt class="docutils literal"><span class="pre">iterator()</span></tt> causes previous <tt class="docutils literal"><span class="pre">prefetch_related()</span></tt> calls to be ignored since these two optimizations do not make sense together.</font></p>
<div class="admonition warning">
<p class="first admonition-title"><font id="557">Warning</font></p>
<p class="last"><font id="558">Some Python database drivers like <tt class="docutils literal"><span class="pre">psycopg2</span></tt> perform caching if using client side cursors (instantiated with <tt class="docutils literal"><span class="pre">connection.cursor()</span></tt> and what Django’s ORM uses). </font><font id="559">Using <tt class="docutils literal"><span class="pre">iterator()</span></tt> does not affect caching at the database driver level. </font><font id="560">To disable this caching, look at <a class="reference external" href="http://initd.org/psycopg/docs/usage.html#server-side-cursors">server side cursors</a>.</font></p>
</div>
</div>
<div class="section" id="s-latest">
<span id="latest"></span><h4><font id="886">latest</font><a class="headerlink" href="querysets.html#latest" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.latest">
<tt class="descname">latest</tt>(<em>field_name=None</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.latest" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="561">Returns the latest object in the table, by date, using the <tt class="docutils literal"><span class="pre">field_name</span></tt> provided as the date field.</font></p>
<p><font id="562">This example returns the latest <tt class="docutils literal"><span class="pre">Entry</span></tt> in the table, according to the <tt class="docutils literal"><span class="pre">pub_date</span></tt> field:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">latest</span><span class="p">(</span><span class="s">'pub_date'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="563">If your model’s <a class="reference internal" href="../../topics/db/models.html#meta-options"><em>Meta</em></a> specifies <a class="reference internal" href="options.html#django.db.models.Options.get_latest_by" title="django.db.models.Options.get_latest_by"><tt class="xref py py-attr docutils literal"><span class="pre">get_latest_by</span></tt></a>, you can leave off the <tt class="docutils literal"><span class="pre">field_name</span></tt> argument to <tt class="docutils literal"><span class="pre">earliest()</span></tt> or <tt class="docutils literal"><span class="pre">latest()</span></tt>. </font><font id="564">Django will use the field specified in <a class="reference internal" href="options.html#django.db.models.Options.get_latest_by" title="django.db.models.Options.get_latest_by"><tt class="xref py py-attr docutils literal"><span class="pre">get_latest_by</span></tt></a> by default.</font></p>
<p><font id="565">Like <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.get" title="django.db.models.query.QuerySet.get"><tt class="xref py py-meth docutils literal"><span class="pre">get()</span></tt></a>, <tt class="docutils literal"><span class="pre">earliest()</span></tt> and <tt class="docutils literal"><span class="pre">latest()</span></tt> raise <a class="reference internal" href="instances.html#django.db.models.Model.DoesNotExist" title="django.db.models.Model.DoesNotExist"><tt class="xref py py-exc docutils literal"><span class="pre">DoesNotExist</span></tt></a> if there is no object with the given parameters.</font></p>
<p><font id="566">Note that <tt class="docutils literal"><span class="pre">earliest()</span></tt> and <tt class="docutils literal"><span class="pre">latest()</span></tt> exist purely for convenience and readability.</font></p>
</div>
<div class="section" id="s-earliest">
<span id="earliest"></span><h4><font id="887">earliest</font><a class="headerlink" href="querysets.html#earliest" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.earliest">
<tt class="descname">earliest</tt>(<em>field_name=None</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.earliest" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="567">Works otherwise like <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.latest" title="django.db.models.query.QuerySet.latest"><tt class="xref py py-meth docutils literal"><span class="pre">latest()</span></tt></a> except the direction is changed.</font></p>
</div>
<div class="section" id="s-first">
<span id="first"></span><h4><font id="888">first</font><a class="headerlink" href="querysets.html#first" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.first">
<tt class="descname">first</tt>()<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.first" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="568">Returns the first object matched by the queryset, or <tt class="docutils literal"><span class="pre">None</span></tt> if there is no matching object. </font><font id="569">If the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> has no ordering defined, then the queryset is automatically ordered by the primary key.</font></p>
<p><font id="570">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">p</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'title'</span><span class="p">,</span> <span class="s">'pub_date'</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="571">Note that <tt class="docutils literal"><span class="pre">first()</span></tt> is a convenience method, the following code sample is equivalent to the above example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'title'</span><span class="p">,</span> <span class="s">'pub_date'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
</div>
</div>
<div class="section" id="s-last">
<span id="last"></span><h4><font id="889">last</font><a class="headerlink" href="querysets.html#last" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.last">
<tt class="descname">last</tt>()<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.last" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="572">Works like <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.first" title="django.db.models.query.QuerySet.first"><tt class="xref py py-meth docutils literal"><span class="pre">first()</span></tt></a>, but returns the last object in the queryset.</font></p>
</div>
<div class="section" id="s-aggregate">
<span id="aggregate"></span><h4><font id="890">aggregate</font><a class="headerlink" href="querysets.html#aggregate" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.aggregate">
<tt class="descname">aggregate</tt>(<em>*args</em>, <em>**kwargs</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.aggregate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="573">Returns a dictionary of aggregate values (averages, sums, etc) calculated over the <tt class="docutils literal"><span class="pre">QuerySet</span></tt>. </font><font id="574">Each argument to <tt class="docutils literal"><span class="pre">aggregate()</span></tt> specifies a value that will be included in the dictionary that is returned.</font></p>
<p><font id="575">The aggregation functions that are provided by Django are described in <a class="reference internal" href="querysets.html#id5">Aggregation Functions</a> below. </font><font id="576">Since aggregates are also <a class="reference internal" href="expressions.html"><em>query expressions</em></a>, you may combine aggregates with other aggregates or values to create complex aggregates.</font></p>
<p><font id="577">Aggregates specified using keyword arguments will use the keyword as the name for the annotation. </font><font id="578">Anonymous arguments will have a name generated for them based upon the name of the aggregate function and the model field that is being aggregated. </font><font id="579">Complex aggregates cannot use anonymous arguments and must specify a keyword argument as an alias.</font></p>
<p><font id="580">For example, when you are working with blog entries, you may want to know the number of authors that have contributed blog entries:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Count</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">Count</span><span class="p">(</span><span class="s">'entry'</span><span class="p">))</span>
<span class="go">{'entry__count': 16}</span>
</pre></div>
</div>
<p><font id="581">By using a keyword argument to specify the aggregate function, you can control the name of the aggregation value that is returned:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">number_of_entries</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">'entry'</span><span class="p">))</span>
<span class="go">{'number_of_entries': 16}</span>
</pre></div>
</div>
<p><font id="582">For an in-depth discussion of aggregation, see <a class="reference internal" href="../../topics/db/aggregation.html"><em>the topic guide on Aggregation</em></a>.</font></p>
</div>
<div class="section" id="s-exists">
<span id="exists"></span><h4><font id="891">exists</font><a class="headerlink" href="querysets.html#exists" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.exists">
<tt class="descname">exists</tt>()<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.exists" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="583">Returns <tt class="docutils literal"><span class="pre">True</span></tt> if the <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet" title="django.db.models.query.QuerySet"><tt class="xref py py-class docutils literal"><span class="pre">QuerySet</span></tt></a> contains any results, and <tt class="docutils literal"><span class="pre">False</span></tt> if not. </font><font id="584">This tries to perform the query in the simplest and fastest way possible, but it <em>does</em> execute nearly the same query as a normal <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet" title="django.db.models.query.QuerySet"><tt class="xref py py-class docutils literal"><span class="pre">QuerySet</span></tt></a> query.</font></p>
<p><font id="585"><a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.exists" title="django.db.models.query.QuerySet.exists"><tt class="xref py py-meth docutils literal"><span class="pre">exists()</span></tt></a> is useful for searches relating to both object membership in a <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet" title="django.db.models.query.QuerySet"><tt class="xref py py-class docutils literal"><span class="pre">QuerySet</span></tt></a> and to the existence of any objects in a <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet" title="django.db.models.query.QuerySet"><tt class="xref py py-class docutils literal"><span class="pre">QuerySet</span></tt></a>, particularly in the context of a large <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet" title="django.db.models.query.QuerySet"><tt class="xref py py-class docutils literal"><span class="pre">QuerySet</span></tt></a>.</font></p>
<p><font id="586">The most efficient method of finding whether a model with a unique field (e.g. <tt class="docutils literal"><span class="pre">primary_key</span></tt>) is a member of a <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet" title="django.db.models.query.QuerySet"><tt class="xref py py-class docutils literal"><span class="pre">QuerySet</span></tt></a> is:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">entry</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="k">if</span> <span class="n">some_queryset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Entry contained in queryset"</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="587">Which will be faster than the following which requires evaluating and iterating through the entire queryset:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">some_queryset</span><span class="p">:</span>
   <span class="k">print</span><span class="p">(</span><span class="s">"Entry contained in QuerySet"</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="588">And to find whether a queryset contains any items:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">some_queryset</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"There is at least one object in some_queryset"</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="589">Which will be faster than:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">some_queryset</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"There is at least one object in some_queryset"</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="590">... but not by a large degree (hence needing a large queryset for efficiency gains).</font></p>
<p><font id="591">Additionally, if a <tt class="docutils literal"><span class="pre">some_queryset</span></tt> has not yet been evaluated, but you know that it will be at some point, then using <tt class="docutils literal"><span class="pre">some_queryset.exists()</span></tt> will do more overall work (one query for the existence check plus an extra one to later retrieve the results) than simply using <tt class="docutils literal"><span class="pre">bool(some_queryset)</span></tt>, which retrieves the results and then checks if any were returned.</font></p>
</div>
<div class="section" id="s-update">
<span id="update"></span><h4><font id="892">update</font><a class="headerlink" href="querysets.html#update" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.update">
<tt class="descname">update</tt>(<em>**kwargs</em>)<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.update" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="592">Performs an SQL update query for the specified fields, and returns the number of rows matched (which may not be equal to the number of rows updated if some rows already have the new value).</font></p>
<p><font id="593">For example, to turn comments off for all blog entries published in 2010, you could do this:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__year</span><span class="o">=</span><span class="mi">2010</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">comments_on</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="594">(This assumes your <tt class="docutils literal"><span class="pre">Entry</span></tt> model has fields <tt class="docutils literal"><span class="pre">pub_date</span></tt> and <tt class="docutils literal"><span class="pre">comments_on</span></tt>.)</font></p>
<p><font id="595">You can update multiple fields — there’s no limit on how many. </font><font id="596">For example, here we update the <tt class="docutils literal"><span class="pre">comments_on</span></tt> and <tt class="docutils literal"><span class="pre">headline</span></tt> fields:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__year</span><span class="o">=</span><span class="mi">2010</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">comments_on</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">headline</span><span class="o">=</span><span class="s">'This is old'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="597">The <tt class="docutils literal"><span class="pre">update()</span></tt> method is applied instantly, and the only restriction on the <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet" title="django.db.models.query.QuerySet"><tt class="xref py py-class docutils literal"><span class="pre">QuerySet</span></tt></a> that is updated is that it can only update columns in the model’s main table, not on related models. </font><font id="598">You can’t do this, for example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">blog__name</span><span class="o">=</span><span class="s">'foo'</span><span class="p">)</span> <span class="c"># Won't work!</span>
</pre></div>
</div>
<p><font id="599">Filtering based on related fields is still possible, though:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog__id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">comments_on</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="600">You cannot call <tt class="docutils literal"><span class="pre">update()</span></tt> on a <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet" title="django.db.models.query.QuerySet"><tt class="xref py py-class docutils literal"><span class="pre">QuerySet</span></tt></a> that has had a slice taken or can otherwise no longer be filtered.</font></p>
<p><font id="601">The <tt class="docutils literal"><span class="pre">update()</span></tt> method returns the number of affected rows:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">comments_on</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">1</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="s">'nonexistent-slug'</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">comments_on</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">0</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__year</span><span class="o">=</span><span class="mi">2010</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">comments_on</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">132</span>
</pre></div>
</div>
<p><font id="602">If you’re just updating a record and don’t need to do anything with the model object, the most efficient approach is to call <tt class="docutils literal"><span class="pre">update()</span></tt>, rather than loading the model object into memory. </font><font id="603">For example, instead of doing this:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">e</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">e</span><span class="o">.</span><span class="n">comments_on</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">e</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="604">...do this:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">comments_on</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="605">Using <tt class="docutils literal"><span class="pre">update()</span></tt> also prevents a race condition wherein something might change in your database in the short period of time between loading the object and calling <tt class="docutils literal"><span class="pre">save()</span></tt>.</font></p>
<p><font id="606">Finally, realize that <tt class="docutils literal"><span class="pre">update()</span></tt> does an update at the SQL level and, thus, does not call any <tt class="docutils literal"><span class="pre">save()</span></tt> methods on your models, nor does it emit the <a class="reference internal" href="../signals.html#django.db.models.signals.pre_save" title="django.db.models.signals.pre_save"><tt class="xref py py-attr docutils literal"><span class="pre">pre_save</span></tt></a> or <a class="reference internal" href="../signals.html#django.db.models.signals.post_save" title="django.db.models.signals.post_save"><tt class="xref py py-attr docutils literal"><span class="pre">post_save</span></tt></a> signals (which are a consequence of calling <a class="reference internal" href="instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><tt class="xref py py-meth docutils literal"><span class="pre">Model.save()</span></tt></a>). </font><font id="607">If you want to update a bunch of records for a model that has a custom <a class="reference internal" href="instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a> method, loop over them and call <a class="reference internal" href="instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt></a>, like this:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__year</span><span class="o">=</span><span class="mi">2010</span><span class="p">):</span>
    <span class="n">e</span><span class="o">.</span><span class="n">comments_on</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">e</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="s-delete">
<span id="delete"></span><h4><font id="893">delete</font><a class="headerlink" href="querysets.html#delete" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.db.models.query.QuerySet.delete">
<tt class="descname">delete</tt>()<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.delete" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="608">Performs an SQL delete query on all rows in the <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet" title="django.db.models.query.QuerySet"><tt class="xref py py-class docutils literal"><span class="pre">QuerySet</span></tt></a>. </font><font id="609">The <tt class="docutils literal"><span class="pre">delete()</span></tt> is applied instantly. </font><font id="610">You cannot call <tt class="docutils literal"><span class="pre">delete()</span></tt> on a <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet" title="django.db.models.query.QuerySet"><tt class="xref py py-class docutils literal"><span class="pre">QuerySet</span></tt></a> that has had a slice taken or can otherwise no longer be filtered.</font></p>
<p><font id="611">For example, to delete all the entries in a particular blog:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="go"># Delete all the entries belonging to this Blog.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog</span><span class="o">=</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="612">By default, Django’s <a class="reference internal" href="fields.html#django.db.models.ForeignKey" title="django.db.models.ForeignKey"><tt class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></tt></a> emulates the SQL constraint <tt class="docutils literal"><span class="pre">ON</span> <span class="pre">DELETE</span> <span class="pre">CASCADE</span></tt> — in other words, any objects with foreign keys pointing at the objects to be deleted will be deleted along with them. </font><font id="613">For example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">blogs</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="c"># This will delete all Blogs and all of their Entry objects.</span>
<span class="n">blogs</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
<p><font id="614">This cascade behavior is customizable via the <a class="reference internal" href="fields.html#django.db.models.ForeignKey.on_delete" title="django.db.models.ForeignKey.on_delete"><tt class="xref py py-attr docutils literal"><span class="pre">on_delete</span></tt></a> argument to the <a class="reference internal" href="fields.html#django.db.models.ForeignKey" title="django.db.models.ForeignKey"><tt class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></tt></a>.</font></p>
<p><font id="615">The <tt class="docutils literal"><span class="pre">delete()</span></tt> method does a bulk delete and does not call any <tt class="docutils literal"><span class="pre">delete()</span></tt> methods on your models. </font><font id="616">It does, however, emit the <a class="reference internal" href="../signals.html#django.db.models.signals.pre_delete" title="django.db.models.signals.pre_delete"><tt class="xref py py-data docutils literal"><span class="pre">pre_delete</span></tt></a> and <a class="reference internal" href="../signals.html#django.db.models.signals.post_delete" title="django.db.models.signals.post_delete"><tt class="xref py py-data docutils literal"><span class="pre">post_delete</span></tt></a> signals for all deleted objects (including cascaded deletions).</font></p>
<p><font id="617">Django needs to fetch objects into memory to send signals and handle cascades. </font><font id="618">However, if there are no cascades and no signals, then Django may take a fast-path and delete objects without fetching into memory. </font><font id="619">For large deletes this can result in significantly reduced memory usage. </font><font id="620">The amount of executed queries can be reduced, too.</font></p>
<p><font id="621">ForeignKeys which are set to <a class="reference internal" href="fields.html#django.db.models.ForeignKey.on_delete" title="django.db.models.ForeignKey.on_delete"><tt class="xref py py-attr docutils literal"><span class="pre">on_delete</span></tt></a> <tt class="docutils literal"><span class="pre">DO_NOTHING</span></tt> do not prevent taking the fast-path in deletion.</font></p>
<p><font id="622">Note that the queries generated in object deletion is an implementation detail subject to change.</font></p>
</div>
<div class="section" id="s-as-manager">
<span id="as-manager"></span><h4><font id="894">as_manager</font><a class="headerlink" href="querysets.html#as-manager" title="Permalink to this headline">¶</a></h4>
<dl class="classmethod">
<dt id="django.db.models.query.QuerySet.as_manager">
<em class="property">classmethod </em><tt class="descname">as_manager</tt>()<a class="headerlink" href="querysets.html#django.db.models.query.QuerySet.as_manager" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<div class="versionadded">
<span class="title">New in Django 1.7.</span> </div>
<p><font id="623">Class method that returns an instance of <a class="reference internal" href="../../topics/db/managers.html#django.db.models.Manager" title="django.db.models.Manager"><tt class="xref py py-class docutils literal"><span class="pre">Manager</span></tt></a> with a copy of the <tt class="docutils literal"><span class="pre">QuerySet</span></tt>’s methods. </font><font id="624">See <a class="reference internal" href="../../topics/db/managers.html#create-manager-with-queryset-methods"><em>Creating Manager with QuerySet methods</em></a> for more details.</font></p>
</div>
</div>
<div class="section" id="s-field-lookups">
<span id="s-id4"></span><span id="field-lookups"></span><span id="id4"></span><h3><font id="848">Field lookups</font><a class="headerlink" href="querysets.html#field-lookups" title="Permalink to this headline">¶</a></h3>
<p><font id="625">Field lookups are how you specify the meat of an SQL <tt class="docutils literal"><span class="pre">WHERE</span></tt> clause. </font><font id="626">They’re specified as keyword arguments to the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> methods <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.filter" title="django.db.models.query.QuerySet.filter"><tt class="xref py py-meth docutils literal"><span class="pre">filter()</span></tt></a>, <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.exclude" title="django.db.models.query.QuerySet.exclude"><tt class="xref py py-meth docutils literal"><span class="pre">exclude()</span></tt></a> and <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.get" title="django.db.models.query.QuerySet.get"><tt class="xref py py-meth docutils literal"><span class="pre">get()</span></tt></a>.</font></p>
<p><font id="627">For an introduction, see <a class="reference internal" href="../../topics/db/queries.html#field-lookups-intro"><em>models and database queries documentation</em></a>.</font></p>
<p><font id="628">Django’s inbuilt lookups are listed below. </font><font id="629">It is also possible to write <a class="reference internal" href="../../howto/custom-lookups.html"><em>custom lookups</em></a> for model fields.</font></p>
<p><font id="630">As a convenience when no lookup type is provided (like in <tt class="docutils literal"><span class="pre">Entry.objects.get(id=14)</span></tt>) the lookup type is assumed to be <a class="reference internal" href="querysets.html#std:fieldlookup-exact"><tt class="xref std std-lookup docutils literal"><span class="pre">exact</span></tt></a>.</font></p>
<div class="section" id="s-exact">
<span id="s-std:fieldlookup-exact"></span><span id="exact"></span><span id="std:fieldlookup-exact"></span><h4><font id="895">exact</font><a class="headerlink" href="querysets.html#exact" title="Permalink to this headline">¶</a></h4>
<p><font id="631">Exact match. </font><font id="632">If the value provided for comparison is <tt class="docutils literal"><span class="pre">None</span></tt>, it will be interpreted as an SQL <tt class="docutils literal"><span class="pre">NULL</span></tt> (see <a class="reference internal" href="querysets.html#std:fieldlookup-isnull"><tt class="xref std std-lookup docutils literal"><span class="pre">isnull</span></tt></a> for more details).</font></p>
<p><font id="633">Examples:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">id__exact</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">id__exact</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="634">SQL equivalents:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE id = 14;
SELECT ... WHERE id IS NULL;
</pre></div>
</div>
<div class="admonition-mysql-comparisons admonition">
<p class="first admonition-title"><font id="635">MySQL comparisons</font></p>
<p class="last"><font id="636">In MySQL, a database table’s “collation” setting determines whether <tt class="docutils literal"><span class="pre">exact</span></tt> comparisons are case-sensitive. </font><font id="637">This is a database setting, <em>not</em> a Django setting. </font><font id="638">It’s possible to configure your MySQL tables to use case-sensitive comparisons, but some trade-offs are involved. </font><font id="639">For more information about this, see the <a class="reference internal" href="../databases.html#mysql-collation"><em>collation section</em></a> in the <a class="reference internal" href="../databases.html"><em>databases</em></a> documentation.</font></p>
</div>
</div>
<div class="section" id="s-iexact">
<span id="s-std:fieldlookup-iexact"></span><span id="iexact"></span><span id="std:fieldlookup-iexact"></span><h4><font id="896">iexact</font><a class="headerlink" href="querysets.html#iexact" title="Permalink to this headline">¶</a></h4>
<p><font id="640">Case-insensitive exact match.</font></p>
<div class="versionchanged">
<span class="title">Changed in Django 1.7:</span> <p><font id="641">If the value provided for comparison is <tt class="docutils literal"><span class="pre">None</span></tt>, it will be interpreted as an SQL <tt class="docutils literal"><span class="pre">NULL</span></tt> (see <a class="reference internal" href="querysets.html#std:fieldlookup-isnull"><tt class="xref std std-lookup docutils literal"><span class="pre">isnull</span></tt></a> for more details).</font></p>
</div>
<p><font id="642">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name__iexact</span><span class="o">=</span><span class="s">'beatles blog'</span><span class="p">)</span>
<span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name__iexact</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="643">SQL equivalents:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE name ILIKE 'beatles blog';
SELECT ... WHERE name IS NULL;
</pre></div>
</div>
<p><font id="644">Note the first query will match <tt class="docutils literal"><span class="pre">'Beatles</span> <span class="pre">Blog'</span></tt>, <tt class="docutils literal"><span class="pre">'beatles</span> <span class="pre">blog'</span></tt>, <tt class="docutils literal"><span class="pre">'BeAtLes</span> <span class="pre">BLoG'</span></tt>, etc.</font></p>
<div class="admonition-sqlite-users admonition">
<p class="first admonition-title"><font id="645">SQLite users</font></p>
<p class="last"><font id="646">When using the SQLite backend and Unicode (non-ASCII) strings, bear in mind the <a class="reference internal" href="../databases.html#sqlite-string-matching"><em>database note</em></a> about string comparisons. </font><font id="647">SQLite does not do case-insensitive matching for Unicode strings.</font></p>
</div>
</div>
<div class="section" id="s-contains">
<span id="s-std:fieldlookup-contains"></span><span id="contains"></span><span id="std:fieldlookup-contains"></span><h4><font id="897">contains</font><a class="headerlink" href="querysets.html#contains" title="Permalink to this headline">¶</a></h4>
<p><font id="648">Case-sensitive containment test.</font></p>
<p><font id="649">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">headline__contains</span><span class="o">=</span><span class="s">'Lennon'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="650">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE headline LIKE '%Lennon%';
</pre></div>
</div>
<p><font id="651">Note this will match the headline <tt class="docutils literal"><span class="pre">'Lennon</span> <span class="pre">honored</span> <span class="pre">today'</span></tt> but not <tt class="docutils literal"><span class="pre">'lennon</span> <span class="pre">honored</span> <span class="pre">today'</span></tt>.</font></p>
<div class="admonition-sqlite-users admonition">
<p class="first admonition-title"><font id="652">SQLite users</font></p>
<p class="last"><font id="653">SQLite doesn’t support case-sensitive <tt class="docutils literal"><span class="pre">LIKE</span></tt> statements; </font><font id="654"><tt class="docutils literal"><span class="pre">contains</span></tt> acts like <tt class="docutils literal"><span class="pre">icontains</span></tt> for SQLite. </font><font id="655">See the <a class="reference internal" href="../databases.html#sqlite-string-matching"><em>database note</em></a> for more information.</font></p>
</div>
</div>
<div class="section" id="s-icontains">
<span id="s-std:fieldlookup-icontains"></span><span id="icontains"></span><span id="std:fieldlookup-icontains"></span><h4><font id="898">icontains</font><a class="headerlink" href="querysets.html#icontains" title="Permalink to this headline">¶</a></h4>
<p><font id="656">Case-insensitive containment test.</font></p>
<p><font id="657">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">headline__icontains</span><span class="o">=</span><span class="s">'Lennon'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="658">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE headline ILIKE '%Lennon%';
</pre></div>
</div>
<div class="admonition-sqlite-users admonition">
<p class="first admonition-title"><font id="659">SQLite users</font></p>
<p class="last"><font id="660">When using the SQLite backend and Unicode (non-ASCII) strings, bear in mind the <a class="reference internal" href="../databases.html#sqlite-string-matching"><em>database note</em></a> about string comparisons.</font></p>
</div>
</div>
<div class="section" id="s-in">
<span id="s-std:fieldlookup-in"></span><span id="in"></span><span id="std:fieldlookup-in"></span><h4><font id="899">in</font><a class="headerlink" href="querysets.html#in" title="Permalink to this headline">¶</a></h4>
<p><font id="661">In a given list.</font></p>
<p><font id="662">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
<p><font id="663">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE id IN (1, 3, 4);
</pre></div>
</div>
<p><font id="664">You can also use a queryset to dynamically evaluate the list of values instead of providing a list of literal values:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">inner_qs</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__contains</span><span class="o">=</span><span class="s">'Cheddar'</span><span class="p">)</span>
<span class="n">entries</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog__in</span><span class="o">=</span><span class="n">inner_qs</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="665">This queryset will be evaluated as subselect statement:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE blog.id IN (SELECT id FROM ... WHERE NAME LIKE '%Cheddar%')
</pre></div>
</div>
<p><font id="666">If you pass in a <tt class="docutils literal"><span class="pre">ValuesQuerySet</span></tt> or <tt class="docutils literal"><span class="pre">ValuesListQuerySet</span></tt> (the result of calling <tt class="docutils literal"><span class="pre">values()</span></tt> or <tt class="docutils literal"><span class="pre">values_list()</span></tt> on a queryset) as the value to an <tt class="docutils literal"><span class="pre">__in</span></tt> lookup, you need to ensure you are only extracting one field in the result. </font><font id="667">For example, this will work (filtering on the blog names):</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">inner_qs</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__contains</span><span class="o">=</span><span class="s">'Ch'</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
<span class="n">entries</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog__name__in</span><span class="o">=</span><span class="n">inner_qs</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="668">This example will raise an exception, since the inner query is trying to extract two field values, where only one is expected:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Bad code! Will raise a TypeError.</span>
<span class="n">inner_qs</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__contains</span><span class="o">=</span><span class="s">'Ch'</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'id'</span><span class="p">)</span>
<span class="n">entries</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog__name__in</span><span class="o">=</span><span class="n">inner_qs</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-performance-considerations admonition" id="nested-queries-performance">
<p class="first admonition-title"><font id="669">Performance considerations</font></p>
<p><font id="670">Be cautious about using nested queries and understand your database server’s performance characteristics (if in doubt, benchmark!). </font><font id="671">Some database backends, most notably MySQL, don’t optimize nested queries very well. </font><font id="672">It is more efficient, in those cases, to extract a list of values and then pass that into the second query. </font><font id="673">That is, execute two queries instead of one:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">values</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="n">name__contains</span><span class="o">=</span><span class="s">'Cheddar'</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">'pk'</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">entries</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog__in</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
</pre></div>
</div>
<p class="last"><font id="674">Note the <tt class="docutils literal"><span class="pre">list()</span></tt> call around the Blog <tt class="docutils literal"><span class="pre">QuerySet</span></tt> to force execution of the first query. </font><font id="675">Without it, a nested query would be executed, because <a class="reference internal" href="../../topics/db/queries.html#querysets-are-lazy"><em>QuerySets are lazy</em></a>.</font></p>
</div>
</div>
<div class="section" id="s-gt">
<span id="s-std:fieldlookup-gt"></span><span id="gt"></span><span id="std:fieldlookup-gt"></span><h4><font id="900">gt</font><a class="headerlink" href="querysets.html#gt" title="Permalink to this headline">¶</a></h4>
<p><font id="676">Greater than.</font></p>
<p><font id="677">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__gt</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="678">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE id &gt; 4;
</pre></div>
</div>
</div>
<div class="section" id="s-gte">
<span id="s-std:fieldlookup-gte"></span><span id="gte"></span><span id="std:fieldlookup-gte"></span><h4><font id="901">gte</font><a class="headerlink" href="querysets.html#gte" title="Permalink to this headline">¶</a></h4>
<p><font id="679">Greater than or equal to.</font></p>
</div>
<div class="section" id="s-lt">
<span id="s-std:fieldlookup-lt"></span><span id="lt"></span><span id="std:fieldlookup-lt"></span><h4><font id="902">lt</font><a class="headerlink" href="querysets.html#lt" title="Permalink to this headline">¶</a></h4>
<p><font id="680">Less than.</font></p>
</div>
<div class="section" id="s-lte">
<span id="s-std:fieldlookup-lte"></span><span id="lte"></span><span id="std:fieldlookup-lte"></span><h4><font id="903">lte</font><a class="headerlink" href="querysets.html#lte" title="Permalink to this headline">¶</a></h4>
<p><font id="681">Less than or equal to.</font></p>
</div>
<div class="section" id="s-startswith">
<span id="s-std:fieldlookup-startswith"></span><span id="startswith"></span><span id="std:fieldlookup-startswith"></span><h4><font id="904">startswith</font><a class="headerlink" href="querysets.html#startswith" title="Permalink to this headline">¶</a></h4>
<p><font id="682">Case-sensitive starts-with.</font></p>
<p><font id="683">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__startswith</span><span class="o">=</span><span class="s">'Will'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="684">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE headline LIKE 'Will%';
</pre></div>
</div>
<p><font id="685">SQLite doesn’t support case-sensitive <tt class="docutils literal"><span class="pre">LIKE</span></tt> statements; </font><font id="686"><tt class="docutils literal"><span class="pre">startswith</span></tt> acts like <tt class="docutils literal"><span class="pre">istartswith</span></tt> for SQLite.</font></p>
</div>
<div class="section" id="s-istartswith">
<span id="s-std:fieldlookup-istartswith"></span><span id="istartswith"></span><span id="std:fieldlookup-istartswith"></span><h4><font id="905">istartswith</font><a class="headerlink" href="querysets.html#istartswith" title="Permalink to this headline">¶</a></h4>
<p><font id="687">Case-insensitive starts-with.</font></p>
<p><font id="688">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__istartswith</span><span class="o">=</span><span class="s">'will'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="689">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE headline ILIKE 'Will%';
</pre></div>
</div>
<div class="admonition-sqlite-users admonition">
<p class="first admonition-title"><font id="690">SQLite users</font></p>
<p class="last"><font id="691">When using the SQLite backend and Unicode (non-ASCII) strings, bear in mind the <a class="reference internal" href="../databases.html#sqlite-string-matching"><em>database note</em></a> about string comparisons.</font></p>
</div>
</div>
<div class="section" id="s-endswith">
<span id="s-std:fieldlookup-endswith"></span><span id="endswith"></span><span id="std:fieldlookup-endswith"></span><h4><font id="906">endswith</font><a class="headerlink" href="querysets.html#endswith" title="Permalink to this headline">¶</a></h4>
<p><font id="692">Case-sensitive ends-with.</font></p>
<p><font id="693">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__endswith</span><span class="o">=</span><span class="s">'cats'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="694">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE headline LIKE '%cats';
</pre></div>
</div>
<div class="admonition-sqlite-users admonition">
<p class="first admonition-title"><font id="695">SQLite users</font></p>
<p class="last"><font id="696">SQLite doesn’t support case-sensitive <tt class="docutils literal"><span class="pre">LIKE</span></tt> statements; </font><font id="697"><tt class="docutils literal"><span class="pre">endswith</span></tt> acts like <tt class="docutils literal"><span class="pre">iendswith</span></tt> for SQLite. </font><font id="698">Refer to the <a class="reference internal" href="../databases.html#sqlite-string-matching"><em>database note</em></a> documentation for more.</font></p>
</div>
</div>
<div class="section" id="s-iendswith">
<span id="s-std:fieldlookup-iendswith"></span><span id="iendswith"></span><span id="std:fieldlookup-iendswith"></span><h4><font id="907">iendswith</font><a class="headerlink" href="querysets.html#iendswith" title="Permalink to this headline">¶</a></h4>
<p><font id="699">Case-insensitive ends-with.</font></p>
<p><font id="700">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__iendswith</span><span class="o">=</span><span class="s">'will'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="701">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE headline ILIKE '%will'
</pre></div>
</div>
<div class="admonition-sqlite-users admonition">
<p class="first admonition-title"><font id="702">SQLite users</font></p>
<p class="last"><font id="703">When using the SQLite backend and Unicode (non-ASCII) strings, bear in mind the <a class="reference internal" href="../databases.html#sqlite-string-matching"><em>database note</em></a> about string comparisons.</font></p>
</div>
</div>
<div class="section" id="s-range">
<span id="s-std:fieldlookup-range"></span><span id="range"></span><span id="std:fieldlookup-range"></span><h4><font id="908">range</font><a class="headerlink" href="querysets.html#range" title="Permalink to this headline">¶</a></h4>
<p><font id="704">Range test (inclusive).</font></p>
<p><font id="705">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">datetime</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
<span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__range</span><span class="o">=</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">))</span>
</pre></div>
</div>
<p><font id="706">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE pub_date BETWEEN '2005-01-01' and '2005-03-31';
</pre></div>
</div>
<p><font id="707">You can use <tt class="docutils literal"><span class="pre">range</span></tt> anywhere you can use <tt class="docutils literal"><span class="pre">BETWEEN</span></tt> in SQL — for dates, numbers and even characters.</font></p>
<div class="admonition warning">
<p class="first admonition-title"><font id="708">Warning</font></p>
<p><font id="709">Filtering a <tt class="docutils literal"><span class="pre">DateTimeField</span></tt> with dates won’t include items on the last day, because the bounds are interpreted as “0am on the given date”. </font><font id="710">If <tt class="docutils literal"><span class="pre">pub_date</span></tt> was a <tt class="docutils literal"><span class="pre">DateTimeField</span></tt>, the above expression would be turned into this SQL:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE pub_date BETWEEN '2005-01-01 00:00:00' and '2005-03-31 00:00:00';
</pre></div>
</div>
<p class="last"><font id="711">Generally speaking, you can’t mix dates and datetimes.</font></p>
</div>
</div>
<div class="section" id="s-year">
<span id="s-std:fieldlookup-year"></span><span id="year"></span><span id="std:fieldlookup-year"></span><h4><font id="909">year</font><a class="headerlink" href="querysets.html#year" title="Permalink to this headline">¶</a></h4>
<p><font id="712">For date and datetime fields, an exact year match. </font><font id="713">Takes an integer year.</font></p>
<p><font id="714">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__year</span><span class="o">=</span><span class="mi">2005</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="715">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE pub_date BETWEEN '2005-01-01' AND '2005-12-31';
</pre></div>
</div>
<p><font id="716">(The exact SQL syntax varies for each database engine.)</font></p>
<p><font id="717">When <a class="reference internal" href="../settings.html#std:setting-USE_TZ"><tt class="xref std std-setting docutils literal"><span class="pre">USE_TZ</span></tt></a> is <tt class="docutils literal"><span class="pre">True</span></tt>, datetime fields are converted to the current time zone before filtering.</font></p>
</div>
<div class="section" id="s-month">
<span id="s-std:fieldlookup-month"></span><span id="month"></span><span id="std:fieldlookup-month"></span><h4><font id="910">month</font><a class="headerlink" href="querysets.html#month" title="Permalink to this headline">¶</a></h4>
<p><font id="718">For date and datetime fields, an exact month match. </font><font id="719">Takes an integer 1 (January) through 12 (December).</font></p>
<p><font id="720">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__month</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="721">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE EXTRACT('month' FROM pub_date) = '12';
</pre></div>
</div>
<p><font id="722">(The exact SQL syntax varies for each database engine.)</font></p>
<p><font id="723">When <a class="reference internal" href="../settings.html#std:setting-USE_TZ"><tt class="xref std std-setting docutils literal"><span class="pre">USE_TZ</span></tt></a> is <tt class="docutils literal"><span class="pre">True</span></tt>, datetime fields are converted to the current time zone before filtering. </font><font id="724">This requires <a class="reference internal" href="querysets.html#database-time-zone-definitions"><em>time zone definitions in the database</em></a>.</font></p>
</div>
<div class="section" id="s-day">
<span id="s-std:fieldlookup-day"></span><span id="day"></span><span id="std:fieldlookup-day"></span><h4><font id="911">day</font><a class="headerlink" href="querysets.html#day" title="Permalink to this headline">¶</a></h4>
<p><font id="725">For date and datetime fields, an exact day match. </font><font id="726">Takes an integer day.</font></p>
<p><font id="727">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__day</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="728">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE EXTRACT('day' FROM pub_date) = '3';
</pre></div>
</div>
<p><font id="729">(The exact SQL syntax varies for each database engine.)</font></p>
<p><font id="730">Note this will match any record with a pub_date on the third day of the month, such as January 3, July 3, etc.</font></p>
<p><font id="731">When <a class="reference internal" href="../settings.html#std:setting-USE_TZ"><tt class="xref std std-setting docutils literal"><span class="pre">USE_TZ</span></tt></a> is <tt class="docutils literal"><span class="pre">True</span></tt>, datetime fields are converted to the current time zone before filtering. </font><font id="732">This requires <a class="reference internal" href="querysets.html#database-time-zone-definitions"><em>time zone definitions in the database</em></a>.</font></p>
</div>
<div class="section" id="s-week-day">
<span id="s-std:fieldlookup-week_day"></span><span id="week-day"></span><span id="std:fieldlookup-week_day"></span><h4><font id="912">week_day</font><a class="headerlink" href="querysets.html#week-day" title="Permalink to this headline">¶</a></h4>
<p><font id="733">For date and datetime fields, a ‘day of the week’ match.</font></p>
<p><font id="734">Takes an integer value representing the day of week from 1 (Sunday) to 7 (Saturday).</font></p>
<p><font id="735">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__week_day</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="736">(No equivalent SQL code fragment is included for this lookup because implementation of the relevant query varies among different database engines.)</font></p>
<p><font id="737">Note this will match any record with a <tt class="docutils literal"><span class="pre">pub_date</span></tt> that falls on a Monday (day 2 of the week), regardless of the month or year in which it occurs. </font><font id="738">Week days are indexed with day 1 being Sunday and day 7 being Saturday.</font></p>
<p><font id="739">When <a class="reference internal" href="../settings.html#std:setting-USE_TZ"><tt class="xref std std-setting docutils literal"><span class="pre">USE_TZ</span></tt></a> is <tt class="docutils literal"><span class="pre">True</span></tt>, datetime fields are converted to the current time zone before filtering. </font><font id="740">This requires <a class="reference internal" href="querysets.html#database-time-zone-definitions"><em>time zone definitions in the database</em></a>.</font></p>
</div>
<div class="section" id="s-hour">
<span id="s-std:fieldlookup-hour"></span><span id="hour"></span><span id="std:fieldlookup-hour"></span><h4><font id="913">hour</font><a class="headerlink" href="querysets.html#hour" title="Permalink to this headline">¶</a></h4>
<p><font id="741">For datetime fields, an exact hour match. </font><font id="742">Takes an integer between 0 and 23.</font></p>
<p><font id="743">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Event</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">timestamp__hour</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="744">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE EXTRACT('hour' FROM timestamp) = '23';
</pre></div>
</div>
<p><font id="745">(The exact SQL syntax varies for each database engine.)</font></p>
<p><font id="746">When <a class="reference internal" href="../settings.html#std:setting-USE_TZ"><tt class="xref std std-setting docutils literal"><span class="pre">USE_TZ</span></tt></a> is <tt class="docutils literal"><span class="pre">True</span></tt>, values are converted to the current time zone before filtering.</font></p>
</div>
<div class="section" id="s-minute">
<span id="s-std:fieldlookup-minute"></span><span id="minute"></span><span id="std:fieldlookup-minute"></span><h4><font id="914">minute</font><a class="headerlink" href="querysets.html#minute" title="Permalink to this headline">¶</a></h4>
<p><font id="747">For datetime fields, an exact minute match. </font><font id="748">Takes an integer between 0 and 59.</font></p>
<p><font id="749">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Event</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">timestamp__minute</span><span class="o">=</span><span class="mi">29</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="750">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE EXTRACT('minute' FROM timestamp) = '29';
</pre></div>
</div>
<p><font id="751">(The exact SQL syntax varies for each database engine.)</font></p>
<p><font id="752">When <a class="reference internal" href="../settings.html#std:setting-USE_TZ"><tt class="xref std std-setting docutils literal"><span class="pre">USE_TZ</span></tt></a> is <tt class="docutils literal"><span class="pre">True</span></tt>, values are converted to the current time zone before filtering.</font></p>
</div>
<div class="section" id="s-second">
<span id="s-std:fieldlookup-second"></span><span id="second"></span><span id="std:fieldlookup-second"></span><h4><font id="915">second</font><a class="headerlink" href="querysets.html#second" title="Permalink to this headline">¶</a></h4>
<p><font id="753">For datetime fields, an exact second match. </font><font id="754">Takes an integer between 0 and 59.</font></p>
<p><font id="755">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Event</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">timestamp__second</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="756">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE EXTRACT('second' FROM timestamp) = '31';
</pre></div>
</div>
<p><font id="757">(The exact SQL syntax varies for each database engine.)</font></p>
<p><font id="758">When <a class="reference internal" href="../settings.html#std:setting-USE_TZ"><tt class="xref std std-setting docutils literal"><span class="pre">USE_TZ</span></tt></a> is <tt class="docutils literal"><span class="pre">True</span></tt>, values are converted to the current time zone before filtering.</font></p>
</div>
<div class="section" id="s-isnull">
<span id="s-std:fieldlookup-isnull"></span><span id="isnull"></span><span id="std:fieldlookup-isnull"></span><h4><font id="916">isnull</font><a class="headerlink" href="querysets.html#isnull" title="Permalink to this headline">¶</a></h4>
<p><font id="759">Takes either <tt class="docutils literal"><span class="pre">True</span></tt> or <tt class="docutils literal"><span class="pre">False</span></tt>, which correspond to SQL queries of <tt class="docutils literal"><span class="pre">IS</span> <span class="pre">NULL</span></tt> and <tt class="docutils literal"><span class="pre">IS</span> <span class="pre">NOT</span> <span class="pre">NULL</span></tt>, respectively.</font></p>
<p><font id="760">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__isnull</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="761">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE pub_date IS NULL;
</pre></div>
</div>
</div>
<div class="section" id="s-search">
<span id="s-std:fieldlookup-search"></span><span id="search"></span><span id="std:fieldlookup-search"></span><h4><font id="917">search</font><a class="headerlink" href="querysets.html#search" title="Permalink to this headline">¶</a></h4>
<p><font id="762">A boolean full-text search, taking advantage of full-text indexing. </font><font id="763">This is like <a class="reference internal" href="querysets.html#std:fieldlookup-contains"><tt class="xref std std-lookup docutils literal"><span class="pre">contains</span></tt></a> but is significantly faster due to full-text indexing.</font></p>
<p><font id="764">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__search</span><span class="o">=</span><span class="s">"+Django -jazz Python"</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="765">SQL equivalent:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE MATCH(tablename, headline) AGAINST (+Django -jazz Python IN BOOLEAN MODE);
</pre></div>
</div>
<p><font id="766">Note this is only available in MySQL and requires direct manipulation of the database to add the full-text index. </font><font id="767">By default Django uses BOOLEAN MODE for full text searches. </font><font id="768">See the <a class="reference external" href="http://dev.mysql.com/doc/refman/5.6/en/fulltext-boolean.html">MySQL documentation</a> for additional details.</font></p>
</div>
<div class="section" id="s-regex">
<span id="s-std:fieldlookup-regex"></span><span id="regex"></span><span id="std:fieldlookup-regex"></span><h4><font id="918">regex</font><a class="headerlink" href="querysets.html#regex" title="Permalink to this headline">¶</a></h4>
<p><font id="769">Case-sensitive regular expression match.</font></p>
<p><font id="770">The regular expression syntax is that of the database backend in use. </font><font id="771">In the case of SQLite, which has no built in regular expression support, this feature is provided by a (Python) user-defined REGEXP function, and the regular expression syntax is therefore that of Python’s <tt class="docutils literal"><span class="pre">re</span></tt> module.</font></p>
<p><font id="772">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">title__regex</span><span class="o">=</span><span class="s">r'^(An?|The) +'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="773">SQL equivalents:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE title REGEXP BINARY '^(An?|The) +'; -- MySQL

SELECT ... WHERE REGEXP_LIKE(title, '^(an?|the) +', 'c'); -- Oracle

SELECT ... WHERE title ~ '^(An?|The) +'; -- PostgreSQL

SELECT ... WHERE title REGEXP '^(An?|The) +'; -- SQLite
</pre></div>
</div>
<p><font id="774">Using raw strings (e.g., <tt class="docutils literal"><span class="pre">r'foo'</span></tt> instead of <tt class="docutils literal"><span class="pre">'foo'</span></tt>) for passing in the regular expression syntax is recommended.</font></p>
</div>
<div class="section" id="s-iregex">
<span id="s-std:fieldlookup-iregex"></span><span id="iregex"></span><span id="std:fieldlookup-iregex"></span><h4><font id="919">iregex</font><a class="headerlink" href="querysets.html#iregex" title="Permalink to this headline">¶</a></h4>
<p><font id="775">Case-insensitive regular expression match.</font></p>
<p><font id="776">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">title__iregex</span><span class="o">=</span><span class="s">r'^(an?|the) +'</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="777">SQL equivalents:</font></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT ... WHERE title REGEXP '^(an?|the) +'; -- MySQL

SELECT ... WHERE REGEXP_LIKE(title, '^(an?|the) +', 'i'); -- Oracle

SELECT ... WHERE title ~* '^(an?|the) +'; -- PostgreSQL

SELECT ... WHERE title REGEXP '(?i)^(an?|the) +'; -- SQLite
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-aggregation-functions">
<span id="s-id5"></span><span id="aggregation-functions"></span><span id="id5"></span><h3><font id="849">Aggregation functions</font><a class="headerlink" href="querysets.html#aggregation-functions" title="Permalink to this headline">¶</a></h3>
<p><font id="778">Django provides the following aggregation functions in the <tt class="docutils literal"><span class="pre">django.db.models</span></tt> module. </font><font id="779">For details on how to use these aggregate functions, see <a class="reference internal" href="../../topics/db/aggregation.html"><em>the topic guide on aggregation</em></a>. </font><font id="780">See the <a class="reference internal" href="expressions.html#django.db.models.Aggregate" title="django.db.models.Aggregate"><tt class="xref py py-class docutils literal"><span class="pre">Aggregate</span></tt></a> documentation to learn how to create your aggregates.</font></p>
<div class="admonition warning">
<p class="first admonition-title"><font id="781">Warning</font></p>
<p class="last"><font id="782">SQLite can’t handle aggregation on date/time fields out of the box. </font><font id="783">This is because there are no native date/time fields in SQLite and Django currently emulates these features using a text field. </font><font id="784">Attempts to use aggregation on date/time fields in SQLite will raise <tt class="docutils literal"><span class="pre">NotImplementedError</span></tt>.</font></p>
</div>
<div class="admonition-note admonition">
<p class="first admonition-title"><font id="785">Note</font></p>
<p class="last"><font id="786">Aggregation functions return <tt class="docutils literal"><span class="pre">None</span></tt> when used with an empty <tt class="docutils literal"><span class="pre">QuerySet</span></tt>. </font><font id="787">For example, the <tt class="docutils literal"><span class="pre">Sum</span></tt> aggregation function returns <tt class="docutils literal"><span class="pre">None</span></tt> instead of <tt class="docutils literal"><span class="pre">0</span></tt> if the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> contains no entries. </font><font id="788">An exception is <tt class="docutils literal"><span class="pre">Count</span></tt>, which does return <tt class="docutils literal"><span class="pre">0</span></tt> if the <tt class="docutils literal"><span class="pre">QuerySet</span></tt> is empty.</font></p>
</div>
<p><font id="789">All aggregates have the following parameters in common:</font></p>
<div class="section" id="s-expression">
<span id="expression"></span><h4><font id="920">expression</font><a class="headerlink" href="querysets.html#expression" title="Permalink to this headline">¶</a></h4>
<p><font id="790">A string that references a field on the model, or a <a class="reference internal" href="expressions.html"><em>query expression</em></a>.</font></p>
<div class="versionadded">
<span class="title">New in Django 1.8:</span> <p><font id="791">Aggregate functions are now able to reference multiple fields in complex computations.</font></p>
</div>
</div>
<div class="section" id="s-output-field">
<span id="output-field"></span><h4><font id="921">output_field</font><a class="headerlink" href="querysets.html#output-field" title="Permalink to this headline">¶</a></h4>
<p><font id="792">An optional argument that represents the <a class="reference internal" href="fields.html"><em>model field</em></a> of the return value</font></p>
<div class="versionadded">
<span class="title">New in Django 1.8:</span> <p><font id="793">The <tt class="docutils literal"><span class="pre">output_field</span></tt> argument was added.</font></p>
</div>
<div class="admonition note">
<p class="first admonition-title"><font id="794">Note</font></p>
<p class="last"><font id="795">When combining multiple field types, Django can only determine the <tt class="docutils literal"><span class="pre">output_field</span></tt> if all fields are of the same type. </font><font id="796">Otherwise, you must provide the <tt class="docutils literal"><span class="pre">output_field</span></tt> yourself.</font></p>
</div>
</div>
<div class="section" id="s-id6">
<span id="id6"></span><h4><font id="922">**extra</font><a class="headerlink" href="querysets.html#id6" title="Permalink to this headline">¶</a></h4>
<p><font id="797">Keyword arguments that can provide extra context for the SQL generated by the aggregate.</font></p>
</div>
<div class="section" id="s-avg">
<span id="avg"></span><h4><font id="923">Avg</font><a class="headerlink" href="querysets.html#avg" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="django.db.models.Avg">
<em class="property">class </em><tt class="descname">Avg</tt>(<em>expression</em>, <em>output_field=None</em>, <em>**extra</em>)<a class="headerlink" href="querysets.html#django.db.models.Avg" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="798">Returns the mean value of the given expression, which must be numeric.</font></p>
<ul class="simple">
<li><font id="941">Default alias: <tt class="docutils literal"><span class="pre">&lt;field&gt;__avg</span></tt></font></li>
<li><font id="942">Return type: <tt class="docutils literal"><span class="pre">float</span></tt></font></li>
</ul>
</dd></dl>
</div>
<div class="section" id="s-id7">
<span id="id7"></span><h4><font id="924">Count</font><a class="headerlink" href="querysets.html#id7" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="django.db.models.Count">
<em class="property">class </em><tt class="descname">Count</tt>(<em>expression</em>, <em>distinct=False</em>, <em>**extra</em>)<a class="headerlink" href="querysets.html#django.db.models.Count" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="799">Returns the number of objects that are related through the provided expression.</font></p>
<ul class="simple">
<li><font id="943">Default alias: <tt class="docutils literal"><span class="pre">&lt;field&gt;__count</span></tt></font></li>
<li><font id="944">Return type: <tt class="docutils literal"><span class="pre">int</span></tt></font></li>
</ul>
<p><font id="800">Has one optional argument:</font></p>
<dl class="attribute">
<dt id="django.db.models.Count.distinct">
<tt class="descname">distinct</tt><a class="headerlink" href="querysets.html#django.db.models.Count.distinct" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="801">If <tt class="docutils literal"><span class="pre">distinct=True</span></tt>, the count will only include unique instances. </font><font id="802">This is the SQL equivalent of <tt class="docutils literal"><span class="pre">COUNT(DISTINCT</span> <span class="pre">&lt;field&gt;)</span></tt>. </font><font id="803">The default value is <tt class="docutils literal"><span class="pre">False</span></tt>.</font></p>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="s-max">
<span id="max"></span><h4><font id="925">Max</font><a class="headerlink" href="querysets.html#max" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="django.db.models.Max">
<em class="property">class </em><tt class="descname">Max</tt>(<em>expression</em>, <em>output_field=None</em>, <em>**extra</em>)<a class="headerlink" href="querysets.html#django.db.models.Max" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="804">Returns the maximum value of the given expression.</font></p>
<ul class="simple">
<li><font id="945">Default alias: <tt class="docutils literal"><span class="pre">&lt;field&gt;__max</span></tt></font></li>
<li><font id="946">Return type: same as input field, or <tt class="docutils literal"><span class="pre">output_field</span></tt> if supplied</font></li>
</ul>
</dd></dl>
</div>
<div class="section" id="s-min">
<span id="min"></span><h4><font id="926">Min</font><a class="headerlink" href="querysets.html#min" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="django.db.models.Min">
<em class="property">class </em><tt class="descname">Min</tt>(<em>expression</em>, <em>output_field=None</em>, <em>**extra</em>)<a class="headerlink" href="querysets.html#django.db.models.Min" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="805">Returns the minimum value of the given expression.</font></p>
<ul class="simple">
<li><font id="947">Default alias: <tt class="docutils literal"><span class="pre">&lt;field&gt;__min</span></tt></font></li>
<li><font id="948">Return type: same as input field, or <tt class="docutils literal"><span class="pre">output_field</span></tt> if supplied</font></li>
</ul>
</dd></dl>
</div>
<div class="section" id="s-stddev">
<span id="stddev"></span><h4><font id="927">StdDev</font><a class="headerlink" href="querysets.html#stddev" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="django.db.models.StdDev">
<em class="property">class </em><tt class="descname">StdDev</tt>(<em>expression</em>, <em>sample=False</em>, <em>**extra</em>)<a class="headerlink" href="querysets.html#django.db.models.StdDev" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="806">Returns the standard deviation of the data in the provided expression.</font></p>
<ul class="simple">
<li><font id="949">Default alias: <tt class="docutils literal"><span class="pre">&lt;field&gt;__stddev</span></tt></font></li>
<li><font id="950">Return type: <tt class="docutils literal"><span class="pre">float</span></tt></font></li>
</ul>
<p><font id="807">Has one optional argument:</font></p>
<dl class="attribute">
<dt id="django.db.models.StdDev.sample">
<tt class="descname">sample</tt><a class="headerlink" href="querysets.html#django.db.models.StdDev.sample" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="808">By default, <tt class="docutils literal"><span class="pre">StdDev</span></tt> returns the population standard deviation. </font><font id="809">However, if <tt class="docutils literal"><span class="pre">sample=True</span></tt>, the return value will be the sample standard deviation.</font></p>
</dd></dl>
<div class="admonition-sqlite admonition">
<p class="first admonition-title"><font id="810">SQLite</font></p>
<p class="last"><font id="811">SQLite doesn’t provide <tt class="docutils literal"><span class="pre">StdDev</span></tt> out of the box. </font><font id="812">An implementation is available as an extension module for SQLite. </font><font id="813">Consult the <a class="reference external" href="http://www.sqlite.org/contrib">SQlite documentation</a> for instructions on obtaining and installing this extension.</font></p>
</div>
</dd></dl>
</div>
<div class="section" id="s-sum">
<span id="sum"></span><h4><font id="928">Sum</font><a class="headerlink" href="querysets.html#sum" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="django.db.models.Sum">
<em class="property">class </em><tt class="descname">Sum</tt>(<em>expression</em>, <em>output_field=None</em>, <em>**extra</em>)<a class="headerlink" href="querysets.html#django.db.models.Sum" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="814">Computes the sum of all values of the given expression.</font></p>
<ul class="simple">
<li><font id="951">Default alias: <tt class="docutils literal"><span class="pre">&lt;field&gt;__sum</span></tt></font></li>
<li><font id="952">Return type: same as input field, or <tt class="docutils literal"><span class="pre">output_field</span></tt> if supplied</font></li>
</ul>
</dd></dl>
</div>
<div class="section" id="s-variance">
<span id="variance"></span><h4><font id="929">Variance</font><a class="headerlink" href="querysets.html#variance" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="django.db.models.Variance">
<em class="property">class </em><tt class="descname">Variance</tt>(<em>expression</em>, <em>sample=False</em>, <em>**extra</em>)<a class="headerlink" href="querysets.html#django.db.models.Variance" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="815">Returns the variance of the data in the provided expression.</font></p>
<ul class="simple">
<li><font id="953">Default alias: <tt class="docutils literal"><span class="pre">&lt;field&gt;__variance</span></tt></font></li>
<li><font id="954">Return type: <tt class="docutils literal"><span class="pre">float</span></tt></font></li>
</ul>
<p><font id="816">Has one optional argument:</font></p>
<dl class="attribute">
<dt id="django.db.models.Variance.sample">
<tt class="descname">sample</tt><a class="headerlink" href="querysets.html#django.db.models.Variance.sample" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="817">By default, <tt class="docutils literal"><span class="pre">Variance</span></tt> returns the population variance. </font><font id="818">However, if <tt class="docutils literal"><span class="pre">sample=True</span></tt>, the return value will be the sample variance.</font></p>
</dd></dl>
<div class="admonition-sqlite admonition">
<p class="first admonition-title"><font id="819">SQLite</font></p>
<p class="last"><font id="820">SQLite doesn’t provide <tt class="docutils literal"><span class="pre">Variance</span></tt> out of the box. </font><font id="821">An implementation is available as an extension module for SQLite. </font><font id="822">Consult the <a class="reference external" href="http://www.sqlite.org/contrib">SQlite documentation</a> for instructions on obtaining and installing this extension.</font></p>
</div>
</dd></dl>
</div>
</div>
</div>
<div class="section" id="s-query-related-classes">
<span id="query-related-classes"></span><h2><font id="844">Query-related classes</font><a class="headerlink" href="querysets.html#query-related-classes" title="Permalink to this headline">¶</a></h2>
<p><font id="823">This section provides reference material for query-related tools not documented elsewhere.</font></p>
<div class="section" id="s-q-objects">
<span id="q-objects"></span><h3><font id="850"><tt class="docutils literal"><span class="pre">Q()</span></tt> objects</font><a class="headerlink" href="querysets.html#q-objects" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="django.db.models.Q">
<em class="property">class </em><tt class="descname">Q</tt><a class="headerlink" href="querysets.html#django.db.models.Q" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="824">A <tt class="docutils literal"><span class="pre">Q()</span></tt> object, like an <a class="reference internal" href="expressions.html#django.db.models.F" title="django.db.models.F"><tt class="xref py py-class docutils literal"><span class="pre">F</span></tt></a> object, encapsulates a SQL expression in a Python object that can be used in database-related operations.</font></p>
<p><font id="825">In general, <tt class="docutils literal"><span class="pre">Q()</span> <span class="pre">objects</span></tt> make it possible to define and reuse conditions. </font><font id="826">This permits the <a class="reference internal" href="../../topics/db/queries.html#complex-lookups-with-q"><em>construction of complex database queries</em></a> using <tt class="docutils literal"><span class="pre">|</span></tt> </font><font id="827">(<tt class="docutils literal"><span class="pre">OR</span></tt>) and <tt class="docutils literal"><span class="pre">&amp;</span></tt> (<tt class="docutils literal"><span class="pre">AND</span></tt>) operators; </font><font id="828">in particular, it is not otherwise possible to use <tt class="docutils literal"><span class="pre">OR</span></tt> in <tt class="docutils literal"><span class="pre">QuerySets</span></tt>.</font></p>
</div>
<div class="section" id="s-prefetch-objects">
<span id="prefetch-objects"></span><h3><font id="851"><tt class="docutils literal"><span class="pre">Prefetch()</span></tt> objects</font><a class="headerlink" href="querysets.html#prefetch-objects" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<span class="title">New in Django 1.7.</span> </div>
<dl class="class">
<dt id="django.db.models.Prefetch">
<em class="property">class </em><tt class="descname">Prefetch</tt>(<em>lookup</em>, <em>queryset=None</em>, <em>to_attr=None</em>)<a class="headerlink" href="querysets.html#django.db.models.Prefetch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<p><font id="829">The <tt class="docutils literal"><span class="pre">Prefetch()</span></tt> object can be used to control the operation of <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.prefetch_related" title="django.db.models.query.QuerySet.prefetch_related"><tt class="xref py py-meth docutils literal"><span class="pre">prefetch_related()</span></tt></a>.</font></p>
<p><font id="830">The <tt class="docutils literal"><span class="pre">lookup</span></tt> argument describes the relations to follow and works the same as the string based lookups passed to <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.prefetch_related" title="django.db.models.query.QuerySet.prefetch_related"><tt class="xref py py-meth docutils literal"><span class="pre">prefetch_related()</span></tt></a>. </font><font id="831">For example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="n">Prefetch</span><span class="p">(</span><span class="s">'choice_set'</span><span class="p">))</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;Choice: Not much&gt;, &lt;Choice: The sky&gt;, &lt;Choice: Just hacking again&gt;]</span>
<span class="go"># This will only execute two queries regardless of the number of Question</span>
<span class="go"># and Choice objects.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="n">Prefetch</span><span class="p">(</span><span class="s">'choice_set'</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;Question: Question object&gt;]</span>
</pre></div>
</div>
<p><font id="832">The <tt class="docutils literal"><span class="pre">queryset</span></tt> argument supplies a base <tt class="docutils literal"><span class="pre">QuerySet</span></tt> for the given lookup. </font><font id="833">This is useful to further filter down the prefetch operation, or to call <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.select_related" title="django.db.models.query.QuerySet.select_related"><tt class="xref py py-meth docutils literal"><span class="pre">select_related()</span></tt></a> from the prefetched relation, hence reducing the number of queries even further:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">voted_choices</span> <span class="o">=</span> <span class="n">Choice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">votes__gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">voted_choices</span>
<span class="go">[&lt;Choice: The sky&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prefetch</span> <span class="o">=</span> <span class="n">Prefetch</span><span class="p">(</span><span class="s">'choice_set'</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">voted_choices</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="n">prefetch</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;Choice: The sky&gt;]</span>
</pre></div>
</div>
<p><font id="834">The <tt class="docutils literal"><span class="pre">to_attr</span></tt> argument sets the result of the prefetch operation to a custom attribute:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">prefetch</span> <span class="o">=</span> <span class="n">Prefetch</span><span class="p">(</span><span class="s">'choice_set'</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">voted_choices</span><span class="p">,</span> <span class="n">to_attr</span><span class="o">=</span><span class="s">'voted_choices'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="n">prefetch</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">voted_choices</span>
<span class="go">[&lt;Choice: The sky&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="n">prefetch</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;Choice: Not much&gt;, &lt;Choice: The sky&gt;, &lt;Choice: Just hacking again&gt;]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title"><font id="835">Note</font></p>
<p class="last"><font id="836">When using <tt class="docutils literal"><span class="pre">to_attr</span></tt> the prefetched result is stored in a list. </font><font id="837">This can provide a significant speed improvement over traditional <tt class="docutils literal"><span class="pre">prefetch_related</span></tt> calls which store the cached result within a <tt class="docutils literal"><span class="pre">QuerySet</span></tt> instance.</font></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="yui-b" id="sidebar">
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
<h3><font id="852">Table Of Contents</font></h3>
<ul>
<li><a class="reference internal" href="querysets.html#"><font id="955">QuerySet API reference</font></a><ul>
<li><a class="reference internal" href="querysets.html#when-querysets-are-evaluated"><font id="956">When QuerySets are evaluated</font></a><ul>
<li><a class="reference internal" href="querysets.html#pickling-querysets"><font id="957">Pickling QuerySets</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="querysets.html#queryset-api"><font id="958">QuerySet API</font></a><ul>
<li><a class="reference internal" href="querysets.html#methods-that-return-new-querysets"><font id="959">Methods that return new QuerySets</font></a><ul>
<li><a class="reference internal" href="querysets.html#filter"><font id="960">filter</font></a></li>
<li><a class="reference internal" href="querysets.html#exclude"><font id="961">exclude</font></a></li>
<li><a class="reference internal" href="querysets.html#annotate"><font id="962">annotate</font></a></li>
<li><a class="reference internal" href="querysets.html#order-by"><font id="963">order_by</font></a></li>
<li><a class="reference internal" href="querysets.html#reverse"><font id="964">reverse</font></a></li>
<li><a class="reference internal" href="querysets.html#distinct"><font id="965">distinct</font></a></li>
<li><a class="reference internal" href="querysets.html#values"><font id="966">values</font></a></li>
<li><a class="reference internal" href="querysets.html#values-list"><font id="967">values_list</font></a></li>
<li><a class="reference internal" href="querysets.html#dates"><font id="968">dates</font></a></li>
<li><a class="reference internal" href="querysets.html#datetimes"><font id="969">datetimes</font></a></li>
<li><a class="reference internal" href="querysets.html#none"><font id="970">none</font></a></li>
<li><a class="reference internal" href="querysets.html#all"><font id="971">all</font></a></li>
<li><a class="reference internal" href="querysets.html#select-related"><font id="972">select_related</font></a></li>
<li><a class="reference internal" href="querysets.html#prefetch-related"><font id="973">prefetch_related</font></a></li>
<li><a class="reference internal" href="querysets.html#extra"><font id="974">extra</font></a></li>
<li><a class="reference internal" href="querysets.html#defer"><font id="975">defer</font></a></li>
<li><a class="reference internal" href="querysets.html#only"><font id="976">only</font></a></li>
<li><a class="reference internal" href="querysets.html#using"><font id="977">using</font></a></li>
<li><a class="reference internal" href="querysets.html#select-for-update"><font id="978">select_for_update</font></a></li>
<li><a class="reference internal" href="querysets.html#raw"><font id="979">raw</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="querysets.html#methods-that-do-not-return-querysets"><font id="980">Methods that do not return QuerySets</font></a><ul>
<li><a class="reference internal" href="querysets.html#get"><font id="981">get</font></a></li>
<li><a class="reference internal" href="querysets.html#create"><font id="982">create</font></a></li>
<li><a class="reference internal" href="querysets.html#get-or-create"><font id="983">get_or_create</font></a></li>
<li><a class="reference internal" href="querysets.html#update-or-create"><font id="984">update_or_create</font></a></li>
<li><a class="reference internal" href="querysets.html#bulk-create"><font id="985">bulk_create</font></a></li>
<li><a class="reference internal" href="querysets.html#count"><font id="986">count</font></a></li>
<li><a class="reference internal" href="querysets.html#in-bulk"><font id="987">in_bulk</font></a></li>
<li><a class="reference internal" href="querysets.html#iterator"><font id="988">iterator</font></a></li>
<li><a class="reference internal" href="querysets.html#latest"><font id="989">latest</font></a></li>
<li><a class="reference internal" href="querysets.html#earliest"><font id="990">earliest</font></a></li>
<li><a class="reference internal" href="querysets.html#first"><font id="991">first</font></a></li>
<li><a class="reference internal" href="querysets.html#last"><font id="992">last</font></a></li>
<li><a class="reference internal" href="querysets.html#aggregate"><font id="993">aggregate</font></a></li>
<li><a class="reference internal" href="querysets.html#exists"><font id="994">exists</font></a></li>
<li><a class="reference internal" href="querysets.html#update"><font id="995">update</font></a></li>
<li><a class="reference internal" href="querysets.html#delete"><font id="996">delete</font></a></li>
<li><a class="reference internal" href="querysets.html#as-manager"><font id="997">as_manager</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="querysets.html#field-lookups"><font id="998">Field lookups</font></a><ul>
<li><a class="reference internal" href="querysets.html#exact"><font id="999">exact</font></a></li>
<li><a class="reference internal" href="querysets.html#iexact"><font id="1000">iexact</font></a></li>
<li><a class="reference internal" href="querysets.html#contains"><font id="1001">contains</font></a></li>
<li><a class="reference internal" href="querysets.html#icontains"><font id="1002">icontains</font></a></li>
<li><a class="reference internal" href="querysets.html#in"><font id="1003">in</font></a></li>
<li><a class="reference internal" href="querysets.html#gt"><font id="1004">gt</font></a></li>
<li><a class="reference internal" href="querysets.html#gte"><font id="1005">gte</font></a></li>
<li><a class="reference internal" href="querysets.html#lt"><font id="1006">lt</font></a></li>
<li><a class="reference internal" href="querysets.html#lte"><font id="1007">lte</font></a></li>
<li><a class="reference internal" href="querysets.html#startswith"><font id="1008">startswith</font></a></li>
<li><a class="reference internal" href="querysets.html#istartswith"><font id="1009">istartswith</font></a></li>
<li><a class="reference internal" href="querysets.html#endswith"><font id="1010">endswith</font></a></li>
<li><a class="reference internal" href="querysets.html#iendswith"><font id="1011">iendswith</font></a></li>
<li><a class="reference internal" href="querysets.html#range"><font id="1012">range</font></a></li>
<li><a class="reference internal" href="querysets.html#year"><font id="1013">year</font></a></li>
<li><a class="reference internal" href="querysets.html#month"><font id="1014">month</font></a></li>
<li><a class="reference internal" href="querysets.html#day"><font id="1015">day</font></a></li>
<li><a class="reference internal" href="querysets.html#week-day"><font id="1016">week_day</font></a></li>
<li><a class="reference internal" href="querysets.html#hour"><font id="1017">hour</font></a></li>
<li><a class="reference internal" href="querysets.html#minute"><font id="1018">minute</font></a></li>
<li><a class="reference internal" href="querysets.html#second"><font id="1019">second</font></a></li>
<li><a class="reference internal" href="querysets.html#isnull"><font id="1020">isnull</font></a></li>
<li><a class="reference internal" href="querysets.html#search"><font id="1021">search</font></a></li>
<li><a class="reference internal" href="querysets.html#regex"><font id="1022">regex</font></a></li>
<li><a class="reference internal" href="querysets.html#iregex"><font id="1023">iregex</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="querysets.html#aggregation-functions"><font id="1024">Aggregation functions</font></a><ul>
<li><a class="reference internal" href="querysets.html#expression"><font id="1025">expression</font></a></li>
<li><a class="reference internal" href="querysets.html#output-field"><font id="1026">output_field</font></a></li>
<li><a class="reference internal" href="querysets.html#id6"><font id="1027">**extra</font></a></li>
<li><a class="reference internal" href="querysets.html#avg"><font id="1028">Avg</font></a></li>
<li><a class="reference internal" href="querysets.html#id7"><font id="1029">Count</font></a></li>
<li><a class="reference internal" href="querysets.html#max"><font id="1030">Max</font></a></li>
<li><a class="reference internal" href="querysets.html#min"><font id="1031">Min</font></a></li>
<li><a class="reference internal" href="querysets.html#stddev"><font id="1032">StdDev</font></a></li>
<li><a class="reference internal" href="querysets.html#sum"><font id="1033">Sum</font></a></li>
<li><a class="reference internal" href="querysets.html#variance"><font id="1034">Variance</font></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="querysets.html#query-related-classes"><font id="1035">Query-related classes</font></a><ul>
<li><a class="reference internal" href="querysets.html#q-objects"><font id="1036"><tt class="docutils literal"><span class="pre">Q()</span></tt> objects</font></a></li>
<li><a class="reference internal" href="querysets.html#prefetch-objects"><font id="1037"><tt class="docutils literal"><span class="pre">Prefetch()</span></tt> objects</font></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><font id="853">Browse</font></h3>
<ul>
<li><font id="1038">Prev: <a href="instances.html">Model instance reference</a></font></li>
<li><font id="1039">Next: <a href="lookups.html">Lookup API reference</a></font></li>
</ul>
<h3><font id="854">You are here:</font></h3>
<ul>
<li>
<a href="../../index.html"><font id="1040">Django 1.8.2.dev20150513143415 documentation</font></a>
<ul><li><a href="../index.html"><font id="1041">API Reference</font></a>
<ul><li><a href="index.html"><font id="1042">Models</font></a>
<ul><li><font id="1043">QuerySet API reference</font></li></ul>
</li></ul></li></ul>
</li>
</ul>
<h3><font id="855">This Page</font></h3>
<ul class="this-page-menu">
<li><a href="http://python.usyiyi.cn/django/_sources/ref/models/querysets.txt" rel="nofollow"><font id="1044">Show Source</font></a></li>
</ul>
<div id="searchbox" style="display: none">
<h3><font id="856">Quick search</font></h3>
<form action="http://python.usyiyi.cn/django/search.html" class="search" method="get">
<input name="q" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
<p class="searchtip" style="font-size: 90%"><font id="838"> Enter search terms or a module, class or function name. </font></p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>
</div>
<h3><font id="857">Last update:</font></h3>
<p class="topless"><font id="839">May 13, 2015</font></p>
</div>
</div>
<div id="ft">
<div class="nav">
    « <a href="instances.html" title="Model instance reference">previous</a>
     |
    <a accesskey="U" href="../index.html" title="API Reference">up</a>
   |
    <a href="lookups.html" title="Lookup API reference">next</a> »</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div id="disqus_thread"></div><br>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'djangocn'; // required: replace example with your forum shortname
    var disqus_identifier = '/django/ref/models/querysets';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<link href="http://python.usyiyi.cn/django/_static/ms_translator.css" rel="stylesheet" type="text/css"/>
<script src="http://python.usyiyi.cn/django/_static/ms_translator.js" type="text/javascript"></script>
<script src="http://python.usyiyi.cn/django/_static/jquery-ui-1.9.2.custom.min.js" type="text/javascript"></script>
<div id="MicrosoftTranslator" style="display:none; position: absolute; z-index: 2147483647; margin: 0px; border: 2px solid rgb(210, 210, 210); padding: 0px; color: rgb(0, 0, 0); background-color: rgb(230, 230, 230); font-family: Arial,Helvetica,Sans-Serif; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: normal; direction: ltr; text-align: left; left: 274px; top: 2048.03px; min-width: 400px;">
    <div id="MSTCClose" style="float: right;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/tooltip_close.gif">
      </a>
    </div>
    
    <div id="MSTCPopDown" style="float: right;" style="display: none;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/popdown.gif">
      </a>
    </div>
    <div id="MSTCPopUP" style="float: right;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/popup.gif">
      </a>
    </div>
    
    <div id="MSTCTitle" style="margin: 4px 4px 8px; font-weight: bold;">原文
    </div>
    
    <div style="direction: ltr; text-align: left;">
      <span id="MSTCOrigion" style="display: inline-block; margin: 0px 4px 4px;"> </span>
    </div>
    
    <div id="MicrosoftTranslatorCommunity" class="MSTCltr">
      <div id="MSTCContent">
        <a id="MSTCExpandLink">
          <span id="MSTCImprove">改进翻译</span>
          <span id="MSTCSuggest">最小化</span>
          <img src="http://python.usyiyi.cn/django/_static/ctftoggledown.gif" id="MSTCToggleDown">
          <img src="http://python.usyiyi.cn/django/_static/ctftoggleup.gif" id="MSTCToggleUp">
        </a>
        <div id="MSTCRootPanel">
          <span id="MSTCLoading" style="display: none;">正在加载...</span>
          <div style="display: none;" id="MSTCTransPanelError">
            <div class="MSTCTableRow">
              <div class="MSTCTransPanelExc MSTCTableCell">
                <img style="border-width:0px;" src="http://python.usyiyi.cn/django/_static/error_exclamation.gif" id="ExclamationImage">
              </div>
              <div class="MSTCTableCell">
                <span id="MSTCTransPanelErrorMsg"></span>
              </div>
            </div>
            <div class="MSTCTableRow">
              <div class="MSTCTableCell"></div>
              <div class="MSTCTableCell MSTCFlipHoriz">
                <input type="image" style="border-width:0px;" src="http://python.usyiyi.cn/django/_static/error_OK.gif" class="MSTCErrorButtons" id="MSTCOKImgBtn" name="MSTCOKImgBtn">
              </div>
            </div>
          </div>
          
          <div id="MSTCTransPanel">
          </div>
          
          <div id="MSTCPrevNextPanel">
            <a id="MSTCPrevLink" style='border-right-width: 1px;border-right-style: solid;padding-right: 5px;'>
              <span>上一页</span>
            </a>
            <a style='color: black; border-right-width: 1px;border-right-style: solid;padding-right: 5px;'>
              <span>第</span>
              <span id="MSTCPage"></span>
              <span>页</span>
            </a>
            <a id="MSTCNextLink" style='padding-left: 5px;'>
              <span>下一页</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>
</html>