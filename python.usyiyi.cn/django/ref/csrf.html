<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>跨站请求伪造防护 — Django 1.8.2 中文文档</title>
<link href="../_static/default.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.8.2.dev20150513143415',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<link href="../index.html" rel="top" title="Django 1.8.2.dev20150513143415 documentation"/>
<link href="index.html" rel="up" title="API Reference"/>
<link href="databases.html" rel="next" title="Databases"/>
<link href="contrib/webdesign.html" rel="prev" title="django.contrib.webdesign"/>
<script src="http://python.usyiyi.cn/django/templatebuiltins.js" type="text/javascript"></script>
<script type="text/javascript">
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='http://python.usyiyi.cn/django/ref/&quot;&#32;+&#32;base&#32;+&#32;&quot;#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='http://python.usyiyi.cn/django/ref/&quot;&#32;+&#32;base&#32;+&#32;&quot;#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);
</script>
</head>
<body>
<div class="document">
<div class="yui-t6" id="custom-doc">
<div id="hd">
<h1><font id="111">Django 1.8.2.</font></h1>
<div id="global-nav">
<a href="../index.html" title="Home page">Home</a>  |
        <a href="../contents.html" title="Table of contents">Table of contents</a>  |
        <a href="../genindex.html" title="Global index">Index</a>  |
        <a href="../py-modindex.html" title="Module index">Modules</a>
</div>
<div class="nav">
    « <a href="contrib/webdesign.html" title="django.contrib.webdesign">previous</a>
     |
    <a accesskey="U" href="index.html" title="API Reference">up</a>
   |
    <a href="databases.html" title="Databases">next</a> »</div>
</div>
<div id="bd">
<div id="yui-main">
<div class="yui-b">
<div class="yui-g" id="ref-csrf">
<div class="section" id="s-module-django.middleware.csrf">
<span id="s-cross-site-request-forgery-protection"></span><span id="module-django.middleware.csrf"></span><span id="cross-site-request-forgery-protection"></span><h1><font id="112">跨站请求伪造保护</font><a class="headerlink" href="csrf.html#module-django.middleware.csrf" title="Permalink to this headline">¶</a></h1>
<p><font id="1">The CSRF middleware and template tag provides easy-to-use protection against <a class="reference external" href="http://www.squarefree.com/securitytips/web-developers.html#CSRF">Cross Site Request Forgeries</a>. </font><font id="2">This type of attack occurs when a malicious Web site contains a link, a form button or some JavaScript that is intended to perform some action on your Web site, using the credentials of a logged-in user who visits the malicious site in their browser. </font><font id="3">A related type of attack, ‘login CSRF’, where an attacking site tricks a user’s browser into logging into a site with someone else’s credentials, is also covered.</font></p>
<p><font id="4">The first defense against CSRF attacks is to ensure that GET requests (and other ‘safe’ methods, as defined by 9.1.1 Safe Methods, HTTP 1.1, <span class="target" id="index-0"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc2616.html#section-9.1.1"><strong>RFC 2616</strong></a>) are side-effect free. </font><font id="5">Requests via ‘unsafe’ methods, such as POST, PUT and DELETE, can then be protected by following the steps below.</font></p>
<div class="section" id="s-how-to-use-it">
<span id="s-using-csrf"></span><span id="how-to-use-it"></span><span id="using-csrf"></span><h2><font id="113">How to use it</font><a class="headerlink" href="csrf.html#how-to-use-it" title="Permalink to this headline">¶</a></h2>
<p><font id="6">To take advantage of CSRF protection in your views, follow these steps:</font></p>
<ol class="arabic">
<li><p class="first"><font id="7">The CSRF middleware is activated by default in the <a class="reference internal" href="settings.html#std:setting-MIDDLEWARE_CLASSES"><tt class="xref std std-setting docutils literal"><span class="pre">MIDDLEWARE_CLASSES</span></tt></a> setting. </font><font id="8">If you override that setting, remember that <tt class="docutils literal"><span class="pre">'django.middleware.csrf.CsrfViewMiddleware'</span></tt> should come before any view middleware that assume that CSRF attacks have been dealt with.</font></p>
<p><font id="9">If you disabled it, which is not recommended, you can use <a class="reference internal" href="csrf.html#django.views.decorators.csrf.csrf_protect" title="django.views.decorators.csrf.csrf_protect"><tt class="xref py py-func docutils literal"><span class="pre">csrf_protect()</span></tt></a> on particular views you want to protect (see below).</font></p>
</li>
<li><p class="first"><font id="10">In any template that uses a POST form, use the <a class="reference internal" href="templates/builtins.html#std:templatetag-csrf_token"><tt class="xref std std-ttag docutils literal"><span class="pre">csrf_token</span></tt></a> tag inside the <tt class="docutils literal"><span class="pre">&lt;form&gt;</span></tt> element if the form is for an internal URL, e.g.:</font></p>
<div class="highlight-python"><div class="highlight"><pre>&lt;form action="." method="post"&gt;
</pre></div>
</div>
<p><font id="11">This should not be done for POST forms that target external URLs, since that would cause the CSRF token to be leaked, leading to a vulnerability.</font></p>
</li>
<li><p class="first"><font id="12">In the corresponding view functions, ensure that the <tt class="docutils literal"><span class="pre">'django.template.context_processors.csrf'</span></tt> context processor is being used. </font><font id="13">Usually, this can be done in one of two ways:</font></p>
<ol class="arabic">
<li><p class="first"><font id="14">Use RequestContext, which always uses <tt class="docutils literal"><span class="pre">'django.template.context_processors.csrf'</span></tt> (no matter what template context processors are configured in the <a class="reference internal" href="settings.html#std:setting-TEMPLATES"><tt class="xref std std-setting docutils literal"><span class="pre">TEMPLATES</span></tt></a> setting). </font><font id="15">If you are using generic views or contrib apps, you are covered already, since these apps use RequestContext throughout.</font></p>
</li>
<li><p class="first"><font id="16">Manually import and use the processor to generate the CSRF token and add it to the template context. </font><font id="17">e.g.:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span>
<span class="kn">from</span> <span class="nn">django.template.context_processors</span> <span class="kn">import</span> <span class="n">csrf</span>

<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">c</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">csrf</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="c"># ... view code here</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">"a_template.html"</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="18">You may want to write your own <a class="reference internal" href="../topics/http/shortcuts.html#django.shortcuts.render_to_response" title="django.shortcuts.render_to_response"><tt class="xref py py-func docutils literal"><span class="pre">render_to_response()</span></tt></a> wrapper that takes care of this step for you.</font></p>
</li>
</ol>
</li>
</ol>
<div class="section" id="s-ajax">
<span id="s-csrf-ajax"></span><span id="ajax"></span><span id="csrf-ajax"></span><h3><font id="122">AJAX</font><a class="headerlink" href="csrf.html#ajax" title="Permalink to this headline">¶</a></h3>
<p><font id="19">While the above method can be used for AJAX POST requests, it has some inconveniences: you have to remember to pass the CSRF token in as POST data with every POST request. </font><font id="20">For this reason, there is an alternative method: on each XMLHttpRequest, set a custom <tt class="docutils literal"><span class="pre">X-CSRFToken</span></tt> header to the value of the CSRF token. </font><font id="21">This is often easier, because many JavaScript frameworks provide hooks that allow headers to be set on every request.</font></p>
<p><font id="22">As a first step, you must get the CSRF token itself. </font><font id="23">The recommended source for the token is the <tt class="docutils literal"><span class="pre">csrftoken</span></tt> cookie, which will be set if you’ve enabled CSRF protection for your views as outlined above.</font></p>
<div class="admonition note">
<p class="first admonition-title"><font id="24">Note</font></p>
<p class="last"><font id="25">The CSRF token cookie is named <tt class="docutils literal"><span class="pre">csrftoken</span></tt> by default, but you can control the cookie name via the <a class="reference internal" href="settings.html#std:setting-CSRF_COOKIE_NAME"><tt class="xref std std-setting docutils literal"><span class="pre">CSRF_COOKIE_NAME</span></tt></a> setting.</font></p>
</div>
<p><font id="26">Acquiring the token is straightforward:</font></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// using jQuery</span>
<span class="kd">function</span> <span class="nx">getCookie</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">cookieValue</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">!=</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">cookies</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">';'</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">cookies</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">cookie</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">cookies</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="c1">// Does this cookie string begin with the name we want?</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">name</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">'='</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">cookieValue</span> <span class="o">=</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">cookieValue</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">csrftoken</span> <span class="o">=</span> <span class="nx">getCookie</span><span class="p">(</span><span class="s1">'csrftoken'</span><span class="p">);</span>
</pre></div>
</div>
<p><font id="27">The above code could be simplified by using the <a class="reference external" href="http://plugins.jquery.com/cookie/">jQuery cookie plugin</a> to replace <tt class="docutils literal"><span class="pre">getCookie</span></tt>:</font></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">csrftoken</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">'csrftoken'</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title"><font id="28">Note</font></p>
<p class="last"><font id="29">The CSRF token is also present in the DOM, but only if explicitly included using <a class="reference internal" href="templates/builtins.html#std:templatetag-csrf_token"><tt class="xref std std-ttag docutils literal"><span class="pre">csrf_token</span></tt></a> in a template. </font><font id="30">The cookie contains the canonical token; </font><font id="31">the <tt class="docutils literal"><span class="pre">CsrfViewMiddleware</span></tt> will prefer the cookie to the token in the DOM. Regardless, you’re guaranteed to have the cookie if the token is present in the DOM, so you should use the cookie!</font></p>
</div>
<div class="admonition warning">
<p class="first admonition-title"><font id="32">Warning</font></p>
<p class="last"><font id="33">If your view is not rendering a template containing the <a class="reference internal" href="templates/builtins.html#std:templatetag-csrf_token"><tt class="xref std std-ttag docutils literal"><span class="pre">csrf_token</span></tt></a> template tag, Django might not set the CSRF token cookie. </font><font id="34">This is common in cases where forms are dynamically added to the page. </font><font id="35">To address this case, Django provides a view decorator which forces setting of the cookie: <a class="reference internal" href="csrf.html#django.views.decorators.csrf.ensure_csrf_cookie" title="django.views.decorators.csrf.ensure_csrf_cookie"><tt class="xref py py-func docutils literal"><span class="pre">ensure_csrf_cookie()</span></tt></a>.</font></p>
</div>
<p><font id="36">Finally, you’ll have to actually set the header on your AJAX request, while protecting the CSRF token from being sent to other domains using <a class="reference external" href="http://api.jquery.com/jQuery.ajax">settings.crossDomain</a> in jQuery 1.5.1 and newer:</font></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">csrfSafeMethod</span><span class="p">(</span><span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// these HTTP methods do not require CSRF protection</span>
    <span class="k">return</span> <span class="p">(</span><span class="sr">/^(GET|HEAD|OPTIONS|TRACE)$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">method</span><span class="p">));</span>
<span class="p">}</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajaxSetup</span><span class="p">({</span>
    <span class="nx">beforeSend</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">settings</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">csrfSafeMethod</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">crossDomain</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">"X-CSRFToken"</span><span class="p">,</span> <span class="nx">csrftoken</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="s-other-template-engines">
<span id="other-template-engines"></span><h3><font id="123">Other template engines</font><a class="headerlink" href="csrf.html#other-template-engines" title="Permalink to this headline">¶</a></h3>
<p><font id="37">When using a different template engine than Django’s built-in engine, you can set the token in your forms manually after making sure it’s available in the template context.</font></p>
<p><font id="38">For example, in the Jinja2 template language, your form could contain the following:</font></p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"display:none"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"csrfmiddlewaretoken"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p><font id="39">You can use JavaScript similar to the <a class="reference internal" href="csrf.html#csrf-ajax"><em>AJAX code</em></a> above to get the value of the CSRF token.</font></p>
</div>
<div class="section" id="s-module-django.views.decorators.csrf">
<span id="s-the-decorator-method"></span><span id="module-django.views.decorators.csrf"></span><span id="the-decorator-method"></span><h3><font id="124">The decorator method</font><a class="headerlink" href="csrf.html#module-django.views.decorators.csrf" title="Permalink to this headline">¶</a></h3>
<p><font id="40">Rather than adding <tt class="docutils literal"><span class="pre">CsrfViewMiddleware</span></tt> as a blanket protection, you can use the <tt class="docutils literal"><span class="pre">csrf_protect</span></tt> decorator, which has exactly the same functionality, on particular views that need the protection. </font><font id="41">It must be used <strong>both</strong> on views that insert the CSRF token in the output, and on those that accept the POST form data. </font><font id="42">(These are often the same view function, but not always).</font></p>
<p><font id="43">Use of the decorator by itself is <strong>not recommended</strong>, since if you forget to use it, you will have a security hole. </font><font id="44">The ‘belt and braces’ strategy of using both is fine, and will incur minimal overhead.</font></p>
<dl class="function">
<dt id="django.views.decorators.csrf.csrf_protect">
<tt class="descname">csrf_protect</tt>(<em>view</em>)<a class="headerlink" href="csrf.html#django.views.decorators.csrf.csrf_protect" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="45">Decorator that provides the protection of <tt class="docutils literal"><span class="pre">CsrfViewMiddleware</span></tt> to a view.</font></p>
<p><font id="46">Usage:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.views.decorators.csrf</span> <span class="kn">import</span> <span class="n">csrf_protect</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="nd">@csrf_protect</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c"># ...</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">"a_template.html"</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p><font id="47">If you are using class-based views, you can refer to <a class="reference internal" href="../topics/class-based-views/intro.html#id2"><em>Decorating class-based views</em></a>.</font></p>
</dd></dl>
</div>
</div>
<div class="section" id="s-rejected-requests">
<span id="rejected-requests"></span><h2><font id="114">Rejected requests</font><a class="headerlink" href="csrf.html#rejected-requests" title="Permalink to this headline">¶</a></h2>
<p><font id="48">By default, a ‘403 Forbidden’ response is sent to the user if an incoming request fails the checks performed by <tt class="docutils literal"><span class="pre">CsrfViewMiddleware</span></tt>. </font><font id="49">This should usually only be seen when there is a genuine Cross Site Request Forgery, or when, due to a programming error, the CSRF token has not been included with a POST form.</font></p>
<p><font id="50">The error page, however, is not very friendly, so you may want to provide your own view for handling this condition. </font><font id="51">To do this, simply set the <a class="reference internal" href="settings.html#std:setting-CSRF_FAILURE_VIEW"><tt class="xref std std-setting docutils literal"><span class="pre">CSRF_FAILURE_VIEW</span></tt></a> setting.</font></p>
</div>
<div class="section" id="s-how-it-works">
<span id="s-how-csrf-works"></span><span id="how-it-works"></span><span id="how-csrf-works"></span><h2><font id="115">How it works</font><a class="headerlink" href="csrf.html#how-it-works" title="Permalink to this headline">¶</a></h2>
<p><font id="52">The CSRF protection is based on the following things:</font></p>
<ol class="arabic">
<li><p class="first"><font id="53">A CSRF cookie that is set to a random value (a session independent nonce, as it is called), which other sites will not have access to.</font></p>
<p><font id="54">This cookie is set by <tt class="docutils literal"><span class="pre">CsrfViewMiddleware</span></tt>. </font><font id="55">It is meant to be permanent, but since there is no way to set a cookie that never expires, it is sent with every response that has called <tt class="docutils literal"><span class="pre">django.middleware.csrf.get_token()</span></tt> (the function used internally to retrieve the CSRF token).</font></p>
</li>
<li><p class="first"><font id="56">A hidden form field with the name ‘csrfmiddlewaretoken’ present in all outgoing POST forms. </font><font id="57">The value of this field is the value of the CSRF cookie.</font></p>
<p><font id="58">This part is done by the template tag.</font></p>
</li>
<li><p class="first"><font id="59">For all incoming requests that are not using HTTP GET, HEAD, OPTIONS or TRACE, a CSRF cookie must be present, and the ‘csrfmiddlewaretoken’ field must be present and correct. </font><font id="60">If it isn’t, the user will get a 403 error.</font></p>
<p><font id="61">This check is done by <tt class="docutils literal"><span class="pre">CsrfViewMiddleware</span></tt>.</font></p>
</li>
<li><p class="first"><font id="62">In addition, for HTTPS requests, strict referer checking is done by <tt class="docutils literal"><span class="pre">CsrfViewMiddleware</span></tt>. </font><font id="63">This is necessary to address a Man-In-The-Middle attack that is possible under HTTPS when using a session independent nonce, due to the fact that HTTP ‘Set-Cookie’ headers are (unfortunately) accepted by clients that are talking to a site under HTTPS. </font><font id="64">(Referer checking is not done for HTTP requests because the presence of the Referer header is not reliable enough under HTTP.)</font></p>
</li>
</ol>
<p><font id="65">This ensures that only forms that have originated from your Web site can be used to POST data back.</font></p>
<p><font id="66">It deliberately ignores GET requests (and other requests that are defined as ‘safe’ by <span class="target" id="index-1"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc2616.html"><strong>RFC 2616</strong></a>). </font><font id="67">These requests ought never to have any potentially dangerous side effects , and so a CSRF attack with a GET request ought to be harmless. </font><font id="68"><span class="target" id="index-2"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc2616.html"><strong>RFC 2616</strong></a> defines POST, PUT and DELETE as ‘unsafe’, and all other methods are assumed to be unsafe, for maximum protection.</font></p>
</div>
<div class="section" id="s-caching">
<span id="caching"></span><h2><font id="116">Caching</font><a class="headerlink" href="csrf.html#caching" title="Permalink to this headline">¶</a></h2>
<p><font id="69">If the <a class="reference internal" href="templates/builtins.html#std:templatetag-csrf_token"><tt class="xref std std-ttag docutils literal"><span class="pre">csrf_token</span></tt></a> template tag is used by a template (or the <tt class="docutils literal"><span class="pre">get_token</span></tt> function is called some other way), <tt class="docutils literal"><span class="pre">CsrfViewMiddleware</span></tt> will add a cookie and a <tt class="docutils literal"><span class="pre">Vary:</span> <span class="pre">Cookie</span></tt> header to the response. </font><font id="70">This means that the middleware will play well with the cache middleware if it is used as instructed (<tt class="docutils literal"><span class="pre">UpdateCacheMiddleware</span></tt> goes before all other middleware).</font></p>
<p><font id="71">However, if you use cache decorators on individual views, the CSRF middleware will not yet have been able to set the Vary header or the CSRF cookie, and the response will be cached without either one. </font><font id="72">In this case, on any views that will require a CSRF token to be inserted you should use the <a class="reference internal" href="csrf.html#django.views.decorators.csrf.csrf_protect" title="django.views.decorators.csrf.csrf_protect"><tt class="xref py py-func docutils literal"><span class="pre">django.views.decorators.csrf.csrf_protect()</span></tt></a> decorator first:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.views.decorators.cache</span> <span class="kn">import</span> <span class="n">cache_page</span>
<span class="kn">from</span> <span class="nn">django.views.decorators.csrf</span> <span class="kn">import</span> <span class="n">csrf_protect</span>

<span class="nd">@cache_page</span><span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">15</span><span class="p">)</span>
<span class="nd">@csrf_protect</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p><font id="73">If you are using class-based views, you can refer to <a class="reference internal" href="../topics/class-based-views/intro.html#id2"><em>Decorating class-based views</em></a>.</font></p>
</div>
<div class="section" id="s-testing">
<span id="testing"></span><h2><font id="117">Testing</font><a class="headerlink" href="csrf.html#testing" title="Permalink to this headline">¶</a></h2>
<p><font id="74">The <tt class="docutils literal"><span class="pre">CsrfViewMiddleware</span></tt> will usually be a big hindrance to testing view functions, due to the need for the CSRF token which must be sent with every POST request. </font><font id="75">For this reason, Django’s HTTP client for tests has been modified to set a flag on requests which relaxes the middleware and the <tt class="docutils literal"><span class="pre">csrf_protect</span></tt> decorator so that they no longer rejects requests. </font><font id="76">In every other respect (e.g. sending cookies etc.), they behave the same.</font></p>
<p><font id="77">If, for some reason, you <em>want</em> the test client to perform CSRF checks, you can create an instance of the test client that enforces CSRF checks:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">csrf_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">enforce_csrf_checks</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-limitations">
<span id="s-csrf-limitations"></span><span id="limitations"></span><span id="csrf-limitations"></span><h2><font id="118">Limitations</font><a class="headerlink" href="csrf.html#limitations" title="Permalink to this headline">¶</a></h2>
<p><font id="78">Subdomains within a site will be able to set cookies on the client for the whole domain. </font><font id="79">By setting the cookie and using a corresponding token, subdomains will be able to circumvent the CSRF protection. </font><font id="80">The only way to avoid this is to ensure that subdomains are controlled by trusted users (or, are at least unable to set cookies). </font><font id="81">Note that even without CSRF, there are other vulnerabilities, such as session fixation, that make giving subdomains to untrusted parties a bad idea, and these vulnerabilities cannot easily be fixed with current browsers.</font></p>
</div>
<div class="section" id="s-edge-cases">
<span id="edge-cases"></span><h2><font id="119">Edge cases</font><a class="headerlink" href="csrf.html#edge-cases" title="Permalink to this headline">¶</a></h2>
<p><font id="82">Certain views can have unusual requirements that mean they don’t fit the normal pattern envisaged here. </font><font id="83">A number of utilities can be useful in these situations. </font><font id="84">The scenarios they might be needed in are described in the following section.</font></p>
<div class="section" id="s-utilities">
<span id="utilities"></span><h3><font id="125">Utilities</font><a class="headerlink" href="csrf.html#utilities" title="Permalink to this headline">¶</a></h3>
<p><font id="85">The examples below assume you are using function-based views. </font><font id="86">If you are working with class-based views, you can refer to <a class="reference internal" href="../topics/class-based-views/intro.html#id2"><em>Decorating class-based views</em></a>.</font></p>
<dl class="function">
<dt id="django.views.decorators.csrf.csrf_exempt">
<tt class="descname">csrf_exempt</tt>(<em>view</em>)<a class="reference internal" href="http://python.usyiyi.cn/django/_modules/django/views/decorators/csrf.html#csrf_exempt"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="csrf.html#django.views.decorators.csrf.csrf_exempt" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="87">This decorator marks a view as being exempt from the protection ensured by the middleware. </font><font id="88">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.views.decorators.csrf</span> <span class="kn">import</span> <span class="n">csrf_exempt</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="nd">@csrf_exempt</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">'Hello world'</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="django.views.decorators.csrf.requires_csrf_token">
<tt class="descname">requires_csrf_token</tt>(<em>view</em>)<a class="headerlink" href="csrf.html#django.views.decorators.csrf.requires_csrf_token" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="89">Normally the <a class="reference internal" href="templates/builtins.html#std:templatetag-csrf_token"><tt class="xref std std-ttag docutils literal"><span class="pre">csrf_token</span></tt></a> template tag will not work if <tt class="docutils literal"><span class="pre">CsrfViewMiddleware.process_view</span></tt> or an equivalent like <tt class="docutils literal"><span class="pre">csrf_protect</span></tt> has not run. </font><font id="90">The view decorator <tt class="docutils literal"><span class="pre">requires_csrf_token</span></tt> can be used to ensure the template tag does work. </font><font id="91">This decorator works similarly to <tt class="docutils literal"><span class="pre">csrf_protect</span></tt>, but never rejects an incoming request.</font></p>
<p><font id="92">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.views.decorators.csrf</span> <span class="kn">import</span> <span class="n">requires_csrf_token</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="nd">@requires_csrf_token</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c"># ...</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">"a_template.html"</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>
<dl class="function">
<dt id="django.views.decorators.csrf.ensure_csrf_cookie">
<tt class="descname">ensure_csrf_cookie</tt>(<em>view</em>)<a class="headerlink" href="csrf.html#django.views.decorators.csrf.ensure_csrf_cookie" title="Permalink to this definition">¶</a></dt>
<dd><p><font id="93">This decorator forces a view to send the CSRF cookie.</font></p>
</dd></dl>
</div>
<div class="section" id="s-scenarios">
<span id="scenarios"></span><h3><font id="126">Scenarios</font><a class="headerlink" href="csrf.html#scenarios" title="Permalink to this headline">¶</a></h3>
<div class="section" id="s-csrf-protection-should-be-disabled-for-just-a-few-views">
<span id="csrf-protection-should-be-disabled-for-just-a-few-views"></span><h4><font id="133">CSRF protection should be disabled for just a few views</font><a class="headerlink" href="csrf.html#csrf-protection-should-be-disabled-for-just-a-few-views" title="Permalink to this headline">¶</a></h4>
<p><font id="94">Most views requires CSRF protection, but a few do not.</font></p>
<p><font id="95">Solution: rather than disabling the middleware and applying <tt class="docutils literal"><span class="pre">csrf_protect</span></tt> to all the views that need it, enable the middleware and use <a class="reference internal" href="csrf.html#django.views.decorators.csrf.csrf_exempt" title="django.views.decorators.csrf.csrf_exempt"><tt class="xref py py-func docutils literal"><span class="pre">csrf_exempt()</span></tt></a>.</font></p>
</div>
<div class="section" id="s-csrfviewmiddleware-process-view-not-used">
<span id="csrfviewmiddleware-process-view-not-used"></span><h4><font id="134">CsrfViewMiddleware.process_view not used</font><a class="headerlink" href="csrf.html#csrfviewmiddleware-process-view-not-used" title="Permalink to this headline">¶</a></h4>
<p><font id="96">There are cases when <tt class="docutils literal"><span class="pre">CsrfViewMiddleware.process_view</span></tt> may not have run before your view is run - 404 and 500 handlers, for example - but you still need the CSRF token in a form.</font></p>
<p><font id="97">Solution: use <a class="reference internal" href="csrf.html#django.views.decorators.csrf.requires_csrf_token" title="django.views.decorators.csrf.requires_csrf_token"><tt class="xref py py-func docutils literal"><span class="pre">requires_csrf_token()</span></tt></a></font></p>
</div>
<div class="section" id="s-unprotected-view-needs-the-csrf-token">
<span id="unprotected-view-needs-the-csrf-token"></span><h4><font id="135">Unprotected view needs the CSRF token</font><a class="headerlink" href="csrf.html#unprotected-view-needs-the-csrf-token" title="Permalink to this headline">¶</a></h4>
<p><font id="98">There may be some views that are unprotected and have been exempted by <tt class="docutils literal"><span class="pre">csrf_exempt</span></tt>, but still need to include the CSRF token.</font></p>
<p><font id="99">Solution: use <a class="reference internal" href="csrf.html#django.views.decorators.csrf.csrf_exempt" title="django.views.decorators.csrf.csrf_exempt"><tt class="xref py py-func docutils literal"><span class="pre">csrf_exempt()</span></tt></a> followed by <a class="reference internal" href="csrf.html#django.views.decorators.csrf.requires_csrf_token" title="django.views.decorators.csrf.requires_csrf_token"><tt class="xref py py-func docutils literal"><span class="pre">requires_csrf_token()</span></tt></a>. </font><font id="100">(i.e. <tt class="docutils literal"><span class="pre">requires_csrf_token</span></tt> should be the innermost decorator).</font></p>
</div>
<div class="section" id="s-view-needs-protection-for-one-path">
<span id="view-needs-protection-for-one-path"></span><h4><font id="136">View needs protection for one path</font><a class="headerlink" href="csrf.html#view-needs-protection-for-one-path" title="Permalink to this headline">¶</a></h4>
<p><font id="101">A view needs CSRF protection under one set of conditions only, and mustn’t have it for the rest of the time.</font></p>
<p><font id="102">Solution: use <a class="reference internal" href="csrf.html#django.views.decorators.csrf.csrf_exempt" title="django.views.decorators.csrf.csrf_exempt"><tt class="xref py py-func docutils literal"><span class="pre">csrf_exempt()</span></tt></a> for the whole view function, and <a class="reference internal" href="csrf.html#django.views.decorators.csrf.csrf_protect" title="django.views.decorators.csrf.csrf_protect"><tt class="xref py py-func docutils literal"><span class="pre">csrf_protect()</span></tt></a> for the path within it that needs protection. </font><font id="103">Example:</font></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.views.decorators.csrf</span> <span class="kn">import</span> <span class="n">csrf_exempt</span><span class="p">,</span> <span class="n">csrf_protect</span>

<span class="nd">@csrf_exempt</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="nd">@csrf_protect</span>
    <span class="k">def</span> <span class="nf">protected_path</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
        <span class="n">do_something</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">some_condition</span><span class="p">():</span>
       <span class="k">return</span> <span class="n">protected_path</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="n">do_something_else</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="s-page-uses-ajax-without-any-html-form">
<span id="page-uses-ajax-without-any-html-form"></span><h4><font id="137">Page uses AJAX without any HTML form</font><a class="headerlink" href="csrf.html#page-uses-ajax-without-any-html-form" title="Permalink to this headline">¶</a></h4>
<p><font id="104">A page makes a POST request via AJAX, and the page does not have an HTML form with a <a class="reference internal" href="templates/builtins.html#std:templatetag-csrf_token"><tt class="xref std std-ttag docutils literal"><span class="pre">csrf_token</span></tt></a> that would cause the required CSRF cookie to be sent.</font></p>
<p><font id="105">Solution: use <a class="reference internal" href="csrf.html#django.views.decorators.csrf.ensure_csrf_cookie" title="django.views.decorators.csrf.ensure_csrf_cookie"><tt class="xref py py-func docutils literal"><span class="pre">ensure_csrf_cookie()</span></tt></a> on the view that sends the page.</font></p>
</div>
</div>
</div>
<div class="section" id="s-contrib-and-reusable-apps">
<span id="contrib-and-reusable-apps"></span><h2><font id="120">Contrib and reusable apps</font><a class="headerlink" href="csrf.html#contrib-and-reusable-apps" title="Permalink to this headline">¶</a></h2>
<p><font id="106">Because it is possible for the developer to turn off the <tt class="docutils literal"><span class="pre">CsrfViewMiddleware</span></tt>, all relevant views in contrib apps use the <tt class="docutils literal"><span class="pre">csrf_protect</span></tt> decorator to ensure the security of these applications against CSRF. </font><font id="107">It is recommended that the developers of other reusable apps that want the same guarantees also use the <tt class="docutils literal"><span class="pre">csrf_protect</span></tt> decorator on their views.</font></p>
</div>
<div class="section" id="s-settings">
<span id="settings"></span><h2><font id="121">Settings</font><a class="headerlink" href="csrf.html#settings" title="Permalink to this headline">¶</a></h2>
<p><font id="108">A number of settings can be used to control Django’s CSRF behavior:</font></p>
<ul class="simple">
<li><a class="reference internal" href="settings.html#std:setting-CSRF_COOKIE_AGE"><font id="138">CSRF_COOKIE_AGE</font></a></li>
<li><a class="reference internal" href="settings.html#std:setting-CSRF_COOKIE_DOMAIN"><font id="139">CSRF_COOKIE_DOMAIN</font></a></li>
<li><a class="reference internal" href="settings.html#std:setting-CSRF_COOKIE_HTTPONLY"><font id="140">CSRF_COOKIE_HTTPONLY</font></a></li>
<li><a class="reference internal" href="settings.html#std:setting-CSRF_COOKIE_NAME"><font id="141">CSRF_COOKIE_NAME</font></a></li>
<li><a class="reference internal" href="settings.html#std:setting-CSRF_COOKIE_PATH"><font id="142">CSRF_COOKIE_PATH</font></a></li>
<li><a class="reference internal" href="settings.html#std:setting-CSRF_COOKIE_SECURE"><font id="143">CSRF_COOKIE_SECURE</font></a></li>
<li><a class="reference internal" href="settings.html#std:setting-CSRF_FAILURE_VIEW"><font id="144">CSRF_FAILURE_VIEW</font></a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="yui-b" id="sidebar">
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
<h3><font id="127">Table Of Contents</font></h3>
<ul>
<li><a class="reference internal" href="csrf.html#"><font id="145">Cross Site Request Forgery protection</font></a><ul>
<li><a class="reference internal" href="csrf.html#how-to-use-it"><font id="146">How to use it</font></a><ul>
<li><a class="reference internal" href="csrf.html#ajax"><font id="147">AJAX</font></a></li>
<li><a class="reference internal" href="csrf.html#other-template-engines"><font id="148">Other template engines</font></a></li>
<li><a class="reference internal" href="csrf.html#module-django.views.decorators.csrf"><font id="149">The decorator method</font></a></li>
</ul>
</li>
<li><a class="reference internal" href="csrf.html#rejected-requests"><font id="150">Rejected requests</font></a></li>
<li><a class="reference internal" href="csrf.html#how-it-works"><font id="151">How it works</font></a></li>
<li><a class="reference internal" href="csrf.html#caching"><font id="152">Caching</font></a></li>
<li><a class="reference internal" href="csrf.html#testing"><font id="153">Testing</font></a></li>
<li><a class="reference internal" href="csrf.html#limitations"><font id="154">Limitations</font></a></li>
<li><a class="reference internal" href="csrf.html#edge-cases"><font id="155">Edge cases</font></a><ul>
<li><a class="reference internal" href="csrf.html#utilities"><font id="156">Utilities</font></a></li>
<li><a class="reference internal" href="csrf.html#scenarios"><font id="157">Scenarios</font></a><ul>
<li><a class="reference internal" href="csrf.html#csrf-protection-should-be-disabled-for-just-a-few-views"><font id="158">CSRF protection should be disabled for just a few views</font></a></li>
<li><a class="reference internal" href="csrf.html#csrfviewmiddleware-process-view-not-used"><font id="159">CsrfViewMiddleware.process_view not used</font></a></li>
<li><a class="reference internal" href="csrf.html#unprotected-view-needs-the-csrf-token"><font id="160">Unprotected view needs the CSRF token</font></a></li>
<li><a class="reference internal" href="csrf.html#view-needs-protection-for-one-path"><font id="161">View needs protection for one path</font></a></li>
<li><a class="reference internal" href="csrf.html#page-uses-ajax-without-any-html-form"><font id="162">Page uses AJAX without any HTML form</font></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="csrf.html#contrib-and-reusable-apps"><font id="163">Contrib and reusable apps</font></a></li>
<li><a class="reference internal" href="csrf.html#settings"><font id="164">Settings</font></a></li>
</ul>
</li>
</ul>
<h3><font id="128">Browse</font></h3>
<ul>
<li><font id="165">Prev: <a href="contrib/webdesign.html">django.contrib.webdesign</a></font></li>
<li><font id="166">Next: <a href="databases.html">Databases</a></font></li>
</ul>
<h3><font id="129">You are here:</font></h3>
<ul>
<li>
<a href="../index.html"><font id="167">Django 1.8.2.dev20150513143415 documentation</font></a>
<ul><li><a href="index.html"><font id="168">API Reference</font></a>
<ul><li><font id="169">Cross Site Request Forgery protection</font></li></ul>
</li></ul>
</li>
</ul>
<h3><font id="130">This Page</font></h3>
<ul class="this-page-menu">
<li><a href="http://python.usyiyi.cn/django/_sources/ref/csrf.txt" rel="nofollow"><font id="170">Show Source</font></a></li>
</ul>
<div id="searchbox" style="display: none">
<h3><font id="131">Quick search</font></h3>
<form action="http://python.usyiyi.cn/django/search.html" class="search" method="get">
<input name="q" type="text"/>
<input type="submit" value="Go"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
<p class="searchtip" style="font-size: 90%"><font id="109"> Enter search terms or a module, class or function name. </font></p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>
</div>
<h3><font id="132">Last update:</font></h3>
<p class="topless"><font id="110">May 13, 2015</font></p>
</div>
</div>
<div id="ft">
<div class="nav">
    « <a href="contrib/webdesign.html" title="django.contrib.webdesign">previous</a>
     |
    <a accesskey="U" href="index.html" title="API Reference">up</a>
   |
    <a href="databases.html" title="Databases">next</a> »</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div id="disqus_thread"></div><br>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'djangocn'; // required: replace example with your forum shortname
    var disqus_identifier = '/django/ref/csrf';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<link href="http://python.usyiyi.cn/django/_static/ms_translator.css" rel="stylesheet" type="text/css"/>
<script src="http://python.usyiyi.cn/django/_static/ms_translator.js" type="text/javascript"></script>
<script src="http://python.usyiyi.cn/django/_static/jquery-ui-1.9.2.custom.min.js" type="text/javascript"></script>
<div id="MicrosoftTranslator" style="display:none; position: absolute; z-index: 2147483647; margin: 0px; border: 2px solid rgb(210, 210, 210); padding: 0px; color: rgb(0, 0, 0); background-color: rgb(230, 230, 230); font-family: Arial,Helvetica,Sans-Serif; font-style: normal; font-variant: normal; font-weight: normal; font-size: 12px; line-height: normal; direction: ltr; text-align: left; left: 274px; top: 2048.03px; min-width: 400px;">
    <div id="MSTCClose" style="float: right;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/tooltip_close.gif">
      </a>
    </div>
    
    <div id="MSTCPopDown" style="float: right;" style="display: none;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/popdown.gif">
      </a>
    </div>
    <div id="MSTCPopUP" style="float: right;">
      <a style="display: inline-block; cursor: pointer; text-decoration: none; vertical-align: top; border: 0px none; padding: 4px;">
        <img src="http://python.usyiyi.cn/django/_static/popup.gif">
      </a>
    </div>
    
    <div id="MSTCTitle" style="margin: 4px 4px 8px; font-weight: bold;">原文
    </div>
    
    <div style="direction: ltr; text-align: left;">
      <span id="MSTCOrigion" style="display: inline-block; margin: 0px 4px 4px;"> </span>
    </div>
    
    <div id="MicrosoftTranslatorCommunity" class="MSTCltr">
      <div id="MSTCContent">
        <a id="MSTCExpandLink">
          <span id="MSTCImprove">改进翻译</span>
          <span id="MSTCSuggest">最小化</span>
          <img src="http://python.usyiyi.cn/django/_static/ctftoggledown.gif" id="MSTCToggleDown">
          <img src="http://python.usyiyi.cn/django/_static/ctftoggleup.gif" id="MSTCToggleUp">
        </a>
        <div id="MSTCRootPanel">
          <span id="MSTCLoading" style="display: none;">正在加载...</span>
          <div style="display: none;" id="MSTCTransPanelError">
            <div class="MSTCTableRow">
              <div class="MSTCTransPanelExc MSTCTableCell">
                <img style="border-width:0px;" src="http://python.usyiyi.cn/django/_static/error_exclamation.gif" id="ExclamationImage">
              </div>
              <div class="MSTCTableCell">
                <span id="MSTCTransPanelErrorMsg"></span>
              </div>
            </div>
            <div class="MSTCTableRow">
              <div class="MSTCTableCell"></div>
              <div class="MSTCTableCell MSTCFlipHoriz">
                <input type="image" style="border-width:0px;" src="http://python.usyiyi.cn/django/_static/error_OK.gif" class="MSTCErrorButtons" id="MSTCOKImgBtn" name="MSTCOKImgBtn">
              </div>
            </div>
          </div>
          
          <div id="MSTCTransPanel">
          </div>
          
          <div id="MSTCPrevNextPanel">
            <a id="MSTCPrevLink" style='border-right-width: 1px;border-right-style: solid;padding-right: 5px;'>
              <span>上一页</span>
            </a>
            <a style='color: black; border-right-width: 1px;border-right-style: solid;padding-right: 5px;'>
              <span>第</span>
              <span id="MSTCPage"></span>
              <span>页</span>
            </a>
            <a id="MSTCNextLink" style='padding-left: 5px;'>
              <span>下一页</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>
</html>